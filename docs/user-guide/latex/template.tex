\documentclass[11pt,openany]{$documentclass$}

% ============================================================================
% PACKAGES
% ============================================================================

% Font and encoding (XeLaTeX â€” native Unicode support)
\usepackage{fontspec}
\setmainfont{Latin Modern Roman}
\setsansfont{Latin Modern Sans}
\setmonofont{DejaVu Sans Mono}[Scale=0.85]
\usepackage{microtype}

% Layout
\usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{parskip}

% Colors
\usepackage[dvipsnames]{xcolor}
\definecolor{codered}{HTML}{DC3545}
\definecolor{codeblue}{HTML}{0066CC}
\definecolor{codegray}{HTML}{6C757D}
\definecolor{codegreen}{HTML}{28A745}
\definecolor{codeyellow}{HTML}{FFC107}
\definecolor{lightgray}{HTML}{F8F9FA}

% Graphics
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{svg}

% Tables
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{tabularx}
\usepackage{array}

% Lists
\usepackage{enumitem}

% Environment hooks (keep verbatim blocks on one page)
\usepackage{etoolbox}
\BeforeBeginEnvironment{verbatim}{\begin{minipage}{\linewidth}}
\AfterEndEnvironment{verbatim}{\end{minipage}}

% Code listings
\usepackage{listings}

% Hyperlinks
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=$if(linkcolor)$$linkcolor$$else$blue$endif$,
    urlcolor=$if(urlcolor)$$urlcolor$$else$blue$endif$,
    citecolor=blue,
    pdftitle={$title$},
    pdfauthor={$author$},
    pdfsubject={User Guide},
    pdfkeywords={Jaato, AI, Documentation}
}
% Better references
\usepackage{varioref}
\usepackage[nameinlink]{cleveref}

% Captions
\usepackage{caption}
\captionsetup{
    font=small,
    labelfont=bf,
    format=plain,
    justification=centering
}

% Appendix
\usepackage[titletoc]{appendix}

% ============================================================================
% CODE LISTING SETUP
% ============================================================================

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{lightgray},
    commentstyle=\color{codegray}\itshape,
    keywordstyle=\color{codeblue}\bfseries,
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codegreen},
    basicstyle=\ttfamily\small,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=8pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    frame=single,
    rulecolor=\color{codegray}
}

\lstset{style=mystyle}

% Language definitions
\lstdefinelanguage{bash}{
    keywords={if, then, else, fi, for, while, do, done, case, esac, function, export, source},
    keywordstyle=\color{codeblue}\bfseries,
    ndkeywords={echo, cd, ls, mkdir, rm, cp, mv, cat, grep, sed, awk},
    ndkeywordstyle=\color{codeyellow}\bfseries,
    sensitive=true,
    comment=[l]{\#},
    commentstyle=\color{codegray}\itshape,
    string=[b]",
    string=[b]',
    stringstyle=\color{codegreen}
}

\lstdefinelanguage{json}{
    string=[s]{"}{"},
    comment=[l]{//},
    commentstyle=\color{codegray}\itshape,
    morestring=[b]',
    stringstyle=\color{codegreen},
    keywords={true, false, null},
    keywordstyle=\color{codeblue}\bfseries
}

% ============================================================================
% CUSTOM COMMANDS
% ============================================================================

% Pandoc tight list support
\providecommand{\tightlist}{\setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Keyboard shortcuts
\newcommand{\keys}[1]{\texttt{\textbf{#1}}}

% Environment variables
\newcommand{\envvar}[1]{\texttt{\textdollar #1}}

% File paths
\newcommand{\filepath}[1]{\texttt{#1}}

% Commands
\newcommand{\cmd}[1]{\texttt{#1}}

% Menu items
\newcommand{\menu}[1]{\textsf{#1}}

% Callout boxes
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}

\newtcolorbox{tipbox}{
    colback=codeblue!5,
    colframe=codeblue,
    title=Tip,
    fonttitle=\bfseries,
    breakable,
    enhanced jigsaw
}

\newtcolorbox{warningbox}{
    colback=codeyellow!5,
    colframe=codeyellow,
    title=Warning,
    fonttitle=\bfseries,
    breakable,
    enhanced jigsaw
}

\newtcolorbox{dangerbox}{
    colback=codered!5,
    colframe=codered,
    title=Important,
    fonttitle=\bfseries,
    breakable,
    enhanced jigsaw
}

\newtcolorbox{notebox}{
    colback=codegray!5,
    colframe=codegray,
    title=Note,
    fonttitle=\bfseries,
    breakable,
    enhanced jigsaw
}

% ============================================================================
% HEADER/FOOTER SETUP
% ============================================================================

\setlength{\headheight}{14pt}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\nouppercase{\leftmark}}
\fancyhead[LO]{\nouppercase{\rightmark}}
\renewcommand{\headrulewidth}{0.4pt}

% Plain style for chapter pages
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
}

% ============================================================================
% TITLE FORMATTING
% ============================================================================

\titleformat{\chapter}[display]
    {\normalfont\huge\bfseries\color{codeblue}}
    {\chaptertitlename\ \thechapter}
    {20pt}
    {\Huge}

\titleformat{\section}
    {\normalfont\Large\bfseries\color{codeblue}}
    {\thesection}
    {1em}
    {}

\titleformat{\subsection}
    {\normalfont\large\bfseries\color{codeblue!80}}
    {\thesubsection}
    {1em}
    {}

% ============================================================================
% TABLE OF CONTENTS
% ============================================================================

\setcounter{tocdepth}{$if(toc-depth)$$toc-depth$$else$3$endif$}

% ============================================================================
% METADATA
% ============================================================================

$if(title)$
\title{\Huge\bfseries $title$}
$endif$

$if(author)$
\author{$author$}
$endif$

$if(date)$
\date{$date$}
$endif$

% ============================================================================
% DOCUMENT
% ============================================================================

\begin{document}

% Title page
$if(title)$
\begin{titlepage}
\centering
\vspace*{2cm}

{\Huge\bfseries $title$\par}
\vspace{1cm}
{\Large Version 1.0\par}
\vspace{2cm}
{\Large $if(author)$$author$$endif$\par}
\vfill
{\large \today\par}

$if(logo)$
\vspace{1cm}
\includegraphics[width=0.3\textwidth]{$logo$}
$endif$

\end{titlepage}
$endif$

% Abstract/Preface
\chapter*{Preface}
\addcontentsline{toc}{chapter}{Preface}

This user guide provides comprehensive documentation for the Jaato rich client,
an interactive terminal user interface for working with AI models through the
Jaato framework.

This guide covers everything from installation and basic usage to advanced features
and customization. Whether you're a beginner getting started with Jaato or an
experienced user looking to leverage advanced features, this guide will help you
make the most of the rich client.

\paragraph{Who This Guide Is For}
This guide is designed for both beginners and advanced users who want to use the
Jaato rich client for AI-assisted development and conversation.

\paragraph{Conventions Used}
Throughout this guide, we use the following conventions:
\begin{itemize}
    \item \cmd{Commands} are shown in monospaced font
    \item \keys{Ctrl+C} represents keyboard shortcuts
    \item \envvar{ENVIRONMENT\_VARIABLES} are prefixed with \textdollar
    \item \filepath{/file/paths} are shown in monospaced font
\end{itemize}

\vfill

% Table of Contents
$if(toc)$
\tableofcontents
\newpage
$endif$

% Main content
$body$

\end{document}
