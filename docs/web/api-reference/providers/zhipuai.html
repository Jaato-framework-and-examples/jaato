<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zhipu AI Provider - jaato docs</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
  <link rel="vcs-git" href="https://github.com/Jaato-framework-and-examples/jaato">
</head>
<body>
  <header class="header">
    <a href="../../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../../getting-started/quickstart.html">Quickstart</a>
      <a href="../index.html">API Reference</a>
      <a href="https://github.com/Jaato-framework-and-examples/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../../core-concepts/client.html">Client</a></li>
          <li><a href="../../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../../core-concepts/tools.html">Tools</a></li>
          <li><a href="../../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../index.html">Overview</a></li>
          <li><a href="../jaato-client.html">JaatoClient</a></li>
          <li><a href="../jaato-runtime.html">JaatoRuntime</a></li>
          <li><a href="../jaato-session.html">JaatoSession</a></li>
          <li><a href="../plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../tool-executor.html">ToolExecutor</a></li>
          <li><a href="../types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Provider Reference</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Overview</a></li>
          <li><a href="anthropic.html">Anthropic</a></li>
          <li><a href="google-genai.html">Google GenAI</a></li>
          <li><a href="github-models.html">GitHub Models</a></li>
          <li><a href="claude-cli.html">Claude CLI</a></li>
          <li><a href="antigravity.html">Antigravity</a></li>
          <li><a href="ollama.html">Ollama</a></li>
          <li><a href="zhipuai.html" class="active">Zhipu AI</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Plugin Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../plugins/index.html">Overview</a></li>
          <li><a href="../plugins/cli.html">CLI</a></li>
          <li><a href="../plugins/file-edit.html">File Edit</a></li>
          <li><a href="../plugins/filesystem-query.html">Filesystem Query</a></li>
          <li><a href="../plugins/todo.html">Todo</a></li>
          <li><a href="../plugins/web-search.html">Web Search</a></li>
          <li><a href="../plugins/mcp.html">MCP</a></li>
          <li><a href="../plugins/permission.html">Permission</a></li>
          <li><a href="../plugins/session.html">Session</a></li>
          <li><a href="../plugins/gc.html">GC</a></li>
          <li><a href="../plugins/other.html">Other Plugins</a></li>
        </ul>
      </div>
    </aside>

    <main class="main">
      <!-- Overview -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h1>Zhipu AI Provider</h1>
          <p class="lead">
            Access Zhipu AI's GLM family of models through the Anthropic-compatible
            API. Includes GLM-5, GLM-4.7 with native chain-of-thought reasoning,
            and cost-effective flash variants.
          </p>

          <table>
            <tbody>
              <tr><td><strong>Provider Name</strong></td><td><code>zhipuai</code></td></tr>
              <tr><td><strong>Module</strong></td><td><code>shared.plugins.model_provider.zhipuai</code></td></tr>
              <tr><td><strong>SDK</strong></td><td><code>anthropic</code> (Anthropic-compatible API)</td></tr>
              <tr><td><strong>Auth</strong></td><td>API key</td></tr>
            </tbody>
          </table>

          <h2 id="highlights">Highlights</h2>
          <ul>
            <li><strong>GLM-5</strong> - Flagship MoE model with agentic engineering focus</li>
            <li><strong>Extended thinking</strong> - Native chain-of-thought on GLM-5 and GLM-4.7</li>
            <li><strong>200K context</strong> - Large context windows on flagship models</li>
            <li><strong>Dynamic model discovery</strong> - New models appear automatically</li>
            <li><strong>Function calling</strong> - Full tool use support via Anthropic-compatible API</li>
          </ul>

          <div class="callout callout-info">
            <div class="callout-title">API Compatibility</div>
            Zhipu AI exposes an Anthropic-compatible API endpoint. The provider
            extends <code>AnthropicProvider</code> and inherits all message
            handling, streaming, and converter logic.
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">Quick start</div>
          <div class="code-block">
            <pre><code class="language-python">from jaato import JaatoClient

client = JaatoClient(provider_name="zhipuai")
client.connect(
    project=None,
    location=None,
    model="glm-5"
)
client.configure_tools(registry)

response = client.send_message(
    "Hello from GLM!",
    on_output=on_output
)</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">With extended thinking</div>
          <div class="code-block">
            <pre><code class="language-python">from shared import load_provider, ProviderConfig

provider = load_provider("zhipuai")
provider.initialize(ProviderConfig(
    api_key="your-key",
    extra={
        'enable_thinking': True,
        'thinking_budget': 10000
    }
))
provider.connect("glm-5")

response = provider.send_message("Complex question")
print(f"Thinking: {response.thinking}")
print(f"Answer: {response.text}")</code></pre>
          </div>
        </div>
      </section>

      <!-- Models -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="models">Available Models</h2>

          <h3>Flagship Models (200K context)</h3>
          <table>
            <thead>
              <tr><th>Model</th><th>Context</th><th>Thinking</th><th>Notes</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>glm-5</strong></td>
                <td>200K</td>
                <td>Yes</td>
                <td>Flagship MoE, agentic focus</td>
              </tr>
              <tr>
                <td><strong>glm-4.7</strong></td>
                <td>200K</td>
                <td>Yes</td>
                <td>Native chain-of-thought</td>
              </tr>
              <tr>
                <td><strong>glm-4.7-flash</strong></td>
                <td>200K</td>
                <td>No</td>
                <td>Fast inference</td>
              </tr>
              <tr>
                <td><strong>glm-4.7-flashx</strong></td>
                <td>200K</td>
                <td>No</td>
                <td>Ultra-fast inference</td>
              </tr>
              <tr>
                <td><strong>glm-4.6</strong></td>
                <td>200K</td>
                <td>No</td>
                <td>Previous flagship, strong coding</td>
              </tr>
            </tbody>
          </table>

          <h3>Balanced Models (128K context)</h3>
          <table>
            <thead>
              <tr><th>Model</th><th>Context</th><th>Notes</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>glm-4.5</strong></td>
                <td>128K</td>
                <td>Balanced reasoning and coding</td>
              </tr>
              <tr>
                <td><strong>glm-4.5-air</strong></td>
                <td>128K</td>
                <td>Lightweight, cost-effective</td>
              </tr>
              <tr>
                <td><strong>glm-4.5-airx</strong></td>
                <td>128K</td>
                <td>Lightweight variant</td>
              </tr>
              <tr>
                <td><strong>glm-4.5-flash</strong></td>
                <td>128K</td>
                <td>Free tier variant</td>
              </tr>
              <tr>
                <td><strong>glm-4.5-x</strong></td>
                <td>128K</td>
                <td>Extended variant</td>
              </tr>
            </tbody>
          </table>

          <div class="callout callout-info">
            <div class="callout-title">Dynamic Discovery</div>
            The provider automatically discovers new models via Z.AI's
            OpenAI-compatible <code>/models</code> endpoint. Newly released
            models appear without provider updates.
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">List available models</div>
          <div class="code-block">
            <pre><code class="language-python">provider = load_provider("zhipuai")
provider.initialize(ProviderConfig(api_key="your-key"))

# Dynamic discovery (queries Z.AI API)
models = provider.list_models()
print(models)
# ['glm-4.5', 'glm-4.5-air', 'glm-4.5-airx',
#  'glm-4.5-flash', 'glm-4.5-x', 'glm-4.6',
#  'glm-4.7', 'glm-4.7-flash', 'glm-4.7-flashx',
#  'glm-5']

# Filter by prefix
flash_models = provider.list_models(prefix="glm-4.7")
print(flash_models)
# ['glm-4.7', 'glm-4.7-flash', 'glm-4.7-flashx']</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Connect to a model</div>
          <div class="code-block">
            <pre><code class="language-python"># Flagship model with thinking
provider.connect("glm-5")

# Fast inference
provider.connect("glm-4.7-flash")

# Cost-effective
provider.connect("glm-4.5-flash")</code></pre>
          </div>
        </div>
      </section>

      <!-- Authentication -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="authentication">Authentication</h2>
          <p>
            Zhipu AI uses API key authentication. Keys can be obtained from
            the Z.AI platform.
          </p>

          <h3>Get Your API Key</h3>
          <ul>
            <li><strong>International:</strong> <a href="https://z.ai/model-api" target="_blank">z.ai/model-api</a></li>
            <li><strong>China:</strong> <a href="https://open.bigmodel.cn/" target="_blank">open.bigmodel.cn</a></li>
          </ul>

          <h3>Credential Priority</h3>
          <table>
            <thead>
              <tr><th>Priority</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>1 (highest)</td>
                <td><code>ZHIPUAI_API_KEY</code> environment variable</td>
              </tr>
              <tr>
                <td>2</td>
                <td><code>api_key</code> in <code>ProviderConfig</code></td>
              </tr>
              <tr>
                <td>3</td>
                <td>Stored credentials (<code>.jaato/zhipuai_auth.json</code>)</td>
              </tr>
            </tbody>
          </table>

          <h3>Credential Storage</h3>
          <p>
            Credentials are stored in JSON files with Unix permissions
            <code>0600</code>:
          </p>
          <ul>
            <li><strong>Project:</strong> <code>.jaato/zhipuai_auth.json</code> (if <code>.jaato/</code> exists)</li>
            <li><strong>User:</strong> <code>~/.jaato/zhipuai_auth.json</code> (fallback)</li>
          </ul>
        </div>
        <div class="panel-code">
          <div class="code-label">Environment variable</div>
          <div class="code-block">
            <pre><code class="language-bash"># .env file
ZHIPUAI_API_KEY=your-api-key
JAATO_PROVIDER=zhipuai
ZHIPUAI_MODEL=glm-5</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Interactive login (TUI)</div>
          <div class="code-block">
            <pre><code class="language-bash"># Login - validates and stores your API key
zhipuai-auth login

# Check status
zhipuai-auth status

# Logout - clears stored credentials
zhipuai-auth logout</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Programmatic login</div>
          <div class="code-block">
            <pre><code class="language-python">from shared.plugins.model_provider.zhipuai import (
    login_with_key,
    validate_api_key,
)

# Validate and store
creds = login_with_key(
    api_key="your-key",
    on_message=lambda msg: print(msg)
)

# Or just validate
valid, detail = validate_api_key("your-key")
print(f"Valid: {valid}")</code></pre>
          </div>
        </div>
      </section>

      <!-- Extended Thinking -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="thinking">Extended Thinking</h2>
          <p>
            GLM-5 and GLM-4.7 (non-flash variants) support native chain-of-thought
            reasoning. When enabled, the model shows its reasoning process before
            producing a final answer.
          </p>

          <h3>Supported Models</h3>
          <table>
            <thead>
              <tr><th>Model</th><th>Thinking Support</th></tr>
            </thead>
            <tbody>
              <tr><td><code>glm-5</code></td><td>Yes</td></tr>
              <tr><td><code>glm-4.7</code></td><td>Yes</td></tr>
              <tr><td><code>glm-4.7-flash</code></td><td>No</td></tr>
              <tr><td><code>glm-4.7-flashx</code></td><td>No</td></tr>
              <tr><td><code>glm-4.6</code></td><td>No</td></tr>
              <tr><td><code>glm-4.5*</code></td><td>No</td></tr>
            </tbody>
          </table>

          <h3>Configuration</h3>
          <table>
            <thead>
              <tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>enable_thinking</code></td>
                <td>bool</td>
                <td>False</td>
                <td>Enable chain-of-thought reasoning</td>
              </tr>
              <tr>
                <td><code>thinking_budget</code></td>
                <td>int</td>
                <td>10000</td>
                <td>Max tokens for thinking</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Enable via config</div>
          <div class="code-block">
            <pre><code class="language-python">provider.initialize(ProviderConfig(
    api_key="your-key",
    extra={
        'enable_thinking': True,
        'thinking_budget': 15000
    }
))
provider.connect("glm-5")</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Enable via environment</div>
          <div class="code-block">
            <pre><code class="language-bash"># .env file
ZHIPUAI_ENABLE_THINKING=true
ZHIPUAI_THINKING_BUDGET=15000</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Access thinking in response</div>
          <div class="code-block">
            <pre><code class="language-python">response = provider.send_message(
    "Analyze the trade-offs of this architecture"
)

if response.has_thinking:
    print("=== Reasoning ===")
    print(response.thinking)
    print()

print("=== Answer ===")
print(response.text)</code></pre>
          </div>
        </div>
      </section>

      <!-- Configuration -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="configuration">Configuration</h2>

          <h3>Environment Variables</h3>
          <table>
            <thead>
              <tr><th>Variable</th><th>Default</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>ZHIPUAI_API_KEY</code></td>
                <td>-</td>
                <td>API key (required)</td>
              </tr>
              <tr>
                <td><code>ZHIPUAI_BASE_URL</code></td>
                <td><code>https://api.z.ai/api/anthropic</code></td>
                <td>API base URL</td>
              </tr>
              <tr>
                <td><code>ZHIPUAI_MODEL</code></td>
                <td><code>glm-4.7</code></td>
                <td>Default model name</td>
              </tr>
              <tr>
                <td><code>ZHIPUAI_CONTEXT_LENGTH</code></td>
                <td>Per-model</td>
                <td>Override context window size</td>
              </tr>
              <tr>
                <td><code>ZHIPUAI_ENABLE_THINKING</code></td>
                <td><code>false</code></td>
                <td>Enable extended thinking</td>
              </tr>
              <tr>
                <td><code>ZHIPUAI_THINKING_BUDGET</code></td>
                <td><code>10000</code></td>
                <td>Max thinking tokens</td>
              </tr>
            </tbody>
          </table>

          <h3>ProviderConfig.extra Options</h3>
          <table>
            <thead>
              <tr><th>Key</th><th>Type</th><th>Default</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>base_url</code></td>
                <td>str</td>
                <td>See env</td>
                <td>Override API base URL</td>
              </tr>
              <tr>
                <td><code>context_length</code></td>
                <td>int</td>
                <td>Per-model</td>
                <td>Override context window</td>
              </tr>
              <tr>
                <td><code>enable_thinking</code></td>
                <td>bool</td>
                <td>False</td>
                <td>Enable chain-of-thought</td>
              </tr>
              <tr>
                <td><code>thinking_budget</code></td>
                <td>int</td>
                <td>10000</td>
                <td>Max thinking tokens</td>
              </tr>
            </tbody>
          </table>

          <div class="callout callout-info">
            <div class="callout-title">Base URL</div>
            The default endpoint is <code>https://api.z.ai/api/anthropic</code>.
            Do <strong>not</strong> include <code>/v1</code> in the base URL &mdash;
            the Anthropic SDK appends it internally.
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">Full .env example</div>
          <div class="code-block">
            <pre><code class="language-bash"># .env
JAATO_PROVIDER=zhipuai
ZHIPUAI_API_KEY=your-api-key
ZHIPUAI_MODEL=glm-5
ZHIPUAI_ENABLE_THINKING=true
ZHIPUAI_THINKING_BUDGET=10000</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Full programmatic config</div>
          <div class="code-block">
            <pre><code class="language-python">from shared import load_provider, ProviderConfig

provider = load_provider("zhipuai")
provider.initialize(ProviderConfig(
    api_key="your-key",
    extra={
        'base_url': 'https://api.z.ai/api/anthropic',
        'context_length': 204800,
        'enable_thinking': True,
        'thinking_budget': 10000,
    }
))

provider.connect("glm-5")

provider.create_session(
    system_instruction="You are a helpful assistant.",
    tools=[...]
)

response = provider.send_message("Hello!")
print(response.text)</code></pre>
          </div>
        </div>
      </section>

      <!-- Function Calling -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="tools">Function Calling</h2>
          <p>
            Zhipu AI supports function calling through the Anthropic-compatible
            API. Tool schemas are automatically converted to the correct format
            by the inherited Anthropic provider logic.
          </p>

          <h3>Supported Features</h3>
          <ul>
            <li>Parallel tool calls</li>
            <li>Tool result streaming</li>
            <li>Automatic schema conversion</li>
          </ul>

          <div class="callout callout-info">
            <div class="callout-title">Prompt Caching</div>
            Prompt caching is <strong>not supported</strong> by Zhipu AI's
            Anthropic-compatible endpoint. The provider automatically disables
            caching regardless of configuration.
          </div>
        </div>
        <div class="panel-code">
          <div class="code-label">Function calling example</div>
          <div class="code-block">
            <pre><code class="language-python">from jaato import JaatoClient

client = JaatoClient(provider_name="zhipuai")
client.connect(None, None, "glm-5")
client.configure_tools(registry)

# Model will use tools as needed
response = client.send_message(
    "List the files in the current directory",
    on_output=on_output
)
# Model calls list_files tool</code></pre>
          </div>
        </div>
      </section>

      <!-- Error Handling -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="errors">Error Handling</h2>
          <p>
            The provider includes Zhipu AI-specific error interpretation with
            actionable messages.
          </p>

          <table>
            <thead>
              <tr><th>Exception</th><th>Cause</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>ZhipuAIAPIKeyNotFoundError</code></td>
                <td>No API key in env, config, or stored credentials</td>
              </tr>
              <tr>
                <td><code>ZhipuAIConnectionError</code></td>
                <td>Auth failure (401/403) or connection issue</td>
              </tr>
              <tr>
                <td><code>RuntimeError</code></td>
                <td>Rate limit (429) or model not found (404)</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Handle errors</div>
          <div class="code-block">
            <pre><code class="language-python">from shared.plugins.model_provider.zhipuai import (
    ZhipuAIAPIKeyNotFoundError,
    ZhipuAIConnectionError,
)

try:
    provider.initialize(config)
    provider.send_message("Hello")
except ZhipuAIAPIKeyNotFoundError:
    print("Set ZHIPUAI_API_KEY or run: zhipuai-auth login")
except ZhipuAIConnectionError as e:
    print(f"Connection failed: {e}")
except RuntimeError as e:
    if "rate limit" in str(e).lower():
        print("Rate limited, retry later")
    elif "not found" in str(e).lower():
        print("Invalid model name")</code></pre>
          </div>
        </div>
      </section>

      <!-- Proxy Support -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="proxy">Corporate Proxy Support</h2>
          <p>
            The provider supports corporate proxy environments including:
          </p>
          <ul>
            <li>HTTP/HTTPS proxies via standard environment variables</li>
            <li>Custom CA certificate bundles</li>
            <li>Kerberos/SPNEGO proxy authentication</li>
          </ul>
          <p>
            Configuration uses the same proxy settings as other jaato providers.
            See the <a href="../../enterprise/proxy-kerberos.html">Proxy &amp; Kerberos</a>
            guide for details.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">Proxy configuration</div>
          <div class="code-block">
            <pre><code class="language-bash"># Standard proxy
export HTTPS_PROXY=http://proxy.corp.com:8080

# Corporate CA bundle
export REQUESTS_CA_BUNDLE=/path/to/ca-bundle.crt

# Kerberos proxy auth
export JAATO_KERBEROS_PROXY=true</code></pre>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>
  <script src="../../assets/js/docs.js"></script>
</body>
</html>
