<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filesystem Query Plugin - jaato docs</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../../getting-started/quickstart.html">Quickstart</a>
      <a href="../index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../../core-concepts/client.html">Client</a></li>
          <li><a href="../../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../../core-concepts/tools.html">Tools</a></li>
          <li><a href="../../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../index.html">Overview</a></li>
          <li><a href="../jaato-client.html">JaatoClient</a></li>
          <li><a href="../jaato-runtime.html">JaatoRuntime</a></li>
          <li><a href="../jaato-session.html">JaatoSession</a></li>
          <li><a href="../plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../tool-executor.html">ToolExecutor</a></li>
          <li><a href="../types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Provider Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../providers/index.html">Overview</a></li>
          <li><a href="../providers/anthropic.html">Anthropic</a></li>
          <li><a href="../providers/google-genai.html">Google GenAI</a></li>
          <li><a href="../providers/github-models.html">GitHub Models</a></li>
          <li><a href="../providers/claude-cli.html">Claude CLI</a></li>
          <li><a href="../providers/antigravity.html">Antigravity</a></li>
          <li><a href="../providers/ollama.html">Ollama</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Plugin Reference</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Overview</a></li>
          <li><a href="cli.html">CLI</a></li>
          <li><a href="file-edit.html">File Edit</a></li>
          <li><a href="filesystem-query.html" class="active">Filesystem Query</a></li>
          <li><a href="todo.html">Todo</a></li>
          <li><a href="web-search.html">Web Search</a></li>
          <li><a href="mcp.html">MCP</a></li>
          <li><a href="permission.html">Permission</a></li>
          <li><a href="session.html">Session</a></li>
          <li><a href="gc.html">GC</a></li>
          <li><a href="mermaid-formatter.html">Mermaid Formatter</a></li>
          <li><a href="other.html">Other Plugins</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Overview -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h1>Filesystem Query Plugin</h1>
          <p class="lead">
            Read-only tools for exploring the filesystem. Find files with glob patterns
            and search content with regular expressions. Auto-approved and background-capable.
          </p>

          <table>
            <tbody>
              <tr>
                <td><strong>Name</strong></td>
                <td><code>filesystem_query</code></td>
              </tr>
              <tr>
                <td><strong>Type</strong></td>
                <td>Tool Plugin (Registry-managed)</td>
              </tr>
              <tr>
                <td><strong>Tools Provided</strong></td>
                <td><code>glob_files</code>, <code>grep_content</code></td>
              </tr>
              <tr>
                <td><strong>User Commands</strong></td>
                <td>None</td>
              </tr>
              <tr>
                <td><strong>Auto-approved</strong></td>
                <td>All tools (read-only)</td>
              </tr>
            </tbody>
          </table>

          <h2 id="features">Features</h2>
          <ul>
            <li><strong>Glob Patterns</strong>: Find files with patterns like <code>**/*.py</code></li>
            <li><strong>Regex Search</strong>: Search file contents with regular expressions</li>
            <li><strong>Structured Output</strong>: JSON responses with metadata</li>
            <li><strong>Smart Exclusions</strong>: Skips <code>node_modules</code>, <code>__pycache__</code>, etc.</li>
            <li><strong>Background Support</strong>: Auto-backgrounds long searches</li>
            <li><strong>Configurable</strong>: Customize exclusions, limits, and timeouts</li>
          </ul>

          <h2 id="use-case">Primary Use Case</h2>
          <p>
            Enables models to be self-sufficient when locating files without requiring
            users to provide exact paths. The model can explore the codebase to find
            relevant files before reading or editing them.
          </p>

          <h2 id="performance">Performance Trade-offs</h2>
          <p>
            <strong>Let's be honest</strong>: Native CLI tools (<code>find</code>, <code>grep</code>)
            are faster—they're written in C and highly optimized. This plugin typically runs
            <strong>2-5x slower</strong> than equivalent CLI commands.
          </p>

          <h3>Why It's Still Worth It</h3>
          <table>
            <thead>
              <tr><th>Benefit</th><th>CLI Tools</th><th>filesystem_query</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>Output format</td>
                <td>Plain text, needs parsing</td>
                <td>Structured JSON with metadata</td>
              </tr>
              <tr>
                <td>Exclusions</td>
                <td>Manual <code>--exclude</code> flags</td>
                <td>Built-in (node_modules, .git, etc.)</td>
              </tr>
              <tr>
                <td>Shell escaping</td>
                <td>Complex quoting rules</td>
                <td>Direct patterns, no escaping</td>
              </tr>
              <tr>
                <td>Permissions</td>
                <td>Requires approval</td>
                <td>Auto-approved (read-only)</td>
              </tr>
              <tr>
                <td>Binary files</td>
                <td>Can output garbage</td>
                <td>Automatically skipped</td>
              </tr>
            </tbody>
          </table>

          <h3>When Exclusions Help</h3>
          <p>
            Automatic exclusions can make this plugin <em>faster</em> than naive CLI usage.
            When users forget <code>--exclude-dir=node_modules</code>, they pay the price.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">Benchmark: glob_files vs find</div>
          <div class="code-block">
            <pre><code class="language-text">Find all Python files (500 files):
glob_files:  avg=0.025s
find:        avg=0.009s
Ratio: 2.7x slower</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Exclusion efficiency</div>
          <div class="code-block">
            <pre><code class="language-text">Find JS files (with node_modules):
glob_files (auto-exclude):  0.031s  (50 files)
find (no exclusions):       0.089s  (250 files)
find (with exclusions):     0.028s  (50 files)

When node_modules is heavy, auto-exclusions
can actually be faster than naive CLI usage.</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Run benchmarks</div>
          <div class="code-block">
            <pre><code class="language-bash">pytest shared/plugins/filesystem_query/tests/test_benchmarks.py -v -s</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">When to use CLI instead</div>
          <div class="code-block">
            <pre><code class="language-text">❌ Performance-critical batch operations
❌ Multi-gigabyte directories
❌ Simple one-off human searches

✅ Model autonomously exploring code
✅ Projects with heavy node_modules
✅ When structured output matters
✅ Safe, no-permission-needed discovery</code></pre>
          </div>
        </div>
      </section>

      <!-- Configuration -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="configuration">Configuration</h2>
          <p>
            Configuration can come from three sources (in priority order):
          </p>
          <ol>
            <li>Runtime config passed to <code>expose_tool()</code></li>
            <li>Config file at <code>.jaato/filesystem_query.json</code></li>
            <li>Hardcoded defaults</li>
          </ol>

          <h3>exclude_patterns</h3>
          <p>Additional glob patterns to exclude from searches.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>list[str]</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>[]</code></td></tr>
            </tbody>
          </table>

          <h3>exclude_mode</h3>
          <p>How to handle exclusions.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>"extend" | "replace"</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>"extend"</code></td></tr>
            </tbody>
          </table>
          <p><code>extend</code> adds to defaults; <code>replace</code> uses only your patterns.</p>

          <h3>include_patterns</h3>
          <p>Force-include patterns that override exclusions.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>list[str]</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>[]</code></td></tr>
            </tbody>
          </table>

          <h3>max_results</h3>
          <p>Maximum files or matches to return.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>int</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>500</code></td></tr>
            </tbody>
          </table>

          <h3>max_file_size_kb</h3>
          <p>Skip files larger than this for grep (in KB).</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>int</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>1024</code> (1MB)</td></tr>
            </tbody>
          </table>

          <h3>timeout_seconds</h3>
          <p>Auto-background threshold for long searches.</p>
          <table>
            <tbody>
              <tr><td><strong>Type</strong></td><td><code>int</code></td></tr>
              <tr><td><strong>Default</strong></td><td><code>30</code></td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Config file example</div>
          <div class="code-block">
            <pre><code class="language-json">// .jaato/filesystem_query.json
{
  "version": "1.0",
  "exclude_patterns": ["vendor", "third_party"],
  "exclude_mode": "extend",
  "include_patterns": ["node_modules/@mycompany"],
  "max_results": 500,
  "max_file_size_kb": 1024,
  "timeout_seconds": 30,
  "context_lines": 2
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Default exclusions</div>
          <div class="code-block">
            <pre><code class="language-text">Version control:
  .git, .svn, .hg, .bzr

JavaScript/Node:
  node_modules, bower_components

Python:
  __pycache__, .venv, venv, .tox
  .mypy_cache, .pytest_cache

Build artifacts:
  dist, build, out, target

IDEs:
  .idea, .vscode

Minified:
  *.min.js, *.min.css</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Override exclusions</div>
          <div class="code-block">
            <pre><code class="language-python"># Add to defaults
config={
    'exclude_patterns': ['custom_dir'],
    'exclude_mode': 'extend',
}

# Replace all defaults
config={
    'exclude_patterns': ['only_this'],
    'exclude_mode': 'replace',
}

# Force-include despite exclusions
config={
    'include_patterns': ['node_modules/@company'],
}</code></pre>
          </div>
        </div>
      </section>

      <!-- glob_files Tool -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="glob-files">glob_files Tool</h2>
          <p>Find files matching a glob pattern.</p>

          <h4>Parameters</h4>
          <table>
            <thead>
              <tr><th>Name</th><th>Type</th><th>Required</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>pattern</code></td>
                <td><code>string</code></td>
                <td>Yes</td>
                <td>Glob pattern (e.g., <code>**/*.py</code>)</td>
              </tr>
              <tr>
                <td><code>root</code></td>
                <td><code>string</code></td>
                <td>No</td>
                <td>Root directory (default: cwd)</td>
              </tr>
              <tr>
                <td><code>max_results</code></td>
                <td><code>int</code></td>
                <td>No</td>
                <td>Max files to return</td>
              </tr>
              <tr>
                <td><code>include_hidden</code></td>
                <td><code>bool</code></td>
                <td>No</td>
                <td>Include hidden files (default: false)</td>
              </tr>
            </tbody>
          </table>

          <h4>Response Fields</h4>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>files</code></td><td><code>array</code></td><td>Matching files with metadata</td></tr>
              <tr><td><code>total</code></td><td><code>int</code></td><td>Total matches found</td></tr>
              <tr><td><code>returned</code></td><td><code>int</code></td><td>Files returned (may be less if truncated)</td></tr>
              <tr><td><code>truncated</code></td><td><code>bool</code></td><td>True if results were limited</td></tr>
              <tr><td><code>root</code></td><td><code>string</code></td><td>Search root directory</td></tr>
              <tr><td><code>pattern</code></td><td><code>string</code></td><td>Pattern used</td></tr>
            </tbody>
          </table>

          <h4>File Object</h4>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>path</code></td><td><code>string</code></td><td>Relative path from root</td></tr>
              <tr><td><code>absolute_path</code></td><td><code>string</code></td><td>Full path</td></tr>
              <tr><td><code>size</code></td><td><code>int</code></td><td>File size in bytes</td></tr>
              <tr><td><code>modified</code></td><td><code>string</code></td><td>ISO timestamp</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Example: Find Python files</div>
          <div class="code-block">
            <pre><code class="language-python">glob_files(pattern="**/*.py")</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Response</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "files": [
    {
      "path": "src/main.py",
      "absolute_path": "/home/user/project/src/main.py",
      "size": 1234,
      "modified": "2025-01-15T10:30:00"
    },
    {
      "path": "tests/test_main.py",
      "absolute_path": "/home/user/project/tests/test_main.py",
      "size": 856,
      "modified": "2025-01-14T15:45:00"
    }
  ],
  "total": 2,
  "returned": 2,
  "truncated": false,
  "root": "/home/user/project",
  "pattern": "**/*.py"
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Common patterns</div>
          <div class="code-block">
            <pre><code class="language-python"># All Python files
glob_files(pattern="**/*.py")

# Test files
glob_files(pattern="**/test_*.py")

# Config files
glob_files(pattern="**/*.{json,yaml,toml}")

# In specific directory
glob_files(pattern="src/**/*.ts")

# Include hidden files
glob_files(pattern="**/*", include_hidden=True)</code></pre>
          </div>
        </div>
      </section>

      <!-- grep_content Tool -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="grep-content">grep_content Tool</h2>
          <p>Search file contents using regular expressions.</p>

          <h4>Parameters</h4>
          <table>
            <thead>
              <tr><th>Name</th><th>Type</th><th>Required</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><code>pattern</code></td>
                <td><code>string</code></td>
                <td>Yes</td>
                <td>Regex pattern to search</td>
              </tr>
              <tr>
                <td><code>path</code></td>
                <td><code>string</code></td>
                <td>No</td>
                <td>File or directory to search (default: cwd)</td>
              </tr>
              <tr>
                <td><code>file_glob</code></td>
                <td><code>string</code></td>
                <td>No</td>
                <td>Only search matching files</td>
              </tr>
              <tr>
                <td><code>context_lines</code></td>
                <td><code>int</code></td>
                <td>No</td>
                <td>Lines of context (default: 2)</td>
              </tr>
              <tr>
                <td><code>case_sensitive</code></td>
                <td><code>bool</code></td>
                <td>No</td>
                <td>Case-sensitive (default: true)</td>
              </tr>
              <tr>
                <td><code>max_results</code></td>
                <td><code>int</code></td>
                <td>No</td>
                <td>Max matches to return</td>
              </tr>
            </tbody>
          </table>

          <h4>Response Fields</h4>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>matches</code></td><td><code>array</code></td><td>Matching lines with context</td></tr>
              <tr><td><code>total_matches</code></td><td><code>int</code></td><td>Total matches found</td></tr>
              <tr><td><code>files_with_matches</code></td><td><code>int</code></td><td>Files containing matches</td></tr>
              <tr><td><code>files_searched</code></td><td><code>int</code></td><td>Total files searched</td></tr>
              <tr><td><code>truncated</code></td><td><code>bool</code></td><td>True if results were limited</td></tr>
            </tbody>
          </table>

          <h4>Match Object</h4>
          <table>
            <thead>
              <tr><th>Field</th><th>Type</th><th>Description</th></tr>
            </thead>
            <tbody>
              <tr><td><code>file</code></td><td><code>string</code></td><td>Relative file path</td></tr>
              <tr><td><code>line</code></td><td><code>int</code></td><td>Line number (1-indexed)</td></tr>
              <tr><td><code>column</code></td><td><code>int</code></td><td>Column of match start</td></tr>
              <tr><td><code>text</code></td><td><code>string</code></td><td>Full line content</td></tr>
              <tr><td><code>match</code></td><td><code>string</code></td><td>Matched text</td></tr>
              <tr><td><code>context_before</code></td><td><code>array</code></td><td>Lines before match</td></tr>
              <tr><td><code>context_after</code></td><td><code>array</code></td><td>Lines after match</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-code">
          <div class="code-label">Example: Find function definitions</div>
          <div class="code-block">
            <pre><code class="language-python">grep_content(
    pattern=r"def process_\w+",
    file_glob="*.py",
    context_lines=2
)</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Response</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "matches": [
    {
      "file": "src/utils.py",
      "absolute_path": "/home/user/project/src/utils.py",
      "line": 42,
      "column": 1,
      "text": "def process_data(input):",
      "match": "def process_data",
      "context_before": ["", "class DataProcessor:"],
      "context_after": ["    '''Process input data.'''", "    return transform(input)"]
    }
  ],
  "total_matches": 1,
  "files_with_matches": 1,
  "files_searched": 15,
  "truncated": false,
  "pattern": "def process_\\w+",
  "path": "/home/user/project",
  "file_glob": "*.py"
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Common searches</div>
          <div class="code-block">
            <pre><code class="language-python"># Find class definitions
grep_content(pattern=r"class\s+\w+")

# Find TODO comments
grep_content(pattern="TODO|FIXME|HACK")

# Find imports
grep_content(pattern=r"import\s+requests")

# Case-insensitive search
grep_content(
    pattern="error",
    case_sensitive=False
)

# Search specific file types
grep_content(
    pattern="async def",
    file_glob="*.py"
)</code></pre>
          </div>
        </div>
      </section>

      <!-- Background Execution -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h2 id="background">Background Execution</h2>
          <p>
            Both tools support background execution for long-running searches.
            If a search exceeds the configured timeout threshold, it automatically
            moves to background execution.
          </p>

          <h3>How It Works</h3>
          <ol>
            <li>Search starts in foreground</li>
            <li>If timeout exceeded, moves to background</li>
            <li>Returns a task handle for status checking</li>
            <li>Model can poll for results</li>
          </ol>

          <h3>Configuration</h3>
          <p>
            Set <code>timeout_seconds</code> to control when auto-backgrounding
            triggers. Default is 30 seconds.
          </p>
        </div>
        <div class="panel-code">
          <div class="code-label">Configure background threshold</div>
          <div class="code-block">
            <pre><code class="language-python"># Longer threshold for patient users
registry.expose_tool('filesystem_query', config={
    'timeout_seconds': 60,
})

# Shorter threshold for responsiveness
registry.expose_tool('filesystem_query', config={
    'timeout_seconds': 10,
})</code></pre>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>


  <script src="../../assets/js/docs.js"></script>
</body>
</html>
