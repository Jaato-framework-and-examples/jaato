<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Environment Plugin - jaato docs</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../../getting-started/quickstart.html">Quickstart</a>
      <a href="../index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../../core-concepts/client.html">Client</a></li>
          <li><a href="../../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../../core-concepts/tools.html">Tools</a></li>
          <li><a href="../../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../index.html">Overview</a></li>
          <li><a href="../jaato-client.html">JaatoClient</a></li>
          <li><a href="../plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Provider Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../providers/index.html">Overview</a></li>
          <li><a href="../providers/anthropic.html">Anthropic</a></li>
          <li><a href="../providers/google-genai.html">Google GenAI</a></li>
          <li><a href="../providers/github-models.html">GitHub Models</a></li>
          <li><a href="../providers/claude-cli.html">Claude CLI</a></li>
          <li><a href="../providers/antigravity.html">Antigravity</a></li>
          <li><a href="../providers/ollama.html">Ollama</a></li>
          <li><a href="../providers/zhipuai.html">Zhipu AI</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Plugin Reference</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Overview</a></li>
          <li><a href="cli.html">CLI</a></li>
          <li><a href="environment.html" class="active">Environment</a></li>
          <li><a href="mcp.html">MCP</a></li>
          <li><a href="file-edit.html">File Edit</a></li>
          <li><a href="todo.html">Todo</a></li>
          <li><a href="web-search.html">Web Search</a></li>
          <li><a href="permission.html">Permission</a></li>
          <li><a href="session.html">Session</a></li>
          <li><a href="gc.html">GC</a></li>
          <li><a href="mermaid-formatter.html">Mermaid Formatter</a></li>
          <li><a href="other.html">Other Plugins</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <!-- Overview -->
      <section class="two-panel">
        <div class="panel-explanation">
          <h1>Environment Plugin</h1>
          <p class="lead">
            Query execution environment (OS, shell, architecture) and internal context
            (token usage, GC thresholds) to generate platform-appropriate commands and manage resources.
          </p>

          <table>
            <tbody>
              <tr>
                <td><strong>Name</strong></td>
                <td><code>environment</code></td>
              </tr>
              <tr>
                <td><strong>Type</strong></td>
                <td>Tool Plugin (Registry-managed)</td>
              </tr>
              <tr>
                <td><strong>Auto-approved</strong></td>
                <td>Yes (read-only, no side effects)</td>
              </tr>
              <tr>
                <td><strong>Tools</strong></td>
                <td><code>get_environment</code></td>
              </tr>
            </tbody>
          </table>

          <h2 id="use-cases">Use Cases</h2>
          <ul>
            <li><strong>Shell command generation</strong> - Determine correct syntax (bash vs PowerShell)</li>
            <li><strong>Path construction</strong> - Use correct separators (<code>/</code> vs <code>\</code>)</li>
            <li><strong>Tool availability</strong> - Know which utilities exist on the platform</li>
            <li><strong>Binary selection</strong> - Choose correct architecture (x86_64 vs arm64)</li>
            <li><strong>Context management</strong> - Monitor token usage and proactively manage context</li>
          </ul>

          <h2 id="tool-get-environment">get_environment</h2>
          <p>
            Query environment information with optional aspect filtering.
          </p>

          <h3>Parameters</h3>
          <table>
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Type</th>
                <th>Required</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>aspect</code></td>
                <td><code>string</code></td>
                <td>No</td>
                <td>Filter to specific aspect: <code>os</code>, <code>shell</code>, <code>arch</code>, <code>cwd</code>, <code>context</code>, or <code>all</code> (default)</td>
              </tr>
            </tbody>
          </table>

          <h2 id="aspects">Aspect Details</h2>

          <h3>OS (<code>aspect="os"</code>)</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Description</th><th>Examples</th></tr>
            </thead>
            <tbody>
              <tr><td><code>type</code></td><td>Lowercase OS identifier</td><td><code>linux</code>, <code>darwin</code>, <code>windows</code></td></tr>
              <tr><td><code>name</code></td><td>Platform name</td><td><code>Linux</code>, <code>Darwin</code>, <code>Windows</code></td></tr>
              <tr><td><code>release</code></td><td>OS version</td><td><code>5.15.0</code>, <code>22.1.0</code></td></tr>
              <tr><td><code>friendly_name</code></td><td>Human-readable</td><td><code>Linux</code>, <code>macOS</code>, <code>Windows</code></td></tr>
            </tbody>
          </table>

          <h3>Shell (<code>aspect="shell"</code>)</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Description</th><th>Examples</th></tr>
            </thead>
            <tbody>
              <tr><td><code>default</code></td><td>Default shell</td><td><code>bash</code>, <code>zsh</code>, <code>cmd</code></td></tr>
              <tr><td><code>current</code></td><td>Current shell</td><td><code>bash</code>, <code>powershell</code></td></tr>
              <tr><td><code>path</code></td><td>Shell path (Unix)</td><td><code>/bin/bash</code></td></tr>
              <tr><td><code>path_separator</code></td><td>PATH delimiter</td><td><code>:</code> (Unix), <code>;</code> (Windows)</td></tr>
              <tr><td><code>dir_separator</code></td><td>Directory separator</td><td><code>/</code> (Unix), <code>\</code> (Windows)</td></tr>
            </tbody>
          </table>

          <h3>Architecture (<code>aspect="arch"</code>)</h3>
          <table>
            <thead>
              <tr><th>Field</th><th>Description</th><th>Examples</th></tr>
            </thead>
            <tbody>
              <tr><td><code>machine</code></td><td>Raw machine type</td><td><code>x86_64</code>, <code>arm64</code></td></tr>
              <tr><td><code>processor</code></td><td>Processor info</td><td><code>x86_64</code>, <code>arm</code></td></tr>
              <tr><td><code>normalized</code></td><td>Standardized name</td><td><code>x86_64</code>, <code>arm64</code>, <code>x86</code></td></tr>
            </tbody>
          </table>

          <h3>Working Directory (<code>aspect="cwd"</code>)</h3>
          <p>
            Returns the absolute path to the current working directory as a string.
          </p>

          <h3>Context (<code>aspect="context"</code>)</h3>
          <p>
            Returns token usage and GC settings. Requires session injection via <code>set_session_plugin()</code>.
          </p>
          <table>
            <thead>
              <tr><th>Field</th><th>Description</th><th>Examples</th></tr>
            </thead>
            <tbody>
              <tr><td><code>model</code></td><td>Model name</td><td><code>claude-sonnet-4-20250514</code></td></tr>
              <tr><td><code>context_limit</code></td><td>Max context size</td><td><code>1048576</code></td></tr>
              <tr><td><code>total_tokens</code></td><td>Total tokens used</td><td><code>15234</code></td></tr>
              <tr><td><code>prompt_tokens</code></td><td>Input tokens</td><td><code>12000</code></td></tr>
              <tr><td><code>output_tokens</code></td><td>Output tokens</td><td><code>3234</code></td></tr>
              <tr><td><code>tokens_remaining</code></td><td>Available tokens</td><td><code>1033342</code></td></tr>
              <tr><td><code>percent_used</code></td><td>Usage percentage</td><td><code>1.45</code></td></tr>
              <tr><td><code>turns</code></td><td>Conversation turns</td><td><code>5</code></td></tr>
              <tr><td><code>gc</code></td><td>GC settings</td><td>Object with thresholds</td></tr>
            </tbody>
          </table>

          <h2 id="configuration">Configuration</h2>
          <p>
            This plugin requires no configuration for basic aspects. For <code>context</code> aspect,
            inject the session via <code>set_session_plugin()</code>.
          </p>
        </div>

        <div class="panel-code">
          <div class="code-label">Basic usage</div>
          <div class="code-block">
            <pre><code class="language-python">from shared.plugins.registry import PluginRegistry

registry = PluginRegistry()
registry.discover()
registry.expose_tool("environment")

# Get all executors
executors = registry.get_exposed_executors()

# Query all environment info
result = executors["get_environment"]({})

# Query specific aspect
os_info = executors["get_environment"]({"aspect": "os"})
shell_info = executors["get_environment"]({"aspect": "shell"})</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Response: context aspect</div>
          <div class="code-block">
            <pre><code class="language-json">{
  "model": "claude-sonnet-4-20250514",
  "context_limit": 1048576,
  "total_tokens": 15234,
  "prompt_tokens": 12000,
  "output_tokens": 3234,
  "tokens_remaining": 1033342,
  "percent_used": 1.45,
  "turns": 5,
  "gc": {
    "threshold_percent": 80.0,
    "auto_trigger": true,
    "preserve_recent_turns": 5
  }
}</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">Response: single aspect</div>
          <div class="code-block">
            <pre><code class="language-json">// get_environment(aspect="shell")
{
  "default": "bash",
  "current": "bash",
  "path": "/bin/bash",
  "path_separator": ":",
  "dir_separator": "/"
}

// get_environment(aspect="cwd")
"/home/user/project"</code></pre>
          </div>

          <div class="code-label" style="margin-top: 24px;">With JaatoClient</div>
          <div class="code-block">
            <pre><code class="language-python">from shared import JaatoClient, PluginRegistry

client = JaatoClient()
client.connect()  # Reads JAATO_PROVIDER and MODEL_NAME from env

registry = PluginRegistry()
registry.discover()
registry.expose_tool("environment")
registry.expose_tool("cli")  # Often used together

client.configure_tools(registry)

# Model can now query environment before
# generating platform-specific commands
response = client.send_message(
    "List files in the current directory"
)</code></pre>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>
  <script src="../../assets/js/docs.js"></script>
</body>
</html>
