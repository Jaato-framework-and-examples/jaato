<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subagent Architecture - Enterprise Architecture - jaato docs</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    .detail-hero { margin-bottom: 48px; }
    .detail-hero .lead { font-size: 18px; color: var(--color-text-secondary); line-height: 1.6; max-width: 720px; }
    .infography-full { margin: 32px 0; border: 1px solid var(--color-border); border-radius: 12px; overflow: hidden; }
    .infography-full img { width: 100%; display: block; background: var(--color-bg-secondary); }
    .infography-full .infography-caption { padding: 12px 20px; font-size: 13px; color: var(--color-text-secondary); border-top: 1px solid var(--color-border); text-align: center; }
    .detail-content h2 { margin-top: 48px; }
    .detail-content h3 { margin-top: 32px; }
    .detail-content table { width: 100%; border-collapse: collapse; margin: 16px 0 24px 0; }
    .detail-content th, .detail-content td { text-align: left; padding: 10px 14px; border-bottom: 1px solid var(--color-border); font-size: 14px; }
    .detail-content th { font-weight: 600; color: var(--color-text); }
    .detail-content td { color: var(--color-text-secondary); }
    .detail-content code { font-size: 13px; padding: 2px 6px; background: var(--color-bg-secondary); border-radius: 4px; }
    .detail-content pre { background: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 8px; padding: 16px 20px; overflow-x: auto; font-size: 13px; line-height: 1.5; margin: 16px 0 24px 0; }
    .detail-content pre code { background: none; padding: 0; }
    .back-link { display: inline-flex; align-items: center; gap: 6px; font-size: 14px; color: #0ea5e9; text-decoration: none; margin-top: 48px; padding-top: 24px; border-top: 1px solid var(--color-border); }
    .back-link:hover { color: #38bdf8; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../getting-started/quickstart.html">Quickstart</a>
      <a href="../api-reference/index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../core-concepts/client.html">Client</a></li>
          <li><a href="../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../core-concepts/tools.html">Tools</a></li>
          <li><a href="../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Guides</div>
        <ul class="sidebar-nav">
          <li><a href="../guides/tool-plugins.html">Building Plugins</a></li>
          <li><a href="../guides/mcp-integration.html">MCP Integration</a></li>
          <li><a href="../guides/permissions.html">Permissions</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Enterprise</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Architecture Overview</a></li>
          <li><a href="model-harness.html">Model Harness</a></li>
          <li><a href="instruction-sources.html">Instruction Sources</a></li>
          <li><a href="tool-system.html">Tool System</a></li>
          <li><a href="permission-system.html">Permission System</a></li>
          <li><a href="event-protocol.html">Event Protocol</a></li>
          <li><a href="ipc-recovery.html">IPC Recovery</a></li>
          <li><a href="multi-provider.html">Multi-Provider</a></li>
          <li><a href="subagent-architecture.html" class="active">Subagent Architecture</a></li>
          <li><a href="opentelemetry.html">OpenTelemetry</a></li>
          <li><a href="proxy-kerberos.html">Proxy &amp; Kerberos</a></li>
          <li><a href="gc-system.html">GC System</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Contributing</div>
        <ul class="sidebar-nav">
          <li><a href="../contributing/index.html">Getting Started</a></li>
          <li><a href="../contributing/architecture.html">Architecture</a></li>
          <li><a href="../contributing/code-style.html">Code Style</a></li>
          <li><a href="../contributing/testing.html">Testing</a></li>
          <li><a href="../contributing/pull-requests.html">Pull Requests</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../api-reference/index.html">Overview</a></li>
          <li><a href="../api-reference/jaato-client.html">JaatoClient</a></li>
          <li><a href="../api-reference/plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../api-reference/types.html">Types</a></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Provider Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../api-reference/providers/index.html">Overview</a></li>
          <li><a href="../api-reference/providers/google-genai.html">Google GenAI</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <section class="detail-hero">
        <h1>Subagent Architecture</h1>
        <p class="lead">
          JAATO's subagent system enables a main agent to delegate specialized tasks to child agents. Subagents share the parent's <code>JaatoRuntime</code> (provider configs, plugin registry, permissions, token ledger) but get their own isolated <code>JaatoSession</code> with independent conversation state, model selection, and GC configuration.
        </p>
      </section>

      <div class="infography-full">
        <a href="../assets/images/enterprise/jaato_subagent_architecture.png" target="_blank">
          <img src="../assets/images/enterprise/jaato_subagent_architecture.png" alt="Subagent Architecture Infography">
        </a>
        <div class="infography-caption">Click to open full-size image in a new tab</div>
      </div>

      <section class="detail-content">

        <h2 id="runtime-session-split">Runtime vs Session Split</h2>
        <p>
          The core architectural insight is separating <strong>shared environment</strong> (<code>JaatoRuntime</code>) from <strong>per-agent state</strong> (<code>JaatoSession</code>). The runtime holds provider configurations, plugin registry, permissions, and the token ledger. Each session holds its own conversation history, model selection, system instructions, and GC state. This split enables fast subagent spawning &mdash; <code>runtime.create_session()</code> is lightweight with no redundant SDK connections.
        </p>

        <h2 id="subagent-profiles">Subagent Profiles</h2>
        <p>
          Subagent behavior is configured through <code>SubagentProfile</code> dataclasses, which can be defined inline in code or discovered from <code>.jaato/profiles/*.json</code> files. Each profile specifies the model, provider, plugins, system instructions, max turns, auto-approved tools, GC configuration, and an icon for UI display.
        </p>
        <table>
          <thead>
            <tr><th>Profile Field</th><th>Purpose</th></tr>
          </thead>
          <tbody>
            <tr><td><code>model</code></td><td>Model name for this subagent (can differ from parent)</td></tr>
            <tr><td><code>provider</code></td><td>Provider name (enables cross-provider delegation)</td></tr>
            <tr><td><code>plugins</code></td><td>List of tool plugin names to expose</td></tr>
            <tr><td><code>system_instructions</code></td><td>Custom instructions for the subagent's role</td></tr>
            <tr><td><code>max_turns</code></td><td>Maximum agentic turns before forced completion</td></tr>
            <tr><td><code>auto_approved</code></td><td>List of tools that skip permission checks</td></tr>
            <tr><td><code>gc</code></td><td>GC plugin configuration (type, thresholds)</td></tr>
          </tbody>
        </table>

        <h2 id="delegation-lifecycle">Delegation Lifecycle</h2>
        <p>
          When the main agent delegates a task, the subagent plugin resolves the profile, creates a session via the shared runtime, configures tools and permissions, executes the task loop, and returns the result. Permission requests from the subagent are bridged to the parent's approval channel via <code>ParentBridgedChannel</code>.
        </p>

        <h2 id="resource-sharing">Resource Sharing vs Isolation</h2>
        <table>
          <thead>
            <tr><th>Resource</th><th>Sharing</th><th>Why</th></tr>
          </thead>
          <tbody>
            <tr><td>Provider configs</td><td>Shared</td><td>Avoid redundant SDK connections</td></tr>
            <tr><td>Plugin registry</td><td>Shared</td><td>Single source of tool definitions</td></tr>
            <tr><td>Permissions</td><td>Shared (bridged)</td><td>Consistent policy enforcement</td></tr>
            <tr><td>Token ledger</td><td>Shared</td><td>Unified usage tracking and billing</td></tr>
            <tr><td>Conversation history</td><td>Isolated</td><td>Independent context per agent</td></tr>
            <tr><td>System instructions</td><td>Isolated</td><td>Role-specific behavior</td></tr>
            <tr><td>GC state</td><td>Isolated</td><td>Independent context management</td></tr>
          </tbody>
        </table>

        <h2 id="cross-provider">Cross-Provider Subagents</h2>
        <p>
          Because provider configs are held at the runtime level, a subagent can use a different provider than its parent. For example, a main agent on Anthropic Claude can delegate research tasks to a subagent running Google Gemini, with both sessions sharing the same tool registry and permission policies.
        </p>

      </section>

      <a href="index.html" class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        Back to Enterprise Overview
      </a>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>
  <script src="../assets/js/docs.js"></script>
</body>
</html>
