<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tool System - Enterprise Architecture - jaato docs</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    .detail-hero {
      margin-bottom: 48px;
    }
    .detail-hero .lead {
      font-size: 18px;
      color: var(--color-text-secondary);
      line-height: 1.6;
      max-width: 720px;
    }
    .infography-full {
      margin: 32px 0;
      border: 1px solid var(--color-border);
      border-radius: 12px;
      overflow: hidden;
    }
    .infography-full img {
      width: 100%;
      display: block;
      background: var(--color-bg-secondary);
    }
    .infography-full .infography-caption {
      padding: 12px 20px;
      font-size: 13px;
      color: var(--color-text-secondary);
      border-top: 1px solid var(--color-border);
      text-align: center;
    }
    .detail-content h2 {
      margin-top: 48px;
    }
    .detail-content h3 {
      margin-top: 32px;
    }
    .detail-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0 24px 0;
    }
    .detail-content th,
    .detail-content td {
      text-align: left;
      padding: 10px 14px;
      border-bottom: 1px solid var(--color-border);
      font-size: 14px;
    }
    .detail-content th {
      font-weight: 600;
      color: var(--color-text);
    }
    .detail-content td {
      color: var(--color-text-secondary);
    }
    .detail-content code {
      font-size: 13px;
      padding: 2px 6px;
      background: var(--color-bg-secondary);
      border-radius: 4px;
    }
    .detail-content pre {
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 16px 20px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.5;
      margin: 16px 0 24px 0;
    }
    .detail-content pre code {
      background: none;
      padding: 0;
    }
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      color: #0ea5e9;
      text-decoration: none;
      margin-top: 48px;
      padding-top: 24px;
      border-top: 1px solid var(--color-border);
    }
    .back-link:hover {
      color: #38bdf8;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="../index.html" class="header-logo">
      jaato <span>docs</span>
    </a>
    <nav class="header-nav">
      <a href="../getting-started/quickstart.html">Quickstart</a>
      <a href="../api-reference/index.html">API Reference</a>
      <a href="https://github.com/apanoia/jaato" target="_blank">GitHub</a>
      <div class="header-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search docs... (press /)">
      </div>
    </nav>
  </header>

  <!-- Layout -->
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Getting Started</div>
        <ul class="sidebar-nav">
          <li><a href="../getting-started/quickstart.html">Quickstart</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Core Concepts</div>
        <ul class="sidebar-nav">
          <li><a href="../core-concepts/client.html">Client</a></li>
          <li><a href="../core-concepts/plugins.html">Plugins</a></li>
          <li><a href="../core-concepts/tools.html">Tools</a></li>
          <li><a href="../core-concepts/providers.html">Providers</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Guides</div>
        <ul class="sidebar-nav">
          <li><a href="../guides/tool-plugins.html">Building Plugins</a></li>
          <li><a href="../guides/mcp-integration.html">MCP Integration</a></li>
          <li><a href="../guides/permissions.html">Permissions</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Enterprise</div>
        <ul class="sidebar-nav">
          <li><a href="index.html">Architecture Overview</a></li>
          <li><a href="model-harness.html">Model Harness</a></li>
          <li><a href="instruction-sources.html">Instruction Sources</a></li>
          <li><a href="tool-system.html" class="active">Tool System</a></li>
          <li><a href="permission-system.html">Permission System</a></li>
          <li><a href="event-protocol.html">Event Protocol</a></li>
          <li><a href="ipc-recovery.html">IPC Recovery</a></li>
          <li><a href="multi-provider.html">Multi-Provider</a></li>
          <li><a href="subagent-architecture.html">Subagent Architecture</a></li>
          <li><a href="opentelemetry.html">OpenTelemetry</a></li>
          <li><a href="proxy-kerberos.html">Proxy &amp; Kerberos</a></li>
          <li><a href="gc-system.html">GC System</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Contributing</div>
        <ul class="sidebar-nav">
          <li><a href="../contributing/index.html">Getting Started</a></li>
          <li><a href="../contributing/architecture.html">Architecture</a></li>
          <li><a href="../contributing/code-style.html">Code Style</a></li>
          <li><a href="../contributing/testing.html">Testing</a></li>
          <li><a href="../contributing/pull-requests.html">Pull Requests</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">API Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../api-reference/index.html">Overview</a></li>
          <li><a href="../api-reference/jaato-client.html">JaatoClient</a></li>
          <li><a href="../api-reference/plugin-registry.html">PluginRegistry</a></li>
          <li><a href="../api-reference/types.html">Types</a></li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Provider Reference</div>
        <ul class="sidebar-nav">
          <li><a href="../api-reference/providers/index.html">Overview</a></li>
          <li><a href="../api-reference/providers/google-genai.html">Google GenAI</a></li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <section class="detail-hero">
        <h1>Tool System &amp; Discoverability</h1>
        <p class="lead">
          JAATO provides tools to AI models through a deferred loading architecture. Rather than loading all 100+ tools upfront, JAATO exposes only a small set of core tools initially. The model discovers additional tools on-demand through introspection, reducing initial context overhead by 70&ndash;85%.
        </p>
      </section>

      <div class="infography-full">
        <a href="../assets/images/enterprise/jaato_tool_system.png" target="_blank">
          <img src="../assets/images/enterprise/jaato_tool_system.png" alt="Tool System Infography">
        </a>
        <div class="infography-caption">Click to open full-size image in a new tab</div>
      </div>

      <section class="detail-content">

        <h2 id="discoverability-modes">Discoverability Modes</h2>
        <p>
          Every tool in JAATO has a <code>discoverability</code> attribute that controls when it appears in the model's context:
        </p>
        <table>
          <thead>
            <tr><th>Mode</th><th>Behavior</th><th>When to Use</th></tr>
          </thead>
          <tbody>
            <tr><td><strong><code>core</code></strong></td><td>Always loaded in initial context</td><td>Essential tools the model needs immediately</td></tr>
            <tr><td><strong><code>discoverable</code></strong></td><td>Loaded on-demand via introspection</td><td>Specialized tools for specific use cases</td></tr>
          </tbody>
        </table>
        <p>
          All tools default to <code>"discoverable"</code> unless explicitly marked as <code>"core"</code>. This means the traditional approach of loading all tool schemas upfront (8,000&ndash;15,000 tokens) is replaced by an initial load of ~1,500&ndash;2,500 tokens for core tools only.
        </p>

        <h2 id="core-tools">Core Tool Registry</h2>
        <p>
          Core tools represent the minimum viable toolkit for agentic operation, consuming approximately 1,200 tokens:
        </p>
        <table>
          <thead>
            <tr><th>Plugin</th><th>Tool</th><th>Why Core?</th></tr>
          </thead>
          <tbody>
            <tr><td><code>introspection</code></td><td><code>list_tools</code>, <code>get_tool_schemas</code></td><td>Gateway to all other tools &mdash; discovery mechanism</td></tr>
            <tr><td><code>file_edit</code></td><td><code>readFile</code></td><td>Essential for code understanding (most frequent operation)</td></tr>
            <tr><td><code>cli</code></td><td><code>run</code></td><td>Fundamental system interaction (builds, tests, etc.)</td></tr>
            <tr><td><code>environment</code></td><td><code>get_environment</code></td><td>Context awareness (OS, working directory)</td></tr>
            <tr><td><code>todo</code></td><td>8+ tools</td><td>Task management for complex multi-step operations</td></tr>
          </tbody>
        </table>

        <h2 id="introspection">Introspection Mechanism</h2>
        <p>
          The introspection system bridges core and discoverable tools through a two-step workflow:
        </p>
        <ol>
          <li><strong><code>list_tools(category="search")</code></strong> &mdash; Returns available tools in a category with names and descriptions</li>
          <li><strong><code>get_tool_schemas(names=["web_search"])</code></strong> &mdash; Retrieves detailed parameter schemas and <strong>activates</strong> the tool for use</li>
        </ol>
        <p>
          The activation step is critical: calling <code>get_tool_schemas()</code> automatically adds the requested tools to the provider's declared tool list, making them callable. Before this call, the model cannot invoke discoverable tools.
        </p>

        <h3>Available Categories</h3>
        <table>
          <thead>
            <tr><th>Category</th><th>Discoverable Tools</th></tr>
          </thead>
          <tbody>
            <tr><td><code>filesystem</code></td><td>updateFile, writeNewFile, removeFile, moveFile, copyFile, glob_files, list_directory, etc.</td></tr>
            <tr><td><code>search</code></td><td>grep_content, web_search, ast_search</td></tr>
            <tr><td><code>web</code></td><td>fetch_url, fetch_url_post</td></tr>
            <tr><td><code>coordination</code></td><td>delegate (subagents), start_background, save_waypoint, etc.</td></tr>
            <tr><td><code>communication</code></td><td>request_clarification</td></tr>
            <tr><td><code>memory</code></td><td>list_templates, get_template, create_template, etc.</td></tr>
            <tr><td><code>MCP</code></td><td>Dynamic tools from connected MCP servers</td></tr>
          </tbody>
        </table>

        <h2 id="execution-pipeline">Tool Execution Pipeline</h2>
        <p>
          Once a tool is available (core or activated), execution follows a six-step pipeline:
        </p>
        <ol>
          <li><strong>Permission check</strong> &mdash; Gated by the permission plugin (auto-approved, whitelisted, or user prompt)</li>
          <li><strong>Auto-background check</strong> &mdash; Long-running tools may be automatically backgrounded</li>
          <li><strong>Executor lookup</strong> &mdash; Maps tool name to its callable via the plugin registry</li>
          <li><strong>Execute</strong> &mdash; Runs the tool logic, handles streaming if supported</li>
          <li><strong>Result enrichment</strong> &mdash; Plugins can modify or augment results post-execution</li>
          <li><strong>Return to model</strong> &mdash; Success/failure result fed back to the model</li>
        </ol>

        <h2 id="parallel-execution">Parallel Tool Execution</h2>
        <p>
          When the model requests multiple independent tools in a single turn, JAATO executes them concurrently using a thread pool (max 8 workers). This is enabled by default via <code>JAATO_PARALLEL_TOOLS=true</code>.
        </p>
        <p>
          Each tool call receives a unique <code>call_id</code> for correlation. Permission prompts are serialized through a channel lock to ensure the user sees one prompt at a time, even when multiple tools need approval concurrently.
        </p>

        <h2 id="inventory">Tool Inventory Summary</h2>
        <table>
          <thead>
            <tr><th>Category</th><th>Core Tools</th><th>Discoverable Tools</th><th>Total</th></tr>
          </thead>
          <tbody>
            <tr><td>Introspection</td><td>2</td><td>0</td><td>2</td></tr>
            <tr><td>Filesystem</td><td>1</td><td>9+</td><td>10+</td></tr>
            <tr><td>System</td><td>1</td><td>2+</td><td>3+</td></tr>
            <tr><td>Coordination</td><td>8+</td><td>5+</td><td>13+</td></tr>
            <tr><td>Search</td><td>0</td><td>3+</td><td>3+</td></tr>
            <tr><td>Web</td><td>0</td><td>2+</td><td>2+</td></tr>
            <tr><td>MCP</td><td>0</td><td>dynamic</td><td>dynamic</td></tr>
            <tr><td><strong>Total</strong></td><td><strong>~14</strong></td><td><strong>~85+</strong></td><td><strong>~100+</strong></td></tr>
          </tbody>
        </table>

        <h2 id="plugin-lifecycle">Plugin Lifecycle</h2>
        <p>
          Tools are provided by plugins managed through the <code>PluginRegistry</code>. Each plugin goes through four phases:
        </p>
        <ol>
          <li><strong>Discovery</strong> &mdash; Registry scans entry points and <code>shared/plugins/</code> directory</li>
          <li><strong>Exposure</strong> &mdash; Plugin is initialized, auto-wired (registry, session, workspace), schemas and executors registered</li>
          <li><strong>Operation</strong> &mdash; Plugin provides schemas, executors, system instructions, and handles tool calls</li>
          <li><strong>Shutdown</strong> &mdash; Plugin cleanup on unexpose or session end</li>
        </ol>

      </section>

      <a href="index.html" class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        Back to Enterprise Overview
      </a>
    </main>
  </div>

  <script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"></script>
  <script src="../assets/js/docs.js"></script>
</body>
</html>
