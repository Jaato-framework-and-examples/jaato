000010*PARMMVS COMPILER=ENTCOB63                                        00001099
000020*PARMMVS PARM.CIC=(SP)                                            00002099
000030*PARMMVS ENV=CICS                                                 00003099
000040*PARMMVS INTERTEST=TXY                                            00004099
000050******************************************************************00005099
000060*********CRIDA AL APLICATIU AL PARAGRAF 087-LINK...=> @Ñ@Ñ@Ñ@ ****00006099
000070*********--> ULTIM PARAGRAF UTILITZAT 135-.... <==****************00007099
000080*  ===== IMPORTANT >>>>>>                                        *00008099
000090*                                                                *00009099
000100*  PER QUE FUNCIONI LA INICIALITZACIÓ DE PANTALLES TF S'HA       *00010099
000110*  D'ACTIVAR (AQPM) REG. 87 DE FAQ400, POSANT A LA POSICIO 18    *00011099
000120*  EL TEXT  =  INI.TF EMU  (TF PER TERM.FINANCER I EMU PER 3270) *00012099
000130*                                                                *00013099
000140*  AQUEST MODUL ESTA PREPARAT PER PROVAR LA INICIALITZACIO DE    *00014099
000150*  PANTALLES 3270 QUAN F030-AQ3TIP05 = 'I'                       *00015099
000160*                                                                *00016099
000170******************************************************************00017099
000180*                                                                *00018099
000190* nota 23.10.2001  Quan les transaccions AQPn actualitzin la CCT *00019099
000200*                  per activar o desactivar les funcions de      *00020099
000210*                  l'Audit, 4Ulls i LORTAD, modificar aquest mo- *00021099
000220*                  dul de manera que es controli l'accés a aques-*00022099
000230*                  tes funcions (SW-ACCES-AUDIT etc) abans d'acce*00023099
000240*                  dir-hi                                        *00024099
000250******************************************************************00025099
000260*   L O G   D E   M O D I F I C A C I O N E S                    *00026099
000270******************************************************************00027099
000280*  AUTOR  FECHA     DESCRIPCION                                  *00028099
000281******************************************************************00028199
000282* U815151 20.06.25    Changes due to an incident (INC0028564013) *00028299
000283*                     related to storage violation in warnings   *00028399
000284*                     area when turning GDPR into informative.   *00028499
000285*                     Search: *OVER-I                            *00028599
000286******************************************************************00028699
000287* U691404 12.05.25    Changes due to an incident related to KPDB *00028799
000288*                     transaction where remote 4 eyes verificatio*00028899
000289*                     n not possible in teweb (PSSTES-3086)      *00028999
000290*                     Search: *INCIKPDB-I/F                      *00029099
000291******************************************************************00029199
000292* U824727 21.02.24    Introduce support for new data access      *00029299
000293*                     restrictions.                              *00029399
000294*                     Search: *NewSAMGbasedWarnings-I/E          *00029499
000295******************************************************************00029599
000300* U824727 16.02.24    Do not invoke target transaction when      *00030099
000310*                     architecturally-driven online 4Eyes has    *00031099
000320*                     been triggered.                            *00032099
000330*                     Search: *AQDrivenOnl4EyesNoInvProg-I/E     *00033099
000340******************************************************************00034099
000350* U824727 16.02.24    Invoke target program when PF11 and end of *00035099
000360*                     2FA token refresh                          *00036099
000370*                     Search: *InvokeTargetOnEnd2FARefresh-I/E   *00037099
000380******************************************************************00038099
000390* U824727 31.01.24    Avoid 027-CONTROL-ACCESO-TRANSACCION when  *00039099
000400*                     it is the context of a remote verifier task*00040099
000410*                     Search: *NoRACFControlForRemoteVerifier-I/E*00041099
000420******************************************************************00042099
000430* U824727 31.01.24    Introduce support to for architectural     *00043099
000440*                     online 4Eyes solution, where the business  *00044099
000450*                     application is not aware that online 4eyes *00045099
000460*                     online 4eyes being performed.              *00046099
000470*                     Search: *AllowAQDrivenOnline4Eyes-I/E      *00047099
000480******************************************************************00048099
000490* U824727 10.01.23    We fix an historical error by which when   *00049099
000500*                     verifying whether a blocking warning has   *00050099
000510*                     an exception, for this we call the module  *00051099
000520*                     registered in TG1051, if the module returns*00052099
000530*                     some return-code distinct from OK, like for*00053099
000540*                     example EP, this is not recorded correctly *00054099
000550*                     into AQLS but an empty log is produced     *00055099
000560*                     instead. We fix this.                      *00056099
000570*                     Search *FixLogExBloq-I/E                   *00057099
000580******************************************************************00058099
000590* U824727 21.04.23    Changes to support the macro mechanization *00059099
000600*                     layer                                      *00060099
000610*                     Search *MACRO-I/E                          *00061099
000620******************************************************************00062099
000630* U824727 21.04.23    We do not want to invoke the target program*00063099
000640*                     when under 2FA and we also want it to      *00064099
000650*                     get control when the 2FA has been cancelled*00065099
000660*                     with PF3, but receiving always the same    *00066099
000670*                     key code under which the 2FA procedure was *00067099
000680*                     initiated.                                 *00068099
000690*                     Search *AZ2FA-I/E                          *00069099
000700******************************************************************00070099
000710* U824727 17.05.23    Under remote verification, the verifier    *00071099
000720*                     doesn't really need to be authorized to    *00072099
000730*                     run the transaction, because she/he is not *00073099
000740*                     really running it.                         *00074099
000750*                     Search *BROADCAST4EYES-DonotcheckAuth-I/E  *00075099
000760******************************************************************00076099
000770* U824727 08.02.23    We do not want to invoke the target program*00077099
000780*                     when under remote verification.            *00078099
000790*                     Search *BROADCAST4EYES-MoreFixes-I/E       *00079099
000800******************************************************************00080099
000810* U824727 12.12.22    We revert back previous change, as it breaks00081099
000820*                     under 3270, not under TeWeb.               *00082099
000830*                     Search *Revert-Fixes-BROADCAST-I/E         *00083099
000840******************************************************************00084099
000850* U824727 30.11.22    We do not call 4Eyes while in remote       *00085099
000860*                     verification                               *00086099
000870*                     Search *Fixes-BROADCAST-I/E                *00087099
000880******************************************************************00088099
000890* U824727 13.10.22    Realizamos un rollback de la modificacion  *00089099
000900*                     anterior ya que parece que ha producido una*00090099
000910*                     regresion en varios modelos no arquitectura*00091099
000920*                     les.                                       *00092099
000930*                     Buscar *eCDL-Optim-Rollback-I/E            *00093099
000940******************************************************************00094099
000950* U824727 13.10.22    Introducimos varias optimizaciones para    *00095099
000960*                     flujos iniciados desde entorno eCDL y      *00096099
000970*                     relacionados principalmente con la pre-    *00097099
000980*                     existencia del SCR que ya nos viene reser- *00098099
000990*                     vada e incluso con valores validos desde   *00099099
001000*                     la capa externa de eCDL. Estas optimizacio-*00100099
001010*                     nes nos permiten gestionar funcionalidades *00101099
001020*                     de la verificacion remota que involucran a *00102099
001030*                     la AQ44.                                   *00103099
001040*                     Buscar *eCDL-Optim-I/E                     *00104099
001050******************************************************************00105099
001060* U825151  02.12.21 JCF-2-I Nyapa 2: la Nyapa con marca JCF-I fa-*00106099
001070*                           lla en operativa de banca telefónica *00107099
001080*                           con BT21. Se deshace la nyapa 1 y se *00108099
001090*                           pone el cambio en el RAQW370         *00109099
001100******************************************************************00110099
001110* U824727 09.03.22    En 4OJOS online distribuido, mientras se   *00111099
001120*                     este en fase de "polling" esperando que el *00112099
001130*                     usuario remoto indicado verifique la       *00113099
001140*                     operacion, evitamos llamar al programa     *00114099
001150*                     aplicativo.                                *00115099
001160*                     Buscar *BROADCAST4EYES-I/E                 *00116099
001170******************************************************************00117099
001180* U824727 23.02.22    Debido a la modificación introducida en el *00118099
001190*                     RAQW135 para poder tener otros conceptos   *00119099
001200*                     de ICP de tipos '020' o '030' de otras ICP *00120099
001210*                     a parte del de la 'AQ001' (discretos), pero*00121099
001220*                     que en general podria aplicar a cualquier  *00122099
001230*                     otro código de concepto, en este programa  *00123099
001240*                     se introduce un filtro en los datos        *00124099
001250*                     obtenidos del RAQW135                      *00125099
001260*                     Buscar *MULTI020-I                         *00126099
001270******************************************************************00127099
001280* U824727 10.01.22    A¦adimos soporte a simulaciones de estado  *00128099
001290*                     y caso sin navegacion previa, lo cual      *00129099
001300*                     deberia permitir comparar mas directamente *00130099
001310*                     invocaciones de eCDL con invocaciones de   *00131099
001320*                     de Fusion, para funcionalidad equivalente  *00132099
001330*                     Se activa cuando se recibe desde el RAQWE1T*00133099
001340*                     un valor 'SIMUFUSI' en L100-AQFILL1        *00134099
001350*                     Tambien se corrigen "bugs" historicos de   *00135099
001360*                     gestion de contexto eCDL dentro del contex-*00136099
001370*                     to CDL.                                    *00137099
001380*                     Buscar *SIMU-I                             *00138099
001390******************************************************************00139099
001400* U825151  02.12.21 JCF-I-> Nyapa: cada vez que una transaccion  *00140099
001410*                           tiene avisos asociados, bloquea el   *00141099
001420*                           path de la transaccion y muestra un  *00142099
001430*                           mensaje en 3270 que indica que se    *00143099
001440*                           pulse INTRO para continuar, pero al  *00144099
001450*                           pestar bloqueado el path, hay usua-  *00145099
001460*                           rios que no se fijan en eso, intro-  *00146099
001470*                           ducen por error la transaccion en un *00147099
001480*                           campo de pantalla, y al retornar un  *00148099
001490*                           error la transaccion provoca un abend*00149099
001500*                           ASRA. Se corrije - INC0021007820     *00150099
001510******************************************************************00151099
001520* U824221  16.06.21 ADS  -> Getion puntero area de datos de      *00152099
001530*                           salida de txn (extension del mapa)   *00153099
001540******************************************************************00154099
001550* U824221  27.05.21 MODLC-> CAMBIAR LINK AL RAQUA31 POR CALL     *00155099
001560*                           DINAMICA                             *00156099
001570******************************************************************00157099
001580* U824221  03.03.21 MOD01-> DECOMISION LLAMADAS RAQWC01 Y RAQW075*00158099
001590*                           OBSOLETAS EN ENTORNO DE ESPA¦A       *00159099
001600******************************************************************00160099
001610* MIGUEL   27.07.20 P1008-> DECOMISION CODIGO OBSOLETO T.F.      *00161099
001620* LOPEZ                                                          *00162099
001630******************************************************************00163099
001640* MIGUEL   09.06.20 P1006-> Excepcion avisos bloqueantes por     *00164099
001650* LOPEZ                     rutina (TG1051)                      *00165099
001660*                           Rectificar acceso a TG051 por código *00166099
001670*                           de aviso.                            *00167099
001680******************************************************************00168099
001690* J.SIERRA 17.12.19 P1000->  Decomision Codigo CAL390            *00169099
001700******************************************************************00170099
001710* J.Avila  31.05.19 JAR02    Correcion en excepciones de avisos  *00171099
001720*                            GDPR                                *00172099
001730******************************************************************00173099
001740* J.Avila 18.06.19  JAR01    INC0012739522, cambiar centro ope-  *00174099
001750*                            rante por centro de pertenencia para*00175099
001760*                            los centros de excepcion de firma   *00176099
001770*                            diferida                            *00177099
001780******************************************************************00178099
001790* J.Aguilar08.04.19  JAS02   En 3270 si el usuario no es válido  *00179099
001800*                            Mostrara error usuario no autorizado*00180099
001810*                            en vez de un abend.                 *00181099
001820******************************************************************00182099
001830* J.Avila  27.03.19  p133a   Correccion en centros de excepcion  *00183099
001840*                            para firma diferida                 *00184099
001850******************************************************************00185099
001860* J.AGUILAR27.03.19  JAS01   Clientes con +1 aviso GDPR          *00186099
001870******************************************************************00187099
001880* J.SIERRA 12.03.19  INCIDENCIA PAGINACION AQLM (JSP01->)        *00188099
001890******************************************************************00189099
001900* J.FORNES 08.03.19  *TRACET4* Restaurar indicador de trace per- *00190099
001910*                    *dido al acceder a la SCR                   *00191099
001920******************************************************************00192099
001930* J.Aguilar04.12.18 Comprobar que el usuario tecnico esta AQUSTECN00193099
001940*  (J9715-I)        esta autorizado a ejecutar la transacción    *00194099
001950******************************************************************00195099
001960* C.Neto   12.11.18  Centros sin autorización     ICP: (p133->)  *00196099
001970******************************************************************00197099
001980* J.Sierra 19.10.18  Optimización accesos sistema ICP: (p156->)  *00198099
001990******************************************************************00199099
002000* J.Fornés 21.06.18  *P122* Actualizar 'Plataforma Firma Digital'*00200099
002010******************************************************************00201099
002020* J.AVILA  12.02.18  CONSIDERAR AVISOS TIPO 'G' PARA BLOQUEOS    *00202099
002030*                    GDPR                                        *00203099
002040*                    BUSCAR p148                                 *00204099
002050******************************************************************00205099
002060* M.LOPEZ  11.12.17  EN EL TRATAMIENTO DE EXCEPCIONES DE AVISOS  *00206099
002070*                    BLOQUEATES, UTILIZAR UN INDICE DIFERENTE    *00207099
002080*                    PARA BUSCAR EN TABLA DE CODIGOS DE AVISOS   *00208099
002090*                    BUSCAR MLV-ABL                              *00209099
002100******************************************************************00210099
002110* J.FORNES 10.11.17  *Prueba de concep.Avisos bl.posteriori P148 *00211099
002120******************************************************************00212099
002130* J.FORNES 08.11.17  *Mejoras generales en info de las trazas    *00213099
002140******************************************************************00214099
002150* J.FORNES 03.05.17  *1)P137. Se guarda dir.CAQLE00 en CAQL101   *00215099
002160*                    *2)Neutralizar temporalmente P122 hasta su  *00216099
002170*                    *aprobación. Buscar '*>>>>>' y quitar       *00217099
002180******************************************************************00218099
002190* J.FORNES 19.04.17  *Revisión del nivel de valores del Trace    *00219099
002200******************************************************************00220099
002210* J.FORNES 05.04.17  *jfm06  * Control para evitar la navegación *00221099
002220*                    *incorrecta desde un Navegador INC0005905819*00222099
002230*                    *En caso de TRACET activo, no hace rollback *00223099
002240******************************************************************00224099
002250* J.FORNES 20.03.17  *TRACET3* Activar TRACE técnico, si se ha   *00225099
002260*                    *activado desde e-CDL                       *00226099
002270******************************************************************00227099
002280* J.Fornés 12.06.16  *P115d*  En caso de error por CAJA CERRADA  *00228099
002290*   emitir el error JAQE314                                      *00229099
002300******************************************************************00230099
002310* J.Fornés 08.04.16  *P115* Tratamiento específico de AUTORIZACI-*00231099
002320*   ON para valor '3'. Se busca en tabla por transacción/producto*00232099
002330*   Se trata también valor '4' para que busque igualmente y en   *00233099
002340*   caso de no encontrar registro se cosindiera a Autorizar      *00234099
002350******************************************************************00235099
002360* J.Fornés 03.03.16  *P101a  *Se revisa si ha cambiado el valor  *00236099
002370*   del switch de AUTORIZACION en los parámetros de canal        *00237099
002380******************************************************************00238099
002390* J.Fornés 08.02.16  *I82* Incidencia en Avisos Bloqueantes      *00239099
002400******************************************************************00240099
002410* J.Fornés 02.11.15  *P101   *Grabación en el Diario de detalles *00241099
002420*           (jfm05) * de Autorización                            *00242099
002430******************************************************************00243099
002440* J.Fornés 15.10.15  *Avisos *Incidencia. Si no hay avisos blo-  *00244099
002450*           (jfm04) *queantes, se pone el indicador a 0 y se mar-*00245099
002460*                   *ca como que no ha encontrado ninguno         00246099
002470******************************************************************00247099
002480* J.Fornés 13.10.15  *P101   * Se pasa puntero de  SCR  a la mo- *00248099
002490*                    *dificación LCO01 (LCO01b)                  *00249099
002500******************************************************************00250099
002510* J.Fornés 29.09.15  *P101   * Se pasa puntero del mapa a la mo- *00251099
002520*                    *dificación LCO01 (LCO01a)                  *00252099
002530******************************************************************00253099
002540* J.Fornés 04.09.15  *P101   * Traspasar puntero de autorizacio- *00254099
002550*                    *nes, en caso de que esté informado         *00255099
002560******************************************************************00256099
002570* L.CUENDA 11.06.15  *LCO01  * Se pretende evitar, bajo algunas  *00257099
002580*                    *circunstancias, que determinados avisos    *00258099
002590*                    *bloqueantes impidan ejecutar la transacción*00259099
002600*                    *a la que protegen.                         *00260099
002610******************************************************************00261099
002620* J.FORNES 05.12.14  *QO2    * Permitir el estado '2' de QO      *00262099
002630*                    *para operaciones autorizadas               *00263099
002640******************************************************************00264099
002650* J.FORNES 02.12.14  *PEAU2  * Permitir el estado '2' de PEAU    *00265099
002660*                    *para operaciones autorizadas               *00266099
002670******************************************************************00267099
002680* J.FORNES 20.08.14  *p86    * Proyecto ID-51724-03 Gestión de   *00268099
002690*                    *efectivo                                   *00269099
002700******************************************************************00270099
002710* J.FORNES 01.07.13  *TRACET2* Modificación parámetros para faci-*00271099
002720*                    *litar la busqueda                          *00272099
002730******************************************************************00273099
002740* J.FORNES 24.02.13  *i43-Incidencia IN23267266. No se muestran  *00274099
002750*   Avisos en 3270 cuando hay un error aplicativo                *00275099
002760******************************************************************00276099
002770* J.FORNES 22.11.12  *i39-Incidencia debida a que se pasaba siem-*00277099
002780*   pre datos a Avisos cuando a veces eran innecesarios          *00278099
002790******************************************************************00279099
002800* J.FORNES 07.05.12  *ID-51515-06* BPM revisión Clientes         *00280099
002810*                    *Referencia P35. OK, falta crida MODUL 'PI' *00281099
002820******************************************************************00282099
002830* J.FORNES 30.11.11  *AQES00378* Tratamiento es estado=Inicio    *00283099
002840*          Se deriva a RAQW008. Si trx.necesita impresora finan- *00284099
002850*          ciera y no la tiene se actua según parámetros         *00285099
002860******************************************************************00286099
002870* J.FORNES 01.04.11  *TRACET* Acciones para Trace Tecnico        *00287099
002880*                    *SE GRABA EN TAQ01_JOURNAL                  *00288099
002890******************************************************************00289099
002900* U824127 25.03.11 * MLV13. Apéndice a cambios MLV11             *00290099
002910******************************************************************00291099
002920* U824127 01.03.11 * MLV12 Para convertir a solucion "C" 4-Ojos  *00292099
002930*                    solo condicionar que el cambio este verifi- *00293099
002940*                    cado por el usuario y que 4-Ojos halla ac-  *00294099
002950*                    tivado el switch de fin de operacion        *00295099
002960*----------------------------------------------------------------*00296099
002970* U824106 22.02.11 * jfm03. Apéndice a cambios MLV11             *00297099
002980******************************************************************00298099
002990* U824127 16.02.11 * MLV11 Nuevo control de solicitud verificacion00299099
003000*                    on-line de 4-Ojos.                          *00300099
003010******************************************************************00301099
003020* U824106 11.10.10 * jfm02. Control·lar que quan es va a Avisos  *00302099
003030*                    diposem del contracte convertit OK          *00303099
003040******************************************************************00304099
003050* U660222 01.06.10 * MLV01                                       *00305099
003060*                    SI EL RETORNO DEL MODULO RAQW008 ES = 'CI'  *00306099
003070*                    TRATAR COMO ABEND SISTEMA                   *00307099
003080******************************************************************00308099
003090* U823414 20.11.09 * Recicladores (Fase 2) - GFTÑ01              *00309099
003100******************************************************************00310099
003110* U104407 27.08.09 * sense ref. Renumero paragrafs               *00311099
003120******************************************************************00312099
003130* U104407 09.07.09 * JFM01                                       *00313099
003140*                  * A SUGGERENCIA DE J.VINYOLES POSEM NIVELL 01 *00314099
003150*                  * A LA COPY CTGL000 PER EVITAR SOLAPAMENT     *00315099
003160******************************************************************00316099
003170* U660222 02.04.09 * M083                                        *00317099
003180*                  * NO CANCELAR TRANSACCION SDPD AL DETECTARSE  *00318099
003190*                  * BUCLE EN ESTADO INICIO                      *00319099
003200******************************************************************00320099
003210* U660222 04.03.09 * I099                                        *00321099
003220*                  * NO INVOCAR AL SISTEMA DE AVISOS NI AL       *00322099
003230*                  * MODULO RAQW370 SI AQ DETECTA ERROR          *00323099
003240******************************************************************00324099
003250* U660222 02.01.09 * M079                                        *00325099
003260*                  * CONTROL CAMBIO ESTADO INICIO A CONTINUACION *00326099
003270*                  * PARA EVITAR BUCLES                          *00327099
003280******************************************************************00328099
003290* U660222 21.08.08 * A366                                        *00329099
003300*                  * GANAR SIEMPRE AREA CAQL101 Y SI ES ECDL     *00330099
003310*                  * MOVER CAMPO L000-AQTPDOCU A L101-AQTPDOCU   *00331099
003320******************************************************************00332099
003330* U660222 28.10.08 * I093                                        *00333099
003340*                  * AL VALIDAR SI UNA TRANSACCION TIENE ACTIVO  *00334099
003350*                  * EL INDICADOR DE LOPD UTILIZAR UN SWITCH     *00335099
003360*                  * DIFERENTE AL DE LA COPY CAQF030, YA QUE SI  *00336099
003370*                  * SE HAN LEIDO DATOS DE OTRA TRANSACCION POR  *00337099
003380*                  * EXISTIR UN RECAMBIO SE UTILIZARIA EL DE LA  *00338099
003390*                  * NUEVA TRANSACCION                           *00339099
003400******************************************************************00340099
003410* U823410 18.03.08 * M057b                                       *00341099
003420*                  * PAGINACION NO ARQUITECTURAL.                *00342099
003430******************************************************************00343099
003440* U823410 18.03.08 * A325b                                       *00344099
003450*                  * EN PAGINACION AL VOLVER A MOSTRAR UNA PAGINA*00345099
003460*                  * YA VISUALIZADA NO PASAR EL CONTROL LOPD     *00346099
003470******************************************************************00347099
003480* U823410 04.03.08 * A348                                        *00348099
003490*                  * ADAPTACION PARA LINK SEGURO                 *00349099
003500******************************************************************00350099
003510* U660222 22.01.08 * i082                                        *00351099
003520*                  * LIMITAR LA GENERACION DE DOCUMENTOS A       *00352099
003530*                  * CAL-390                                     *00353099
003540******************************************************************00354099
003550* U104407 17.05.07 * M067                                        *00355099
003560*                  * Informar idioma sol·lic. x usuari           *00356099
003570******************************************************************00357099
003580* U104407 17.05.07 * M062                                        *00358099
003590*                  * Permetre anar a menú si es 'MEN-VACV'       *00359099
003600******************************************************************00360099
003610* U660222 17.04.07 * M059                                        *00361099
003620*                  * IMPRESION DOCUMENTOS EN RECAMBIO            *00362099
003630******************************************************************00363099
003640* U823296 19.03.07 * M057                                        *00364099
003650*                  * Control paginación no arquitectural         *00365099
003660******************************************************************00366099
003670* U660222 06.02.07 * A338                                        *00367099
003680*                  * Si eCDL informar el idioma de usuario       *00368099
003690******************************************************************00369099
003700* U660222 19.01.07 * A336                                        *00370099
003710*                  * Iniciar L100-AQSWPRTD                       *00371099
003720******************************************************************00372099
003730* U660222 21.11.06 * M050                                        *00373099
003740*                  * SI CAL390 Y PBC DESACTIVAR INDICADOR DE     *00374099
003750*                  * PAGINACION                                  *00375099
003760*                  *                                             *00376099
003770******************************************************************00377099
003780* U660222 17.10.06 * M044                                        *00378099
003790*                  * APLICAR LAS MACROS DE INICIALIZACION DE     *00379099
003800*                  * PANTALLA PARA CORREOS                       *00380099
003810*                  *                                             *00381099
003820******************************************************************00382099
003830* U660222 16.10.06 * I047                                        *00383099
003840*                  * ACTIVAR L100-CAMBIO-POR-APLICACION TAN SOLO *00384099
003850*                  * SI EL CANAL TIENE ACTIVADO EL SWITCH DE     *00385099
003860*                  * NAVEGACION                                  *00386099
003870*                  *                                             *00387099
003880******************************************************************00388099
003890* U660222 04.09.06 * M042 PARCHE DISPENSADOR                     *00389099
003900*                  *                                             *00390099
003910******************************************************************00391099
003920* U660222 04.09.06 * I045                                        *00392099
003930*                  *                                             *00393099
003940*                  * LLAMADA AL CONTROLADOR DE NAVEGACION AUN    *00394099
003950*                  * CUANDO LA TRANSACCION ANTERIOR ES IGUAL A   *00395099
003960*                  * LA ACTUAL Y ESTE ACTIVO EL SWITCH DE RECAM- *00396099
003970*                  * BIO DE TRANSACCION                          *00397099
003980*                  *                                             *00398099
003990******************************************************************00399099
004000* U660222 14.09.06 * M039                                        *00400099
004010*                  *                                             *00401099
004020*                  * SI eCDL Y RECAMBIO, Y LA TRANSACCION DESTI- *00402099
004030*                  * NO ES UN MENU DE APLICACION NO REALIZAR EL  *00403099
004040*                  * RECAMBIO                                    *00404099
004050*                  *                                             *00405099
004060******************************************************************00406099
004070* U660222 01.09.06 * i039                                        *00407099
004080*                  *                                             *00408099
004090*                  * MAQUILLAR LOS ERRORES DE ACCESO AL MODULO   *00409099
004100*                  * RSLW060, COMO USUARIO NO AUTORIZADO         *00410099
004110*                  *                                             *00411099
004120******************************************************************00412099
004130* U660222 30.08.06 * A326b                                       *00413099
004140*                  *                                             *00414099
004150*                  * RECTIFICAR LA SIMULACION DEL INICIO PARA    *00415099
004160*                  * ECDL                                        *00416099
004170*                  *                                             *00417099
004180******************************************************************00418099
004190* U660222 11.08.06 * I036                                        *00419099
004200*                  *                                             *00420099
004210*                  * APLICAR CONTROL IMPRESORA A LOS TIPOS DE    *00421099
004220*                  * PUESTO "OS22"                               *00422099
004230*                  *                                             *00423099
004240******************************************************************00424099
004250* U660222 28.06.06 * A327                                        *00425099
004260*                  *                                             *00426099
004270*                  * NO INVOCAR APLICACION SI POSPONER OPERACION *00427099
004280*                  *                                             *00428099
004290******************************************************************00429099
004300* U660222 28.06.06 * A283                                        *00430099
004310*                  *                                             *00431099
004320*                  * INFORMAR NUEVOS CAMPOS DEL AREA DE ENLACE   *00432099
004330*                  * CON RAQW085                                 *00433099
004340*                  *                                             *00434099
004350******************************************************************00435099
004360* U660222 22.05.06 * I032                                        *00436099
004370*                  *                                             *00437099
004380*                  * RECTIFICAR CONTROL DE EJECUCION DE TRANSAC- *00438099
004390*                  * CIONES ENTRE TF Y TWEB                      *00439099
004400*                  *                                             *00440099
004410******************************************************************00441099
004420* U660222 11.05.06 * M028b                                       *00442099
004430*                  *                                             *00443099
004440*                  * APLICAR LA CONDICION ANTERIOR SOLO A LA     *00444099
004450*                  * PAGINACION ARQUITECTURAL                    *00445099
004460*                  *                                             *00446099
004470******************************************************************00447099
004480* U660222 10.05.06 * M029                                        *00448099
004490*                  *                                             *00449099
004500*                  * ALMACENAR PAGINA SI ESTADO INICIO Y SWITCH  *00450099
004510*                  * L100-HAY-MAS-DATOS ACTIVO                   *00451099
004520*                  *                                             *00452099
004530******************************************************************00453099
004540* U660222 02.05.06 * A326                                        *00454099
004550*                  *                                             *00455099
004560*                  * ABRIR NUEVO FAST-PATH 3270 A TODOS LOS      *00456099
004570*                  * USUARIOS                                    *00457099
004580*                  *                                             *00458099
004590******************************************************************00459099
004600* U660222 26.04.06 * M028                                        *00460099
004610*                  *                                             *00461099
004620*                  * CONDICIONAR TAMBIEN LA ELIMINACION DE LAS   *00462099
004630*                  * PAGINAS DE UNA TRANSACCION CUANDO HAYA SIDO *00463099
004640*                  * INICIADA POR RECAMBIO                       *00464099
004650*                  *                                             *00465099
004660******************************************************************00466099
004670* U660222 13.04.06 * A326                                        *00467099
004680*                  *                                             *00468099
004690*                  * PASAR FAST-PATH 3270 A SERVICIO NAVEGACION  *00469099
004700*                  *                                             *00470099
004710******************************************************************00471099
004720* U660222 05.04.06 * A325                                        *00472099
004730*                  *                                             *00473099
004740*                  * MEJORAS LORTAD                              *00474099
004750*                  *                                             *00475099
004760******************************************************************00476099
004770* U660222 07.03.06 * M023                                        *00477099
004780*                  *                                             *00478099
004790*                  * CONTROL NUMERO SECUENCIA DE TRANSACCION PARA*00479099
004800*                  * DB-DIRECT                                   *00480099
004810*                  *                                             *00481099
004820******************************************************************00482099
004830* U660222 07.03.06 * I021                                        *00483099
004840*                  *                                             *00484099
004850*                  * NO INVOCAR AL MODULO RAQW135 SI ENTRADA CCT *00485099
004860*                  * ES "MEN-" + APLICACION, YA QUE SOLO CON     *00486099
004870*                  * "MEN-" SE ESTABA LIMITANDO A OTRAS TRANSAC- *00487099
004880*                  * CIONES QUE NO ERAN MENU DE APLICACION       *00488099
004890*                  *                                             *00489099
004900******************************************************************00490099
004910* U660222 07.03.06 * I020                                        *00491099
004920*                  *                                             *00492099
004930*                  * NO INVOCAR A RAQWA11 DESPUES DE HABER LLA-  *00493099
004940*                  * MADO A LA APLICACION SI LA CUENTA CCC NO    *00494099
004950*                  * ES NUMERICO                                 *00495099
004960*                  *                                             *00496099
004970******************************************************************00497099
004980* U660222 07.03.06 * M021                                        *00498099
004990*                  *                                             *00499099
005000*                  * ABRIR VALIDACION COMPATIBILIDAD DE TERMINAL *00500099
005010*                  * AL ENTORNO ECDL Y MOVER ESTA VALIDACION AL  *00501099
005020*                  * PARRAFO 029-PROCESO-PROGRAMA                *00502099
005030*                  *                                             *00503099
005040******************************************************************00504099
005050* U660222 24.02.06 * I018                                        *00505099
005060*                  *                                             *00506099
005070*                  * DESPUES DE REALIZAR UN FAST-PATH CON TRAS-  *00507099
005080*                  * PASO TOTAL, OSEA SIMULANDO LA CONSULTA,     *00508099
005090*                  * SE HA DE SALVAR EL SCR Y EL MAPA            *00509099
005100*                  *                                             *00510099
005110******************************************************************00511099
005120* U660222 06.02.06 * M010                                        *00512099
005130*                  *                                             *00513099
005140*                  * AL INVOCAR A RAQW085 EN EL PROCEDIMIENTO    *00514099
005150*                  * 099-ABEND-PROC MOVER '00' A L085-AQCDIDIO   *00515099
005160*                  *                                             *00516099
005170******************************************************************00517099
005180* U660222 01.02.06 * I014                                        *00518099
005190*                  *                                             *00519099
005200*                  * DESACTIVAR INDICADOR FIRMA ELECTRONICO NECE-*00520099
005210*                  * SARIA. L100-AQSWFIRM                        *00521099
005220*                  *                                             *00522099
005230******************************************************************00523099
005240* U660222 30.01.06 * M016                                        *00524099
005250*                  *                                             *00525099
005260*                  * INVOCACION EXIT REBU110 PARA DBDIRECT ECDL  *00526099
005270*                  *                                             *00527099
005280******************************************************************00528099
005290* U660222 09.01.06 * M010                                        *00529099
005300*                  *                                             *00530099
005310*                  * OBTENER EL TEXTO GENERICO DE LOS MENSAJES   *00531099
005320*                  * DE TIPO ABEND                               *00532099
005330*                  *                                             *00533099
005340******************************************************************00534099
005350* U660222 21.12.05 * I013                                        *00535099
005360*                  *                                             *00536099
005370*                  * SOLO ENTORNO ECDL                           *00537099
005380*                  * INFORMAR EL CAMPO L100-AQCDTRFI CON EL CODI-*00538099
005390*                  * GO DE TERMINAL FISICO DEL TERMINAL OPERANTE *00539099
005400*                  * CAMPO F060-AQCDTRFi                         *00540099
005410*                  *                                             *00541099
005420******************************************************************00542099
005430* U660222 16.12.05 * M009                                        *00543099
005440*                  *                                             *00544099
005450*                  * NUEVO RETORNO ECDL USUARIO NO AUTORIZADO    *00545099
005460*                  * A EJECUTAR UNA TRANSACCION                  *00546099
005470*                  *                                             *00547099
005480******************************************************************00548099
005490* U660222 14.12.05 * M002                                        *00549099
005500*                  *                                             *00550099
005510*                  * LIBERAR EL CONTROL DE IMPRESORAS A TODOS    *00551099
005520*                  * LOS USUARIOS                                *00552099
005530*                  *                                             *00553099
005540******************************************************************00554099
005550* U660222 21.11.05 * I005                                        *00555099
005560*                  *                                             *00556099
005570*                  * RECTIFICAR EL CONTROL PARA FORZAR LA TRAN-  *00557099
005580*                  * SACCION A ESTADO INICIO Y CASO 1, YA QUE    *00558099
005590*                  * SI SE HACE PARA ECDL ADEMAS SE TIENE QUE    *00559099
005600*                  * REALIZAR LA SIMULACION DE INICIO            *00560099
005610*                  *                                             *00561099
005620******************************************************************00562099
005630* U660222 03.11.05 * PROVISIONAL                                 *00563099
005640*                  *                                             *00564099
005650*                  *                                             *00565099
005660*                  *                                             *00566099
005670*                  *                                             *00567099
005680******************************************************************00568099
005690* U660222 20.10.05 * MLV-20-10-05 (M002)                         *00569099
005700*                  *                                             *00570099
005710*                  * SI EBRANCH,NO PERMITIR EJECUTAR LA TRANSAC- *00571099
005720*                  * CION SI LA TRANSACCION IMPRIME, LA IMPRESO- *00572099
005730*                  * RA DEL PUESTO ES 'IBM 4722' Y EL TIPO DE    *00573099
005740*                  * PUESTO ES 'OS2'                             *00574099
005750******************************************************************00575099
005760*                  *                                             *00576099
005770* U660222 20.10.05 * MLV-20-10-05 (I003)                         *00577099
005780*                  *                                             *00578099
005790*                  * SI GT03 INCIAR PAGINA ACTUAL = 1 Y PAGINA   *00579099
005800*                  * TOTAL = 0                                   *00580099
005810******************************************************************00581099
005820* U660222 20.10.05 * MLV-20-10-05                                *00582099
005830*                  *                                             *00583099
005840*                  * ELIMNINAR CAMBIOS EN LAS LLAMADAS A RAQW135 *00584099
005850*                  * PARA TRASPASAR A INTEGRACION                *00585099
005860*                  *                                             *00586099
005870*                  * NEUTRALIZAR MODIFICACION M002               *00587099
005880*                  *                                             *00588099
005890******************************************************************00589099
005900* U660222 19.10.05 * MLV-19-10-05                                *00590099
005910*                  *                                             *00591099
005920*                  * ANULAR CAMBIO ANTERIOR PARA PODER TRASPASAR *00592099
005930*                  * A INTEGRACION                               *00593099
005940*                  *                                             *00594099
005950******************************************************************00595099
005960* U660222 18.10.05 * MLV-18-10-05 (I003-1)                       *00596099
005970*                  *                                             *00597099
005980*                  * INICIAR LAS TRANSACCIONES PAGINABLES CON    *00598099
005990*                  * PAGINA ACTUAL Y TOTAL = 1                   *00599099
006000*                  *                                             *00600099
006010*                  *                                             *00601099
006020******************************************************************00602099
006030* U660222 18.10.05 * MLV-18-10-05 (I004)                         *00603099
006040*                  *                                             *00604099
006050*                  * ANULAR EL INDICADOR DE MENSAJES INESPERADOS *00605099
006060*                  * Y MOVER ESPACIOS A L100-AQ1ERRCD SOLO SI HAY*00606099
006070*                  * MENSAJES INESPERADOS Y TAMBIEN AVISOS A     *00607099
006080*                  * POSTERIORI EMU 3270                         *00608099
006090*                  *                                             *00609099
006100******************************************************************00610099
006110* U660222 10.10.05 * MLV-10-10-05 (I002)                         *00611099
006120*                  *                                             *00612099
006130*                  * PARA VALIDAR A TRAVES DE RSLW060 SI EL USUA-*00613099
006140*                  * RIO ESTA AUTORIZADO A EJECUTAR LA TRANSAC - *00614099
006150*                  * CION, TOMAR EL CODIGO DE TRANSACCION DEL    *00615099
006160*                  * CAMPO L100-AQ1TRANT                         *00616099
006170*                  *                                             *00617099
006180*                  * PONER EL CONTROL DE ACCESO DE A TRANSACCION *00618099
006190*                  * DESPUES DE:                                 *00619099
006200*                  *    025-TRACE-RECEIVE                        *00620099
006210*                  *    026-TRACTAR-CCT-ACTUAL                   *00621099
006220*                  *                                             *00622099
006230*                  * ESTO ES PARA QUE EL CAMPO L100-AQ1TRANT     *00623099
006240*                  * ESTE INFORMADO CON EL CODIGO DE LA TRANSAC- *00624099
006250*                  * CION EN CURSO, Y PARA QUE SI SE HA ACTIVADO *00625099
006260*                  * UN TRACE Y EL USUARIO NO ESTA AUROTIZADO    *00626099
006270*                  * SE GRABA EL MENSAJE DE ENTRADA EN EL TRACE  *00627099
006280*                  *                                             *00628099
006290******************************************************************00629099
006300*                                                                *00630099
006310* U660222 20.09.05 * INCIDENCIA                                  *00631099
006320*                  *                                             *00632099
006330*                  * OBTENER EL AREA DE MEMORIA PARA ALOJAR EL   *00633099
006340*                  * VECTOR DE LAS TECLAS ANTES DE LEER EL SCR   *00634099
006350*                  *                                             *00635099
006360******************************************************************00636099
006370*                                                                *00637099
006380* U660222 15.09.05 * INCIDENCIA                                  *00638099
006390*                  *                                             *00639099
006400*                  * UTILIZAR UN SWITCH ESPECIFICO PARA INDICAR  *00640099
006410*                  * QUE YA SE HA INVOCADO A LA EXIT REBU103 DE  *00641099
006420*                  * SALIDA, NO EL SW-APLICATIVO-NO-LLAMADO, YA  *00642099
006430*                  * QUE AL UTILIZAR ESTE ULTIMO LA PAGINACION   *00643099
006440*                  * NO FUNCIONABA CORRECTAMENTE                 *00644099
006450*                  *                                             *00645099
006460******************************************************************00646099
006470*                                                                *00647099
006480* U660222 09.09.05 * INCIDENCIA                                  *00648099
006490*                  *                                             *00649099
006500*                  * UTILIZAR UN SWITCH PARA NO INVOCAR AL MODULO*00650099
006510*                  * DE AVISOS SI SE DETECTA QUE LA TRANSACCION  *00651099
006520*                  * NO SE PUEDE EJECUTAR EN EL ENTORNO          *00652099
006530*                  *                                             *00653099
006540******************************************************************00654099
006550*                                                                *00655099
006560* U660222 29.08.05  A300                                         *00656099
006570*                  *                                             *00657099
006580*                  * CAMBIAR EL MODULO QUE INCREMENTA EL NUMERO  *00658099
006590*                  * DE OPERACION, ANTES ERA RAQW018, AHORA ES   *00659099
006600*                  * RAQWP01                                     *00660099
006610*                  *                                             *00661099
006620******************************************************************00662099
006630*                  *                                             *00663099
006640* J.ORTIZ  130599  ADAPTACIO DE PGTU010 AL NOU RAQW002           *00664099
006650* M.LOPEZ  180599  INCORPORAR CAMBIOS EFECTUADOS EN PGTU010      *00665099
006660*                  RELACIONANOS CON 4-OJOS (BUSCAR ML180599)     *00666099
006670* J.MERCHAN200599  INCORPORAR CAMBIOS EFECTUADOS EN PGTU010      *00667099
006680*                  RELACIONANOS VERIFICAR USUARIO (JAMB)         *00668099
006690* J.MERCHAN210599  INCORPORAR CAMBIOS EFECTUADOS EN PGTU010      *00669099
006700*                  RELACIONANOS MENSAJES CICS/DLI (JAMB)         *00670099
006710* R.TORTOSA260599  INCORPORAR CAMBIOS EFECTUADOS EN PGTU010      *00671099
006720*                  TRATAMOS EL INDIC. DE ACCESO-TRANSACCION(RTA1)*00672099
006730* M.LOPEZ  270599  INCORPORAR CAMBIOS EFECTUADOS EN PGTU010      *00673099
006740*                  DAR CONFIRMACION DE MONEDA AUTOMATICA SI EL   *00674099
006750*                  CANAL NO ADMITE LA MANUAL                     *00675099
006760* M.LOPEZ  010699  SI SE SOLICITA AUTORIZACION (4-OJOS O PEAU) O *00676099
006770*                  FIRMA ELECRONICA COMPROBAR QUE EL CANAL LO    *00677099
006780*                  ADMITE.                                       *00678099
006790* M.LOPEZ   080699 SI EN LA TRANSACCION ANTERIOR SE SOLICITO     *00679099
006800*                  AUTORIZACION (PEAU O 4-OJOS) Y EL CANAL NO LO *00680099
006810*                  ADMITE, SE ANULA EL INDICADOR DE AUTORIZACION *00681099
006820*                  DEL SCR, PARA QUE NO QUEDE REFLEJADO EN EL    *00682099
006830*                  LOS DE AUDIT/TRAIL                            *00683099
006840* M.LOPEZ   080699 CAMBIO DEL CAMPO L100-AQSIPAIS (PIC X(2)) POR *00684099
006850*                  L100-AQCDPISO (PIC X(3)) CODIGO ISO PAIS      *00685099
006860*                  INFORMAR EN L100-AQLOMONN 724 EN VEZ DE 20    *00686099
006870*                  (CODIGO NUM. MONEDA LOCAL) CUANDO EL PAIS ES  *00687099
006880*                  ESPA#A (CODIGO PAIS 11)                       *00688099
006890* M.LOPEZ   180699 PROVISIONAL. PARA EL CANAL CORREOS (008) Y    *00689099
006900*                  CORREOS IVR (010) CUANDO EL MODULO RQOU002    *00690099
006910*                  RETORNE QUE LA TRANSACCION TIENE SOLUCION DE  *00691099
006920*                  TIPO AUTORIZACION (1) CAMBIAR A SOLUCION TIPO *00692099
006930*                  3                                             *00693099
006940* M.LOPEZ   180699 PROVISIONAL. DESPUES DE RECUPERAR EL SCR      *00694099
006950*                  GUARDAR EL TIPO DE CONEXION (L100-AQTIPCON) EN*00695099
006960*                  UN CAMPO DE WORKING. DESPUES DE INVOVAR AL MO-*00696099
006970*                  DULO DE OBTE7CION DE ATRIBUTOS DEL CANAL CAM- *00697099
006980*                  BIAR SI EL PRODUCTO ES 10,11 O 12 Y FRANCIA   *00698099
006990*                  POR PRODUCTO 04.                              *00699099
007000* M.LOPEZ   210699 PROVISIONAL. DESPUES DE INVOCAR AL MODULO     *00700099
007010*                  DE 4-OJOS RQOU002, SI LA SOLUCION ES DE TIPO  *00701099
007020*                  1 (AUTORIZACION) Y EL CANAL ES 008 ó 010      *00702099
007030*                  (CORREOS O CORREOS IVR) CAMBIAR A SOLUCION 3  *00703099
007040*                  MODIFICANDO EL AREA DE ENLACE DEL MODULO      *00704099
007050*                  BUSCAR MLV210699                              *00705099
007060* M.LOPEZ   290699 RECTIFICAR LLAMADA A LA EXIT DE VALIDACIONES  *00706099
007070*                  DE INTERNET EMPRESAS. BUSCAR ML290699         *00707099
007080*                                                                *00708099
007090* M.LOPEZ   130799 INFORMAR EN EL AREA DE ENLACE DEL MODULO      *00709099
007100*                  RAQW163 EL CODIGO DE USUARIO EXTERNO. ML130799*00710099
007110* J.MERCHAN 110899 INCLUIR CAMPO IDIOMA IMPRESION -AQCDIDIM-     *00711099
007120* M.LOPEZ   020999 NO ARRANCAR LAS TRANSACCION AQ47, AQ14 Y AQ48 *00712099
007130*                  SI EL USUARIO CONECTADO NO ESTA AUTORIZADO A  *00713099
007140*                  EJECUTAR LA AQ47                              *00714099
007150* M.LOPEZ   070999 SI AL SIMULAR EL ESTADO INICIO PARA TF SE DE- *00715099
007160*                  TECTA UN ABEND, SE ACTIVA EL INDICADOR        *00716099
007170*                  SW-APLICATIVO-LLAMADO PARA QUE SEA INVOCADA   *00717099
007180*                  LA EXIT REBU103 EN LA RUTINA 999-PROC-ABEND   *00718099
007190*                               -------------------              *00719099
007200*                  INVOCAR A LA EXIT DE SALIDA REBU103 AUN CUANDO*00720099
007210*                  SE SOLICITE UNA AUTORIZACION                  *00721099
007220*                               -------------------              *00722099
007230* M.LOPEZ   080999 MOVER LA ENTIDAD OPERANTE AL AREA DE ENLACE   *00723099
007240*                  DEL MODULO RAQW163. BUSCAR ML080999           *00724099
007250*                               -------------------              *00725099
007260* j.ortiz   130999 moure codi idioma a l'area d'enllaç amb el    *00726099
007270*                  modul RAQW250                                 *00727099
007280* J.ORTIZ   140999 MOURE CANAL A AREA ENLLAç 4 ULLS(L002-QOCDMEDA*00728099
007290*                  I ELIMINAR "XAPUSSA"                          *00729099
007300* M.LOPEZ   230999 CAMBIAR NOMBRE TSQ 'QAQAtttt POR QAQttttA     *00730099
007310*                                 TSQ 'QAQ0tttt POR QAQtttt0     *00731099
007320* R.TORTOSA 300999 ELIMINAR CAMPO WORKING DE AUTORIZACION, ANALI-*00732099
007330*                  ZANDO EL CAMPO DE LA SCR AQ1STAUT, PARA GRABAR*00733099
007340*                  EN EL DIARIO (BUSCAR *RT3009).                *00734099
007350* R.TORTOSA 091299 A#ADIR, EN SCR, EL CAMPO DE IDIOMA BASE DE    *00735099
007360*                  GENERACION.                                   *00736099
007370*                  OBTENER AREA DE MEMORIA PARA DATOS DE USUARIO *00737099
007380*                  E INFORMARLA EN ACCESO AL FAQ075, MEDIANTE AL *00738099
007390*                  RAQW075.                                      *00739099
007400* j.ortiz   291299 afegir tractament sol.licitud idioma impressio*00740099
007410*                  AQCDIDIM                                      *00741099
007420* J.ORTIZ   250100 ABANS DE FER EL DISCONNECT, CRIDA AL MODUL DE *00742099
007430*                  MANOLO MORALES RCIU000.                       *00743099
007440* J.ORTIZ   080200 SI TRANSAC. ES DE LOGON ACCES A TAULES GENERAL*00744099
007450*                  DE CANALS(367) PER OBTENIR CANAL DISTRIBUCIO I*00745099
007460*                  TECNOLOGIA                                    *00746099
007470* M.LOPEZ   210200 PARCHE CORREOS. SI SE HA SOLICITADO IDIOMA  DE*00747099
007480*                  IMPRESION, SE FUERZA IDIOMA '00' Y SE VUELVE  *00748099
007490*                  A INVOCAR A LA APLICACION. BUSCAR ML210200    *00749099
007500* M.LOPEZ   230200 ELIMINAR LA MODIFICACION ANTERIOR             *00750099
007510* J.MERCHAN 240200 LLAMADA RTGW991 PARA DATOS DE PAIS EXCLUYENDO *00751099
007520*                  A ESPA#A                                      *00752099
007530* M.LOPEZ   090300 SUSTITUIR EL ACCESO A LA TSQ DE MENSAJES VA-  *00753099
007540*                  RIABLES POR LA LLAMADA AL MODULO RAQW095      *00754099
007550* J.ORTIZ   190400 ELIMINAR ELS MOVES DE LES DADES GLOSS PER     *00755099
007560*                  PORTUGAL I SUBSTITUIR-LES PER CRIDA A RTGW991 *00756099
007570* M.LOPEZ   120500 ELIMINAR LA INCLUSION DE LA COPY CAQL310 Y TO-*00757099
007580*                  DA REFERENCIA A CUALQUIER CAMPO DE LA MISMA.  *00758099
007590*                  MLV120500                                     *00759099
007600* j.Ortiz   010600 inicialitzar camps AQCROCUR i AQCRCAMP (num.  *00760099
007610*                  occurs i nom del camp on hi ha el cursor)     *00761099
007620* JVB       060600 parametrizar gravacio autit/trail          .  *00762099
007630* j.Ortiz   280600 tractar PF1 per iniciar transacció relacionada*00763099
007640*                  AQPF, i link a RAQW392 per preparar CGTL0010  *00764099
007650*                  ABANS I DESPRES DEL LINK ALS APLICATIUS       *00765099
007660* M.LOPEZ   120700 INVOCAR AL MODULO RAQW185 SI LA TRANSACCION   *00766099
007670*                  ES AQVE. BUSCAR MLV120700                     *00767099
007680* M.LOPEZ   170700 ELIMINAR CAMBIOS DEL DIA 12/05/00             *00768099
007690*                                                                *00769099
007700* J.ORTIZ   180700 INCORPORAR EL TRACTAMENT DE TRANSACCIONS TCPIP*00770099
007710*                  (SENSE TERMINAL I CODI TRANSAC.UNIC = TCPI)   *00771099
007720*                  RECEPCIO DADES A TRAVES DE LINK A PAQW000     *00772099
007730* M.LOPEZ   200700 INVOCAR AL MODULO RAQW170 EN ESTADO INICIO,   *00773099
007740*                  CASO 1 PARA ELIMINAR DEL POOL LOS DATOS PARA  *00774099
007750*                  PAGINACION QUE PUDIERAN EXISTIR DEL TERMINAL  *00775099
007760*                  TRANSACCION OPERERANTE. BUSCAR MLV200700      *00776099
007770* M.LOPEZ   020800 PARA TCPIP NO PROVOCAR ABEND 'ZZZZ'           *00777099
007780* M.LOPEZ   210800 RECTIFICAR RUTINA TRANSACCIONES RELACIONADAS  *00778099
007790* M.LOPEZ   050900 EN SOLICITUD DE CAMBIO DE TRANSACCION SI ES   *00779099
007800*                  TCPIP NO ARRANCAR LA NUEVA TRANSACCION        *00780099
007810* J.Ortiz   120900 substituir crida a RAQW250 per RAQW260 que es *00781099
007820*                  la versió cobol de RAQW250(Fast-apth anada)   *00782099
007830* J.ORTIZ   091000 ELIMINAR SYNCPOINT QUAN L'ENTORN ES TCPIP I   *00783099
007840*                  NO GRAVAR AUDIT. FER GETMAIN PER PASSAR L'ADRE*00784099
007850*                  çA DE CAQL160 AL àREA T040                    *00785099
007860* J.ORTIZ   171000 gravar cua ts 'QAQnum.tasca' per guardar scr  *00786099
007870*                  per fer aquesta area accesible a qualsevol mò-*00787099
007880*                  dul llegint aquesta cua.                      *00788099
007890* J.ORTIZ   191000 ELIMINAR ACCES A FAQ400 PER ACCES A RAQW392   *00789099
007900* J.ORTIZ   291000 Accedir a FAQ400, clau 99 i 000000001 (paked) *00790099
007910*                  on en el registre hi ha el numero del mòdul   *00791099
007920*                  que s'ha d'accedir per el Fast-Path.          *00792099
007930* J.ORTIZ   151100 ESBORRAR REG SCR AMBTASCA+SYSID(ADRECES SCR)  *00793099
007940*                  ELIMINAR ACCES A RTGW991 I TRASPASSAR-HO A    *00794099
007950*                  RAQW392 (DADES DEL PAIS)                      *00795099
007960* J.ORTIZ   201100 CAMBIAR DE LUGAR EL TRATAMIENTO DE LA AQVC    *00796099
007970* M.LOPEZ   231100 RECTIFICAR TRATAMIENTO AQVC                   *00797099
007980* M.LOPEZ   241100 CAMBIAR DE LUGAR RUTINA 010-MISSATGE-TCPIP    *00798099
007990* M.LOPEZ   241100 SI TERMINAL = 3270 NO ACTUALIZAR LA ULTIMA    *00799099
008000*                  OPERACION Y FECHA EN LOS DATOS DEL TERMINAL   *00800099
008010*                  BUSCAR MLV241100                              *00801099
008020* JVB       191200 INCOPRORAR CRIDA AL MODUL RAQW022 IMPRESIO DE *00802099
008030*                  DOCUMENTS AFP  jvb191200                      *00803099
008040* M.LOPEZ   281200 INVOCAR 30-OBTENER-... SEA CUAL SEA EL TIPO   *00804099
008050*                  DE TERMINAL                                   *00805099
008060* J.ORTIZ   160101 SI INDICATIU L085-AQ4INTRA (DE MISSATGE D'ABEN*00806099
008070*                  ESTA ACTIVAT A 'S' NO S'HA DE TRANSFORMAR     *00807099
008080*                  A MISSATGE D'ABEND GENERAL JSTB020            *00808099
008090* J.ORTIZ   230101 MOURE INDICADOR DE TIPUS ARXIU A GRAVAR EN EL *00809099
008100*                  MODUL AQW160 (AUDIT/BCA.ELEC. O TOTS DOS)     *00810099
008110* M.LOPEZ   120101 RESPETAR EL CASO SI DESDE LA TRANSACCION AQPF *00811099
008120*                  SE PULSA F3 PARA VOLVER A LA TRANSACCION      *00812099
008130*                  ORIGEN BUSCAR MLV120201                       *00813099
008140* JVB       310101 COMPROBAR IMPORT Y MONEDA EN PERIODE PT EURO  *00814099
008150*                  ELIMINAR DESPUES DE PERIDO SOLO MONEDA EURO   *00815099
008160*                  marca JVB310101                                00816099
008170*                  cambios reimplantados                         *00817099
008180*           050601 nos camp per restaurar tecla de funcio       * 00818099
008190* J.ORTIZ   030501 CONVERTIR EL MISSATGE JGTE200 A JAQE121 VARIA-*00819099
008200*                  BLE PER TAL D'INFORMAR A L'USUARI DE LA TRAN- *00820099
008210*                  SACCIO QUE NO ESTA AUTORITZAT A REALITZAR-LA   00821099
008220* M.LOPEZ   280601 INFORMAR TECLA DE FUNCION EN EL AREA DE EN-   *00822099
008230*                  LACE CON EL MODULO RAQW375                    *00823099
008240* j.ortiz   300701 link a raqw392 amb funcio 'fa' abans de link  *00824099
008250*                  a raqw370                                      00825099
008260* M. LOPEZ  070801 ELIMINAR PARCHE PARA SALVAR DNF DE LA         *00826099
008270*                  TRANSACCION SG06                              *00827099
008280* J.Ortiz   100901 susbtituir lectura FAQ150 per accés al mòdul  *00828099
008290*                  RAQW603                                       *00829099
008300* J.Ortiz   130901 substituir transaccio TCPI per TSPI (X.Bedia) *00830099
008310* M.LOPEZ   190901 INVOCAR A RAQW392 DESDE VARIOS PUNTOS PARA    *00831099
008320*                  TENER DISPONIBLE EL SCR ALTERNATIVO           *00832099
008330* J.Ortiz   161001 No accedir a control 4 Ulls, quan tecla de    *00833099
008340*                  funció es INTRO (028-ACCES-A-4ULLS)           *00834099
008350* J.ORTIZ   161001 NO ACCEDIR A RAQW075(FAQ075) arxiu usuaris si *00835099
008360*                  ES SPAIN (PROVISIONALMENT FINS QUE ESTIGUIN   *00836099
008370*                  ELS PARAMETRES DE FAQ400 UNIFICATS EN UN SOL  *00837099
008380*                  REGISTRE I ACCEDITS A L'INICI DE LA TRANSACCIO*00838099
008390* J.ORTIZ   221001 AVANçAR LA LECTURA DE FAQ030 PER OBTENIR INDI-*00839099
008400*                  CADORS DE TRANSAC. AMB AUDIT, 4 ULLS, LORTAD  *00840099
008410*                  ETC.                                          *00841099
008420*                  REGRAVAR FAQ030 QUAN LA TRANSAC. TINGUI ACTIVA*00842099
008430*                  DA UNA DE LES FUNCIONS ANTERIORS, POSANT A 'S'*00843099
008440*                  EL BYTE CORRESPONENT EN EL REGISTRE FAQ030    *00844099
008450* M.LOPEZ   131101 RECTIFICAR PROCEDIMIENTO PARA SOLICITAR EL    *00845099
008460*                  IDIOMA DE IMPRESION PARA 3270.                *00846099
008470*                  BSCAR MLV131101                               *00847099
008480* JVB       151101 NO FER CRIDA A 4ULL SI S'ESTA CONFIRMANT MONED*00848099
008490* J.L.M     111201 ACCESO A RAQW311 PARA TRATAMIENTO DEL FAQ030  *00849099
008500*                  BUSCAR : JLM-11/12/01                         *00850099
008510* j.ortiz   141201 eliminar les rutines de tractament del fast-  *00851099
008520*                  path, start de trasaccions, comprovar estat   *00852099
008530*                  dels aplicatius i transaccions relacionades i *00853099
008540*                  substituir-ho per accés a 2 mòduls, RAQW007/8 *00854099
008550* J.ORTIZ   241201 ELIMINAR ACCES 4 ULLS PER ACCES A RAQW009     *00855099
008560*                  PASSAR A RAQW163 LA PREPARACIÓ DE L'AREA DE   *00856099
008570* J.V.B     250202 20020225 Traspas area scr de working a Linkage*00857099
008580* J.V.B     130202 LECTURA REGISTRE CAQF409 I GUARDAR PTR A L310 *00858099
008590* J.ORTIZ   250302 SUBSTITUIR ABEND JSTB024 (USUARI CONNECTAT)   *00859099
008600*                  PER UN ERROR JAQE130.PETICIO SUPORT-C.CHAVES  *00860099
008610* J.ORTIZ   040402 ACCES AL MODUL DE PAGINACIO TF PER ENVIAR LES *00861099
008620*                  PAGINES EMMAGATZEMADES I EMMAGATZEMAR PAGINES *00862099
008630* J.V.B     150402 SOBREDIMENSION DE SCR PARA DETECTAR ERRORES   *00863099
008640*                  POR USO INDEBIDO DE ESTE AREA POR APPLIC      *00864099
008650* J.V.B     240402 PRESERVAR EL CENTRE DESPLAÇAT DE L'USUARI EN  *00865099
008660*                  CAS QUE S'HAGI MODIFICAT EL REGISTRE DES DE   *00866099
008670*                  SL15                                          *00867099
008680* J.L.M.    140502 ADAPTACION A WEBBRANCH                        *00868099
008690*                  BUSCAR : JLM-22/05/02                         *00869099
008700* J.V.B     270502 A partir del nuevo indicador aqswrolb se      *00870099
008710*                  realiza rollback si este indicador esta on    *00871099
008720* J.V.B     270502 En caso de awswrolb no se grava scr ni se     *00872099
008730*  .               realiza paginacion                            *00873099
008740* J.V.B     290502 se limita la llamda a raqw022 unicamente      *00874099
008750*                  para 3270, el tf se resuelve en raqw020       *00875099
008760* J.V.B     270502 Por problemas con el orden send/rollback se   *00876099
008770*                  realiza en rollback de lopd en el modulo      *00877099
008780*                  raqw220                                       *00878099
008790* J.L.M.    110602 Se retira actualizacion CCT                   *00879099
008800*                     BUSCAR: JLM-11/06/02                       *00880099
008810* J.ortiz   270702 posar controls en numero secuencia i recanvi  *00881099
008820*                  en entorns TF. Gravacio reg.SCR al trace si   *00882099
008830*                  existeix registre clau 95 arxius FAQ400.      *00883099
008840* M.Lopez   260802 No mover al area CAQLD01 el codigo de ABEND   *00884099
008850*                  si este es variable                           *00885099
008860*                  buscar MLV260802                              *00886099
008870* M.Lopez   290802 Si el Abend es DB2, DLI o CICS se informa como*00887099
008880*                  mensaje variable en CAQLD01                   *00888099
008890*                  buscar MLV290802                              *00889099
008900* J.Ortiz   040902 esborrar punter AQPTRAV (àrea missatges). Di- *00890099
008910*                  reccionar àrea CGTL015 abans de examinar-la   *00891099
008920*                  buscar JO040902                               *00892099
008930* J.Ortiz   090902 Si long. missatge protocol TF és 0, i no es un*00893099
008940*                  recanvi de transacció, finalitzar mòdul.      *00894099
008950* J.Ortiz   160902 NO FER   START-TRANSID QUAN ES UN TERMINAL    *00895099
008960*                  3270 I ESTA ACTIVADA AQUESTA FUNCIO(PAQW000)  *00896099
008970*                  registre 80, arxiu FAQ400                      00897099
008980* J. L. M.  300902 Realizar abend si no se puede grabar diario   *00898099
008990*                  buscar : JLM-30/09/02                          00899099
009000* M. L. V.  181002 CAMBIAR DE LUGAR LA LLAMADA AL TRAMIENTO DEL  *00900099
009010*                  DIARIO EN LA RUTINA 031-FINAL. DEBE ESTAR     *00901099
009020*                  ANTES DEL ENVIO DE LA RESPUESTA AL TERMINAL   *00902099
009030* M. L. V.  231002 CAMBIAR DE LUGAR EL BORRADO DE LA COLA TS     *00903099
009040*                  QUE CONTIENE LOS MENSAJES VARIABLES           *00904099
009050* M. L. V.  251002 POR CAMBIO DE TRANSACCION MOVER EL CODIGO     *00905099
009060*                  DE LA NUEVA TRANSACCION A L100-AQTXTRAN.      *00906099
009070* J.Ortiz   201102 Si és una transacció d'arquitectura (AQ) i el *00907099
009080*                  seu estat es inactiva, i el tipus és = 5, dei-*00908099
009090*                  xar-la executar, en cas d'un tipus diferent i *00909099
009100*                  si està inactiva, no executar-la              *00910099
009110* M.LOPEZ   261102 INICIALIZAR L100-AQ1MPTRI AL RECUPERAR SCR    *00911099
009120* M.LOPEZ   261102 INICIALIZAR L100-AQ1PTRAV AL RECUPERAR SCR    *00912099
009130* M. L. V.  021202 NO ACTIVAR SW-NO-GRABAR-DIARIO DESPUES DE     *00913099
009140*                  INVOCAR AL MODULO RAQW163                     *00914099
009150*                  EN LA RUTINA 031-FINAL CAMBIAR EL LUGAR DONDE *00915099
009160*                  SE BORRA LA TSQ QUE CONTIENE LOS MENSAJES     *00916099
009170*                  VARIABLES                                     *00917099
009180* M. L. V.  091202 INVOCAR AL MODULO RAQW029 DESPUES DE LLAMAR AL*00918099
009190*                  PROGRAMA DE APLICACION PARA VALIDAR ATRIBUTOS *00919099
009200*                  DEL MAPA                                      *00920099
009210* M. L. V.  101202 BORRAR COLA DE MENSAJES VARIABLES AL INICIO   *00921099
009220*                  DE LA TRANSACCION                             *00922099
009230* J. L. M.  020103 Modificar abend si no se puede grabar diario  *00923099
009240*                  buscar : JLM-30/09/02                          00924099
009250* J. L. M.  100103 Tratar abend informado por el RAQW022.        *00925099
009260*                  buscar : JLM-10/01/03                          00926099
009270* J. L. M.  130103 Utilizar terminal lógico en nombre cola de    *00927099
009280*                  mensajes en vez de EIBTRMID                   *00928099
009290*                  buscar : JLM-13/01/03                         *00929099
009300* J. V. B.  200103 CONTOL PARA GRABAR SCR EN CASO DE ROLB-SI     *00930099
009310*                  SI SE TRATA DE FAST-PATH ya que si no se queda*00931099
009320*                  en 555 y no se puede salir de la pantalla(LPD)*00932099
009330* J. ORTIZ  260203 INCORPORACIO FUNCIONS DE PAGNACIó I NAVEGACIO *00933099
009340*                  (ASSOCIADA A LA PAGINACIO),                   *00934099
009350* J. ORTIZ  070303 capar acces a raqwn20 mitjançant sw-pagi que  *00935099
009360*                  no esta activat.                              *00936099
009370*                  Esborrar a 0 F030-AQSWPAGI quan aquest te     *00937099
009380*                  informat un 1.(de traspassos). Eliminar       *00938099
009390*                  quan es determini com pujar indicador des de  *00939099
009400*                  DESING/1, i estigui modificat EXTRAED1(host)  *00940099
009410* J. ORTIZ  130303 INICIALITZAR PANTALLES TF I 3270 (RAQW015)    *00941099
009420*                  ESTA PARAMETRITZAT, REG. 87 ARXIU FAQ400      *00942099
009430* J. L. M.  240403 REALIZAR UNA SEGUNDA GRABACION DEL DIARIO,    *00943099
009440*                  CUANDO LA LORTAD HAYA REALIZADO UN ROLLBACK   *00944099
009450*                  BUSCAR: JLM-24/04/03                          *00945099
009460* J. L. M.  250403 NUEVO CAMPO EN SCR AQUSULAU ( USER DE LA      *00946099
009470*                  ULTIMA AUTORIZACION). SE INICIA EN I CASO 1   *00947099
009480*                  BUSCAR: JLM-25/04/03                          *00948099
009490* J. ORTIZ  280403 Tractament de la totalització. Link a RAQUQ04 *00949099
009500*                  si camp LQ02-AQCDRETO = 'OK'                  *00950099
009510* J.V.B     130303 CRIDA A FUNCIO CONTROL OPERACION AMB COMPRES  *00951099
009520*                  D'EMPLEATS                                    *00952099
009530* J.V.B     130303 ELIMINACIO DE LA CRIDA A MODUL RAQW375        *00953099
009540*                  CONFIRMACIO MONEDA EN PERIODO POST-TRANSITORIO*00954099
009550* J.L.M     190503 TRATAR ERROR EN LLAMADA A RAQW163             *00955099
009560*                  BUSCAR : JLM-19/05/03                         *00956099
009570* J.ORTIZ   230503 QUAN TRANSAC. ES T001 I R001, EN SIMULAR INICI*00957099
009580*                  PASSAR EL PUNTER REAL AQ1MPRI PER TAL QUE EL  *00958099
009590*                  PROGRAMA CORRESPONEN TRACTI LA DATA D,OPERACIó*00959099
009600* M.LOPEZ   030703 ADAPTACIONES POR INCORPORACION DE eCDL        *00960099
009610*                  BUSCAR MLV-03-07-03                           *00961099
009620* J.Ortiz   150703 No fer link a 110-4OJOS-STANDARD quan la tran-*00962099
009630*                  saccio se inicien els camps a traves de RAQW01500963099
009640* M.LOPEZ   150703 NO COMPROBAR LA COMPATILIDAD DEL TERMINAL CON *00964099
009650*                  LA TRANSACCION SI EL ENTORNO EL ECDL          *00965099
009660*                  BUSCAR MLV-15-07-03                           *00966099
009670* M.LOPEZ   130803 VOLVER A DEJAR LA RUTINA DE MOVER LOS DATOS   *00967099
009680*                  DE LA CCT EN LA RUTINA 032-CCT-CONT EN EL     *00968099
009690*                  QUE ESTABA ANTES DE QUE LA MOVIERA JORDI ORTIZ*00969099
009700*                  BUSCAR MLV-13-08-03                           *00970099
009710* M.LOPEZ   140803 NO GRABAR DIARIO ELECTRONICO SI EL ENTORNO ES *00971099
009720*                  eCDL Y EL ESTADO INICIAL ES INICIO            *00972099
009730*                  BUSCAR MLV-14-08-03                           *00973099
009740* M.LOPEZ   030903 ADAPTACIONES NECESARIAS PARA EJECUTAR AQLG    *00974099
009750*                  DESDE ENTORNO eCDL                            *00975099
009760*                  BUSCAR MLV-03-09-03                           *00976099
009770*                  UTILIZAR LA ENTIDAD 0205 AL BUSCAR LOS DATOS  *00977099
009780*                  DEL CANAL SI EL CANAL CORRESPONDE AL 100      *00978099
009790*                  DB-CREDIT INTERNET                            *00979099
009800*                  BUSCAR MLV-03-09-03                           *00980099
009810* M.LOPEZ   040903 SI LOS MODULOS RAQW360 O RAQW361 (AQLG Y GT03)*00981099
009820*                  RETORNAN UN ERROR Y ES ENTORNO eCDL, SE LIBE- *00982099
009830*                  RA EL TERMINAL QUE PREVIAMENTE HA SIDO ASIGNA-*00983099
009840*                  NADO                                          *00984099
009850*                  BUSCAR MLV-04-09-03                           *00985099
009860* M.LOPEZ   040903 CORREGIR EL POSIBLE BUCLE INFINITO EN LAS     *00986099
009870*                  RUTINAS:                                      *00987099
009880*                             117-FORMATEAR-ABEND-DLI            *00988099
009890*                             116-FORMATEAR-ABEND-CICS           *00989099
009900*                  BUSCAR MLV-08-09-03                           *00990099
009910* A. GARCIA 100903 EN LA ASIGNACIÒN DEL TERMINAL eCDL SE DEJA    *00991099
009920*                  DE PASAR EL PUNTERO DE SESIÓN AL ÁREA DE      *00992099
009930*                  ENLACE DEL MÓDULO RAQWE57.                    *00993099
009940*                  BUSCAR AGI-10-09-03                           *00994099
009950* M.LOPEZ   150903 INFORMAR LOS DATOS DEL TERMINAL DE DEFECTO    *00995099
009960*                  ANTES DE ASIGNAR UN TERMINAL PARA eCDL        *00996099
009970*                  BUSCAR MLV-15-09-03                           *00997099
009980* M.LOPEZ   160903 CORREGIR EL POSIBLE BUCLE INFINITO EN LA      *00998099
009990*                  RUTINA:                                       *00999099
010000*                             118-MENSAJE-VARIABLE               *01000099
010010* M.LOPEZ   300903 SI ENTORNO eCDL NO MOVER EL NUMERO DE PAGINA  *01001099
010020*                  A LA COPY DEL SCR                             *01002099
010030*                  BUSCAR MLV-29-09-03                           *01003099
010040* M.LOPEZ   031003 EN EL TRATAMIENTO DE ABEND EN eCDL CAMBIAR EL *01004099
010050*                  MENSAJE DE ABEND POR EL STANDAR CORRESPONDIENTE01005099
010060*                  BUSCAR MLV-03-10-03                           *01006099
010070* J.ORTIZ   151003 ELIMINAR CAMPS L100-AQNBPSBD I L100-AQDLIVCO  *01007099
010080* R.TORTOSA 171003 OBTENER AVISOS A PRIORI/POSTERIORI            *01008099
010090*                  BUSCAR RTA-17-10-03                           *01009099
010100* M.LOPEZ   101103 INCLUIR LLAMADA AL MODULO RSLW060 PARA EL     *01010099
010110*                  CONTROL DEL ACCESO A LA TRANSACCION DESDE eCDL*01011099
010120*                  BUSCAR MLV-11-11-03                           *01012099
010130* hm1       171103 Inclusion de la invocacion al modulo de trace *01013099
010140*                  para consultar activacion/desactivacion.      *01014099
010150*                  Si se produce abend, la arquitectura realiza  *01015099
010160*                  un rollback y pierde los registros de trace.  *01016099
010170* hm1b      171103 Sustitucion de la gravación en fichero de SCR *01017099
010180*                  para el caso de area mal formateada.          *01018099
010190* JORTIZ    120204 SI ES SW-TRANSACCIO (RECANVI ANTERIOR) NO FER *01019099
010200*                  LA INICIALITZACIO DE LA PANTALLA SI ES TF     *01020099
010210* R.TORTOSA 200204 EFECTUAR LLAMADA, SEGUN CONDICIONES, PARA VER *01021099
010220*                  SI HAY AVISOS BLOQUEANTES, ANTES DE LLAMAR AL *01022099
010230*                  PROGRAMA DE LA APLICACION. SI HAY, NO SE LLAMA*01023099
010240*                  Y SE MUESTRAN LOS AVISOS BLOQUEANTES.         *01024099
010250*                  BUSCAR RTA-20-02-04                           *01025099
010260* JORTIZ    230204 SI ES SW-TRANSACCIO (RECANVI ANTERIOR) NO FER *01026099
010270*                  LA INICIALITZACIO DE LA PANTALLA SI ES TF     *01027099
010280* JORTIZ    040304 Afegir accesos a RAQWN08 per eliminar, loca-  *01028099
010290*                  litzar,emmagatzemar les pantalles de paginació*01029099
010300* R.TORTOSA 040204 SE AMPLIAN LAS AREAS DE ENLACE DEL RAQW222 Y  *01030099
010310*                  DEL RAQWA11 CON UN OCCURS DE 20 PARA IDENTIFI-*01031099
010320*                  CAR A UN CLIENTE.                             *01032099
010330* J.ORTIZ   190304 ACCEDIR SEMPRE AL MODUL RAQW075 I MOURE IDIOMA*01033099
010340*                  DE L'USUARI A L078-IDIOUSER (NOU CAMP) PERQUE-*01034099
010350*                  L078-AQCDIDIO S'ESTA MOVENT A BLANCS, NO SE   *01035099
010360*                  EL MOTIU, PERO PER EVITAR PROBLEMES EL MOC    *01036099
010370*                  A UN CAMP NOU.                                *01037099
010380* M.LOPEZ   240304 A265                                          *01038099
010390*                  MODIFICACIONES NECESARIAS PARA:               *01039099
010400*                                                                *01040099
010410*                      - CAMBIO DE TRANSACCION POR TECLA         *01041099
010420*                      - FAST-PATH CON TRASPASO DE DATOS         *01042099
010430*                      - RETORNO TRANSACCION ANTERIOR            *01043099
010440* M.LOPEZ   290304 A268                                          *01044099
010450*                                                                *01045099
010460*                  TRATAR COMO ABEND ARQUITECTURAL LOS ABENDS    *01046099
010470*                  DETECTADOS EN LAS TRANSACCIONES DE CUENTAS:   *01047099
010480*                                                                *01048099
010490*                        TLD3, TLF1, KC10 y KC20                 *01049099
010500*                                                                *01050099
010510* M.LOPEZ   310304 A265                                          *01051099
010520*                                                                *01052099
010530*                  EN EL PARRAFO 032-CCT-CONT SI EL RECAMBIO SE  *01053099
010540*                  HA SOLICITADO COMO CONSECUENCIA DEL FAST-PATH *01054099
010550*                  CON TRASPASO DE DATOS, SE HA DE GUARDAR EL    *01055099
010560*                  AREA INTERNA DE PANTALLA, YA QUE SERA NECESA- *01056099
010570*                  RIA EN LA SIGUIENTE EJECUCION                 *01057099
010580*                                                                *01058099
010590* J.ORTIZ   07.04.04  SI ES 3270 I PF3 I LA TRANSACCIO NO TE     *01059099
010600*                     MENU APLICATIU (MEN-aaaa), AL FER PF3,     *01060099
010610*                     EXECUTAR LA GT05                           *01061099
010620*                                                                *01062099
010630* M.LOPEZ   130404 A265                                          *01063099
010640*                                                                *01064099
010650*                  EN EL PARRAFO 022-LLEGIR-ARXIU-FAQ030 NO FORZAR01065099
010660*                  ESTADO INICIO Y CASO 1 PARA LOS CASOS EN QUE  *01066099
010670*                  EL CAMBIO DE TRANSACCION SE HA PRODUCIDO COMO *01067099
010680*                  CONSECUENCIA DEL RETORNO A LA TRANSACCION AN- *01068099
010690*                  TERIOR EN UN FAST-PATH                        *01069099
010700*                                                                *01070099
010710* M.LOPEZ   210404 A265                                          *01071099
010720*                                                                *01072099
010730*                  INICIAR LA COPY CAQLN09 EN EL INICIO DEL      *01073099
010740*                  PARRAFO 081-LLAMAR-PGM-APLICACION             *01074099
010750*                                                                *01075099
010760* M.LOPEZ   220404 A265                                          *01076099
010770*                                                                *01077099
010780*                  PARA DETERMINAR SI SE HA DE INVOCAR AL CONTRO-*01078099
010790*                  LADOR DE PAGINACION PARA ALMACENAR UNA NUEVA  *01079099
010800*                  PAGINA, SE DE DEBE CUMPLIR QUE EL ULTIMO      *01080099
010810*                  ESTADO Y CASO CON EL QUE SE HA LLAMADO AL     *01081099
010820*                  PROGRAMA DE LA APLICACION HAYA SIDO DIFERENTE *01082099
010830*                  DE ESTADO INICIO Y CASO 1                     *01083099
010840*                                                                *01084099
010850* J.Ortiz   280404 A265                                          *01085099
010860*                                                                *01086099
010870*                  Link al mòdul RAQW450, dspres de l'aplicatiu  *01087099
010880*                  per preparar els missatges dirigits a eCDL    *01088099
010890*                  i que susbtituexen la AQ46.                   *01089099
010900*                                                                *01090099
010910* M.LOPEZ   120504 A265                                          *01091099
010920*                                                                *01092099
010930*                  GRABAR DIARIO ELECTRONICO CUANDO SE HA RETOR- *01093099
010940*                  NADO A LA TRANSACCION ANTERIOR DESPUES DE     *01094099
010950*                  PULSAR PF6                                    *01095099
010960*                                                                *01096099
010970* J.ORTIZ   130504 A272-A274                                     *01097099
010980*                  INCORPORAR LA GESTIO DELS AVISOS BLOQUEJANTS, *01098099
010990*                  A POSTERIORI, DE PEAU I 4 ULLS PER A 3270.    *01099099
011000*                  PREPARACIó àREA CAQL135 (CAMPS DISCRETS + CAMP*01100099
011010*                  DE 4 ULLS) + DADES EXPLICITES DE CAMPS (IMPORT*01101099
011020*                  CCC, NUMECTO ETC.                             *01102099
011030*                                                                *01103099
011040* M.LOPEZ   280504 A265                                          *01104099
011050*                                                                *01105099
011060*                  CAMBIAR DE LUGAR LA LLAMADA AL CONTROLADOR    *01106099
011070*                  DE PAGINACION, CUANDO SE INVOCA PARA ALMACE-  *01107099
011080*                  NAR PAGINAS                                   *01108099
011090* J.ORTIZ   180604                                               *01109099
011100*                  EN ACCIO PRG SI TRANSACCIÓ A ARRANCAR NO ES   *01110099
011110*                  COMPATIBLE AMB TIPUS TERMINAL, PROVOCAR ERROR *01111099
011120*                  EN SUBSTITUCIO DE L'ABEND JGTB137             *01112099
011130* J.ORTIZ   250604                                               *01113099
011140*                  SI LINK A APLICACIO AMB ACCIO 'PRG' I RETORNA *01114099
011150*                  TAMBE ACCIO 'PRG', MODIFICAR-HO A 'TER'       *01115099
011160*                                                                *01116099
011170* M.LOPEZ   200704 A271                                          *01117099
011180*                  LLAMADA AL MODULO DE CONSOLIDACION DE DATOS   *01118099
011190*                  ANTES DE PROVOCAR EL ABEND 'ZZZZ'             *01119099
011200*                                                                *01120099
011210* M.LOPEZ   260704 A271                                          *01121099
011220*                  NO INVOCAR AL MODULO RAQW392 PARA ELIMINAR    *01122099
011230*                  LA COLA TS QUE CONTINE LOS DIRECCIONES DE LAS *01123099
011240*                  AREAS DE SCR, LOG, TRACE, ETC, YA QUE PUEDEN  *01124099
011250*                  SER UTILIZADAS HASTA EL FINAL DE LA TARES.    *01125099
011260*                  LA ELIMINACION  SE DEBE EFECTUAR JUSTO ANTES  *01126099
011270*                  DE FINALIZAR LA EJECUCION DE LA TAREA Y DEBE  *01127099
011280*                  SOLICITARLO EL PROGRAMA DIRECTOR DE CADA UNA  *01128099
011290*                  DE LAS ARQUITECTURAS, ES DECIR SI:            *01129099
011300*                                                                *01130099
011310*                  SOLO CDL: PAQW000                             *01131099
011320*                  ECDL    : PAQWE00                             *01132099
011330*                  CAL390  : RAQXXXX                             *01133099
011340*                                                                *01134099
011350*                  SI SE ELIMINA LA COLA TS CUANDO SE PROVOCA EL *01135099
011360*                  ABEND 'ZZZZ'                                  *01136099
011370*                                                                *01137099
011380* j.ortiz   26082004                                             *01138099
011390*                  gravar diari de la transac.gt03, independent  *01139099
011400*                  del tipus del terminal                        *01140099
011410* j.ortiz   16092004 A274                                        *01141099
011420*                  ELIMINAR ACCES A RAQW365 (4 ULLS) I FER-HO A  *01142099
011430*                  TRAVES DE RAQW135                             *01143099
011440* j.ortiz   23092004                                             *01144099
011450*                  ELIMINAR EL CONTROL QUE ES FEIA DE QUE SI ACCIO01145099
011460*                  ABANS DE LINK PROG.APLICATIU ERA 'PRG' I TORNA-01146099
011470*                  VA TAMBE ACCIO = PRG, ES CANVIAVA A ACCIO TER.*01147099
011480* M.LOPEZ   041004 A271                                          *01148099
011490*                  HACER "SYNCPOINT" DESPUES DE LA LLAMADA AL    *01149099
011500*                  MODULO RAQWL09 Y ANTES DEL ABEND "ZZZZ" PARA  *01150099
011510*                  CONSOLIDAD LO QUE SE PUEDA HABER GRABADO EN   *01151099
011520*                  LAS TABLAS DEL LOG DE ERRORES, TRACE, ETC     *01152099
011530* M.LOPEZ   201004 MLV-20-10-04                                  *01153099
011540*                  SI eCDL TOMAR EL ESTADO Y CASO DEL AREA       *01154099
011550*                  CAQL000 EN VEZ DEL AREA T040-... YA QUE EL    *01155099
011560*                  CAMPO DEL CASO DEL AREA T040 SOLO ES DE UN    *01156099
011570*                  BYTE POR LO QUE SE PRODUCE UN TRUNCAMIENTO    *01157099
011580*                  CUANDO SE UTILIZAN CASOS > 9                  *01158099
011590* J.Ortiz   21102004                                             *01159099
011600*                  link a avisos quan la CCT tingui informat     *01160099
011610*                  l'indicador(ICP), enlloc de de fer la crida   *01161099
011620*                  per a totes les transac.amb camps discrets    *01162099
011630* J.Ortiz   17012005                                             *01163099
011640*                  PER ENTORNS 3270, SI HI HA INDICACIÓ DE MIS-  *01164099
011650*                  SATGE PENDENT (AQ44), I TE INDICACIO D'AVISOS *01165099
011660*                  A POSTERIORI, ANUL.LAR LA AQ44                *01166099
011670* M.LOPEZ   16022005    MLV-16-02-05                             *01167099
011680*                  EN LA RUTINA 099-ABEND-PROC. SI EL ABEND ES   *01168099
011690*                  DE ARQUITECTURA, MOVER MENSAJE DE ABEND GENE- *01169099
011700*                  RAL A L100-AQ1ABNCD                           *01170099
011710* J.ORTIZ   17022005    JO-17-02-05                             * 01171099
011720*                  EN UNA SESSIO SI NO HI HA REG. SCR, GENERAR   *01172099
011730*                  UN ABEND JAQB210, QUE INDICA QUE S'HAN DE     *01173099
011740*                  RECONNECTAR DE NOU                            *01174099
011750* M.LOPEZ   24032005    MLV-29-03-05                             *01175099
011760*                  PARA CAL/390 FORMATEAR CORRECTAMENTE EL AREA  *01176099
011770*                  DE RESPUESTA SI SE PRODUCE UN ABEND DE ARQUI- *01177099
011780*                  TECTURA                                       *01178099
011790* J.ORTIZ   30032005    JO-30-03-05                             * 01179099
011800*                  MOURE SPACES A L100-AQTRFAST DESPRES DE TRAC- *01180099
011810*                  TAR EL FAST-PATH                              *01181099
011820*                  TAR EL FAST-PATH                              *01182099
011830*------------------*--------------------------------------------*|01183099
011840* u660253  30.03.05* A288                                       *|01184099
011850*                  * llamada a raqwc01 exit obtencion user ent  *|01185099
011860*                  * & user branch                              *|01186099
011870*------------------*--------------------------------------------*|01187099
011880* U232804  07.04.05* A291                                       *|01188099
011890*                  * LINK A RAQW018 QUAN PARAMETRE DE CANAL,    *|01189099
011900*                  * AQASGNOP = S (PER ACTUALITZAR NUM.SECUENCIA*|01190099
011910*------------------*--------------------------------------------*|01191099
011920* U232804  14.04.05* A295                                       *|01192099
011930*                  * LINK A RAQW046 PER ESBORRAR LES CUES TS DE *|01193099
011940*                  * MISSATGES VARIABLES                        *|01194099
011950* U232804  18.04.05* A296                                       *|01195099
011960*                  * control de l'entorn (F030-AQ3TIP07) si es  *|01196099
011970*                  * TF o e-CDL(deixar-es ejecutar o no ejecutar*|01197099
011980* U232804  18.04.05* Substituir acces a FAQ400 per determinar si*|01198099
011990*                  * hi ha inicialitzacio de transaccions, i fer*|01199099
012000*                  * ho unicament quan es oficines producte 18  *|01200099
012010* U232804  26.04.05* FER DELETE DE LA CUA TS QAQttttK que conte *|01201099
012020*                  * l'area CAQL135                             *|01202099
012030*                  *                                            *|01203099
012040* U660222  12.05.05* MLV-13-05-2005                             *|01204099
012050*                  *                                            *|01205099
012060*                  * NO INVOCAR AL SERVICIO DE AVISOS A POSTE-  *|01206099
012070*                  * RIORI SI SE HAY UN ERROR DETECTADO POR LA  *|01207099
012080*                  * ARQUITECTURA                               *|01208099
012090*                  *                                            *|01209099
012100* U660222  19.05.05* MLV-19-05-05 A265                          *|01210099
012110*                  *                                            *|01211099
012120*                  * SOLO PARA ECDL.                            *|01212099
012130*                  * TRATAMIENTO DEL CAMBIO DE TRANSACCION,ENTRE*|01213099
012140*                  * TRANSACCIONES RELACIONADAS                 *|01214099
012150*                  *                                            *|01215099
012160* U660222  25.05.05* A303 MLV-25-05-05                          *|01216099
012170*                  *                                            *|01217099
012180*                  * ALMACENAR Y RECUPERAR EL VECTOR DE TECLAS  *|01218099
012190****************************************************************| 01219099
012200*                                                               *|01220099
012210*   LAS ULTIMAS ACTUALIZACIONES ESTAN AL PRINCIPIO DE ESTE LOG  *|01221099
012220*                                                               *|01222099
012230******************************************************************01223099
012240 IDENTIFICATION DIVISION.                                         01224099
012250*                                                                 01225099
012260*AUTHOR.     SISTEMAS  SANT CUGAT                                 01226099
012270*                                                                 01227099
012280*INSTALLATION.  (C) 1991     DB SERVICIOS, SA                     01228099
012290*                                                                 01229099
012300*RESPONSABLE. GFT.                                                01230099
012310*                                                                 01231099
012320 PROGRAM-ID. RAQW001.                                             01232099
012330 ENVIRONMENT DIVISION.                                            01233099
012340 CONFIGURATION SECTION.                                           01234099
012350 SPECIAL-NAMES.                                                   01235099
012360     DECIMAL-POINT IS COMMA.                                      01236099
012370 DATA DIVISION.                                                   01237099
012380 WORKING-STORAGE SECTION.                                         01238099
012390*                                                                 01239099
012400 01  DADES-XXXX  PIC X(42)  VALUE                                 01240099
012410         '*** INICI WORKING STORAGE     ***********'.             01241099
012420 01  DADES-INIC  PIC X(42)  VALUE                                 01242099
012430         '*** RAQW001 DATA 03/07/2003   ***********'.             01243099
012440 01  DADES-INI1  PIC X(42)  VALUE                                 01244099
012450         '*(ADAPTACION POR INCORPORACION ECDL)*   '.              01245099
012460*                                                                 01246099
012470 01  WK-WORKA-SCR.                                                01247099
012480     05  WK-CLAU-SCR   PIC X(6).                                  01248099
012490     05  WK-REGI-SCR   PIC X(4074).                               01249099
012500/                                                                 01250099
012510 01  CUATS-SCR-AREA.                                              01251099
012520     05  CUATS-SCR-TRANS-ORIGEN  PIC X(4).                        01252099
012530     05  CUATS-SCR-MAPA-ORIGEN   PIC X(8).                        01253099
012540     05  CUATS-SCR-COPY-ORIGEN   PIC X(8).                        01254099
012550     05  CUATS-SCR-REGIS.                                         01255099
012560        10  CUATS-SCR-CLAU.                                       01256099
012570             15  CUATS-SCR-S          PIC X  VALUE 'S'.           01257099
012580             15  CUATS-SCR-TRM        PIC X(4).                   01258099
012590             15  CUATS-SCR-N          PIC X VALUE 'N'.            01259099
012600        10  CUATS-DATOS               PIC X(4074).                01260099
012610*                                                                 01261099
012620*                                                                 01262099
012630 01  F400-CAQF400.                                                01263099
012640   05 F400-AQCLF400.                                              01264099
012650     10 F400-AQCDREGT           PIC 9(2).                         01265099
012660     10 FILLER                  PIC X(5).                         01266099
012670   05 F400-AQCDTRAD             PIC X(993).                       01267099
012680   05 F400-AQCDTRAR REDEFINES F400-AQCDTRAD.                      01268099
012690      10  F400-AQCDTRAN    PIC X(2) OCCURS 50 TIMES.              01269099
012700      10  FILLER           PIC X(893).                            01270099
012710*                                                                 01271099
012720*p133->                                                           01272099
012730 01 WORKING-TABLA-1248.                                           01273099
012740   05 WS-IDX-TRANS              PIC 9(2) VALUE ZEROES.            01274099
012750*p133<-                                                           01275099
012760*                                                                 01276099
012770*                                                                 01277099
012780*                                                                 01278099
012790     COPY CAQW001.                                                01279099
012800*tracet->                                                         01280099
012810*                                                                 01281099
012820     COPY CAQL700.                                                01282099
012830*tracet<-                                                         01283099
012840*                                                                 01284099
012850                                                                  01285099
012860 01  AREA-CAQLP01.                                                01286099
012870     COPY CAQLP01.                                                01287099
012880*                                                                 01288099
012890 01  AREA-CAQL046.                                                01289099
012900     COPY CAQL046.                                                01290099
012910*                                                                 01291099
012920 01  AREA-CAQLL09.                                                01292099
012930     COPY CAQLL09.                                                01293099
012940*                                                                 01294099
012950*A348.I                                                           01295099
012960*    Copy                                                         01296099
012970*--> AREA ENLACE CON MODULO 'RAQW056' (GESTION FIRMA)             01297099
012980 01  AREA-CAQL056.                                                01298099
012990     COPY CAQL056.                                                01299099
013000*A348.F                                                           01300099
013010*P35->                                                            01301099
013020* Copy módul RAQUA31(acces consulta taula AVISOS)                 01302099
013030 01  AREA-CAQLA31.                                                01303099
013040     COPY CAQLA31.                                                01304099
013050* Copy módul RPIW602 (comunicación con BPM desde Partner Data)    01305099
013060 01  AREA-RPIW602.                                                01306099
013070     COPY XPWSTDIO.                                               01307099
013080     COPY CPIL602.                                                01308099
013090*P35<-                                                            01309099
013100*LCO01.I                                                          01310099
013110* Copy para LINKAGE de todos los módulos aplicativos que se       01311099
013120* utilicen para excepción de avisos bloqueantes.                  01312099
013130 01  AREA-CAQLAEB.                                                01313099
013140     COPY CAQLAEB.                                                01314099
013150*LCO01.F                                                          01315099
013160*p133->                                                           01316099
013170* Copy TG 1248 (Permisos para la Firma Digital)                   01317099
013180     COPY CTGT1248.                                               01318099
013190*p133<-                                                           01319099
013200*                                                                 01320099
013210 01  FILLER      PIC X(42)  VALUE                                 01321099
013220         'PR.RAQW001 -dades-cuatd   ****************'.            01322099
013230*                                                                 01323099
013240*                                                                 01324099
013250 01  DADES-CUATD.                                                 01325099
013260     04  LONGET           PIC S9(8)   COMP VALUE 0.               01326099
013270     04  LONG-CUATD-CICS  PIC S9(4)   COMP VALUE +132.            01327099
013280     04  NOMBRE-CUATD-CICS PIC X(4)        VALUE 'MSG1'.          01328099
013290*                                                                 01329099
013300     04 FAST-PATH                        PIC X(4).                01330099
013310*    04 SW-FAQ400                        PIC X(1) VALUE '1'.      01331099
013320*hm1b                                                             01332099
013330     04 W-APLI-SAL                       PIC X(4) VALUE SPACES.   01333099
013340     04 SW-FAQ400                        PIC 9(1) VALUE 1.        01334099
013350     04 SW-AVISOS-P                      PIC X(1) VALUE '0'.      01335099
013360*hm1b                                                             01336099
013370     04 SW-INUTIL                        PIC X(1) VALUE '0'.      01337099
013380     04 SW-FASPAT-ANADA                  PIC X(1) VALUE '0'.      01338099
013390     04 SW-FASPAT-TORNA                  PIC X(1) VALUE '0'.      01339099
013400     04 W-SQLCODE                        PIC 9(3) VALUE 0.        01340099
013410*M067->                                                           01341099
013420     04 W-AQCDIDIU                       PIC X(2) VALUE SPACES.   01342099
013430*M067<-                                                           01343099
013440*                                                                 01344099
013450     04  PT-ABSTIME       PIC S9(18)  COMP.                       01345099
013460     04  PT-YYYYMMDD      PIC 9(8).                               01346099
013470     04  PT-YYMMDD        PIC 9(6).                               01347099
013480     04  FILLER REDEFINES PT-YYMMDD.                              01348099
013490         10 PT-YY         PIC 99.                                 01349099
013500         10 PT-MM         PIC 99.                                 01350099
013510         10 PT-DD         PIC 99.                                 01351099
013520     04  PT-TIME          PIC 9(8).                               01352099
013530     04  PT-HHMMSSDS REDEFINES PT-TIME.                           01353099
013540        07  PT-HHMMSS     PIC 9(6).                               01354099
013550        07  PT-DS         PIC 99.                                 01355099
013560     04 WS-TSQ-NOMBRE.                                            01356099
013570        10 FILLER                 PIC X(3) VALUE 'QAQ'.           01357099
013580        10 WS-TSQ-TERMINAL        PIC X(4).                       01358099
013590        10 WS-TSQ-ID-COLA         PIC X(1).                       01359099
013600     04 WS-TSQ-NOM.                                               01360099
013610        10 FILLER                 PIC X(3) VALUE 'QAQ'.           01361099
013620        10 WS-TSQ-TERMAL          PIC X(4).                       01362099
013630        10 FILLER                 PIC X(1) VALUE 'K'.             01363099
013640     04 C-1                       PIC S9(4) COMP  VALUE +1.       01364099
013650*                                                                 01365099
013660 01  CONSTANTES.                                                  01366099
013670*                                                                 01367099
013680*MLV-ABL->                                                        01368099
013690     05 WS-CON-1               PIC S9(4) COMP VALUE 1.            01369099
013700*MLV-ABL<-                                                        01370099
013710*                                                                 01371099
013720     05 W-ENTRADA-MENU-APLIC.                                     01372099
013730        10 FILLER              PIC X(4) VALUE 'MEN-'.             01373099
013740        10 W-ENT-MENU-APLIC    PIC X(4) VALUE SPACES.             01374099
013750     05 C-IBM4722              PIC X(16) VALUE 'IBM 4722        '.01375099
013760     05 C-PUESTO-OS2           PIC X(4)  VALUE 'OS2 '.            01376099
013770     05 C-PUESTO-OS22          PIC X(4)  VALUE 'OS22'.            01377099
013780     05 C-MSK-FA8C8E           PIC X(3)       VALUE X'FA8C8E'.    01378099
013790********** FUNCION DE DIARIO ELECTRóNICO = +5 ****************    01379099
013800     05 WS-AVISOS              PIC  X(1) VALUE ' '.               01380099
013810     05 W-FUNCDIA              PIC S9(4) COMP  VALUE +5.          01381099
013820**************************************************************    01382099
013830     05 W-TERM-TCPIP           PIC X(4) VALUE 'NNNN'.             01383099
013840        88 TERM-TCPIP                VALUE 'TCPI'.                01384099
013850     05 WS-VERSIO-AQ           PIC X(11) VALUE '*VERSIO-AQ*'.     01385099
013860     05 W-TEXT-08              PIC X(26) VALUE '*VERSIO-AQ*'.     01386099
013870     05 WS-DATA-1              PIC X(10) VALUE '23.05.2001'.      01387099
013880     05 WS-VERS-1              PIC X(48) VALUE                    01388099
013890        '*ANUL.LACIO TRUCADES A RAQW392 PER GRAVAR TRACE*'.       01389099
013900     05 WS-DATA-2              PIC X(10) VALUE 'XX.XX.XXXX'.      01390099
013910     05 WS-VERS-2              PIC X(48) VALUE                    01391099
013920        'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'.       01392099
013930*                                                                 01393099
013940     05 WS-CANVIS-AQ           PIC X(11) VALUE '*CANVIS-AQ*'.     01394099
013950     05 WS-DACA-1              PIC X(10) VALUE '23.05.2001'.      01395099
013960     05 WS-CANV-1              PIC X(6)  VALUE '*AXXX*'.          01396099
013970     05 WS-DACA-2              PIC X(10) VALUE 'XX.XX.XXXX'.      01397099
013980     05 WS-CANV-2              PIC X(6)  VALUE '*AXXX*'.          01398099
013990     05 WS-DACA-3              PIC X(10) VALUE 'XX.XX.XXXX'.      01399099
014000     05 WS-CANV-4              PIC X(6)  VALUE '*AXXX*'.          01400099
014010     05 SW-PAGI                PIC X(1)  VALUE '*'.               01401099
014020     05 SW-ENTORN-EBRANCH      PIC X(1)  VALUE ' '.               01402099
014030*MODLC-I                                                          01403099
014040     05 CON-RAQUA31            PIC X(07) VALUE 'RAQUA31'.         01404099
014050*MODLC-F                                                          01405099
014060*                                                                 01406099
014070*M044->                                                           01407099
014080     05 SW-EJECUCION-MACROS    PIC S9(2) COMP VALUE 0.            01408099
014090        88 SW-NO-EJECUTAR-MACROS VALUE 0.                         01409099
014100        88 SW-SI-EJECUTAR-MACROS VALUE 1.                         01410099
014110*<-M044                                                           01411099
014120*                                                                 01412099
014130*MLV13->                                                          01413099
014140     05 SW-MENSAJE-4OJOS       PIC S9(2) COMP VALUE 0.            01414099
014150        88 SW-NO-MENSAJE-4OJOS  VALUE 0.                          01415099
014160        88 SW-SI-MENSAJE-4OJOS  VALUE 1.                          01416099
014170*MLV13<-                                                          01417099
014180*                                                                 01418099
014190*p133->                                                           01419099
014200     05 SW-TG1248-ENCONTRADO   PIC X(1) VALUE 'N'.                01420099
014210        88 SW-TG1248-SI-ENCONTRADO      VALUE 'S'.                01421099
014220        88 SW-TG1248-NO-ENCONTRADO      VALUE 'N'.                01422099
014230     05 WS-CDRETORN            PIC X(2).                          01423099
014240*p133<-                                                           01424099
014250*                                                                 01425099
014260     05 TEXTO-TRACE            PIC X(8).                          01426099
014270     05 WS-CAS                 PIC 9(3) VALUE 0.                  01427099
014280     05 SW-USER                PIC 9(1) VALUE 0.                  01428099
014290     05 W-HHMMSS               PIC 9(6).                          01429099
014300     05 WS-SW-RAQW015          PIC  X(1) VALUE ' '.               01430099
014310     05 WS-LONG-FDF            PIC S9(4) COMP.                    01431099
014320     05 W-TECLA-CICS           PIC  X(1).                         01432099
014330*    05 W-TECLA-CICS-EURO      PIC  X(1).                         01433099
014340     05 W-CASO-ENTRADA         PIC 9(3) VALUE 0.                  01434099
014350     05 W-DAT-TERM-FISICO      PIC X(220).                        01435099
014360     05 W-APLICACION           PIC X(4) VALUE SPACES.             01436099
014370     05 W-EF                   PIC X(1) VALUE X'EF'.              01437099
014380     05 W-ABEND-APLICACION.                                       01438099
014390        88 SW-ABEND-APL-CICS   VALUE 'JGTB101'.                   01439099
014400        88 SW-ABEND-APL-DLI    VALUE 'JAQB300'.                   01440099
014410        10 FILLER              PIC X(1) VALUE SPACES.             01441099
014420           88 SW-ABEND-APL-DB2 VALUE 'I'.                         01442099
014430        10 FILLER              PIC X(6) VALUE SPACES.             01443099
014440     05 W-PROGRAMA             PIC X(8) VALUE SPACES.             01444099
014450     05 WS-ACCIO-ANT           PIC X(3) VALUE SPACES.             01445099
014460     05 W-AQTRACE              PIC X(1) VALUE SPACES.             01446099
014470     05 W-PANTALLA             PIC X(8) VALUE SPACES.             01447099
014480     05 W-ENTRADA-APLIC        PIC X(8) VALUE SPACES.             01448099
014490     05 W-ENT-APL              PIC X(8) VALUE SPACES.             01449099
014500*    05 SW-TIPO-ABEND          PIC 9(1) VALUE 0.                  01450099
014510*       88 SW-ABEND-ARQUITECTURAL  VALUE 1.                       01451099
014520     05 WS-TIPO-ERROR-USER     PIC 9(1) VALUE 0.                  01452099
014530        88 SW-USER-OK              VALUE 0.                       01453099
014540        88 SW-ERROR-USER-FISICO    VALUE 1.                       01454099
014550        88 SW-ERROR-USER-LOGICO    VALUE 2.                       01455099
014560     05 W-EIBTRMID             PIC X(4)       VALUE SPACES.       01456099
014570     05 W-LENGTH               PIC S9(4)      VALUE 0.            01457099
014580*                                                                 01458099
014590*                                                                 01459099
014600     05 WI-OFICI               PIC 9(4) VALUE 0.                  01460099
014610     05 WI-LLOC                PIC 9(4) VALUE 0.                  01461099
014620     05 W-LIS                  PIC X(56) VALUE                    01462099
014630      'ER.RECANVI,SCR: NNNNN; T040 AMB DADES I SW-TRANSAC.ACTIV'. 01463099
014640*                                                                 01464099
014650     05 W-LIZ                  PIC X(56) VALUE                    01465099
014660      'ER.RECANVI,SCR: NNNNN; SW.NO ACT./EIBTRNID:NNNN/MID:NNNN'. 01466099
014670*                                                                 01467099
014680     05 W-LETAL                PIC X(20) VALUE SPACES.            01468099
014690     05 W-TRA25                PIC X(4)  VALUE SPACES.            01469099
014700     05 W-LIT                  PIC X(56) VALUE                    01470099
014710      'RAQWZZZ ERROR RECANVI,S.SCR:       T040:                '. 01471099
014720*                                                                 01472099
014730     05 W-ZZZ                  PIC ZZ9.                           01473099
014740     05 W-LITE                 PIC X(56) VALUE                    01474099
014750      'RAQWZZZ ERROR CAS REBUT T040:  X     I SCR LLEGIT:  XXX '. 01475099
014760*                                                                 01476099
014770     05 W-KEY                  PIC S9(9) COMP VALUE 0.            01477099
014780     05 W-PARAMS-SCR           PIC X(5)       VALUE SPACES.       01478099
014790     05 WS-HORA-ACTUAL         PIC 9(9)       VALUE 0.            01479099
014800     05 W-DADES-CONTROL        PIC X(4)       VALUE SPACES.       01480099
014810     05 W-DADES-LLOC           PIC X(4)       VALUE SPACES.       01481099
014820     05 W-SEQUENCIA            PIC 9(5)       VALUE 0.            01482099
014830     05 C-INDICADOR.                                              01483099
014840        10 FILLER              PIC X          VALUE 'X'.          01484099
014850        10 WS-TERM-LOGICO      PIC X(4)       VALUE SPACES.       01485099
014860     05 C-4080                 PIC S9(4) COMP VALUE +4080.        01486099
014870     05 C-1920                 PIC S9(4) COMP VALUE +1920.        01487099
014880     05 C-40                   PIC S9(4) COMP VALUE +40.          01488099
014890     05 C-LOW-VALUES           PIC X VALUE LOW-VALUES.            01489099
014900     05 C-ESTADO-INICIO        PIC X VALUE 'I'.                   01490099
014910     05 C-ESTADO-CONTINUACION  PIC X VALUE 'C'.                   01491099
014920     05 C-ESTADO-CONFIRMACION  PIC X VALUE 'X'.                   01492099
014930     05 C-ESCRITURA            PIC X VALUE 'O'.                   01493099
014940     05 C-SALVAR-MAPA          PIC X VALUE 'M'.                   01494099
014950     05 C-IMPRIMIR-DOCUMENTOS  PIC X VALUE 'D'.                   01495099
014960     05 C-TERM-FINANCIERO      PIC S9(9) COMP VALUE +177.         01496099
014970     05 C-S                    PIC X VALUE 'S'.                   01497099
014980     05 C-C                    PIC X VALUE 'C'.                   01498099
014990     05 C-E                    PIC X VALUE 'E'.                   01499099
015000     05 C-I                    PIC X VALUE 'I'.                   01500099
015010     05 C-F                    PIC X VALUE 'F'.                   01501099
015020     05 C-A                    PIC X VALUE 'A'.                   01502099
015030     05 C-SPACES               PIC X VALUE SPACES.                01503099
015040     05 C-MENU-APLICACIONES    PIC X(4) VALUE 'GT05'.             01504099
015050     05 C-MENU-AGRUPACIONES    PIC X(4) VALUE 'AQM1'.             01505099
015060     05 C-ENTRADA-APLIC        PIC X(8) VALUE 'MEN-APLI'.         01506099
015070     05 C-ENTRADA-AGRUP        PIC X(8) VALUE 'MEN-AGRU'.         01507099
015080     05 C-APL-GENERAL          PIC X(4) VALUE 'AQ  '.             01508099
015090     05 C-MES-3270             PIC X(8) VALUE 'RAQW110 '.         01509099
015100     05 C-MES-TF               PIC X(8) VALUE 'RAQW020 '.         01510099
015110     05 MENSAJES-AVISO.                                           01511099
015120        10 C-EJECUTAR-AQ44          PIC X(7) VALUE 'JGTA017'.     01512099
015130        10 C-AVISO-TRANS-ARQ        PIC X(7) VALUE 'JAQA016'.     01513099
015140*LCO01.I                                                          01514099
015150        10 C-AVISO-EXC-BLOQUEO      PIC X(7) VALUE 'JAQA931'.     01515099
015160*LCO01.F                                                          01516099
015170     05 MENSAJES-ABEND.                                           01517099
015180        10 C-ABEND-NO-CCT           PIC X(7) VALUE 'JGTB146'.     01518099
015190        10 C-ABEND-TRANS-NO-AUTORI  PIC X(7) VALUE 'JAQB084'.     01519099
015200        10 C-NUM-SEQUENCIA          PIC X(7) VALUE 'JAQB200'.     01520099
015210        10 C-RECANVI                PIC X(7) VALUE 'JAQB201'.     01521099
015220        10 C-ABEND-BUCLE-INICIO     PIC X(7) VALUE 'JAQB202'.     01522099
015230        10 C-CCT-NO-EXISTE          PIC X(7) VALUE 'JAQB003'.     01523099
015240        10 C-ABEND-NO-LOG-PC1       PIC X(7) VALUE 'JGTB044'.     01524099
015250        10 C-ABEND-CICS             PIC X(7) VALUE 'JGTB101'.     01525099
015260        10 C-CICS-NO-DEFINIDO       PIC X(7) VALUE 'JAQB020'.     01526099
015270        10 C-ERROR-MODULO           PIC X(7) VALUE 'JGTB143'.     01527099
015280        10 C-AREA-INACTIVA          PIC X(7) VALUE 'JGTB139'.     01528099
015290        10 C-ABEND-GENERAL          PIC X(7) VALUE 'JSTB001'.     01529099
015300        10 C-SCR-NO-EXISTE          PIC X(7) VALUE 'JAQB018'.     01530099
015310        10 C-TERM-NO-DEFINIDO       PIC X(7) VALUE 'JSTB006'.     01531099
015320        10 C-ABEND-TERM-NOK         PIC X(7) VALUE 'JSTB007'.     01532099
015330        10 C-ABEND-NO-COMPATIB      PIC X(7) VALUE 'JGTB137'.     01533099
015340*                                                                 01534099
015350        10 C-NO-DATOS-FIRMAR        PIC X(7) VALUE 'JAQE302'.     01535099
015360*                                                                 01536099
015370        10 C-TERMI-NO-COMPATIB      PIC X(7) VALUE 'JAQE268'.     01537099
015380        10 C-ABEND-TERM-NO-COMPATIB PIC X(7) VALUE 'JAQB090'.     01538099
015390        10 C-TERM-INACTIVO          PIC X(7) VALUE 'JSTB100'.     01539099
015400        10 C-USUA-NO-AUTORIZ        PIC X(7) VALUE 'JSTB024'.     01540099
015410        10 C-ABEND-TIPO-CONEXION    PIC X(7) VALUE 'JAQB027'.     01541099
015420        10 C-ABEND-RUTINA-ENTRADA   PIC X(7) VALUE 'JAQB028'.     01542099
015430        10 C-ABEND-RUTINA-SALIDA    PIC X(7) VALUE 'JAQB029'.     01543099
015440        10 C-ABEND-OPE-USU-FISICO   PIC X(7) VALUE 'JAQB030'.     01544099
015450        10 C-ABEND-OPE-USU-LOGICO   PIC X(7) VALUE 'JAQB031'.     01545099
015460        10 C-ABEND-COD-ACC-TRAN     PIC X(7) VALUE 'JAQB040'.     01546099
015470        10 C-ABEND-TIPO-CONF-MONEDA PIC X(7) VALUE 'JAQB044'.     01547099
015480        10 C-ABEND-TIPO-PEAU        PIC X(7) VALUE 'JAQB045'.     01548099
015490        10 C-ABEND-TIPO-AUTEN       PIC X(7) VALUE 'JAQB050'.     01549099
015500        10 C-ABEND-CANAL-NO-AUTEN   PIC X(7) VALUE 'JAQB049'.     01550099
015510        10 C-ABEND-TIPO-4OJOS       PIC X(7) VALUE 'JAQB051'.     01551099
015520        10 C-ABEND-4OJOS-STANDARD   PIC X(7) VALUE 'JAQB053'.     01552099
015530        10 C-ABEND-US-FIS-NO-AUT    PIC X(7) VALUE 'JAQB055'.     01553099
015540        10 C-ABEND-US-LOG-NO-AUT    PIC X(7) VALUE 'JAQB056'.     01554099
015550        10 C-ABEND-CANAL-NO-4OJOS   PIC X(7) VALUE 'JAQB062'.     01555099
015560        10 C-ABEND-CONT-USU-TRAN-1  PIC X(7) VALUE 'JAQB063'.     01556099
015570        10 C-ABEND-CONT-USU-TRAN-2  PIC X(7) VALUE 'JAQB085'.     01557099
015580        10 C-ABEND-4OJOS-NO-TIPO-1  PIC X(7) VALUE 'JAQB065'.     01558099
015590        10 C-ABEND-DIARIO           PIC X(7) VALUE 'JAQB400'.     01559099
015600        10 C-NO-TERM-LIBRES         PIC X(7) VALUE 'JAQB082'.     01560099
015610        10 C-NO-TERM-CENTRO         PIC X(7) VALUE 'JAQB083'.     01561099
015620     05 MENSAJES-ERROR.                                           01562099
015630        10 C-ACCION-NO-VALIDA       PIC X(7) VALUE 'JAQE272'.     01563099
015640        10 C-TRANS-INACT            PIC X(7) VALUE 'JGTE004'.     01564099
015650        10 C-TRANS-INVALIDA         PIC X(7) VALUE 'JTFE230'.     01565099
015660        10 C-ERROR-PF6              PIC X(7) VALUE 'JGTE030'.     01566099
015670        10 C-APLIC-CERRADA          PIC X(7) VALUE 'JGTE062'.     01567099
015680        10 C-APLIC-CERRADA-ST       PIC X(7) VALUE 'JSTB012'.     01568099
015690        10 C-TRANS-NO-AUTORI        PIC X(7) VALUE 'JAQE121'.     01569099
015700        10 C-ERROR-NO-WORKA         PIC X(7) VALUE 'JGTE011'.     01570099
015710        10 C-ERROR-CANAL-NO-PEAU    PIC X(7) VALUE 'JAQE098'.     01571099
015720*                                                                 01572099
015730*                                                                 01573099
015740 01  FILLER      PIC X(42)  VALUE                                 01574099
015750         'PR.RAQW001 -VARIABLES TREBALL ************'.            01575099
015760*                                                                 01576099
015770 01  VARIABLES-TRABAJO.                                           01577099
015780*                                                                 01578099
015790     05 WS-TABLA-TRAN.                                            01579099
015800        10 WS-TRAN-OCCURS OCCURS 10 TIMES.                        01580099
015810           15 WS-TRAN-1             PIC X(4).                     01581099
015820           15 FILLER                PIC X.                        01582099
015830           15 WS-TRAN-2             PIC X(4).                     01583099
015840           15 FILLER                PIC X.                        01584099
015850           15 WS-TRAN-3             PIC X(4).                     01585099
015860           15 FILLER                PIC X.                        01586099
015870           15 WS-TRAN-4             PIC X(4).                     01587099
015880           15 FILLER                PIC X.                        01588099
015890           15 WS-TRAN-5             PIC X(4).                     01589099
015900           15 FILLER                PIC X.                        01590099
015910*                                                                 01591099
015920*MLV-ABL->                                                        01592099
015930     05 WS-IND-COD                  PIC S9(4) COMP VALUE 0.       01593099
015940*MLV-ABL<-                                                        01594099
015950*JAS01-I                                                          01595099
015960     05 WS-IND-COD2                 PIC S9(4) COMP VALUE 0.       01596099
015970*JAS01-F                                                          01597099
015980     05 WS-L310PARAM                PIC  X(174).                  01598099
015990     05 WS-AQ1MENSA                  PIC X(32) VALUE SPACES.      01599099
016000*BROADCAST4EYES-I                                                 01600099
016010     05 WS-AQ1AVCD1                  PIC X(7) VALUE SPACES.       01601099
016020*BROADCAST4EYES-E                                                 01602099
016030*BROADCAST4EYES-MoreFixes-I                                       01603099
016040     05 SW-InvokeUnderRemoteVerif    PIC X(1).                    01604099
016050        88 invokeTargetUnderRemote    VALUE 'Y'.                  01605099
016060        88 notInvokeTargetUnderRemote VALUE 'N'.                  01606099
016070*BROADCAST4EYES-MoreFixes-E                                       01607099
016080     05 WS-EXIT-BE                   PIC X(8) VALUE SPACES.       01608099
016090     05 SW-CONTROL-LOPD              PIC X(1) VALUE SPACES.       01609099
016100        88 SW-CONTROL-LOPD-SI        VALUE 'A'.                   01610099
016110     05 SW-LLAMADA-PGM-APLIC         PIC S9(2) COMP VALUE 0.      01611099
016120        88 SW-NO-LLAMAR-PGM-APLIC    VALUE 0.                     01612099
016130        88 SW-SI-LLAMAR-PGM-APLIC    VALUE 1.                     01613099
016140     05 SW-SIMULACION-INICIO-ECDL    PIC S9(2) COMP VALUE 0.      01614099
016150        88 SW-NO-SIMULAR-INICIO-ECDL VALUE 0.                     01615099
016160        88 SW-SIMULAR-INICIO-ECDL    VALUE 1.                     01616099
016170     05 SW-INICIO-CASO-1             PIC S9(2) COMP VALUE 0.      01617099
016180        88 SW-NO-FORZAR-INICIO-CASO-1 VALUE 0.                    01618099
016190        88 SW-FORZAR-INICIO-CASO-1    VALUE 1.                    01619099
016200     05 SW-ENTORNO-EJECUCION         PIC S9(2) COMP VALUE 0.      01620099
016210        88 SW-NO-ERROR-ENTORNO-EJEC  VALUE 0.                     01621099
016220        88 SW-ERROR-ENTORNO-EJEC     VALUE 1.                     01622099
016230     05 SW-DETECCION-ERROR           PIC 9(1) VALUE 0.            01623099
016240        88 SW-ERROR-NO-DETECTADO-AQ  VALUE 0.                     01624099
016250        88 SW-ERROR-DETECTADO-AQ     VALUE 1.                     01625099
016260     05 SW-GRAVACIO              PIC 9(1) VALUE 0.                01626099
016270     05 WS-TECLA                 PIC X(1) VALUE SPACES.           01627099
016280        88 SW-TECLA-CON-RELACION VALUE 'A' 'C' 'D' 'E' 'F' 'I'.   01628099
016290        88 SW-TECLA-SHTF1        VALUE 'A'.                       01629099
016300        88 SW-TECLA-SHTF3        VALUE 'C'.                       01630099
016310        88 SW-TECLA-SHTF4        VALUE 'D'.                       01631099
016320        88 SW-TECLA-SHTF5        VALUE 'E'.                       01632099
016330        88 SW-TECLA-SHTF6        VALUE 'F'.                       01633099
016340        88 SW-TECLA-SHTF9        VALUE 'I'.                       01634099
016350     05 WS-TIPO-CONEXION         PIC X(2) VALUE SPACES.           01635099
016360     05 SW-GRAVAR-FAQ030         PIC  9(1) VALUE 0.               01636099
016370     05 SW-CONTROL-AUDIT         PIC  9(1) VALUE 0.               01637099
016380     05 SW-CONTROL-4ULLS         PIC  9(1) VALUE 0.               01638099
016390     05 SW-ACCES-4ULLS           PIC  9(1) VALUE 0.               01639099
016400     05 SW-ACCES-AUDIT           PIC  9(1) VALUE 0.               01640099
016410     05 W-INDEX-CCT              PIC S9(8) COMP VALUE 0.          01641099
016420     05 W-AQPTL310               PIC S9(8) COMP.                  01642099
016430     05 W-POINTER                PIC S9(8) COMP.                  01643099
016440     05 W-AQ1TRANT               PIC  X(4) VALUE SPACES.          01644099
016450     05 W-POINTER-AREAUSU        PIC S9(8) COMP.                  01645099
016460     05 W-NUM-ABEND              PIC X(2) VALUE SPACES.           01646099
016470     05 W-MODULO                 PIC X(8) VALUE SPACES.           01647099
016480     05 W-PTR-CAQL155            PIC S9(8) COMP.                  01648099
016490     05 W-ESTADO-INICIAL         PIC X    VALUE SPACES.           01649099
016500     05 W-PRIMER-ESTADO          PIC X    VALUE SPACES.           01650099
016510     05 W-ULTIMO-ESTADO-LINK     PIC X    VALUE SPACES.           01651099
016520     05 W-ULTIMO-CASO-LINK       PIC S9(3) COMP-3 VALUE 0.        01652099
016530     05 W-ESTADO                 PIC X    VALUE SPACES.           01653099
016540     05 W-ABEND-INICIAL          PIC X(7) VALUE SPACES.           01654099
016550     05 COD-RESP                 PIC S9(8) COMP VALUE 0.          01655099
016560     05 W-ITEM                   PIC S9(4) COMP VALUE 0.          01656099
016570*P35->                                                            01657099
016580     05 W-N4                     PIC  9(4).                       01658099
016590     05 W-I1                     PIC  9(4) COMP VALUE 0.          01659099
016600     05 W-I2                     PIC  9(4) COMP VALUE 0.          01660099
016610     05 W-I3                     PIC  9(4) COMP VALUE 0.          01661099
016620     05 W-I4                     PIC  9(4) COMP VALUE 0.          01662099
016630     05 W-I5                     PIC  9(4) COMP VALUE 0.          01663099
016640     05 W-AQCDPLAN-GRUP.                                          01664099
016650        10 W-AQCDPLAN            PIC  X(25) OCCURS 10.            01665099
016660     05 W-AQIDAVRL-GRUP.                                          01666099
016670        10 W-AQIDAVRL            PIC  X(26) OCCURS 20.            01667099
016680*LCO01.I                                                          01668099
016690     05 WS-RESP                  PIC  X(8) VALUE SPACES.          01669099
016700     05 W-AQCDAVIS-GRUP.                                          01670099
016710        10 W-AQCDAVIS            PIC  X(10) OCCURS 10.            01671099
016720        10 FILLER                PIC  X(01) VALUE SPACES.         01672099
016730*LCO01.F                                                          01673099
016740*P35<-                                                            01674099
016750     05 W-MENS-A11               PIC S9(2) COMP VALUE 0.          01675099
016760     05 WS-IND1                  PIC 9(2) COMP VALUE 0.           01676099
016770*P148-I                                                           01677099
016780     05 WS-IND2                  PIC 9(2) COMP VALUE 0.           01678099
016790     05 WS-IND3                  PIC 9(2) COMP VALUE 0.           01679099
016800     05 WS-IND4                  PIC 9(2) COMP VALUE 0.           01680099
016810*MULTI020-I                                                       01681099
016820     05 WS-IND5                  PIC 9(2) COMP VALUE 0.           01682099
016830*MULTI020-E                                                       01683099
016840*P148-F                                                           01684099
016850     05 SW-TIPO-PROCESO          PIC 9 VALUE 0.                   01685099
016860        88 SW-PROCESO-TF-LOCAL   VALUE 1.                         01686099
016870        88 SW-PROCESO-TF-HOST    VALUE 2.                         01687099
016880        88 SW-PROCESO-TF         VALUE 1 2.                       01688099
016890        88 SW-PROCESO-BE-LOCAL   VALUE 3.                         01689099
016900        88 SW-PROCESO-BE-HOST    VALUE 4.                         01690099
016910        88 SW-PROCESO-BE         VALUE 3 4.                       01691099
016920     05 SW-CORREOS               PIC 9 VALUE 0.                   01692099
016930        88 SW-PROCESO-CO-LOCAL   VALUE 1.                         01693099
016940        88 SW-PROCESO-CO-HOST    VALUE 2.                         01694099
016950        88 SW-PROCESO-CO         VALUE 1 2.                       01695099
016960     05 WS-ERROR-AGENT           PIC XX VALUE SPACES.             01696099
016970     05 SW-BUSQUEDA              PIC 9 VALUE 0.                   01697099
016980        88 SW-NO-ENCONTRADO      VALUE 0.                         01698099
016990        88 SW-ENCONTRADO         VALUE 1.                         01699099
017000     05 SW-BUSQUEDA-APL          PIC 9 VALUE 0.                   01700099
017010        88 SW-NO-ENCONT-APL      VALUE 0.                         01701099
017020        88 SW-ENCONT-APL         VALUE 1.                         01702099
017030     05 SW-BUSQUEDA-ENTRADA      PIC 9 VALUE 0.                   01703099
017040        88 SW-NO-ENCONT-ENTRADA  VALUE 0.                         01704099
017050        88 SW-ENCONT-ENTRADA     VALUE 1.                         01705099
017060     05 SW-ARRANQUE-GT03         PIC 9 VALUE 0.                   01706099
017070        88 SW-NO-ARRANCAR-GT03   VALUE 0.                         01707099
017080        88 SW-ARRANCAR-GT03      VALUE 1.                         01708099
017090     05 SW-DIARIO                PIC 9 VALUE 0.                   01709099
017100        88 SW-NO-GRABAR-DIARIO   VALUE 0.                         01710099
017110        88 SW-GRABAR-DIARIO      VALUE 1.                         01711099
017120     05 SW-TIPO-TRANSACCION      PIC 9 VALUE 0.                   01712099
017130        88 SW-TRAN-NO-ARQUITEC   VALUE 0.                         01713099
017140        88 SW-TRAN-ARQUITEC      VALUE 1.                         01714099
017150     05 SW-APLICACION            PIC 9 VALUE 0.                   01715099
017160        88 SW-APL-INACTIVA       VALUE 0.                         01716099
017170        88 SW-APL-ACTIVA         VALUE 1.                         01717099
017180        88 SW-APL-NO-EXISTE      VALUE 2.                         01718099
017190     05 SW-ESTADO-BD-APL         PIC 9 VALUE 0.                   01719099
017200        88 SW-BD-SOLO-CONSULTA   VALUE 1.                         01720099
017210     05 SW-TIPO-ABEND            PIC 9 VALUE 1.                   01721099
017220        88 SW-ABEND-ARQUITECTURAL  VALUE 1.                       01722099
017230*       88 SW-ABEND-ARQUITEC     VALUE 1.                         01723099
017240        88 SW-ABEND-APLICATIVO   VALUE 2.                         01724099
017250     05 WS-APLICATIVO-LLAMADO    PIC 9 VALUE 0.                   01725099
017260        88 SW-APLICATIVO-NO-LLAMADO VALUE 0.                      01726099
017270        88 SW-APLICATIVO-LLAMADO VALUE 1.                         01727099
017280     05 WS-LLAMADA-EXIT-BE-OUT   PIC 9 VALUE 0.                   01728099
017290        88 SW-EXIT-BE-OUT-NO-INVOCADO VALUE 0.                    01729099
017300        88 SW-EXIT-BE-OUT-SI-INVOCADO VALUE 1.                    01730099
017310*P148-I                                                           01731099
017320     05 SW-GDPR-PREVIO           PIC X VALUE SPACES.              01732099
017330        88 GDPRNO-ENCONTRADO     VALUE '0'.                       01733099
017340        88 GDPRSI-ENCONTRADO     VALUE '1'.                       01734099
017350     05 SW-SWITCH-GDPR           PIC X  VALUE SPACES.             01735099
017360       88 SW-GDPR-PRIORI         VALUE '1'.                       01736099
017370       88 SW-GDPR-POSTER         VALUE '2'.                       01737099
017380*P148-F                                                           01738099
017390     05 W-CONT                   PIC S9(4) COMP VALUE 0.          01739099
017400     05 FILLER REDEFINES W-CONT.                                  01740099
017410        10 FILLER                PIC X.                           01741099
017420        10 W-CONT-R              PIC X.                           01742099
017430     05 SW-BUCLE                 PIC 9 VALUE 0.                   01743099
017440        88 SW-SEGUIR-BUCLE       VALUE 0.                         01744099
017450        88 SW-FIN-BUCLE          VALUE 1.                         01745099
017460     05 W-TIPO-DEVICE            PIC S9(9) COMP VALUE 0.          01746099
017470     05 W-PUNTER-SAVE            PIC S9(8) COMP VALUE 0.          01747099
017480     05 W-LONG-RECEIVE           PIC S9(4) COMP VALUE 0.          01748099
017490     05 W-CASO                   PIC 9 VALUE 0.                   01749099
017500     05 W-ENVIO                  PIC X VALUE SPACES.              01750099
017510     05 W-RESPUESTA              PIC X VALUE SPACES.              01751099
017520     05 W-DATO.                                                   01752099
017530        10 FILLER                PIC X VALUE SPACES.              01753099
017540        10 W-TERM-LOGICO         PIC X(4) VALUE SPACES.           01754099
017550     05 W-TRANID                 PIC X(4) VALUE SPACES.           01755099
017560     05 W-EIBAID                 PIC X(1) VALUE ' '.              01756099
017570     05 W-EIBTRNID               PIC X(4).                        01757099
017580        88 SW-LOGON-AQLG         VALUE 'AQLG'.                    01758099
017590        88 SW-LOGON-GT03         VALUE 'GT03'.                    01759099
017600        88 SW-AQPF               VALUE 'AQPF'.                    01760099
017610        88 SW-AQVC               VALUE 'AQVC'.                    01761099
017620        88 SW-TRANS-ESPECIAL     VALUE 'GT03' 'AQLG' 'AQVC'.      01762099
017630        88 SW-MENU-GNRAL-APLIC   VALUE 'GT05'.                    01763099
017640        88 SW-MENU-GNRAL-AGRUP   VALUE 'AQM1'.                    01764099
017650     05 W-INDICE                 PIC S9(4) COMP VALUE 0.          01765099
017660     05 W-PUNTER                 PIC S9(4) COMP VALUE 0.          01766099
017670     05 W-ABSTIME                PIC S9(18) COMP VALUE 0.         01767099
017680*                                                                 01768099
017690     05 W1-DATA-ACTUAL.                                           01769099
017700        10 W1-YYYY-ACTUAL        PIC 9(4) VALUE 0.                01770099
017710        10 FILLER                PIC 9(4) VALUE 0.                01771099
017720     05 W2-DATA-ACTUAL REDEFINES W1-DATA-ACTUAL.                  01772099
017730        10 FILLER                PIC 99.                          01773099
017740        10 W-YYMMDD              PIC 9(6).                        01774099
017750     05 W-YYYYMMDD-ACTUAL REDEFINES W2-DATA-ACTUAL PIC 9(8).      01775099
017760*                                                                 01776099
017770     05 W3-DATA-ACTUAL.                                           01777099
017780        10 W-MMDDYY              PIC 9(6).                        01778099
017790        10 FILLER                PIC 99.                          01779099
017800     05 W4-DATA-ACTUAL REDEFINES W3-DATA-ACTUAL.                  01780099
017810        10 FILLER                PIC 9(4).                        01781099
017820        10 W4-YYYY-ACTUAL        PIC 9(4).                        01782099
017830     05 W-MMDDYYYY-ACTUAL REDEFINES W4-DATA-ACTUAL PIC 9(8).      01783099
017840*                                                                 01784099
017850     05 W5-DATA-ACTUAL.                                           01785099
017860        10 W-DDMMYY              PIC 9(6).                        01786099
017870        10 FILLER                PIC 99.                          01787099
017880     05 W6-DATA-ACTUAL REDEFINES W5-DATA-ACTUAL.                  01788099
017890        10 FILLER                PIC 9(4).                        01789099
017900        10 W6-YYYY-ACTUAL        PIC 9(4).                        01790099
017910     05 W-DDMMYYYY-ACTUAL REDEFINES W6-DATA-ACTUAL PIC 9(8).      01791099
017920*                                                                 01792099
017930     05 W-HORA-ACTUAL            PIC 9(6) VALUE 0.                01793099
017940     05 FILLER REDEFINES W-HORA-ACTUAL.                           01794099
017950        10 W-HH-ACTUAL           PIC 99.                          01795099
017960        10 W-MM-ACTUAL           PIC 99.                          01796099
017970        10 W-SS-ACTUAL           PIC 99.                          01797099
017980     05 W-TIME-INICIO.                                            01798099
017990        10 W-HORA-INICIO         PIC 9(6) VALUE 0.                01799099
018000        10 FILLER                PIC 99   VALUE 0.                01800099
018010     05 FILLER REDEFINES W-TIME-INICIO.                           01801099
018020        10 W-HH-INICIO           PIC 99.                          01802099
018030        10 W-MM-INICIO           PIC 99.                          01803099
018040        10 W-SS-INICIO           PIC 99.                          01804099
018050        10 FILLER                PIC 99.                          01805099
018060     05 W-DIF-MINUTOS            PIC 9(4) VALUE 0.                01806099
018070     05 W-YEAR                   PIC S9(5) COMP VALUE 0.          01807099
018080     05 W-LONG                   PIC S9(04) COMP VALUE 0.         01808099
018090     05 W-USERID.                                                 01809099
018100        10 FILLER                PIC X(3) VALUE SPACES.           01810099
018110        10 FILLER                PIC X(5) VALUE SPACES.           01811099
018120     05 W-USER  REDEFINES W-USERID.                               01812099
018130        10 FILLER                PIC X.                           01813099
018140        10 FILLER                PIC X(7).                        01814099
018150     05 W-USER2 REDEFINES W-USER.                                 01815099
018160        10 FILLER                PIC X.                           01816099
018170        88 SW-USUARIO-BE        VALUE 'E' .                       01817099
018180        10 FILLER                PIC X(7).                        01818099
018190     05 W-INDEX-R.                                                01819099
018200        10 FILLER                PIC X.                           01820099
018210        10 W-INDEX-BYTE-2        PIC X.                           01821099
018220     05 W-INDEX REDEFINES W-INDEX-R PIC S9(4) COMP.               01822099
018230*                                                                 01823099
018240     05 W-MENSAJE-ABEND.                                          01824099
018250        10 W-MENSAJE.                                             01825099
018260           15 W-MENSAJE-CLAVE   PIC X(07) VALUE SPACES.           01826099
018270           15 W-MENSAJE-GUION   PIC X     VALUE SPACES.           01827099
018280           15 W-MENSAJE-TEXTO   PIC X(69) VALUE SPACES.           01828099
018290        10 FILLER               PIC X(3)  VALUE SPACES.           01829099
018300        10 RESTO-MSJ-ABEND      PIC X(77) VALUE SPACES.           01830099
018310     05 W-ID-TERMINAL           PIC X(4)  VALUE SPACES.           01831099
018320     05 W-HORA-ABEND            PIC X(8)  VALUE SPACES.           01832099
018330*                                                                 01833099
018340     05 W-COD-ABEND.                                              01834099
018350        88 SW-ABEND-SISTEMA         VALUE 'JSTB001'.              01835099
018360        88 SW-ABEND-CICS            VALUE 'JGTB101'.              01836099
018370        88 SW-ABEND-DLI             VALUE 'JAQB300'.              01837099
018380        10 FILLER.                                                01838099
018390           88 SW-CONSERVAR-MENSAJE  VALUE 'JSTB'.                 01839099
018400           15 FILLER                PIC X(1) VALUE SPACES.        01840099
018410              88 SW-ABEND-DB2       VALUE 'I'.                    01841099
018420           15 FILLER                PIC XXX VALUE SPACES.         01842099
018430        10 FILLER                   PIC XXX VALUE SPACES.         01843099
018440     05 W-TEXTO-ABEND3.                                           01844099
018450        10 FILLER            PIC X(11) VALUE 'ABEND DB2 '.        01845099
018460        10 FILLER            PIC X(08) VALUE ' TABLE:'.           01846099
018470        10 W-TA3-TABLENAME   PIC X(16) VALUE SPACES.              01847099
018480        10 FILLER            PIC X(11) VALUE ' SQLCODE:'.         01848099
018490        10 W-TA3-SQLCODE     PIC +++9.                            01849099
018500        10 FILLER            PIC X(11) VALUE ' SQLERRM:'.         01850099
018510        10 W-TA3-SQLERRM     PIC X(60) VALUE SPACES.              01851099
018520     05 W-TEXTO-ABEND5.                                           01852099
018530        10 FILLER            PIC X(17) VALUE 'ABEND CICS START '. 01853099
018540        10 FILLER            PIC X(9)  VALUE ' TRANSID:'.         01854099
018550        10 W-TA5-TRANSID     PIC X(08) VALUE SPACES.              01855099
018560        10 FILLER            PIC X(5)  VALUE ' COD:'.             01856099
018570        10 W-TA5-ABEND       PIC X(4) VALUE SPACES.               01857099
018580     05 W-ENTRADA.                                                01858099
018590        10 FILLER            PIC X(4) VALUE 'MEN-'.               01859099
018600        10 W-APLICAC         PIC X(4) VALUE SPACES.               01860099
018610     05 W-COLA.                                                   01861099
018620        10 FILLER            PIC XXX  VALUE 'QAQ'.                01862099
018630        10 W-TERMID-TS       PIC X(4) VALUE SPACES.               01863099
018640        10 FILLER            PIC X    VALUE 'M'.                  01864099
018650* indicador lpd para forzar write SCR a pesar de rolb-si en fpath 01865099
018660     05 SW-FASTPATH              PIC 9(1) VALUE 0.                01866099
018670*                                                                 01867099
018680*--- ERROR FORMATEADO DEL ABEND DB2 DE UN MODULO LLAMADO          01868099
018690     05 WS-ABEND-DB2.                                             01869099
018700        07 FILLER                 PIC X    VALUE 'I'.             01870099
018710        07 WS-ABEND-NUM           PIC 9(3).                       01871099
018720*                                                                 01872099
018730*hm1                                                              01873099
018740     05 WS-ERROR-MODULO.                                          01874099
018750        07 FILLER         PIC X(13)                               01875099
018760                          VALUE 'ERROR MODULO '.                  01876099
018770        07 WS-MODULO-E    PIC X(8).                               01877099
018780        07 WS-RETORNO-P   PIC X(10)                               01878099
018790                          VALUE ' RETORNO: '.                     01879099
018800        07 WS-RETORNO-E   PIC X(10).                              01880099
018810*hm1                                                              01881099
018820*tracet->                                                         01882099
018830     05 WS-TRACE          PIC X     VALUE SPACES.                 01883099
018840     05 WS-AQNBDTRA       PIC X(32) VALUE SPACES.                 01884099
018850     05 WS-AQINFORM       PIC X(80) VALUE SPACES.                 01885099
018860     05 WS-TRACE-ORDEN    PIC 9(4)  COMP  VALUE ZERO.             01886099
018870     05 WS-LDADES         PIC 9(4)  COMP  VALUE ZERO.             01887099
018880     05 WS-AQ1DCASO       PIC 9(3).                               01888099
018890*tracet-<                                                         01889099
018900*LCO01.I                                                          01890099
018910*    Contadores para avisos bloqueantes reales y de excepción.    01891099
018920     05 WS-CONT-AV-BLOQ   PIC 9(2)  COMP  VALUE ZEROES.           01892099
018930     05 WS-CONT-EX-BLOQ   PIC 9(2)  COMP  VALUE ZEROES.           01893099
018940*    Nombre de modulo aplicativo para excep. de avisos bloqueantes01894099
018950     05 WS-MOD-EXBLOQ     PIC X(8)  VALUE SPACES.                 01895099
018960*LCO01.F                                                          01896099
018961*NewSAMGbasedWarnings-I                                           01896199
018962*    Amount of SAMG data access restriction warnings detected     01896299
018963     05 WS-CONT-AV-SAMG   PIC 9(2)  COMP  VALUE ZEROES.           01896399
018964     05 FILLER            PIC X.                                  01896499
018965        88 totalMasking   VALUE 'N'.                              01896599
018966        88 partialMasking VALUE 'Y'.                              01896699
018967     05 FILLER            PIC X VALUE 'N'.                        01896799
018968        88 notEvalNavigWarnings VALUE 'N'.                        01896899
018969        88 evalNavigWarnings    VALUE 'Y'.                        01896999
018970     05 FILLER            PIC X VALUE 'N'.                        01897099
018971        88 warningTypeStringPending  VALUE 'N'.                   01897199
018972        88 warningTypeStringObtained VALUE 'Y'.                   01897299
018973*NewSAMGbasedWarnings-E                                           01897399
018974*P148-I                                                           01897499
018975     05 WS-CONT-EX-GDPR              PIC 9(2)  COMP  VALUE ZEROES.01897599
018976     05 WS-CONT-LIN-EXGDPR           PIC 9(2)  COMP  VALUE ZEROES.01897699
018977     05 WS-AREA-GDPR                 OCCURS 40 TIMES.             01897799
018978       10 WS-AQTPAVIS-GDPR           PIC X(1).                    01897899
018979       10 WS-AQCDPLAN-GDPR           PIC X(10).                   01897999
018980       10 WS-AQTXAVIS-GDPR           PIC X(70).                   01898099
018990     05 WS-AQTIPAVI.                                              01899099
019000*NewSAMGbasedWarnings-I                                           01900099
019010*      10 FILLER                     PIC 9(3).                    01901099
019020       10 WS-AQTIPAVI-U              PIC 9.                       01902099
019030       10 WS-AQTIPAVI-J              PIC 9.                       01903099
019040       10 WS-AQTIPAVI-P              PIC 9.                       01904099
019050*NewSAMGbasedWarnings-E                                           01905099
019060       10 WS-AQTIPAVI-V              PIC 9.                       01906099
019070       10 WS-AQTIPAVI-A              PIC 9.                       01907099
019080       10 WS-AQTIPAVI-G              PIC 9.                       01908099
019090       10 WS-AQTIPAVI-X              PIC 9.                       01909099
019100       10 WS-AQTIPAVI-D              PIC 9.                       01910099
019110*P148-F                                                           01911099
019120*----------------------------------------------------------------*01912099
019130*                                                                 01913099
019140*                                                                 01914099
019150 01  FILLER      PIC X(42)  VALUE                                 01915099
019160         'PR.RAQW001 -AREA PCIU102      ************'.            01916099
019170*                                                                 01917099
019180 01  AREA-ENLACE.                                                 01918099
019190     05  LK-TRANSAC              PIC X(4).                        01919099
019200     05  LK-POSTA                PIC X VALUE ' '.                 01920099
019210 01  W-FAQ030-TS                 PIC X(8) VALUE 'QAQFAQ30'.       01921099
019220 01  W-AREA-FAQ030               PIC X(10) VALUE SPACES.          01922099
019230*                                                                 01923099
019240*                                                                 01924099
019250 01  FILLER      PIC X(42)  VALUE                                 01925099
019260         'PR.RAQW001 -AREA ENLLAS       ************'.            01926099
019270*                                                                 01927099
019280 COPY DFHAID.                                                     01928099
019290*                                                                 01929099
019300 01 AREA-CCIL004.                                                 01930099
019310 COPY CCIL004.                                                    01931099
019320*                                                                 01932099
019330*--> COPY CORRESPONDIENTE A LA TABLA GENERAL 367 (CANALES)        01933099
019340*                                                                 01934099
019350     COPY CTGT0367.                                               01935099
019360*                                                                 01936099
019370*--> COPY CORRESPONDIENTE A LA TABLA GENERAL 600                  01937099
019380*                                                                 01938099
019390     COPY CTGT0600.                                               01939099
019400*                                                                 01940099
019410*                                                                 01941099
019420*--> COPY CORRESPONENT ACCES A TAULES GENERALS                    01942099
019430*                                                                 01943099
019440*JFM01-->                                                         01944099
019450 01 AREA-CTGL000.                                                 01945099
019460*<<-JFM01                                                         01946099
019470     COPY CTGL000.                                                01947099
019480*                                                                 01948099
019490*--> AREA DE ENLACE CON MODULO RTGU005                            01949099
019500*                                                                 01950099
019510 01  AREA-CTGL005.                                                01951099
019520     COPY CTGL005.                                                01952099
019530*                                                                 01953099
019540*                                                                 01954099
019550*--> COPY FICHERO FAQ060 (TERMINALES)                             01955099
019560*--> AREA ENLACE CON MODULO RAQW170                               01956099
019570*                                                                 01957099
019580 01  AREA-CAQL170.                                                01958099
019590     COPY CAQL170.                                                01959099
019600*                                                                 01960099
019610*                                                                 01961099
019620 01  FILLER      PIC X(42)  VALUE                                 01962099
019630         'PR.RAQW001 -AREA ENLLAS RAQW075 **********'.            01963099
019640*                                                                 01964099
019650*--> AREA ENLLAC MODUL RAQW075                                    01965099
019660*                                                                 01966099
019670 01  AREA-CAQL075.                                                01967099
019680     COPY CAQL075.                                                01968099
019690*                                                                 01969099
019700*--> AREA ENLLAC MODUL RAGU400                                    01970099
019710*                                                                 01971099
019720*                                                                 01972099
019730 01  FILLER      PIC X(42)  VALUE                                 01973099
019740         'PR.RAQW001 -AREA ENLLAS RAQW120 **********'.            01974099
019750*                                                                 01975099
019760*--> AREA ENLACE CON MODULO 'RAQW120' (OBTENCION ATRIBUTOS CANAL) 01976099
019770*                                                                 01977099
019780 01  AREA-CAQL120.                                                01978099
019790 COPY CAQL120.                                                    01979099
019800*                                                                 01980099
019810*--> AREA ENLACE CON MODULO 'RAQW130' (VERIFICACION USUARIO)      01981099
019820*                                                                 01982099
019830 01  AREA-CAQL130.                                                01983099
019840     COPY CAQL130.                                                01984099
019850*hm1                                                              01985099
019860*--> AREA ENLACE CON MODULO 'RAQW140'                             01986099
019870*                                                                 01987099
019880 01  CAQL140-AREA.                                                01988099
019890     COPY CAQL140.                                                01989099
019900*hm1                                                              01990099
019910*    copy modulo de interface del servicio de trace               01991099
019920 01  CAQLT00-AREA.                                                01992099
019930     COPY CAQLT00.                                                01993099
019940                                                                  01994099
019950*hm1                                                              01995099
019960*--> AREA ENLACE CON MODULO 'RAQW145' (CONVERSION MJES. CICS/DLI) 01996099
019970*                                                                 01997099
019980 01  AREA-CAQL240.                                                01998099
019990     COPY CAQL240.                                                01999099
020000*                                                                 02000099
020010*--> AREA ENLACE CON MODULO 'RAQW085'                             02001099
020020*                                                                 02002099
020030 01  AREA-CAQL085.                                                02003099
020040 COPY CAQL085.                                                    02004099
020050*                                                                 02005099
020060*SIMU-I                                                           02006099
020070* Se asteriscan estas areas al detectar que no se usan            02007099
020080* ahorrando asi memoria de working                                02008099
020090*--> AREA ENLACE CON MODULO 'RAQWE57'                             02009099
020100*                                                                 02010099
020110*01  AREA-RAQWE57.                                                02011099
020120*COPY CAQLE57.                                                    02012099
020130*                                                                 02013099
020140*--> AREA ENLACE CON MODULO 'RAQWE74'                             02014099
020150*                                                                 02015099
020160*01  AREA-RAQWE74.                                                02016099
020170*COPY CAQLE74.                                                    02017099
020180*                                                                 02018099
020190* Area de enlace con el modulo de alta de terminales RAQW605      02019099
020200 01  AREA-CAQL605.                                                02020099
020210   COPY CAQL605.                                                  02021099
020220*SIMU-E                                                           02022099
020230*                                                                 02023099
020240*--> AREA ENLACE CON MODULO 'RTGW991'                             02024099
020250*                                                                 02025099
020260*--> Area spad con transaccion AQ72                               02026099
020270*                                                                 02027099
020280 01  AREA-RAQW006.                                                02028099
020290 COPY CAQL006.                                                    02029099
020300 01  AREA-RAQW140.                                                02030099
020310 COPY CAQL145.                                                    02031099
020320 01  AREA-RAQW065.                                                02032099
020330 COPY CAQL165.                                                    02033099
020340 COPY CAQF040.                                                    02034099
020350 COPY CAQL045.                                                    02035099
020360 01  AREA-CAQL095.                                                02036099
020370 COPY CAQL095.                                                    02037099
020380* jv060600                                                        02038099
020390 01  AREA-CAQL127.                                                02039099
020400 COPY CAQL127.                                                    02040099
020410*                                                                 02041099
020420 01  AREA-CAQLN08.                                                02042099
020430 COPY CAQLN08.                                                    02043099
020440*                                                                 02044099
020450 01  AREA-CAQLN09.                                                02045099
020460 COPY CAQLN09.                                                    02046099
020470                                                                  02047099
020480 01 DADES-START          PIC X(100) VALUE SPACES.                 02048099
020490                                                                  02049099
020500 01 DADES-SCR.                                                    02050099
020510    05 FILLER             PIC X(4)   VALUE 'H.I.'.                02051099
020520    05 F025-HORA-INICI    PIC X(8)   VALUE SPACES.                02052099
020530    05 FILLER             PIC X(1)   VALUE ' '.                   02053099
020540    05 FILLER             PIC X(4)   VALUE 'H.L.'.                02054099
020550    05 F025-HORA-LECTURA  PIC X(8)   VALUE SPACES.                02055099
020560    05 FILLER             PIC X(1)   VALUE ' '.                   02056099
020570    05 FILLER             PIC X(4)   VALUE 'H.G.'.                02057099
020580    05 F025-HORA-GRAVACIO PIC X(8)   VALUE SPACES.                02058099
020590    05 FILLER             PIC X(1)   VALUE ' '.                   02059099
020600    05 FILLER             PIC X(4)   VALUE 'H.F.'.                02060099
020610    05 F025-HORA-FINAL    PIC X(8)   VALUE SPACES.                02061099
020620    05 FILLER             PIC X(1)   VALUE ' '.                   02062099
020630    05 FILLER             PIC X(7)   VALUE '*TASCA '.             02063099
020640    05 F025-NUM-TASCA     PIC 9(5)   VALUE 0.                     02064099
020650    05 FILLER             PIC X(6)   VALUE '*T040:'.              02065099
020660    05 F025-T040-AREA     PIC X(50)  VALUE SPACES.                02066099
020670    05 FILLER             PIC X(8)   VALUE ' *SCR-L.'.            02067099
020680    05 F025-SCR-LLEGIT    PIC X(832) VALUE SPACES.                02068099
020690    05 FILLER             PIC X(8)   VALUE '**SCR-G.'.            02069099
020700    05 F025-SCR-GRAVAT    PIC X(832) VALUE SPACES.                02070099
020710*                                                                 02071099
020720* RTA-17-10-03 INICIO                                             02072099
020730* AREA ACCESO A MODULO RAQWA11 (AVISOS A PRIORI)                  02073099
020740*                                                                 02074099
020750 01  AREA-CAQLA11.                                                02075099
020760     COPY CAQLA11.                                                02076099
020770*                                                                 02077099
020780* AREA ACCESO A MODULO RAQW222 (OBTENCION CONTRATO ICP)           02078099
020790*                                                                 02079099
020800*01  AREA-CAQL222.                                                02080099
020810*    COPY CAQL222.                                                02081099
020820*                                                                 02082099
020830* RTA-17-10-03 FINAL                                              02083099
020840*                                                                 02084099
020850* JVB310101 INI                                                   02085099
020860* AREA ACCESO A MODULO RAQW375 CIMPE                              02086099
020870*                                                                 02087099
020880 01  AREA-caql375.                                                02088099
020890     COPY CAQL375.                                                02089099
020900*                                                                 02090099
020910* jo200501                                                        02091099
020920* AREA ACCES  A MODUL  RAQW395 (trace propi aq (faq400))          02092099
020930*                                                                 02093099
020940 01  AREA-caql395.                                                02094099
020950     COPY CAQL395.                                                02095099
020960*                                                                 02096099
020970 01  W-PUNTER-COMP             PIC S9(8) COMP.                    02097099
020980 01  W-PUNTER-POINTER REDEFINES W-PUNTER-COMP POINTER.            02098099
020990*                                                                 02099099
021000 01  FILLER      PIC X(42)  VALUE                                 02100099
021010         'PR.RAQW001 -AREA L100-AREA-SALVADA *******'.            02101099
021020*                                                                 02102099
021030 01  L100-AREA-SALVADA      PIC X(860).                           02103099
021040*                                                                 02104099
021050 01  FILLER      PIC X(42)  VALUE                                 02105099
021060         'PR.RAQW001 -AREA L010-CAQL010   ****'.                  02106099
021070*                                                                 02107099
021080 01  AREA-CAQLQ10.                                                02108099
021090     COPY CAQLQ10.                                                02109099
021100*                                                                 02110099
021110 01  FILLER      PIC X(42)  VALUE                                 02111099
021120         'PR.RAQW001 -AREA ENLLAS RAQW392    *******'.            02112099
021130*                                                                 02113099
021140*                                                                 02114099
021150 01  L100-AREA-RAQW392.                                           02115099
021160     03 L392-OPCIONS         PIC X(02).                           02116099
021170     03 L392-AQCONVER        PIC X(01).                           02117099
021180     03 L392-AQ1ABNCD        PIC X(7).                            02118099
021190     03 L392-FILLER          PIC X(40).                           02119099
021200     03 L392-SCR-AQ          PIC X(860).                          02120099
021210     03 L392-SCR-APL         PIC X(860).                          02121099
021220*                                                                 02122099
021230 01  CSLW055.                                                     02123099
021240     10 CSLW055-USERID           PIC X(8).                        02124099
021250     10 CSLW055-PWD              PIC X(8).                        02125099
021260     10 CSLW055-NETID            PIC X(8).                        02126099
021270     10 CSLW055-OP               PIC X.                           02127099
021280       88 CSLW055-VERIFY-OP             VALUE 'V'.                02128099
021290       88 CSLW055-DELETE-OP         VALUE 'D'.                    02129099
021300     10 CSLW055-RESULT           PIC X.                           02130099
021310       88 CSLW055-AUTH-USER         VALUE 'S'.                    02131099
021320       88 CSLW055-NOT-AUTH-USER     VALUE 'N'.                    02132099
021330       88 CSLW055-ERROR-RACF        VALUE 'R'.                    02133099
021340       88 CSLW055-ERROR-USUARIO     VALUE 'U'.                    02134099
021350       88 CSLW055-ERROR-RECURSO     VALUE 'I'.                    02135099
021360       88 CSLW055-PWD-EXPIRADO      VALUE 'E'.                    02136099
021370       88 CSLW055-PWD-NOT-AUTH      VALUE 'M'.                    02137099
021380       88 CSLW055-PWD-INVALIDO      VALUE 'F'.                    02138099
021390*                                                                 02139099
021400 01  CSLW060.                                                     02140099
021410     10 CSLW060-USERID                    PIC X(8).               02141099
021420     10 CSLW060-PASSWORD                  PIC X(8).               02142099
021430     10 CSLW060-NETID                     PIC X(8).               02143099
021440     10 CSLW060-OP                        PIC X.                  02144099
021450       88 CSLW060-VERIFY-OP               VALUE 'A'.              02145099
021460     10 CSLW060-RESULT                    PIC X.                  02146099
021470       88 CSLW060-AUTH-USER               VALUE 'S'.              02147099
021480       88 CSLW060-NOT-AUTH-USER           VALUE 'N'.              02148099
021490       88 CSLW060-ERROR-RECURSO-A         VALUE 'I'.              02149099
021500       88 CSLW060-ERROR-RECURSO-OTROS     VALUE 'U'.              02150099
021510       88 CSLW060-ERROR-RACF              VALUE 'R'.              02151099
021520       88 CSLW060-PWD-ERROR               VALUE 'M'.              02152099
021530       88 CSLW060-PWD-EXPIRADO            VALUE 'E'.              02153099
021540       88 CSLW060-NEW-PWD-ERROR           VALUE 'F'.              02154099
021550     10 CSLW060-TRANID                    PIC X(4).               02155099
021560*                                                                 02156099
021570* A288-I                                                          02157099
021580*--> Area enlace raqwc01 (interfase get user branch)              02158099
021590*                                                                 02159099
021600 01  AREA-CAQLC01.                                                02160099
021610     COPY CAQLC01.                                                02161099
021620*                                                                 02162099
021630* A288-F                                                          02163099
021640*p115->                                                           02164099
021650 01  W-P115.                                                      02165099
021660   05  W-CLAU-P115.                                               02166099
021670     10  W-TRANP115    PIC X(4).                                  02167099
021680     10  W-SEPAP115    PIC X(1)  VALUE '-'.                       02168099
021690     10  W-PRODP115    PIC X(8).                                  02169099
021700     10  FILLER        PIC X(7)  VALUE SPACES.                    02170099
021710                                                                  02171099
021720   05 W-ESTAT-P115     PIC X(2).                                  02172099
021730      88 W-TRX-ACTIVA            VALUE 'SI'.                      02173099
021740      88 W-TRX-INACTIVA          VALUE 'NO'.                      02174099
021750*p115<-                                                           02175099
021760*                                                                 02176099
021770*p122-> indicador de Firma Digital                                02177099
021780   05 W-TIPUS-PFD      PIC X(1).                                  02178099
021790      88 W-PFD-SI                VALUE 'S'.                       02179099
021800      88 W-PFD-NO                VALUE 'N'.                       02180099
021810*                                                                 02181099
021820* Area enlace módulo RAQWS14                                      02182099
021830 01  AREA-RAQWS14.                                                02183099
021840     COPY CAQLS14.                                                02184099
021850*p122<-                                                           02185099
021860 01  FILLER      PIC X(42)  VALUE                                 02186099
021870         'PR.RAQW001 ****** FINAL WORKING  *********'.            02187099
021880*                                                                 02188099
021890*AllowAQDrivenOnline4Eyes-I                                       02189099
021900 01  FILLER                       PIC X VALUE 'N'.                02190099
021910     88 archOnline4EyesSolution    VALUE 'Y'.                     02191099
021920     88 notArchOnline4EyesSolution VALUE 'N'.                     02192099
021930*AllowAQDrivenOnline4Eyes-E                                       02193099
021940*                                                                 02194099
021941*MACRO-I                                                          02194199
021942 01  FILLER                       PIC X VALUE SPACE.              02194299
021943     88 TECH-USER-UNKNOWN         VALUE SPACE.                    02194399
021944     88 ITS-TECH-USER             VALUE 'Y'.                      02194499
021945     88 NOT-TECH-USER             VALUE 'N'.                      02194599
021946 01  FILLER.                                                      02194699
021947     05 wsGroupBlockPos              PIC 9(4)  VALUE 0.           02194799
021948     05 wsGroupBlockSize             PIC 9(4)  VALUE 0.           02194899
021949     05 wsCSLFUS1-FUNC-RETC1         PIC 9(9).                    02194999
021950     05 wsCSLFUS1-FUNC-RETC2         PIC 9(9).                    02195099
021951     05 CON-LOW-VALUES               PIC X VALUE LOW-VALUE.       02195199
021952*MACRO-E                                                          02195299
021953*                                                                 02195399
021954*----------------------------------------------------------------*02195499
021955*                                                                *02195599
021956 LINKAGE SECTION.                                                 02195699
021957*                                                                *02195799
021958 01   DFHCOMMAREA.                                                02195899
021959      COPY CAQL300.                                               02195999
021960*                                                                *02196099
021970*--> AREA ENLACE CON MODULO 'RAQW082'                             02197099
021980*                                                                 02198099
021990*                                                                 02199099
022000 01  AREA-CAQL135.                                                02200099
022010     COPY CAQL135.                                                02201099
022020*                                                                 02202099
022030 01  AREA-CAQL082.                                                02203099
022040 COPY CAQL082.                                                    02204099
022050*                                                                 02205099
022060*MACRO-I                                                          02206099
022070 01 RSLFUS1-COMMAREA.                                             02207099
022080    COPY CSLFUS1.                                                 02208099
022090*MACRO-E                                                          02209099
022100*                                                                 02210099
022110*--> AREA COMUNICACIO ENTRE MODULS                                02211099
022120*jvb 20020225                                                     02212099
022130*--> traspaso de area scr de working a linage                     02213099
022140*01  LK-AREA-SCR.                                                 02214099
022150*    05 FILLER PIC X(4080).                                       02215099
022160*                                                                 02216099
022170* JVB150402I                                                      02217099
022180* area definida per a detectar errors degut a us spad > 3220      02218099
022190* o us indegut de la commarea                                     02219099
022200                                                                  02220099
022210 01  L100-AREA-TOTAL-W.                                           02221099
022220     05 L100-SCR             PIC X(860).                          02222099
022230     05 FILLER               PIC X(3220).                         02223099
022240     02 SPAD-WORK            PIC X(4000).                         02224099
022250 01  L100-AREA-TOTAL REDEFINES L100-AREA-TOTAL-W.                 02225099
022260     02 L100-AREA.                                                02226099
022270     COPY CAQL100.                                                02227099
022280     02 SPAD-SCR             PIC X(3220).                         02228099
022290* JVB150402F                                                      02229099
022300                                                                  02230099
022310*01  SCR-AREA-APLICA.                                             02231099
022320*    05 CGTL0010-SCR-APLI    PIC X(860).                          02232099
022330                                                                  02233099
022340*INI-JLM-11/12/01 *** PASA A LINKAGE                              02234099
022350* COPY ARXIU DE GRUPS                                             02235099
022360 COPY CAQF030.                                                    02236099
022370*FIN-JLM-11/12/01                                                 02237099
022380*                                                                 02238099
022390*--> AREA COMUNICACIO ENTRE MODULS                                02239099
022400*                                                                 02240099
022410 01  AREA-CAQL310.                                                02241099
022420     COPY CAQL310.                                                02242099
022430*                                                                 02243099
022440*--> AREA COMUNICACIO DEL REGISTRE D'AUDIT PER TCPIP              02244099
022450*                                                                 02245099
022460*                                                                 02246099
022470*--> AREA ADICIONAL DEL SCR                                       02247099
022480*                                                                 02248099
022490 01  AREA-AQ-ADINAL.                                              02249099
022500     COPY CAQL101.                                                02250099
022510*                                                                 02251099
022520*--> AREA DE AVISOS ( HASTA 40 CODIGOS X(7) )                     02252099
022530*                                                                 02253099
022540 01  CGTL015-AREA.                                                02254099
022550     COPY CAQL015.                                                02255099
022560*                                                                 02256099
022570*--> AREA TRANSACCIONS RELACIONADES                               02257099
022580*                                                                 02258099
022590 01  AREA-CAQL394.                                                02259099
022600     COPY CAQL394.                                                02260099
022610*                                                                 02261099
022620*--> AREA ATRIBUTOS CANAL                                         02262099
022630*                                                                 02263099
022640 01  AREA-CAQL121.                                                02264099
022650     COPY CAQL121.                                                02265099
022660*                                                                 02266099
022670*    area arxiu terminals                                         02267099
022680 COPY CAQF060.                                                    02268099
022690*                                                                 02269099
022700*--> AREA DE TOTALITZACIO                                         02270099
022710*                                                                 02271099
022720*--> AREA DATOS DE USUARIO                                        02272099
022730*                                                                 02273099
022740 01  CAQL078-AREA.                                                02274099
022750     COPY CAQL078.                                                02275099
022760*                                                                 02276099
022770*--> AREA ESTADO FUNCIONES ICP                                    02277099
022780*                                                                 02278099
022790     COPY CAQF409.                                                02279099
022800*                                                                 02280099
022810*--> AREA DESCRIPCION APLICACIONES                                02281099
022820*                                                                 02282099
022830     COPY CAQL002.                                                02283099
022840     COPY CAQL003.                                                02284099
022850*                                                                 02285099
022860* INI-JLM-22/05/02                                                02286099
022870*--> AREA GRABACION DIARIO ELECTR.                                02287099
022880 01  AREA-CAQLD01.                                                02288099
022890     COPY CAQLD01.                                                02289099
022900* FIN-JLM-22/05/02                                                02290099
022910*                                                                 02291099
022920 01  AREA-DNF.                                                    02292099
022930     05 PUNTERO-SIG-AREA           PIC S9(8) COMP.                02293099
022940     05 FILLER                     PIC X(4092).                   02294099
022950*                                                                 02295099
022960*----------------------------------------------------------------*02296099
022970*                                                                *02297099
022980*     WORKA CORRESPONDIENTE AL MENSAJE PC - HOST                 *02298099
022990*                                                                *02299099
023000*----------------------------------------------------------------*02300099
023010 01  T040-AREA.                                                   02301099
023020       05 T040-TRANID              PIC X(4).                      02302099
023030       05 T040-ENTITAT             PIC X(4).                      02303099
023040       05 T040-OFICINA             PIC X(4).                      02304099
023050       05 T040-LLOC                PIC X(4).                      02305099
023060       05 T040-SECUENCIA-TRAN      PIC 9(5).                      02306099
023070       05 T040-TIPO-PROCESO        PIC X(1).                      02307099
023080       05 T040-CONVERSACIONES.                                    02308099
023090          10 T040-ESTADO           PIC X(1).                      02309099
023100          10 T040-CASO             PIC 9(1).                      02310099
023110       05 T040-PANTALLA-PC         PIC X(3).                      02311099
023120       05 T040-ENTORN-TCPIP        PIC X(1).                      02312099
023130       05 T040-TECLA-FUNCION       PIC X(1).                      02313099
023140       05 T040-FILLER              PIC X(4).                      02314099
023150       05 T040-CAMPOS              PIC X(1004).                   02315099
023160       05 T040-LONG-ENTR           PIC 9(5)  COMP.                02316099
023170       05 T040-ADDR                PIC 9(8)  COMP.                02317099
023180       05 T040-LONG-SORT           PIC 9(5)  COMP.                02318099
023190       05 T040-ADDR-AUDIT          PIC 9(8)  COMP.                02319099
023200*----------------------------------------------------------------*02320099
023210 01  T040-RESPUESTA-CAL390.                                       02321099
023220     05 T040-SAL-DUMMY             PIC X(5).                      02322099
023230     05 T040-SAL-PUESTO            PIC 9(4).                      02323099
023240     05 T040-SAL-SECUENCIA         PIC 9(5).                      02324099
023250     05 T040-SAL-RESULTADO         PIC X(1).                      02325099
023260     05 T040-SAL-ESTADO            PIC X(1).                      02326099
023270     05 T040-SAL-CASO              PIC 9(1).                      02327099
023280     05 T040-SAL-TIPO-AREA         PIC X(1).                      02328099
023290     05 T040-SAL-NIVEL             PIC X(1).                      02329099
023300     05 T040-SAL-MENSAJE           PIC X(7).                      02330099
023310     05 T040-SAL-FIN               PIC X(3).                      02331099
023320*                                                                 02332099
023330*----------------------------------------------------------------*02333099
023340*                                                                 02334099
023350*                                                                 02335099
023360*--> AREA INTERNA DE PANTALLA QUE SE PASA AL APLICATIVO CUANDO    02336099
023370*--> SE SIMULA EL ESTADO INICIO                                   02337099
023380*                                                                 02338099
023390 01  AREA-MAPA-FICTICIA          PIC X(1920).                     02339099
023400*                                                                 02340099
023410*--> AREA MISSATGES                                               02341099
023420*                                                                 02342099
023430 01  AREA-MISSATGES      PIC X(300).                              02343099
023440*                                                                 02344099
023450* RTA-17-10-03 INICIO                                             02345099
023460*                                                                 02346099
023470*--> AREA AVISOS A PRIORI                                         02347099
023480*                                                                 02348099
023490 01  AREA-CAQLA99.                                                02349099
023500 COPY CAQLA99.                                                    02350099
023510*                                                                 02351099
023520* RTA-17-10-03 INICIO                                             02352099
023530*                                                                 02353099
023540 COPY CAQF150.                                                    02354099
023550*                                                                 02355099
023560 COPY CAQL155.                                                    02356099
023570*                                                                 02357099
023580 01  AREA-MAPA-REAL              PIC X(1920).                     02358099
023590*                                                                 02359099
023600* AREA DE ENLACE CON EL PROGRAMA PRINCIPAL (PAQW000)              02360099
023610*                                                                 02361099
023620 01  AREA-CAQL000.                                                02362099
023630     COPY CAQL000.                                                02363099
023640*                                                                 02364099
023650* AREA DEL VECTOR DE TECLAS                                       02365099
023660     COPY CAQL017.                                                02366099
023670*                                                                 02367099
023680*p101a->                                                          02368099
023690* Area de sesion eCDL                                             02369099
023700     COPY CAQLE00.                                                02370099
023710*p101a<-                                                          02371099
023720*                                                                 02372099
023730*BROADCAST4EYES-MoreFixes-I                                       02373099
023740* AREA DE CONTEXTO DEL CANAL EBRANCH.                             02374099
023750  COPY CAQLE98.                                                   02375099
023760*BROADCAST4EYES-MoreFixes-E                                       02376099
023770*                                                                 02377099
023780*p122->                                                           02378099
023790* Area parcial de Autorizaciones                                  02379099
023800     COPY CAQLS98.                                                02380099
023810*p122<-                                                           02381099
023820*                                                                 02382099
023830*AllowAQDrivenOnline4Eyes-I                                       02383099
023840*---> AREA PEL FITXER DE CONTROL DE TRANSACCIONS (FQO010)  *      02384099
023850      COPY CQOF010.                                               02385099
023860*AllowAQDrivenOnline4Eyes-E                                       02386099
023870                                                                  02387099
023880*----------------------------------------------------------------*02388099
023890*                                                                *02389099
023900 PROCEDURE DIVISION.                                              02390099
023910*                                                                *02391099
023920*----------------------------------------------------------------*02392099
023930*tracet2-> se adelanta la lectura de parámetros                   02393099
023940     PERFORM 018-LEER-PARAMETROS                                  02394099
023950*tracet2<-                                                        02395099
023960                                                                  02396099
023970                                                                  02397099
023980*Trace técnico: puede activarse de dos modos distintos:           02398099
023990*   1)poniendo '@DXn' en la impresora financiera mediante GT25    02399099
024000*   2)poniendo el código de terminal a tracear en FAQ400 (RW999)  02400099
024010*tracet->                                                         02401099
024020     IF L300-AQPTARE1  > 0                                        02402099
024030        MOVE L300-AQPTARE1          TO W-PUNTER-COMP              02403099
024040        SET ADDRESS OF AREA-CAQL310 TO W-PUNTER-POINTER           02404099
024050        SET ADDRESS OF F060-CAQF060 TO L310-CAQF060               02405099
024060        IF F060-AQ9IMP1(1:3)= '@DX'                               02406099
024070           MOVE F060-AQ9IMP1(4:1)   TO WS-TRACE                   02407099
024080           MOVE 'INICIO (1)---->>'  TO WS-AQNBDTRA                02408099
024090           MOVE F060-AQCDTERM       TO WS-AQINFORM(1:4)           02409099
024100           MOVE '-------------->>'  TO WS-AQINFORM(6:20)          02410099
024110        END-IF                                                    02411099
024120*tracet2->                                                        02412099
024130* Si reg.encontrado y 4º switch activo (trace) se compara terminal02413099
024140* en curso con el del parámetro. Si coinciden: trace activado     02414099
024150        IF SW-FAQ400 = 1 AND F400-AQCDTRAD (4:1) IS NUMERIC       02415099
024160                         AND F060-AQCDTERM = F400-AQCDTRAD (6:4)  02416099
024170           MOVE F400-AQCDTRAD (4:1) TO WS-TRACE                   02417099
024180           MOVE 'INICIO (2)---->>'  TO WS-AQNBDTRA                02418099
024190           MOVE F060-AQCDTERM       TO WS-AQINFORM(1:4)           02419099
024200           MOVE '-------------->>'  TO WS-AQINFORM(6:20)          02420099
024210        END-IF                                                    02421099
024220*                                                                 02422099
024230        IF WS-TRACE > '0'                                         02423099
024240           PERFORM 131-TRACE-TECNIC                               02424099
024250        END-IF                                                    02425099
024260*tracet2<-                                                        02426099
024270     END-IF                                                       02427099
024280*tracet<-                                                         02428099
024290*                                                                 02429099
024300     PERFORM 001-INICI-TRANSAC                                    02430099
024310*                                                                 02431099
024320*SIMU-I                                                           02432099
024330*    Ojo porque antes de que con esta modificación hubiesemos     02433099
024340*    a¦adido dentro de 001-INICI-TRANSAC un direccionamiento      02434099
024350*    a la CAQL100, no era correcto usar variables de L100-        02435099
024360*    Obviamente esto es un "bug" en el código que por algun       02436099
024370*    efecto colateral todavia no se ha transformado en            02437099
024380*    una incidencia. Variables que se estaban usando sin          02438099
024390*    direccionamiento:                                            02439099
024400*                                                                 02440099
024410*      - L100-AREA-TOTAL (dentro de 002-INICIO-PROGRAMA)          02441099
024420*      - L100-AQSWJFIM (mas abajo)                                02442099
024430*      - L100-AQPTLOG     (dentro de 003-OBTENER-DATOS-TERMINAL)  02443099
024440*      - L100-ENTORNO-ECDL(dentro de 003-OBTENER-DATOS-TERMINAL)  02444099
024450*      - L100-AQ1ABNCD    (dentro de 003-OBTENER-DATOS-TERMINAL)  02445099
024460*      - L100-AQ1EIBFN    (dentro de 003-OBTENER-DATOS-TERMINAL)  02446099
024470*      - L100-AQ1EIBRC    (dentro de 003-OBTENER-DATOS-TERMINAL)  02447099
024480*      - L100-AQ1EIBRS    (dentro de 003-OBTENER-DATOS-TERMINAL)  02448099
024490*      - L100-AQPTUSUA (mas abajo)                                02449099
024500*      - L100-AQCDPISO (mas abajo)                                02450099
024510*      - L100-AQPTCANL    (dentro de 015-ACCESO-SCR)              02451099
024520*      - L100-AQPTUSUA    (dentro de 015-ACCESO-SCR)              02452099
024530*                                                                 02453099
024540*    Antes de nuestra modificacion en 001-INICI-TRANSAC           02454099
024550*    ninguna de ellas se deberia haber podido usar antes de       02455099
024560*    la llamada a 015-ACCESO-SCR o a 016-ACCES-SCR-RECANVI        02456099
024570*    que se realizan bastante mas abajo.                          02457099
024580*                                                                 02458099
024590*    Ademas, antes de nuestra modificacion, se alocaba siempre    02459099
024600*    y se inicializaba siempre la CAQL100 dentro de               02460099
024610*    002-INICIO-PROGRAMA, cuando ya nos venia alocada y rellenada 02461099
024620*    desde eCDL, con lo cual se desperdiciaba memoria y quiza     02462099
024630*    se pierden valores pre-rellenados por eCDL.                  02463099
024640*                                                                 02464099
024650*    TO-DO: Revisar los campos de la CAQL100 que se estan sobre-  02465099
024660*    escribiendo dentro de 002-INICIO-PROGRAMA cuando ya vienen   02466099
024670*    informados desde eCDL.                                       02467099
024680*SIMU-E                                                           02468099
024690                                                                  02469099
024700     IF L300-AQCODOPE NOT = 'S'                                   02470099
024710        PERFORM 002-INICIO-PROGRAMA                               02471099
024720*MLV-04-09-03 INICIO                                              02472099
024730        IF EIBTRNID EQUAL 'AQTF'                                  02473099
024740           MOVE 'AQTF'     TO W-EIBTRMID                          02474099
024750        END-IF                                                    02475099
024760        IF L300-ENTORNO-ECDL                                      02476099
024770           MOVE 'ECDL'     TO W-EIBTRMID                          02477099
024780        END-IF                                                    02478099
024790        INITIALIZE F060-CAQF060                                   02479099
024800*MLV-04-09-03 FINAL                                               02480099
024810        PERFORM 003-OBTENER-DATOS-TERMINAL                        02481099
024820     ELSE                                                         02482099
024830*TRACET3-> asegurar que se limpia indicador de trace              02483099
024840        MOVE SPACES TO L100-AQSWJFIM                              02484099
024850*TRACET3<-                                                        02485099
024860        PERFORM 004-INICI-RECANVI                                 02486099
024870     END-IF                                                       02487099
024880*                                                                 02488099
024890*RTA-20-2-04                                                      02489099
024900*--> LIMPIAMOS EL PUNTERO A AVISOS A PRIORI/POSTERIORI            02490099
024910     MOVE ZEROS TO L310-CAQLA99                                   02491099
024920*RTA-20-2-04 FINAL                                                02492099
024930*                                                                 02493099
024940     INITIALIZE L120-CAQL120                                      02494099
024950*                                                                 02495099
024960     PERFORM 005-OBTENER-ATRIBUTOS-CANAL                          02496099
024970*                                                                 02497099
024980*                                                                 02498099
024990     IF L300-AQCODOPE  = 'S'                                      02499099
025000        MOVE L100-AQPTUSUA          TO W-PUNTER-COMP              02500099
025010        SET ADDRESS OF CAQL078-AREA TO W-PUNTER-POINTER           02501099
025020     ELSE                                                         02502099
025030*                                                                 02503099
025040* ABANS ES PREGUNTAVA PER SPAIN CODI ES, I ARA ES VOL QUE SEMPRE  02504099
025050* VAGI A L'ARXIU A CONSULTAR USUARI                               02505099
025060*                                                                 02506099
025070        IF L100-AQCDPISO(1:2) NOT = 'XX'                          02507099
025080           PERFORM 006-OBTENER-DATOS-USUARIO                      02508099
025090        ELSE                                                      02509099
025100           PERFORM 007-DADES-DEFECTE-USUARI                       02510099
025110        END-IF                                                    02511099
025120     END-IF                                                       02512099
025130*                                                                 02513099
025140     PERFORM 008-DIRECCIONAR-AREA-CVT                             02514099
025150*                                                                 02515099
025160     IF L300-AQCODOPE  NOT = 'S'                                  02516099
025170        PERFORM 009-MENSAJES                                      02517099
025180     END-IF                                                       02518099
025190*                                                                 02519099
025200*--> Si es la transaccion se ejecuta desde el CAQL390 los datos   02520099
025210*--> llegan via LINKAGE, no se ha de hacer 'RECEIVE'              02521099
025220*                                                                 02522099
025230*P1000->                                                          02523099
025240*    IF W-EIBTRMID = 'TCPI' OR                                    02524099
025250*P1000<-                                                          02525099
025260*                                                                 02526099
025270*MLV-03-07-03 INICIO                                              02527099
025280*       EIBTRNID = 'AQTF'                                         02528099
025290*P1000->                                                          02529099
025300*       EIBTRNID = 'AQTF' OR                                      02530099
025310     IF EIBTRNID = 'AQTF' OR                                      02531099
025320*P1000<-                                                          02532099
025330        L300-ENTORNO-ECDL                                         02533099
025340*MLV-03-07-03 FINAL                                               02534099
025350*                                                                 02535099
025360        PERFORM 010-MISSATGE-TCPIP                                02536099
025370     ELSE                                                         02537099
025380*                                                                 02538099
025390*--> Si es LOGON PC (GT03) no se va a recibir los datos porque    02539099
025400*--> ya los ha recibido el programa PCIU000                       02540099
025410        IF (F060-TERM-FINANCIERO) AND (NOT SW-LOGON-GT03)         02541099
025420*                                                                 02542099
025430*MLV-03-07-03 INICIO                                              02543099
025440*          AND W-TERM-TCPIP NOT = 'TCPI'                          02544099
025450*P1000->                                                          02545099
025460*          AND (W-TERM-TCPIP NOT = 'TCPI') AND                    02546099
025470*          (NOT L300-ENTORNO-ECDL)                                02547099
025480           AND (NOT L300-ENTORNO-ECDL)                            02548099
025490*P1000<-                                                          02549099
025500*MLV-03-07-03 INICIO                                              02550099
025510*                                                                 02551099
025520           PERFORM 011-LEER-MENSAJE-ENTRADA                       02552099
025530        END-IF                                                    02553099
025540     END-IF                                                       02554099
025550* INI-JLM-13/01/03                                                02555099
025560*MLV-03-09-03 INICIO                                              02556099
025570                                                                  02557099
025580* Si entorno eCDL y GT03 o AQLG no se borra la cola de mensajes   02558099
025590* variables porque aun no se conoce el terminal                   02559099
025600*SIMU-I                                                           02560099
025610*    Los parentesis se ponen para que el código sea un reflejo    02561099
025620*    fiel del comentario anterior, ya que en su forma previa      02562099
025630*    y debido al orden de precedencia en la evaluacion de los     02563099
025640*    operadores logicos AND y OR, el código no reflejaba          02564099
025650*    correctamente la intención expresada por el programador que  02565099
025660*    hizo dicho comentario. Adicionalmente, en este punto del     02566099
025670*    programa la linkage CAQL100 todavía no esta direccionada     02567099
025680*    por lo que no se puede usar el prefijo L100, sino que debe   02568099
025690*    usarse el L300. A partir de nuestra modificación, no         02569099
025700*    obstante, dado que dentro de la llamada previa a             02570099
025710*    001-INICI-TRANSAC hemos a¦adido un direccionamiento          02571099
025720*    a la CAQL100, si que seria posible usar L100- o L300-        02572099
025730*    de forma intercambiable, pero para mantener el espiritu      02573099
025740*    previo del código, lo cambiamos a usar L300-.                02574099
025750*    Obviamente esto es un "bug" en el código que por algun       02575099
025760*    efecto colateral todavia no se ha transformado en            02576099
025770*    una incidencia.                                              02577099
025780*    IF L100-ENTORNO-ECDL AND SW-LOGON-AQLG OR SW-LOGON-GT03      02578099
025790     IF L300-ENTORNO-ECDL AND (SW-LOGON-AQLG OR SW-LOGON-GT03)    02579099
025800        OR L100-AQFILL16 = 'SIMUFUSI'                             02580099
025810*SIMU-E                                                           02581099
025820        CONTINUE                                                  02582099
025830     ELSE                                                         02583099
025840*JO-14.04.2005                                                    02584099
025850        MOVE W-EIBTRMID      TO W-TERMID-TS                       02585099
025860        EXEC CICS DELETEQ TS QUEUE (W-COLA) RESP (COD-RESP)       02586099
025870        END-EXEC                                                  02587099
025880     END-IF                                                       02588099
025890                                                                  02589099
025900*                                                                 02590099
025910     IF SW-LOGON-GT03 OR SW-LOGON-AQLG                            02591099
025920*SIMU-I                                                           02592099
025930        OR L100-AQFILL16 = 'SIMUFUSI'                             02593099
025940*SIMU-E                                                           02594099
025950        PERFORM 012-TRANS-ESPECIAL                                02595099
025960        PERFORM 013-ESBORRA-PAGINACIO                             02596099
025970*A271 26/07/04 INICIO                                             02597099
025980*       PERFORM 124-ESBORRA-REGIS-SCR-TASCA                       02598099
025990*A271 26/07/04 FINAL                                              02599099
026000*tracet->                                                         02600099
026010        IF WS-TRACE > '0'                                         02601099
026020           MOVE 'END-RAQW001-01' TO WS-AQNBDTRA                   02602099
026030           MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                   02603099
026040           STRING                                                 02604099
026050              '<<==== Tran/estado/caso|ret: ' F030-AQ3TRNID '/'   02605099
026060               L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE    02606099
026070               DELIMITED BY SIZE  INTO WS-AQINFORM                02607099
026080           END-STRING                                             02608099
026090           PERFORM 131-TRACE-TECNIC                               02609099
026100        END-IF                                                    02610099
026110*tracet<-                                                         02611099
026120        EXEC CICS RETURN END-EXEC                                 02612099
026130     END-IF                                                       02613099
026140*                                                                 02614099
026150     PERFORM 014-OBTENER-AREA-TECLAS                              02615099
026160*                                                                 02616099
026170     IF L300-AQCODOPE  NOT = 'S'                                  02617099
026180        PERFORM 015-ACCESO-SCR                                    02618099
026190     ELSE                                                         02619099
026200        PERFORM 016-ACCES-SCR-RECANVI                             02620099
026210     END-IF                                                       02621099
026211                                                                  02621199
026212*NewSAMGbasedWarnings-I                                           02621299
026213*    We set this here, because once RAQWN09 is invoked further    02621399
026214*    in the program flow, the value of L100-AQSWRECT coming       02621499
026215*    from the SCR will be lost                                    02621599
026216     IF NOT L100-NO-HAY-CAMBIO                                    02621699
026217        SET evalNavigWarnings TO TRUE                             02621799
026218     ELSE                                                         02621899
026219        SET notEvalNavigWarnings TO TRUE                          02621999
026220     END-IF                                                       02622099
026221*NewSAMGbasedWarnings-E                                           02622199
026222*                                                                 02622299
026223*INI-JO-07.04.2005                                                02622399
026224*                                                                 02622499
026225*                                                                 02622599
026226*26.04.2005-JO-INICI                                              02622699
026227*                                                                 02622799
026228     IF EIBTRNID = 'GT05'                                         02622899
026229        MOVE L100-AQ1TERML  TO WS-TSQ-TERMAL                      02622999
026230                                                                  02623099
026240        EXEC CICS DELETEQ TS QUEUE (WS-TSQ-NOM)                   02624099
026250             RESP (COD-RESP)                                      02625099
026260        END-EXEC                                                  02626099
026270     END-IF                                                       02627099
026280*                                                                 02628099
026290*26.04.2005-JO-FI                                                 02629099
026300*                                                                 02630099
026310     PERFORM 017-INCREM-NUM-OPERACION                             02631099
026320*                                                                 02632099
026330*FI-JO-07.04.2005                                                 02633099
026340*                                                                 02634099
026350*hm1 Si esta activado el nuevo trace en el fichero de paraetros   02635099
026360*    invocar al servicio. En caso contrario no hace nada.         02636099
026370                                                                  02637099
026380                                                                  02638099
026390     MOVE 0      TO  L100-AQHMALPC                                02639099
026400     MOVE 0      TO  L100-AQCTMINU                                02640099
026410     MOVE SPACES TO  L100-AQCDLAYR                                02641099
026420                                                                  02642099
026430*tracet2->                                                        02643099
026440*****PERFORM 018-LEER-PARAMETROS                                  02644099
026450*tracet2<-                                                        02645099
026460                                                                  02646099
026470*    IF SW-FAQ400 = 1 AND F400-AQ4REGTO (2:1) = 'S'               02647099
026480     IF SW-FAQ400 = 1 AND F400-AQCDTRAD (2:1) = 'S'               02648099
026490         PERFORM 019-PETICION-NUEVO-TRACE                         02649099
026500     END-IF                                                       02650099
026510*hm1                                                              02651099
026520*                                                                 02652099
026530* INI-JLM-25/04/03                                                02653099
026540     IF L100-ESTADO-INICIO AND L100-AQ1DCASO = 1                  02654099
026550        MOVE SPACES        TO L100-AQUSULAU                       02655099
026560     END-IF                                                       02656099
026570* FIN-JLM-25/04/03                                                02657099
026580*                                                                 02658099
026590     IF EIBTRNID = 'AQTF'                                         02659099
026600        MOVE W-USERID      TO L100-AQ1USCIC                       02660099
026610     END-IF                                                       02661099
026620                                                                  02662099
026630     PERFORM 020-VALIDAR-RANGO-USUARIO                            02663099
026640**RTA1                                                            02664099
026650*                                                                 02665099
026660*MLV-10-10-05 INICIO                                              02666099
026670*    PERFORM 027-CONTROL-ACCESO-TRANSACCION                       02667099
026680*MLV-10-10-05 FINAL                                               02668099
026690*                                                                 02669099
026700*P1008->                                                          02670099
026710*    IF NOT  L300-ENTORNO-ECDL                                    02671099
026720*                                                                 02672099
026730*       IF F060-TERM-FINANCIERO AND L100-SW-HAY-MENSAJES          02673099
026740*          PERFORM 021-ENVIO-MENSAJES                             02674099
026750*       END-IF                                                    02675099
026760*    END-IF                                                       02676099
026770*P1008-<                                                          02677099
026780*--> MLV280700 Inicio                                             02678099
026790     IF SW-AQVC                                                   02679099
026800        PERFORM 012-TRANS-ESPECIAL                                02680099
026810*A271 26/07/04 INICIO                                             02681099
026820*       PERFORM 124-ESBORRA-REGIS-SCR-TASCA                       02682099
026830*A271 26/07/04 FINAL                                              02683099
026840*tracet->                                                         02684099
026850        IF WS-TRACE > '0'                                         02685099
026860           MOVE 'END-RAQW001-02' TO WS-AQNBDTRA                   02686099
026870           MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                   02687099
026880           STRING                                                 02688099
026890              '<<==== Tran/estado/caso|ret: ' F030-AQ3TRNID '/'   02689099
026900               L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE    02690099
026910               DELIMITED BY SIZE  INTO WS-AQINFORM                02691099
026920           END-STRING                                             02692099
026930           PERFORM 131-TRACE-TECNIC                               02693099
026940        END-IF                                                    02694099
026950*tracet<-                                                         02695099
026960        EXEC CICS RETURN END-EXEC                                 02696099
026970     END-IF                                                       02697099
026980*--> MLV280700 Final                                              02698099
026990*                                                                 02699099
027000     PERFORM 022-LLEGIR-ARXIU-FAQ030                              02700099
027010     PERFORM 023-CONTROL-DE-FUNCIONS                              02701099
027020*                                                                 02702099
027030*                                                                 02703099
027040* AVERIGUA I REGRAVAR ARXIU FAQ030 PER ACTIVAR INDICADORS DE      02704099
027050* FUNCIONS DE PAGINACIó PER TRASPASSOS                            02705099
027060*                                                                 02706099
027070*    IF F030-AQSWPAGI = '1' AND F030-AQ3TRNID(1:2) NOT = 'AQ'     02707099
027080*       PERFORM 20-REGRAVA-FAQ030                                 02708099
027090*    END-IF                                                       02709099
027100*                                                                 02710099
027110     PERFORM 024-LLEGIR-ARXIU-FAQ150                              02711099
027120     PERFORM 025-TRACE-RECEIVE                                    02712099
027130     PERFORM 026-TRACTAR-CCT-ACTUAL                               02713099
027140*                                                                 02714099
027150*MLV-10-10-05 INICIO                                              02715099
027160*NoRACFControlForRemoteVerifier-I                                 02716099
027170     SET invokeTargetUnderRemote TO TRUE                          02717099
027180     IF L300-ENTORNO-ECDL                                         02718099
027190        SET ADDRESS OF LE00-CAQLE00 TO L000-AQPTSESP              02719099
027200        SET ADDRESS OF LE98-CAQLE98 TO ADDRESS OF LE00-AQAQBUFF   02720099
027210        IF LE98-AQPERSKY(1:2) = 'VE'                              02721099
027220           SET notInvokeTargetUnderRemote TO TRUE                 02722099
027230        END-IF                                                    02723099
027231*NewSAMGbasedWarnings-I                                           02723199
027232*       We are reusing invokeTargetUnderRemote for when receiving 02723299
027233*       the confirmation of access for justifiable SAMG warnings  02723399
027234*       as under such a situation we do not want to call the      02723499
027235*       target program either, and some other tasks might         02723599
027236*       be avoided as well. We can only do this for remote channel02723699
027237*       because for native 3270 channel the only copy of the      02723799
027238*       screen in place is that of the CICS map itself, so we     02723899
027239*       always need to invoke the target program.                 02723999
027240        IF L100-AQAVISOS = 'J' OR 'H'                             02724099
027241           SET notInvokeTargetUnderRemote TO TRUE                 02724199
027242        END-IF                                                    02724299
027243*NewSAMGbasedWarnings-E                                           02724399
027244*                                                                 02724499
027245     END-IF                                                       02724599
027246*                                                                 02724699
027253     IF invokeTargetUnderRemote                                   02725399
027260*NoRACFControlForRemoteVerifier-E                                 02726099
027270        PERFORM 027-CONTROL-ACCESO-TRANSACCION                    02727099
027280*NoRACFControlForRemoteVerifier-I                                 02728099
027290     END-IF                                                       02729099
027300*NoRACFControlForRemoteVerifier-E                                 02730099
027310*MLV-10-10-05 FINAL                                               02731099
027320*                                                                 02732099
027330*                                                                 02733099
027340*Revert-Fixes-BROADCAST-I                                         02734099
027350*Fixes-BROADCAST-I                                                02735099
027360*    IF NOT L100-AUTORIZ-PEAU-DIST      AND                       02736099
027370*       NOT L100-AUTORIZ-PEAU-DIST-INIT AND                       02737099
027380*       NOT L100-AUTORIZ-4OJOS-DIST     AND                       02738099
027390*       NOT L100-AUTORIZ-4OJOS-DIST-INIT                          02739099
027400*Fixes-BROADCAST-E                                                02740099
027410*Revert-Fixes-BROADCAST-E                                         02741099
027420*INCIKPDB-I                                                       02742099
027430*       PERFORM 028-ACCES-A-4ULLS                                 02743099
027440     IF invokeTargetunderRemote                                   02744099
027450        PERFORM 028-ACCES-A-4ULLS                                 02745099
027460     END-IF                                                       02746099
027470*INCIKPDB-F                                                       02747099
027480*Revert-Fixes-BROADCAST-I                                         02748099
027490*Fixes-BROADCAST-I                                                02749099
027500*    END-IF                                                       02750099
027510*Fixes-BROADCAST-E                                                02751099
027520*Revert-Fixes-BROADCAST-E                                         02752099
027530*                                                                 02753099
027540     IF L300-AQCODOPE  NOT = 'S'                                  02754099
027550        IF F060-TERM-3270                                         02755099
027560           MOVE EIBAID  TO W-EIBAID                               02756099
027570        END-IF                                                    02757099
027580     ELSE                                                         02758099
027590        MOVE LOW-VALUES TO W-EIBAID                               02759099
027600     END-IF                                                       02760099
027610                                                                  02761099
027620     IF F060-TERM-FINANCIERO                                      02762099
027630        MOVE T040-TECLA-FUNCION   TO W-EIBAID                     02763099
027640     END-IF                                                       02764099
027650                                                                  02765099
027660*    IF F060-TERM-FINANCIERO                                      02766099
027670*       IF T040-ESTADO = 'I'                                      02767099
027680*          PERFORM 013-ESBORRA-PAGINACIO                          02768099
027690*       END-IF                                                    02769099
027700*    END-IF                                                       02770099
027710     IF F060-TERM-WEB-BRANCH                                      02771099
027720        MOVE EIBAID  TO W-EIBAID                                  02772099
027730     END-IF                                                       02773099
027740                                                                  02774099
027750*NewSAMGbasedWarnings-I                                           02775099
027760*       MOVE W-EIBAID   TO L100-AQTECPAG.                         02776099
027770     IF L100-AQAVISOS NOT = 'H'                                   02777099
027771*       We are processing a PETCONF so we delay this              02777199
027772        MOVE W-EIBAID TO L100-AQTECPAG                            02777299
027773     END-IF                                                       02777399
027774*NewSAMGbasedWarnings-E                                           02777499
027775                                                                  02777599
027776*                                                                 02777699
027777*                                                                 02777799
027778* TRACTAMENT D'EL ENTER O ALTRES TECLES EN PAGINACIO ???          02777899
027779* HE DE POSAR ALGUNA COSA AQUI ???                                02777999
027780*                                                                 02778099
027790                                                                  02779099
027800     PERFORM 029-PROCESO-PROGRAMA                                 02780099
027810*                                                                 02781099
027820     PERFORM 030-DESPRES-APLICA                                   02782099
027830*                                                                 02783099
027840*  CONTROL DELS PROGRAMES QUE TORNEN PER ERROR PGR ENLLOC DE PRG  02784099
027850*                                                                 02785099
027860     IF L100-AQ1ACCIO = 'PGR'                                     02786099
027870        IF L100-AQIDCICS = 'D' OR 'I' OR 'H' OR 'U'               02787099
027880           SET L100-ACCION-TERMINAL TO TRUE                       02788099
027890           MOVE 'JAQE000' TO L100-AQ1ERRCD                        02789099
027900        END-IF                                                    02790099
027910     END-IF                                                       02791099
027920                                                                  02792099
027930                                                                  02793099
027940     IF L100-ACCION-TERMINAL                                      02794099
027950         PERFORM 031-FINAL                                        02795099
027960     ELSE                                                         02796099
027970         PERFORM 032-CCT-CONT                                     02797099
027980     END-IF                                                       02798099
027990                                                                  02799099
028000*NewSAMGbasedWarnings-I                                           02800099
028010     IF L100-AQAVISOS = 'H'                                       02801099
028020        MOVE W-EIBAID TO L100-AQTECPAG                            02802099
028030     END-IF                                                       02803099
028031*NewSAMGbasedWarnings-E                                           02803199
028032     .                                                            02803299
028033*                                                                 02803399
028034*----------------------------------------------------------------*02803499
028035*    -  MARCAR A RAQW392 INICI TRANSACCIO                        *02803599
028036*----------------------------------------------------------------*02803699
028037 001-INICI-TRANSAC.                                               02803799
028038*------------------                                               02803899
028039*tracet->                       +                                 02803999
028040     IF WS-TRACE > '0'                                            02804099
028050        MOVE '001-INICI-TRANSAC               ' TO WS-AQNBDTRA    02805099
028060        PERFORM 131-TRACE-TECNIC                                  02806099
028070     END-IF                                                       02807099
028080*tracet<-                                                         02808099
028090*I005 INICIO                                                      02809099
028100     SET SW-NO-SIMULAR-INICIO-ECDL TO TRUE                        02810099
028110*I005 FINAL                                                       02811099
028120*                                                                 02812099
028130*MLV-13-05-2005 INICIO                                            02813099
028140     SET SW-ERROR-NO-DETECTADO-AQ TO TRUE                         02814099
028150*MLV-13-05-2005 FINAL                                             02815099
028160     MOVE '0'            TO W-AQTRACE.                            02816099
028170*                                                                 02817099
028180*MLV-03-07-03 INICIO                                              02818099
028190*                                                                 02819099
028200* Si es entorno eCDL se direcciona el area de enlace con PAQW000  02820099
028210* ya que en ella existen datos como punteros y otro tipo de infor-02821099
028220* macion que se necita en este modulo                             02822099
028230*                                                                 02823099
028240     IF L300-ENTORNO-ECDL                                         02824099
028250        MOVE L300-AQPTARE2 TO W-PUNTER-COMP                       02825099
028260        SET  ADDRESS OF AREA-CAQL000 TO W-PUNTER-POINTER          02826099
028270*TRACET3->                                                        02827099
028280*       direccionar área eCDL para ver si solicitado trace de eCDL02828099
028290        SET ADDRESS OF LE00-CAQLE00 TO L000-AQPTSESP              02829099
028300        MOVE LE00-AQSWTRAC TO WS-TRACE                            02830099
028310        IF WS-TRACE > '0'                                         02831099
028320           MOVE '001-INICI-TRANSAC               ' TO WS-AQNBDTRA 02832099
028330           MOVE 'INICIO (3)---->>'                 TO WS-AQNBDTRA 02833099
028340           PERFORM 131-TRACE-TECNIC                               02834099
028350        END-IF                                                    02835099
028360*TRACET3<-                                                        02836099
028370                                                                  02837099
028380*eCDL-Optim-Rollback-I                                            02838099
028390*eCDL-Optim-I                                                     02839099
028400**      IF LE00-AQPTSCRP NOT = Nulls                              02840099
028410*          Nota: lo limitamos a EBRANCH para evitar el            02841099
028420*                efecto colateral sobre los eventos de            02842099
028430*                PBC y MYBANK                                     02843099
028440**         AND LE00-AQIDPROD = 'EBRANCH'                          02844099
028450**         SET ADDRESS OF L100-AREA-TOTAL TO LE00-AQPTSCRP        02845099
028460**      END-IF                                                    02846099
028470*eCDL-Optim-E                                                     02847099
028480*eCDL-Optim-Rollback-E                                            02848099
028490     END-IF                                                       02849099
028500*                                                                 02850099
028510*MLV-03-07-03 FINAL                                               02851099
028520*                                                                 02852099
028530* MLV101202 INICIO                                                02853099
028540* BORRAR LA COLA TS DE LOS MENSAJES VARIABLES                     02854099
028550* INI-JLM-13/01/03                                                02855099
028560*    MOVE EIBTRMID TO W-TERMID-TS                                 02856099
028570*    EXEC CICS DELETEQ TS QUEUE (W-COLA) RESP (COD-RESP)          02857099
028580*    END-EXEC                                                     02858099
028590* FIN-JLM-13/01/03                                                02859099
028600*    .                                                            02860099
028610* MLV101202 FINAL                                                 02861099
028620*A366->                                                           02862099
028630*                                                                 02863099
028640*    Ganar area de datos adicional del SCR                        02864099
028650*                                                                 02865099
028660     EXEC CICS GETMAIN SET (ADDRESS OF AREA-AQ-ADINAL)            02866099
028670          INITIMG (C-LOW-VALUES)                                  02867099
028680          FLENGTH (LENGTH OF AREA-AQ-ADINAL) RESP (COD-RESP)      02868099
028690          NOSUSPEND                                               02869099
028700     END-EXEC                                                     02870099
028710                                                                  02871099
028720     IF COD-RESP NOT = DFHRESP (NORMAL)                           02872099
028730        PERFORM 033-INFORMAR-DATOS-ABEND                          02873099
028740     END-IF                                                       02874099
028750                                                                  02875099
028760*    SET  W-PUNTER-POINTER TO ADDRESS OF AREA-AQ-ADINAL           02876099
028770*    MOVE W-PUNTER-COMP    TO L100-AQPTAPLI                       02877099
028780                                                                  02878099
028790     IF L300-ENTORNO-ECDL                                         02879099
028800        MOVE L000-AQTPDOCU TO L101-AQTPDOCU                       02880099
028810*GFTÑ01-I                                                         02881099
028820*    Traspaso del detalle del billetaje de una operacion          02882099
028830        MOVE L000-AQDETABE TO L101-AQDETABE                       02883099
028840*GFTÑ01-F                                                         02884099
028850*P137-> Guardar dirección de CAQLE00 en puntero de CAQL101        02885099
028860        MOVE L000-AQPTSESC TO L101-AQPTECDL                       02886099
028870*P137<-                                                           02887099
028880*ADS-I                                                            02888099
028890        MOVE ZEROS         TO L101-AQPTADSC                       02889099
028900*ADS-F                                                            02890099
028910     END-IF                                                       02891099
028920*A366<-                                                           02892099
028930     .                                                            02893099
028940*                                                                 02894099
028950*----------------------------------------------------------------*02895099
028960*    -  DETERMINAR CICS DE TERMINALES DONDE SE EJECUTA LA TRAN - *02896099
028970*       SACCION.                                                 *02897099
028980*    -  OBTENER AREA DE MEMORIA PARA EL SCR.                     *02898099
028990*----------------------------------------------------------------*02899099
029000 002-INICIO-PROGRAMA.                                             02900099
029010*--------------------                                             02901099
029020*tracet->                       +                                 02902099
029030     IF WS-TRACE > '0'                                            02903099
029040        MOVE '002-INICIO-PROGRAMA             ' TO WS-AQNBDTRA    02904099
029050        PERFORM 131-TRACE-TECNIC                                  02905099
029060     END-IF                                                       02906099
029070*tracet<-                                                         02907099
029080     INITIALIZE L045-CAQL045                                      02908099
029090     INITIALIZE L145-CAQL145                                      02909099
029100*    Obtener memoria para area registro de sesion                 02910099
029110                                                                  02911099
029120* JVB150402 SE HACE GETMAIN SOBRE ...TOTAL-W EN LUGAT DE --TOTAL  02912099
029130*    EXEC CICS GETMAIN SET (ADDRESS OF L100-AREA-TOTAL)           02913099
029140*                                                                 02914099
029150*                                                                 02915099
029160*eCDL-Optim-Rollback-I                                            02916099
029170*eCDL-Optim-I                                                     02917099
029180*    Realmente solo hay que hacerlo cuando no venimos de eCDL     02918099
029190*    puesto que si venimos de eCDL, ya tendremos probablemente    02919099
029200*    una SCR parcialmente alocada.                                02920099
029210**   IF NOT L300-ENTORNO-ECDL OR                                  02921099
029220**      (L300-ENTORNO-ECDL AND LE00-AQPTSCRP = Nulls)             02922099
029230*        Nota: lo limitamos a no EBRANCH para evitar el           02923099
029240*              efecto colateral sobre los eventos de              02924099
029250*              PBC y MYBANK                                       02925099
029260**      OR LE00-AQIDPROD NOT = 'EBRANCH'                          02926099
029270*eCDL-Optim-E                                                     02927099
029280*eCDL-Optim-Rollback-E                                            02928099
029290        EXEC CICS GETMAIN SET (ADDRESS OF L100-AREA-TOTAL-W)      02929099
029300             INITIMG (C-LOW-VALUES)                               02930099
029310             FLENGTH (LENGTH OF L100-AREA-TOTAL-W) RESP (COD-RESP)02931099
029320             NOSUSPEND                                            02932099
029330        END-EXEC                                                  02933099
029340*eCDL-Optim-Rollback-I                                            02934099
029350*eCDL-Optim-I                                                     02935099
029360**   END-IF                                                       02936099
029370*eCDL-Optim-E                                                     02937099
029380*eCDL-Optim-Rollback-E                                            02938099
029390*                                                                 02939099
029400*    EXEC CICS GETMAIN SET (ADDRESS OF SCR-AREA-APLICA)           02940099
029410*         INITIMG (C-LOW-VALUES)                                  02941099
029420*         FLENGTH (LENGTH OF SCR-AREA-APLICA) RESP (COD-RESP)     02942099
029430*         NOSUSPEND                                               02943099
029440*    END-EXEC                                                     02944099
029450*                                                                 02945099
029460*eCDL-Optim-Rollback-I                                            02946099
029470*eCDL-Optim-I                                                     02947099
029480*    No podemos inicializar L100-CAQF100 cuando ya nos viene      02948099
029490*    rellenada desde eCDL                                         02949099
029500*    INITIALIZE L100-CAQF100                                      02950099
029510**   IF NOT L300-ENTORNO-ECDL OR                                  02951099
029520**      (L300-ENTORNO-ECDL AND LE00-AQPTSCRP = Nulls)             02952099
029530*        Nota: lo limitamos a no EBRANCH para evitar el           02953099
029540*              efecto colateral sobre los eventos de              02954099
029550*              PBC y MYBANK                                       02955099
029560**      OR LE00-AQIDPROD NOT = 'EBRANCH'                          02956099
029570**      INITIALIZE L100-CAQF100                                   02957099
029580**   END-IF                                                       02958099
029590*eCDL-Optim-E                                                     02959099
029600     INITIALIZE L100-CAQF100                                      02960099
029610*eCDL-Optim-Rollback-E                                            02961099
029620*tracet->                                                         02962099
029630     MOVE WS-TRACE TO L100-AQSWJFIM                               02963099
029640*tracet<-                                                         02964099
029650                                                                  02965099
029660* JVB150402I                                                      02966099
029670     MOVE HIGH-VALUES TO SPAD-WORK                                02967099
029680* JVB150402F                                                      02968099
029690                                                                  02969099
029700     PERFORM 034-DIRECCIONAR-AREA-CAQL310                         02970099
029710                                                                  02971099
029720* INI-JLM-22/05/02                                                02972099
029730*                                                                 02973099
029740*--> Obtener area de memoria para area de diario electronico      02974099
029750*                                                                 02975099
029760*--> No se utiliza la opcion RESP para que en caso de error       02976099
029770*--> termine la transaccion con un ABEND de CICS                  02977099
029780*                                                                 02978099
029790     EXEC CICS GETMAIN SET (L310-CAQLD01P)                        02979099
029800          INITIMG (C-SPACES)                                      02980099
029810          FLENGTH (LENGTH OF LD01-CAQLD01)                        02981099
029820          NOSUSPEND                                               02982099
029830     END-EXEC                                                     02983099
029840     SET ADDRESS OF AREA-CAQLD01 TO L310-CAQLD01                  02984099
029850     INITIALIZE AREA-CAQLD01                                      02985099
029860* FIN-JLM-22/05/02                                                02986099
029870*                                                                 02987099
029880*    Almacenar direccion de la Scr-AQ i SCR-Aplicativa en CAQL310 02988099
029890                                                                  02989099
029900*    SET L310-AQSCRAP     TO ADDRESS OF SCR-AREA-APLICA           02990099
029910     SET L310-AQSCRAR     TO ADDRESS OF L100-AREA-TOTAL           02991099
029920     SET W-PUNTER-POINTER TO ADDRESS OF L100-AREA-TOTAL           02992099
029930*    ALMACENAR DIRECCION DE LA SCR EN CAQL300                     02993099
029940     MOVE W-PUNTER-COMP   TO L300-AQPTARE3                        02994099
029950                                                                  02995099
029960     SET  W-PUNTER-POINTER TO ADDRESS OF L155-CAQL155             02996099
029970     MOVE W-PUNTER-COMP     TO W-PTR-CAQL155                      02997099
029980                                                                  02998099
029990*SIMU-I                                                           02999099
030000     IF L100-AQFILL16 = 'SIMUFUSI'                                03000099
030010*       Procedemos a crear dinamicamente el terminal que ha sido  03001099
030020*       leido del header ECDL_TERM en la tabla de pool terminales 03002099
030030*       y tambien en el VSAM.                                     03003099
030040*       No hace falta borrarlo posteriormente puesto que este     03004099
030050*       parrafo se puede repetir sin problemas cada vez           03005099
030060        PERFORM 146-ALTA-TERMINAL-DESECHABLE                      03006099
030070     END-IF                                                       03007099
030080*SIMU-E                                                           03008099
030090                                                                  03009099
030100*    INITIALIZE F060-CAQF060                                      03010099
030110     SET ADDRESS OF F060-CAQF060      TO L310-CAQF060             03011099
030120                                                                  03012099
030130* 120302 jvb ini                                                  03013099
030140*    CONSULTA REgISTRO ESTADO DE FUNCIONES ICP                    03014099
030150*    MEDIANTE LLAMADA RAQW127 RECUPERAMOS CAQF409                 03015099
030160                                                                  03016099
030170     EXEC CICS GETMAIN SET (ADDRESS OF F409-AREA)                 03017099
030180          FLENGTH (LENGTH OF F409-AREA) INITIMG (C-LOW-VALUES)    03018099
030190          RESP (COD-RESP) NOSUSPEND                               03019099
030200     END-EXEC                                                     03020099
030210                                                                  03021099
030220     IF COD-RESP NOT = DFHRESP(NORMAL)                            03022099
030230        PERFORM 033-INFORMAR-DATOS-ABEND                          03023099
030240     END-IF                                                       03024099
030250                                                                  03025099
030260     INITIALIZE F409-AREA                                         03026099
030270     INITIALIZE AREA-CAQL127                                      03027099
030280                                                                  03028099
030290     MOVE SPACES                TO F409-AQCDKEY                   03029099
030300     SET  L127-LECTURA          TO TRUE                           03030099
030310     MOVE 9                     TO F409-AQCDREGT                  03031099
030320     MOVE F409-AQCDKEY          TO L127-AQCLV127                  03032099
030330     MOVE 'RAQW001'             TO L127-AQPROGRA                  03033099
030340                                                                  03034099
030350     EXEC CICS LINK PROGRAM  ('RAQW127') COMMAREA (AREA-CAQL127)  03035099
030360          RESP (COD-RESP)                                         03036099
030370     END-EXEC                                                     03037099
030380                                                                  03038099
030390     IF COD-RESP NOT = DFHRESP (NORMAL)                           03039099
030400        PERFORM 033-INFORMAR-DATOS-ABEND                          03040099
030410     END-IF                                                       03041099
030420                                                                  03042099
030430     IF L127-AQCDTORN NOT = SPACES                                03043099
030440        MOVE 'JGTB143'      TO L100-AQ1ABNCD                      03044099
030450        MOVE 'RAQW127'      TO L045-AQTXMENS (1)                  03045099
030460        MOVE L127-AQCDTORN  TO L045-AQTXMENS (2)                  03046099
030470        SET SW-ABEND-ARQUITECTURAL TO TRUE                        03047099
030480        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    03048099
030490        PERFORM 099-ABEND-PROC                                    03049099
030500     END-IF                                                       03050099
030510                                                                  03051099
030520     SET  L310-CAQF409P       TO ADDRESS OF F409-AREA             03052099
030530     MOVE L127-AQREG127       TO F409-AREA                        03053099
030540*                                                                 03054099
030550* 120302 JVB FIN                                                  03055099
030560                                                                  03056099
030570*--> Obtener area de memoria para los datos adicionales del Log.  03057099
030580*--> Si el area no se obtiene correctamente, los punteros quedaran03058099
030590*--> inicializados a 0, indicando asi que no podran ser utilizados03059099
030600*                                                                 03060099
030610     EXEC CICS GETMAIN SET (ADDRESS OF L155-CAQL155)              03061099
030620          INITIMG (C-SPACES)                                      03062099
030630          FLENGTH (LENGTH OF L155-CAQL155) RESP (COD-RESP)        03063099
030640          NOSUSPEND                                               03064099
030650     END-EXEC                                                     03065099
030660     IF COD-RESP = DFHRESP (NORMAL)                               03066099
030670        INITIALIZE L155-CAQL155                                   03067099
030680        SET  W-PUNTER-POINTER TO ADDRESS OF L155-CAQL155          03068099
030690        MOVE W-PUNTER-COMP     TO W-PTR-CAQL155                   03069099
030700     ELSE                                                         03070099
030710        MOVE 0 TO W-PTR-CAQL155                                   03071099
030720     END-IF                                                       03072099
030730*                                                                 03073099
030740     SET L100-TIPO-SRC-ONLINE TO TRUE                             03074099
030750     MOVE W-PTR-CAQL155       TO L100-AQPTLOG                     03075099
030760     MOVE C-S                 TO L100-AQ1PREFJ                    03076099
030770     MOVE SPACES              TO W-NUM-ABEND                      03077099
030780     MOVE EIBTRNID            TO L100-AQ1TRANT                    03078099
030790     MOVE EIBTRNID            TO W-AQ1TRANT                       03079099
030800     MOVE EIBTRMID            TO W-EIBTRMID                       03080099
030810     MOVE EIBTRNID            TO W-EIBTRNID                       03081099
030820*MLV-03-07-03 INICIO                                              03082099
030830*tracet->                       +                                 03083099
030840     IF WS-TRACE > '1'                                            03084099
030850        MOVE '002-INICIO-PROGRAMA (2)         ' TO WS-AQNBDTRA    03085099
030860        STRING                                                    03086099
030870          'TRACE: ' WS-TRACE '. '                                 03087099
030880          'W-AQ1TRANT: ' W-AQ1TRANT                               03088099
030890           DELIMITED BY SIZE   INTO WS-AQINFORM                   03089099
030900        END-STRING                                                03090099
030910        PERFORM 131-TRACE-TECNIC                                  03091099
030920     END-IF                                                       03092099
030930                                                                  03093099
030940*tracet<-                                                         03094099
030950*                                                                 03095099
030960*JO17072000-TCPIP                                                 03096099
030970*    IF  EIBTRNID  = 'TCPI' OR 'TSPI' OR 'AQTF'                   03097099
030980*        PERFORM  038-TRACTAR-TCPIP                               03098099
030990*    END-IF                                                       03099099
031000*                                                                 03100099
031010     IF L300-ENTORNO-ECDL OR                                      03101099
031020*P1000->                                                          03102099
031030*       (EIBTRNID  = 'TCPI' OR 'TSPI' OR 'AQTF')                  03103099
031040         EIBTRNID  = 'AQTF'                                       03104099
031050*P1000<-                                                          03105099
031060        PERFORM 038-TRACTAR-TCPIP                                 03106099
031070     END-IF                                                       03107099
031080*                                                                 03108099
031090*MLV-03-07-03 FINAL                                               03109099
031100*                                                                 03110099
031110     IF L310-CAQL082P > 0                                         03111099
031120        SET ADDRESS OF AREA-CAQL082 TO L310-CAQL082               03112099
031130     ELSE                                                         03113099
031140        PERFORM 035-ACCES-RAQW082                                 03114099
031150     END-IF                                                       03115099
031160                                                                  03116099
031170*                                                                 03117099
031180     MOVE L082-STCDPAIS TO L100-STCDPAIS                          03118099
031190     MOVE L082-AQCDCICS TO L100-AQSYSID                           03119099
031200     MOVE L082-AQIDCICS TO L100-AQIDCICS                          03120099
031210     MOVE L082-AQCICTOR TO L100-AQCICTOR                          03121099
031220     MOVE L082-AQNUMEMO TO L100-AQNUMEMO                          03122099
031230*                                                                 03123099
031240*P1008->                                                          03124099
031250*    IF W-TERM-TCPIP = 'NNNN'                                     03125099
031260*       EXEC CICS ASSIGN USERID (W-USERID) END-EXEC               03126099
031270*    ELSE                                                         03127099
031280*       EXEC CICS ASSIGN USERID (W-USERID) END-EXEC               03128099
031290*    END-IF                                                       03129099
031300*                                                                 03130099
031310     EXEC CICS ASSIGN USERID (W-USERID) END-EXEC                  03131099
031320*P1008<-                                                          03132099
031330*                                                                 03133099
031340     IF L100-AQPTLOG > 0                                          03134099
031350        MOVE '*CICS: '     TO L155-AQERDET3 (1:7)                 03135099
031360        MOVE L082-AQCDCICS TO L155-AQERDET3 (8:4)                 03136099
031370     END-IF                                                       03137099
031380     PERFORM 036-SI-ES-PF15                                       03138099
031390                                                                  03139099
031400*--> Obtener area de memoria para los atributos del canal         03140099
031410*                                                                 03141099
031420*--> No se utiliza la opcion RESP para que en caso de error       03142099
031430*--> termine la transaccion con un ABEND de CICS                  03143099
031440*                                                                 03144099
031450     EXEC CICS GETMAIN SET (L100-AQPTCANL)                        03145099
031460          INITIMG (C-SPACES)                                      03146099
031470          FLENGTH (LENGTH OF L121-CAQL121)                        03147099
031480          NOSUSPEND                                               03148099
031490     END-EXEC                                                     03149099
031500     MOVE L100-AQPTCANL          TO W-PUNTER-COMP                 03150099
031510     MOVE L100-AQPTCANL          TO L310-CAQL121P                 03151099
031520     SET ADDRESS OF AREA-CAQL121 TO W-PUNTER-POINTER              03152099
031530     INITIALIZE L121-CAQL121                                      03153099
031540     MOVE 0  TO L100-AQPTUSUA.                                    03154099
031550*                                                                 03155099
031560*--> obtenim dades del pais                                       03156099
031570*                                                                 03157099
031580     PERFORM 039-LINK-DADES-PAIS.                                 03158099
031590*                                                                 03159099
031600*----------------------------------------------------------------*03160099
031610 003-OBTENER-DATOS-TERMINAL.                                      03161099
031620*---------------------------                                      03162099
031630*tracet->                       +                                 03163099
031640     IF WS-TRACE > '1'                                            03164099
031650        MOVE '003-OBTENER-DATOS-TERMINAL.     ' TO WS-AQNBDTRA    03165099
031660        PERFORM 131-TRACE-TECNIC                                  03166099
031670     END-IF                                                       03167099
031680*tracet<-                                                         03168099
031690*MLV-04-09-03 INICIO                                              03169099
031700*    INITIALIZE F060-CAQF060                                      03170099
031710* INI-JLM-01/02/02                                                03171099
031720*    IF EIBTRNID EQUAL 'AQTF'                                     03172099
031730*       MOVE 'AQTF'     TO W-EIBTRMID                             03173099
031740*    END-IF                                                       03174099
031750* FIN-JLM-01/02/02                                                03175099
031760*mlv-08-07-03 INICIO                                              03176099
031770*    IF L300-ENTORNO-ECDL                                         03177099
031780*       MOVE 'ECDL'     TO W-EIBTRMID                             03178099
031790*    END-IF                                                       03179099
031800*MLV-08-07-03 FINAL                                               03180099
031810*MLV-04-09-03 FINAL                                               03181099
031820     MOVE W-EIBTRMID TO F060-AQCDTRFI                             03182099
031830     EXEC CICS READ DATASET ('FAQ063') RIDFLD (F060-AQCDTRFI)     03183099
031840          INTO (F060-CAQF060) RESP (COD-RESP)                     03184099
031850     END-EXEC                                                     03185099
031860     IF COD-RESP NOT = DFHRESP (NORMAL)                           03186099
031870        EVALUATE COD-RESP                                         03187099
031880            WHEN DFHRESP (NOTFND)                                 03188099
031890                 IF L100-AQPTLOG > 0                              03189099
031900                    MOVE 'VSAM    '    TO L155-AQPHTYPE           03190099
031910                    MOVE 'FAQ063  '    TO L155-AQNAMRSO           03191099
031920                    MOVE 'READ    '    TO L155-AQCDIORQ           03192099
031930                    MOVE 'KEY:    '    TO L155-AQOPENAM(1:8)      03193099
031940                    MOVE F060-AQCDTRFI TO L155-AQOPENAM(9:4)      03194099
031950                 END-IF                                           03195099
031960                 MOVE C-TERM-NO-DEFINIDO TO L100-AQ1ABNCD         03196099
031970            WHEN OTHER                                            03197099
031980                 MOVE C-ABEND-CICS TO L100-AQ1ABNCD               03198099
031990                 MOVE EIBFN        TO L100-AQ1EIBFN               03199099
032000                 MOVE EIBRCODE     TO L100-AQ1EIBRC               03200099
032010                 MOVE EIBRSRCE     TO L100-AQ1EIBRS               03201099
032020         END-EVALUATE                                             03202099
032030*MLV-03-09-03 INICIO                                              03203099
032040         IF L100-ENTORNO-ECDL                                     03204099
032050             SET F060-TERM-FINANCIERO TO TRUE                     03205099
032060         ELSE                                                     03206099
032070             EXEC CICS INQUIRE TERMINAL (EIBTRMID)                03207099
032080                  DEVICE (W-TIPO-DEVICE)                          03208099
032090             END-EXEC                                             03209099
032100             IF W-TIPO-DEVICE = C-TERM-FINANCIERO                 03210099
032110                SET F060-TERM-FINANCIERO TO TRUE                  03211099
032120             ELSE                                                 03212099
032130                SET F060-TERM-3270 TO TRUE                        03213099
032140            END-IF                                                03214099
032150         END-IF                                                   03215099
032160*MLV-03-09-03 FINAL                                               03216099
032170         SET SW-ABEND-ARQUITECTURAL TO TRUE                       03217099
032180         PERFORM 099-ABEND-PROC                                   03218099
032190     END-IF                                                       03219099
032200*                                                                 03220099
032210     IF F060-TERM-INACTIVO                                        03221099
032220        MOVE C-TERM-INACTIVO TO L100-AQ1ABNCD                     03222099
032230        MOVE F060-AQCDTRFI   TO L045-AQTXMENS (1)                 03223099
032240        MOVE F060-AQNUENTI   TO L045-AQTXMENS (2)                 03224099
032250        MOVE F060-STOFICIN   TO L045-AQTXMENS (3)                 03225099
032260        SET SW-ABEND-ARQUITECTURAL TO TRUE                        03226099
032270        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    03227099
032280        PERFORM 099-ABEND-PROC                                    03228099
032290     END-IF                                                       03229099
032300*                                                                 03230099
032310     IF NOT F060-TERM-FINANCIERO AND NOT F060-TERM-3270           03231099
032320        MOVE C-ABEND-TERM-NOK TO L100-AQ1ABNCD                    03232099
032330        SET SW-ABEND-ARQUITECTURAL TO TRUE                        03233099
032340        PERFORM 099-ABEND-PROC                                    03234099
032350     END-IF.                                                      03235099
032360                                                                  03236099
032370*tracet->                                                         03237099
032380     IF WS-TRACE = SPACES                                         03238099
032390        IF F060-AQ9IMP1(1:3)= '@DX'                               03239099
032400           MOVE F060-AQ9IMP1(4:1) TO WS-TRACE                     03240099
032410           MOVE 'RAQW001-Entra003' TO WS-AQNBDTRA                 03241099
032420           PERFORM 131-TRACE-TECNIC                               03242099
032430        END-IF                                                    03243099
032440     END-IF                                                       03244099
032450     .                                                            03245099
032460*tracet<-                                                         03246099
032470*                                                                 03247099
032480*----------------------------------------------------------------*03248099
032490*    -  TRACTAR EL RECANVI DE LA TRANSACIO, QUAN NO HI HA HAGUT  *03249099
032500*       START TRANSID DE LA TRANSACCIO RECANVIADA                *03250099
032510*----------------------------------------------------------------*03251099
032520 004-INICI-RECANVI.                                               03252099
032530*------------------                                               03253099
032540*tracet->                       +                                 03254099
032550     IF WS-TRACE > '1'                                            03255099
032560        MOVE '004-INICI-RECANVI.              ' TO WS-AQNBDTRA    03256099
032570        PERFORM 131-TRACE-TECNIC                                  03257099
032580     END-IF                                                       03258099
032590*tracet<-                                                         03259099
032600     INITIALIZE L045-CAQL045                                      03260099
032610     INITIALIZE L145-CAQL145                                      03261099
032620                                                                  03262099
032630     MOVE L300-AQPTARE3               TO W-PUNTER-COMP            03263099
032640     SET ADDRESS OF L100-AREA-TOTAL-W TO W-PUNTER-POINTER         03264099
032650                                                                  03265099
032660     PERFORM 034-DIRECCIONAR-AREA-CAQL310                         03266099
032670                                                                  03267099
032680     SET ADDRESS OF F060-CAQF060      TO L310-CAQF060             03268099
032690     SET ADDRESS OF F409-AREA         TO L310-CAQF409P            03269099
032700                                                                  03270099
032710     MOVE L100-AQPTLOG                TO W-PTR-CAQL155            03271099
032720     MOVE L100-AQPTLOG                TO  W-PUNTER-COMP           03272099
032730     SET ADDRESS OF L155-CAQL155      TO W-PUNTER-POINTER         03273099
032740                                                                  03274099
032750     MOVE SPACES              TO W-NUM-ABEND                      03275099
032760     MOVE EIBTRMID            TO W-EIBTRMID                       03276099
032770     MOVE L300-AQTRANRE       TO L100-AQ1TRANT                    03277099
032780     MOVE L300-AQTRANRE       TO W-EIBTRNID                       03278099
032790     MOVE L300-AQTRANRE       TO EIBTRNID                         03279099
032800     MOVE LOW-VALUES          TO EIBAID                           03280099
032810     MOVE L300-AQTRANRE       TO W-AQ1TRANT                       03281099
032820*                                                                 03282099
032830     IF L310-CAQL082P > 0                                         03283099
032840        SET ADDRESS OF AREA-CAQL082 TO L310-CAQL082               03284099
032850     ELSE                                                         03285099
032860        PERFORM 035-ACCES-RAQW082                                 03286099
032870     END-IF                                                       03287099
032880                                                                  03288099
032890     EXEC CICS ASSIGN USERID (W-USERID) END-EXEC                  03289099
032900*                                                                 03290099
032910     IF L100-AQPTLOG > 0                                          03291099
032920        MOVE '*CICS: '     TO L155-AQERDET3 (1:7)                 03292099
032930        MOVE L082-AQCDCICS TO L155-AQERDET3 (8:4)                 03293099
032940     END-IF                                                       03294099
032950                                                                  03295099
032960     PERFORM 036-SI-ES-PF15                                       03296099
032970                                                                  03297099
032980     MOVE L100-AQPTCANL          TO W-PUNTER-COMP                 03298099
032990     SET ADDRESS OF AREA-CAQL121 TO W-PUNTER-POINTER              03299099
033000     SET ADDRESS OF AREA-CAQLD01 TO L310-CAQLD01                  03300099
033010     INITIALIZE AREA-CAQLD01.                                     03301099
033020                                                                  03302099
033030*----------------------------------------------------------------*03303099
033040*    OBTENER LOS ATRIBUTOS DEL CANAL + TIPO TERMINAL             *03304099
033050*----------------------------------------------------------------*03305099
033060 005-OBTENER-ATRIBUTOS-CANAL.                                     03306099
033070*----------------------------                                     03307099
033080*tracet->                       +                                 03308099
033090     IF WS-TRACE > '1'                                            03309099
033100        MOVE '005-OBTENER-ATRIBUTOS-CANAL.    ' TO WS-AQNBDTRA    03310099
033110        PERFORM 131-TRACE-TECNIC                                  03311099
033120     END-IF                                                       03312099
033130*tracet<-                                                         03313099
033140     MOVE '10'          TO L120-AQCDOPCI                          03314099
033150     MOVE L100-AQPTCANL TO L120-AQPTCANL                          03315099
033160     MOVE L100-AQPTCANL TO L310-CAQL120P                          03316099
033170     MOVE F060-AQCDCANL TO L120-AQCDCANA                          03317099
033180     EVALUATE TRUE                                                03318099
033190     WHEN F060-TERM-3270                                          03319099
033200          SET L120-CANAL-TERM-3270 TO TRUE                        03320099
033210     WHEN F060-TERM-FINANCIERO                                    03321099
033220          SET L120-CANAL-TERM-TF   TO TRUE                        03322099
033230     END-EVALUATE                                                 03323099
033240     EXEC CICS LINK PROGRAM('RAQW120') COMMAREA (L120-CAQL120)    03324099
033250          LENGTH (LENGTH OF L120-CAQL120) RESP (COD-RESP)         03325099
033260     END-EXEC                                                     03326099
033270     IF COD-RESP NOT = DFHRESP (NORMAL)                           03327099
033280         PERFORM 033-INFORMAR-DATOS-ABEND                         03328099
033290     END-IF                                                       03329099
033300     IF L120-AQRETORN NOT = SPACES                                03330099
033310        MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                      03331099
033320        MOVE 'RAQW120'      TO L045-AQTXMENS (1)                  03332099
033330        MOVE L120-AQRETORN  TO L045-AQTXMENS (2)                  03333099
033340        SET SW-ABEND-ARQUITECTURAL TO TRUE                        03334099
033350        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    03335099
033360        PERFORM 099-ABEND-PROC                                    03336099
033370     END-IF                                                       03337099
033380*P1000->                                                          03338099
033390*M050->                                                           03339099
033400*    IF W-TERM-TCPIP = 'TCPI' AND                                 03340099
033410*       L121-AQCDCANA = 1 AND L121-AQCDCPRO = '04'                03341099
033420*       SET L121-PAGINA-NO TO TRUE                                03342099
033430*    END-IF                                                       03343099
033440*<-M050                                                           03344099
033450*P1000<-                                                          03345099
033460     .                                                            03346099
033470*                                                                 03347099
033480*----------------------------------------------------------------*03348099
033490*    OBTENER DATOS DE USUARIO E INFORMAR EN AREA RESERVADA,      *03349099
033500*    ASI COMO EL PUNTERO A LA MISMA EN EL SCR                    *03350099
033510*----------------------------------------------------------------*03351099
033520 006-OBTENER-DATOS-USUARIO.                                       03352099
033530*--------------------------                                       03353099
033540*tracet->                       +                                 03354099
033550     IF WS-TRACE > '1'                                            03355099
033560        MOVE '006-OBTENER-DATOS-USUARIO.      ' TO WS-AQNBDTRA    03356099
033570********PERFORM 131-TRACE-TECNIC                                  03357099
033580     END-IF                                                       03358099
033590*tracet<-                                                         03359099
033600*MOD01-I                                                          03360099
033610*    INITIALIZE L075-CAQL075                                      03361099
033620*    SET L075-LECTURA   TO TRUE                                   03362099
033630*    MOVE W-USERID      TO L075-AQCDUSEP                          03363099
033640*    EXEC CICS LINK PROGRAM ('RAQW075') RESP (COD-RESP)           03364099
033650*         COMMAREA (L075-CAQL075)                                 03365099
033660*         LENGTH (LENGTH OF L075-CAQL075)                         03366099
033670*    END-EXEC                                                     03367099
033680*    IF COD-RESP NOT = DFHRESP (NORMAL)                           03368099
033690*       PERFORM 033-INFORMAR-DATOS-ABEND                          03369099
033700*    END-IF                                                       03370099
033710*MOD01-F                                                          03371099
033720*                                                                 03372099
033730*--> Obtener area de memoria para los datos de usuario            03373099
033740*                                                                 03374099
033750*--> No se utiliza la opcion RESP para que en caso de error       03375099
033760*--> termine la transaccion con un ABEND de CICS                  03376099
033770*                                                                 03377099
033780     EXEC CICS GETMAIN SET (L100-AQPTUSUA)                        03378099
033790          INITIMG (C-SPACES)                                      03379099
033800          FLENGTH (LENGTH OF L078-CAQL078)                        03380099
033810          NOSUSPEND                                               03381099
033820     END-EXEC                                                     03382099
033830     MOVE L100-AQPTUSUA          TO W-PUNTER-COMP                 03383099
033840     MOVE L100-AQPTUSUA          TO l310-CAQL078P                 03384099
033850     SET ADDRESS OF CAQL078-AREA TO W-PUNTER-POINTER              03385099
033860*                                                                 03386099
033870     INITIALIZE L078-CAQL078                                      03387099
033880     MOVE L100-AQIDIOMA  TO  L078-AQIDIOMA                        03388099
033890     MOVE L100-AQIDIOMA  TO  L078-IDIOUSER                        03389099
033900*MOD01-I                                                          03390099
033910*    EVALUATE TRUE                                                03391099
033920*    WHEN L075-OPERACIO-OK                                        03392099
033930***OK                                                             03393099
033940*         MOVE L075-AQCDUSIN TO L078-AQCDUSIN                     03394099
033950*         MOVE L075-AQCDUSEX TO L078-AQCDUSEX                     03395099
033960*         IF L075-AQCDIDIO NOT NUMERIC                            03396099
033970***          MOVE L100-AQIDIOMA TO L078-AQCDIDIO                  03397099
033980*            MOVE SPACES        TO L078-AQCDIDIO                  03398099
033990*            MOVE L075-AQCDIDIO TO L078-IDIOUSER                  03399099
034000*         ELSE                                                    03400099
034010***          MOVE L075-AQCDIDIO TO L078-AQCDIDIO                  03401099
034020*            MOVE SPACES        TO L078-AQCDIDIO                  03402099
034030*         END-IF                                                  03403099
034040*    WHEN L075-REGIS-NOTFOUND                                     03404099
034050***No existe el usuario en el fichero FAQ075                      03405099
034060*         MOVE SPACES          TO L078-AQCDUSIN                   03406099
034070*                                 L078-AQCDUSEX                   03407099
034080***       MOVE L100-AQIDIOMA   TO L078-AQCDIDIO                   03408099
034090*         MOVE SPACES          TO L078-AQCDIDIO                   03409099
034100*    WHEN OTHER                                                   03410099
034110***Otros errores                                                  03411099
034120*         MOVE SPACES          TO L078-AQCDUSIN                   03412099
034130*                                 L078-AQCDUSEX                   03413099
034140*         MOVE L100-AQIDIOMA   TO L078-AQCDIDIO                   03414099
034150*         MOVE C-ERROR-MODULO  TO L100-AQ1ABNCD                   03415099
034160*         MOVE 'RAQW075'       TO L045-AQTXMENS (1)               03416099
034170*         MOVE L075-AQCDTORN   TO L045-AQTXMENS (2)               03417099
034180*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      03418099
034190*         PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  03419099
034200*         PERFORM 099-ABEND-PROC                                  03420099
034210*    END-EVALUATE                                                 03421099
034220                                                                  03422099
034230     MOVE W-USERID       TO  L078-AQCDUSIN                        03423099
034240     MOVE W-USERID       TO  L078-AQCDUSEX                        03424099
034250     MOVE SPACES         TO  L078-AQCDIDIO                        03425099
034260*MOD01-F                                                          03426099
034270                                                                  03427099
034280*M067-> poso per defecte idioma d'instal·lacio...                 03428099
034290     MOVE L100-AQIDIOMA TO L100-AQCDIDIU, W-AQCDIDIU              03429099
034300*M067<-                                                           03430099
034310*A338->                                                           03431099
034320     IF L300-ENTORNO-ECDL                                         03432099
034330        IF L000-AQCDIDIU IS NUMERIC                               03433099
034340           MOVE L000-AQCDIDIU TO L078-IDIOUSER                    03434099
034350*M067->                                                           03435099
034360                                 L100-AQCDIDIU, W-AQCDIDIU        03436099
034370*M067<-                                                           03437099
034380        END-IF                                                    03438099
034390     END-IF                                                       03439099
034400*A338<-                                                           03440099
034410*tracet->                                                         03441099
034420     IF WS-TRACE > '1'                                            03442099
034430        STRING 'IDIOMA UTILIZADO: ', L100-AQCDIDIU                03443099
034440           DELIMITED BY SIZE INTO WS-AQINFORM                     03444099
034450        END-STRING                                                03445099
034460        ADD 25 TO WS-LDADES                                       03446099
034470        PERFORM 131-TRACE-TECNIC                                  03447099
034480     END-IF                                                       03448099
034490*tracet<-                                                         03449099
034500     .                                                            03450099
034510*                                                                 03451099
034520*----------------------------------------------------------------*03452099
034530*    DADES DEL USUARI QUAN NO S'ACCEDEIX A L'ARXIU FAQ075        *03453099
034540*    (PROVISIONALMENT QUAN PAIS ES ESPANYA)                      *03454099
034550*----------------------------------------------------------------*03455099
034560 007-DADES-DEFECTE-USUARI.                                        03456099
034570*-------------------------                                        03457099
034580*--> Obtener area de memoria para los datos de usuario            03458099
034590*--> No se utiliza la opcion RESP para que en caso de error       03459099
034600*--> termine la transaccion con un ABEND de CICS                  03460099
034610*                                                                 03461099
034620*tracet->                       +                                 03462099
034630     IF WS-TRACE > '1'                                            03463099
034640        MOVE '007-DADES-DEFECTE-USUARI.       ' TO WS-AQNBDTRA    03464099
034650        PERFORM 131-TRACE-TECNIC                                  03465099
034660     END-IF                                                       03466099
034670*tracet<-                                                         03467099
034680     EXEC CICS GETMAIN SET (L100-AQPTUSUA)                        03468099
034690          INITIMG (C-SPACES)                                      03469099
034700          FLENGTH (LENGTH OF L078-CAQL078)                        03470099
034710          NOSUSPEND                                               03471099
034720     END-EXEC                                                     03472099
034730     MOVE L100-AQPTUSUA          TO W-PUNTER-COMP                 03473099
034740     SET ADDRESS OF CAQL078-AREA TO W-PUNTER-POINTER              03474099
034750*                                                                 03475099
034760     INITIALIZE L078-CAQL078                                      03476099
034770     MOVE L100-AQIDIOMA  TO  L078-AQIDIOMA                        03477099
034780     MOVE SPACES         TO  L078-AQCDUSIN                        03478099
034790     MOVE SPACES         TO  L078-AQCDUSEX.                       03479099
034800*                                                                 03480099
034810*----------------------------------------------------------------*03481099
034820*   -  DIRECCIONAR AREA DE DESCRIPCION DE APLICACIONES           *03482099
034830*----------------------------------------------------------------*03483099
034840 008-DIRECCIONAR-AREA-CVT.                                        03484099
034850*-------------------------                                        03485099
034860*tracet->                       +                                 03486099
034870     IF WS-TRACE > '1'                                            03487099
034880        MOVE '008-DIRECCIONAR-AREA-CVT.       ' TO WS-AQNBDTRA    03488099
034890        PERFORM 131-TRACE-TECNIC                                  03489099
034900     END-IF                                                       03490099
034910*tracet<-                                                         03491099
034920     INITIALIZE L006-CAQL006                                      03492099
034930     SET L006-ESPERA TO TRUE                                      03493099
034940     MOVE L082-AQNUMEMO  TO L006-AQNUMEMO                         03494099
034950                                                                  03495099
034960     EXEC CICS LINK PROGRAM ('RAQW006') COMMAREA (L006-CAQL006)   03496099
034970          RESP (COD-RESP)                                         03497099
034980     END-EXEC                                                     03498099
034990                                                                  03499099
035000     IF COD-RESP NOT = DFHRESP (NORMAL)                           03500099
035010        PERFORM 033-INFORMAR-DATOS-ABEND                          03501099
035020     END-IF                                                       03502099
035030     EVALUATE L006-AQRETORN                                       03503099
035040        WHEN ' '                                                  03504099
035050             CONTINUE                                             03505099
035060        WHEN OTHER                                                03506099
035070             IF L100-AQPTLOG > 0                                  03507099
035080                MOVE 'MODULE  '     TO L155-AQPHTYPE              03508099
035090                MOVE 'RAQW006 '     TO L155-AQPRONAM              03509099
035100                MOVE 'QUERY   '     TO L155-AQCDIORQ              03510099
035110                MOVE 'RETORN CODE:' TO L155-AQOPENAM(1:13)        03511099
035120                MOVE L006-AQRETORN  TO L155-AQOPENAM(14:1)        03512099
035130             END-IF                                               03513099
035140     END-EVALUATE                                                 03514099
035150     EVALUATE L006-AQRETORN                                       03515099
035160        WHEN ' '                                                  03516099
035170             MOVE L006-AQPTAPLI TO L100-AQPTACVT                  03517099
035180             MOVE L006-AQPTAPLI TO L310-AQPTACVT                  03518099
035190             MOVE L006-AQPTAPLI TO W-PUNTER-COMP                  03519099
035200             SET ADDRESS OF L002-CAQL002 TO W-PUNTER-POINTER      03520099
035210        WHEN 'I'                                                  03521099
035220             MOVE C-AREA-INACTIVA TO L100-AQ1ABNCD                03522099
035230             SET SW-ABEND-ARQUITECTURAL TO TRUE                   03523099
035240             PERFORM 099-ABEND-PROC                               03524099
035250        WHEN 'B'                                                  03525099
035260             MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                 03526099
035270             MOVE 'RAQW006'      TO L045-AQTXMENS (1)             03527099
035280             MOVE L006-AQRETORN  TO L045-AQTXMENS (2)             03528099
035290             SET SW-ABEND-ARQUITECTURAL TO TRUE                   03529099
035300             PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               03530099
035310             PERFORM 099-ABEND-PROC                               03531099
035320        WHEN 'X'                                                  03532099
035330             MOVE L006-AQ1EIBFN TO L100-AQ1EIBFN                  03533099
035340             MOVE L006-AQ1EIBRC TO L100-AQ1EIBRC                  03534099
035350             MOVE L006-AQ1EIBRS TO L100-AQ1EIBRS                  03535099
035360             MOVE C-ABEND-CICS  TO L100-AQ1ABNCD                  03536099
035370             SET SW-ABEND-ARQUITECTURAL TO TRUE                   03537099
035380             PERFORM 099-ABEND-PROC                               03538099
035390     END-EVALUATE.                                                03539099
035400*                                                                 03540099
035410*----------------------------------------------------------------*03541099
035420 009-MENSAJES.                                                    03542099
035430*-------------                                                    03543099
035440*tracet->                       +                                 03544099
035450     IF WS-TRACE > '1'                                            03545099
035460        MOVE '009-MENSAJES.                   ' TO WS-AQNBDTRA    03546099
035470        PERFORM 131-TRACE-TECNIC                                  03547099
035480     END-IF                                                       03548099
035490*tracet<-                                                         03549099
035500*                                                                 03550099
035510     MOVE 'MG'            TO L310-AQCODOPE                        03551099
035520     INITIALIZE W001-CAQW001                                      03552099
035530                                                                  03553099
035540     PERFORM 041-LINK-RAQW008                                     03554099
035550                                                                  03555099
035560     IF L310-AQCODRET NOT = SPACES                                03556099
035570        SET SW-ABEND-ARQUITECTURAL TO TRUE                        03557099
035580        PERFORM 099-ABEND-PROC                                    03558099
035590     END-IF.                                                      03559099
035600*                                                                 03560099
035610*----------------------------------------------------------------*03561099
035620*    -  RECEPCIO DADES DES D'ENTORN TCPIP                        *03562099
035630*----------------------------------------------------------------*03563099
035640 010-MISSATGE-TCPIP.                                              03564099
035650*-------------------                                              03565099
035660*tracet->                       +                                 03566099
035670     IF WS-TRACE > '1'                                            03567099
035680        MOVE '010-MISSATGE-TCPIP.             ' TO WS-AQNBDTRA    03568099
035690        PERFORM 131-TRACE-TECNIC                                  03569099
035700     END-IF                                                       03570099
035710*tracet<-                                                         03571099
035720     MOVE 'RV'                TO L310-AQCODOPE                    03572099
035730     INITIALIZE W001-CAQW001                                      03573099
035740     PERFORM 040-LINK-RAQW005                                     03574099
035750     MOVE W001-AQPUNTER       TO W-PUNTER-COMP                    03575099
035760     MOVE W001-LONGRECE       TO W-LONG-RECEIVE                   03576099
035770     SET ADDRESS OF T040-AREA TO W-PUNTER-POINTER                 03577099
035780     MOVE W001-AQTERMI        TO W-EIBTRMID.                      03578099
035790*                                                                 03579099
035800*----------------------------------------------------------------*03580099
035810*    -  RECEPCION DE LOS DATOS ASOCIADOS A LA TRANSACCION        *03581099
035820*    -  SI LA LONGITUD DEL MENSAJE ES 0, SE TRATA DE UN RECAMBIO *03582099
035830*       DE TRANSACCION SOLICITADO POR LA APLICACION              *03583099
035840*----------------------------------------------------------------*03584099
035850 011-LEER-MENSAJE-ENTRADA.                                        03585099
035860*-------------------------                                        03586099
035870*tracet->                       +                                 03587099
035880     IF WS-TRACE > '1'                                            03588099
035890        MOVE '011-LEER-MENSAJE-ENTRADA.       ' TO WS-AQNBDTRA    03589099
035900        PERFORM 131-TRACE-TECNIC                                  03590099
035910     END-IF                                                       03591099
035920*tracet<-                                                         03592099
035930     MOVE 'RV'                TO L310-AQCODOPE                    03593099
035940     INITIALIZE W001-CAQW001                                      03594099
035950     PERFORM 040-LINK-RAQW005                                     03595099
035960     MOVE W001-AQPUNTER       TO W-PUNTER-COMP                    03596099
035970     MOVE W001-LONGRECE       TO W-LONG-RECEIVE                   03597099
035980     IF  W001-LONGRECE > 0                                        03598099
035990         SET ADDRESS OF T040-AREA TO W-PUNTER-POINTER             03599099
036000     END-IF                                                       03600099
036010     MOVE W001-AQTERMI        TO W-EIBTRMID.                      03601099
036020*                                                                 03602099
036030*----------------------------------------------------------------*03603099
036040*    TRATAMIENTO ESPECIAL DE LAS TRANSACCIONES GT03, AQLG Y AQVC *03604099
036050*----------------------------------------------------------------*03605099
036060 012-TRANS-ESPECIAL.                                              03606099
036070*-------------------                                              03607099
036080*tracet->                       +                                 03608099
036090     IF WS-TRACE > '1'                                            03609099
036100        MOVE '012-TRANS-ESPECIAL.             ' TO WS-AQNBDTRA    03610099
036110        PERFORM 131-TRACE-TECNIC                                  03611099
036120     END-IF                                                       03612099
036130*tracet<-                                                         03613099
036140*--> MLV231100 INICIO                                             03614099
036150*                                                                 03615099
036160     IF SW-LOGON-GT03 OR SW-LOGON-AQLG                            03616099
036170*SIMU-I                                                           03617099
036180        OR L100-AQFILL16 = 'SIMUFUSI'                             03618099
036190*SIMU-E                                                           03619099
036200        MOVE F060-AQCDTERM TO L100-AQ1TERML                       03620099
036210        MOVE W-USERID      TO L100-AQ1USCIC                       03621099
036220*I013->                                                           03622099
036230*       MOVE EIBTRMID      TO L100-AQCDTRFI                       03623099
036240        IF L300-ENTORNO-ECDL                                      03624099
036250           MOVE F060-AQCDTRFI TO L100-AQCDTRFI                    03625099
036260        ELSE                                                      03626099
036270           MOVE EIBTRMID      TO L100-AQCDTRFI                    03627099
036280        END-IF                                                    03628099
036290*<-I013                                                           03629099
036300        PERFORM 042-INFORMAR-DATOS-TERMINAL                       03630099
036310        MOVE 'AQ'          TO L100-AQ1APLIC                       03631099
036320        PERFORM 043-DADES-CANAL                                   03632099
036330        IF L100-AQPTLOG > 0                                       03633099
036340           MOVE '*CICS: '     TO L155-AQERDET3 (1:7)              03634099
036350           MOVE L082-AQCDCICS TO L155-AQERDET3 (8:4)              03635099
036360        END-IF                                                    03636099
036370        PERFORM 044-FORMATEAR-FECHAS                              03637099
036380        SET  L100-VAL-IDIOMA-NO  TO TRUE                          03638099
036390        MOVE L082-STCDPAIS TO L100-STCDPAIS                       03639099
036400        MOVE L082-AQCDCICS TO L100-AQSYSID                        03640099
036410        MOVE L082-AQIDCICS TO L100-AQIDCICS                       03641099
036420        MOVE L082-AQCICTOR TO L100-AQCICTOR                       03642099
036430        MOVE L082-AQNUMEMO TO L100-AQNUMEMO                       03643099
036440*I003-1 INICIO                                                    03644099
036450*       MOVE 0             TO L100-AQNPAGEN                       03645099
036460*       MOVE 0             TO L100-AQNPAGUL                       03646099
036470        MOVE 1             TO L100-AQNPAGEN                       03647099
036480        MOVE 0             TO L100-AQNPAGUL                       03648099
036490*I003-1 FINAL                                                     03649099
036500        MOVE ' '           TO L100-AQECTANT                       03650099
036510        MOVE ' '           TO L100-AQFIPAGI                       03651099
036520*p101a->                                                          03652099
036530*       por defecto se activa sw Autorización a 'NO' en login     03653099
036540        SET L100-AUTH-SERV-NO       TO TRUE                       03654099
036550*p101a<-                                                          03655099
036560     END-IF                                                       03656099
036570*                                                                 03657099
036580*--> Campos necesarios para la llamada al modulo RAQW163          03658099
036590*                                                                 03659099
036600     MOVE L100-AQ1DCASO TO W-CASO-ENTRADA                         03660099
036610     MOVE 'RAQW001'     TO W-PROGRAMA                             03661099
036620     MOVE SPACES        TO W-PANTALLA                             03662099
036630     MOVE 'AQ'          TO W-APLICACION                           03663099
036640*                                                                 03664099
036650     EVALUATE TRUE                                                03665099
036660      WHEN SW-LOGON-GT03                                          03666099
036670           EXEC CICS LINK PROGRAM ('RAQW361') RESP (COD-RESP)     03667099
036680                COMMAREA (L100-CAQF100)                           03668099
036690           END-EXEC                                               03669099
036700*                                                                 03670099
036710*--> Si es TF se informa la entidad/oficina operante en el SCR,   03671099
036720*--> ya que antes de la llamada al modulo se informo la de        03672099
036730*--> instalacion para efectuar una validacion                     03673099
036740*                                                                 03674099
036750           IF F060-TERM-FINANCIERO                                03675099
036760              MOVE F060-AQ9ENTOP TO L100-AQ1BANOP                 03676099
036770              MOVE F060-AQ9OFICO TO L100-AQ1OFIOP                 03677099
036780           END-IF                                                 03678099
036790           IF COD-RESP NOT = DFHRESP (NORMAL)                     03679099
036800              PERFORM 033-INFORMAR-DATOS-ABEND                    03680099
036810           END-IF                                                 03681099
036820           IF L100-AQ1ABNCD NOT = SPACES                          03682099
036830              SET SW-ABEND-ARQUITECTURAL TO TRUE                  03683099
036840              PERFORM 099-ABEND-PROC                              03684099
036850           END-IF                                                 03685099
036860*                                                                 03686099
036870* 26.08.2004-jo  gravar diari per qulasevol tipus terminal        03687099
036880*                                                                 03688099
036890*          IF F060-TERM-FINANCIERO                                03689099
036900*             PERFORM 045-LLAMADA-RAQW163                         03690099
036910*          END-IF                                                 03691099
036920*                                                                 03692099
036930           PERFORM 045-LLAMADA-RAQW163                            03693099
036940*                                                                 03694099
036950      WHEN SW-LOGON-AQLG                                          03695099
036960*SIMU-I                                                           03696099
036970*         Para obtener sesión y vincularla al terminal que hemos  03697099
036980*         solicitado mediante el header ECDL_TERM                 03698099
036990      WHEN L100-AQFILL16 = 'SIMUFUSI'                             03699099
037000*SIMU-E                                                           03700099
037010           SET W-PUNTER-POINTER TO ADDRESS OF T040-AREA           03701099
037020           MOVE W-PUNTER-COMP    TO L100-AQ1FMSGP                 03702099
037030           MOVE W-LONG-RECEIVE   TO L100-AQ1MLONI                 03703099
037040           EXEC CICS LINK PROGRAM ('RAQW360') RESP (COD-RESP)     03704099
037050                COMMAREA (L100-CAQF100)                           03705099
037060           END-EXEC                                               03706099
037070           IF COD-RESP NOT = DFHRESP (NORMAL)                     03707099
037080              PERFORM 033-INFORMAR-DATOS-ABEND                    03708099
037090           END-IF                                                 03709099
037100           IF L100-AQ1ABNCD NOT = SPACES                          03710099
037110              SET SW-ABEND-ARQUITECTURAL TO TRUE                  03711099
037120              PERFORM 099-ABEND-PROC                              03712099
037130           END-IF                                                 03713099
037140           PERFORM 045-LLAMADA-RAQW163                            03714099
037150*                                                                 03715099
037160*--> MLV120700 Inicio                                             03716099
037170*                                                                 03717099
037180      WHEN SW-AQVC                                                03718099
037190*--> Si el entorno no es produccion llamar al trace               03719099
037200           IF L082-AQIDCICS NOT = 'E'                             03720099
037210              PERFORM 025-TRACE-RECEIVE                           03721099
037220           END-IF                                                 03722099
037230           EXEC CICS LINK PROGRAM ('RAQW185') RESP (COD-RESP)     03723099
037240                COMMAREA (L100-CAQF100)                           03724099
037250           END-EXEC                                               03725099
037260           IF COD-RESP NOT = DFHRESP (NORMAL)                     03726099
037270              PERFORM 033-INFORMAR-DATOS-ABEND                    03727099
037280           END-IF                                                 03728099
037290           IF L100-AQ1ABNCD NOT = SPACES                          03729099
037300              SET SW-ABEND-ARQUITECTURAL TO TRUE                  03730099
037310              PERFORM 099-ABEND-PROC                              03731099
037320           END-IF                                                 03732099
037330           PERFORM 045-LLAMADA-RAQW163                            03733099
037340*                                                                 03734099
037350*--> MLV120700 Final                                              03735099
037360     END-EVALUATE.                                                03736099
037370*                                                                 03737099
037380*----------------------------------------------------------------*03738099
037390*   LINK PROGRAMA RAQWN80 (PAGINACIO)                           .*03739099
037400*----------------------------------------------------------------*03740099
037410 013-ESBORRA-PAGINACIO.                                           03741099
037420*----------------------                                           03742099
037430*tracet->                       +                                 03743099
037440     IF WS-TRACE > '1'                                            03744099
037450        MOVE '013-ESBORRA-PAGINACIO.          ' TO WS-AQNBDTRA    03745099
037460        PERFORM 131-TRACE-TECNIC                                  03746099
037470     END-IF                                                       03747099
037480*tracet<-                                                         03748099
037490     INITIALIZE LN08-CAQLN08.                                     03749099
037500     MOVE 'EI'             TO LN08-AQFUNCIO                       03750099
037510                                                                  03751099
037520     IF L300-ENTORNO-ECDL                                         03752099
037530        MOVE L300-AQPTARE2    TO LN08-AQPTR000                    03753099
037540        MOVE L310-AQSCRARC    TO LN08-AQPTRSCR                    03754099
037550     ELSE                                                         03755099
037560        MOVE L300-AQPTARE3    TO LN08-AQPTRSCR                    03756099
037570     END-IF                                                       03757099
037580                                                                  03758099
037590     MOVE L300-AQPTARE1       TO LN08-AQPTR310                    03759099
037600*                                                                 03760099
037610*M057b->                                                          03761099
037620*    IF L121-PAGINA-SI  AND  F030-AQSWPAGI = '1'                  03762099
037630     IF L121-PAGINA-SI                                            03763099
037640     AND ((F030-AQSWPAGI = '1') OR                                03764099
037650          (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))         03765099
037660*M057b<-                                                          03766099
037670        EXEC CICS LINK PROGRAM ('RAQWN08')                        03767099
037680             RESP (COD-RESP)                                      03768099
037690             COMMAREA (LN08-CAQLN08)                              03769099
037700        END-EXEC                                                  03770099
037710                                                                  03771099
037720        IF COD-RESP NOT = DFHRESP (NORMAL)                        03772099
037730           PERFORM 033-INFORMAR-DATOS-ABEND                       03773099
037740        ELSE                                                      03774099
037750           IF LN08-AQRETCOD  = 'OK' OR 'NF' OR 'NP'               03775099
037760              CONTINUE                                            03776099
037770           ELSE                                                   03777099
037780              MOVE  'JSTB081'        TO  L100-AQ1ABNCD            03778099
037790              SET  SW-ABEND-APLICATIVO  TO TRUE                   03779099
037800              MOVE  LN08-AQRETCOD    TO  L045-AQTXMENS (3)        03780099
037810              MOVE  'PROCESO BORRADO PAGINACION'                  03781099
037820                                     TO  L045-AQTXMENS (1)        03782099
037830              MOVE  ',RETORNO ERRONEO DE RAQWN08 :'               03783099
037840                                     TO  L045-AQTXMENS (2)        03784099
037850              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              03785099
037860              PERFORM 099-ABEND-PROC                              03786099
037870           END-IF                                                 03787099
037880        END-IF                                                    03788099
037890     END-IF.                                                      03789099
037900*                                                                 03790099
037910******************************************************************03791099
037920*    Obtener el area de memoria para almacenar el vector de las  *03792099
037930*    teclas                                                       03793099
037940******************************************************************03794099
037950 014-OBTENER-AREA-TECLAS.                                         03795099
037960*------------------------                                         03796099
037970*tracet->                       +                                 03797099
037980     IF WS-TRACE > '1'                                            03798099
037990        MOVE '014-OBTENER-AREA-TECLAS.        ' TO WS-AQNBDTRA    03799099
038000        PERFORM 131-TRACE-TECNIC                                  03800099
038010     END-IF                                                       03801099
038020*tracet<-                                                         03802099
038030     MOVE LENGTH OF L017-CAQL017 TO LONGET                        03803099
038040     EXEC CICS GETMAIN SET (L310-CAQL017) FLENGTH (LONGET)        03804099
038050          INITIMG (C-SPACES) RESP (COD-RESP)                      03805099
038060          NOSUSPEND                                               03806099
038070     END-EXEC                                                     03807099
038080     IF COD-RESP NOT = DFHRESP (NORMAL)                           03808099
038090         PERFORM 033-INFORMAR-DATOS-ABEND                         03809099
038100     END-IF                                                       03810099
038110*    Direccionar el vector de teclas                              03811099
038120     SET ADDRESS OF L017-CAQL017 TO L310-CAQL017P                 03812099
038130     .                                                            03813099
038140*                                                                 03814099
038150*----------------------------------------------------------------*03815099
038160*    -  LECTURA DEL SCR ANTERIOR                                 *03816099
038170*    -  SI NO EXISTE UN SCR ES QUE NO SE HA ENTRADO AL SISTEMA   *03817099
038180*       POR LA TRANSACCION GT03 EN EL CASO DE 3270, O NO SE HA   *03818099
038190*       EFECTUADO LA LGON SI ES TERMINAL FINANCIERO.             *03819099
038200*----------------------------------------------------------------*03820099
038210 015-ACCESO-SCR.                                                  03821099
038220*---------------                                                  03822099
038230*tracet->                       +                                 03823099
038240     IF WS-TRACE > '1'                                            03824099
038250        MOVE '015-ACCESO-SCR.                 ' TO WS-AQNBDTRA    03825099
038260        PERFORM 131-TRACE-TECNIC                                  03826099
038270     END-IF                                                       03827099
038280*tracet<-                                                         03828099
038290*--> Guardar el puntero del area de atributos del canal ya que    03829099
038300*--> al realizar la lectura del SCR anterior se pierde            03830099
038310*--> Guardar también el puntero del area de datos de usuario      03831099
038320*                                                                 03832099
038330     MOVE L100-AQPTCANL TO W-POINTER                              03833099
038340     MOVE L100-AQPTUSUA TO W-POINTER-AREAUSU                      03834099
038350*                                                                 03835099
038360*MLV-03-07-03 INICIO                                              03836099
038370*                                                                 03837099
038380* Si el entorno es eCDL, el Conector-CDL ya ha accedido al fichero03838099
038390* por lo que se direccionan los datos                             03839099
038400*                                                                 03840099
038410*MACRO-I                                                          03841099
038420*    Just in case check pointer validity for avoiding 0C4         03842099
038430     IF L300-ENTORNO-ECDL AND L000-AQPTSCRP NOT = NULL            03843099
038440*       Needed by the macro mechanization layer and inocuous      03844099
038450*       for eCDL as it should come as such already from eCDL      03845099
038460        MOVE L000-AQPTSCRC TO L300-AQPTARE3                       03846099
038470*MACRO-E                                                          03847099
038480        SET ADDRESS OF L100-AREA-TOTAL TO L000-AQPTSCRP           03848099
038490        MOVE L000-AQPTSCRC TO L310-AQSCRARC                       03849099
038500*M067->                                                           03850099
038510        MOVE W-AQCDIDIU TO L100-AQCDIDIU,                         03851099
038520                           L100-AQIDIOMA                          03852099
038530*M067<-                                                           03853099
038540*tracet->                                                         03854099
038550        IF WS-TRACE = SPACES                                      03855099
038560           IF F060-AQ9IMP1(1:3)= '@DX'                            03856099
038570              MOVE F060-AQ9IMP1(4:1)         TO WS-TRACE          03857099
038580              MOVE WS-TRACE                  TO L100-AQSWJFIM     03858099
038590              MOVE '015-entrada por ECDL(1)' TO WS-AQNBDTRA       03859099
038600              MOVE F060-AQCDTERM             TO WS-AQINFORM(1:4)  03860099
038610              MOVE '-------------->>'        TO WS-AQINFORM(6:20) 03861099
038620              PERFORM 131-TRACE-TECNIC                            03862099
038630           END-IF                                                 03863099
038640*tracet<-                                                         03864099
038650*tracet2->                                                        03865099
038660* Si reg.encontrado y 4º switch activo (trace) se compara terminal03866099
038670* en curso con el del parámetro. Si coinciden: trace activado     03867099
038680           IF SW-FAQ400 = 1 AND F400-AQCDTRAD (4:1) IS NUMERIC    03868099
038690                            AND F060-AQCDTERM = F400-AQCDTRAD(6:4)03869099
038700              MOVE F400-AQCDTRAD (4:1)       TO WS-TRACE          03870099
038710              MOVE WS-TRACE                  TO L100-AQSWJFIM     03871099
038720              MOVE '015-entrada por ECDL(2)' TO WS-AQNBDTRA       03872099
038730              MOVE F060-AQCDTERM             TO WS-AQINFORM(1:4)  03873099
038740              MOVE '-------------->>'        TO WS-AQINFORM(6:20) 03874099
038750           END-IF                                                 03875099
038760*tracet2<-                                                        03876099
038770        END-IF                                                    03877099
038780     ELSE                                                         03878099
038790*                                                                 03879099
038800*MLV-03-07-03 FINAL                                               03880099
038810*                                                                 03881099
038820        MOVE W-EIBTRMID    TO L100-AQ1TERML                       03882099
038830        EXEC CICS READ DATASET ('FGT010X')                        03883099
038840             INTO (L100-AREA-TOTAL)                               03884099
038850             RIDFLD (L100-AQ1CLAVE) RESP (COD-RESP)               03885099
038860        END-EXEC                                                  03886099
038870        IF COD-RESP NOT = DFHRESP (NORMAL)                        03887099
038880           EVALUATE COD-RESP                                      03888099
038890           WHEN DFHRESP (NOTFND)                                  03889099
038900              IF W-TERM-TCPIP  = 'NNNN'                           03890099
038910                 IF F060-TERM-FINANCIERO                          03891099
038920                    INITIALIZE L085-CAQL085                       03892099
038930                    MOVE 'F'                TO L085-AQCODOPE      03893099
038940                    MOVE C-ABEND-NO-LOG-PC1 TO L085-AQ4CLAVE      03894099
038950                    PERFORM 047-LLAMADA-RAQW085                   03895099
038960                    MOVE L085-AQTXME77      TO L145-AQMSGTXT      03896099
038970                    MOVE 'ARQ'        TO L145-AQ1ABNCD            03897099
038980                    MOVE W-NUM-ABEND  TO L145-AQ1ABNCD(4:2)       03898099
038990                    SET SW-ABEND-ARQUITECTURAL TO TRUE            03899099
039000                    PERFORM 048-GRABAR-LOG                        03900099
039010*JO-17-02-05-ini                                                  03901099
039020                    MOVE 'JAQB210'       TO L100-AQ1ABNCD         03902099
039030*JO-17-02-05-fi                                                   03903099
039040                    MOVE C-E TO W-RESPUESTA                       03904099
039050                    PERFORM 049-ENVIAR-RESPUESTA                  03905099
039060*tracet->                                                         03906099
039070                    IF WS-TRACE > '0'                             03907099
039080                       MOVE 'END-RAQW001-03' TO WS-AQNBDTRA       03908099
039090                       MOVE L100-AQ1DCASO    TO WS-AQ1DCASO       03909099
039100                       STRING                                     03910099
039110                         '<<==== Tran/estado/caso|ret: '          03911099
039120                          F030-AQ3TRNID '/'                       03912099
039130                          L100-AQ1ESTAD '/' WS-AQ1DCASO '|'       03913099
039140                          L300-AQCDFURE                           03914099
039150                          DELIMITED BY SIZE  INTO WS-AQINFORM     03915099
039160                       END-STRING                                 03916099
039170                       PERFORM 131-TRACE-TECNIC                   03917099
039180                    END-IF                                        03918099
039190*tracet<-                                                         03919099
039200                    EXEC CICS RETURN END-EXEC                     03920099
039210                 END-IF                                           03921099
039220                 IF F060-TERM-3270                                03922099
039230                    SET SW-ABEND-ARQUITECTURAL TO TRUE            03923099
039240*JO-17-02-05-ini                                                  03924099
039250                    MOVE 'JAQB210'       TO L100-AQ1ABNCD         03925099
039260*JO-17-02-05-fi                                                   03926099
039270                    PERFORM 099-ABEND-PROC                        03927099
039280                 END-IF                                           03928099
039290              ELSE                                                03929099
039300*JO-17-02-05-ini                                                  03930099
039310*                EXEC CICS WRITE DATASET ('FGT010X')              03931099
039320*                  FROM(L100-AREA-TOTAL)                          03932099
039330*                  RIDFLD (L100-AQ1CLAVE) LENGTH (C-4080)         03933099
039340*                  RESP (COD-RESP)                                03934099
039350*                END-EXEC                                         03935099
039360*                IF COD-RESP NOT = DFHRESP (NORMAL)               03936099
039370*                   MOVE C-ABEND-CICS TO L100-AQ1ABNCD            03937099
039380*                   MOVE EIBFN        TO L100-AQ1EIBFN            03938099
039390*                   MOVE EIBRCODE     TO L100-AQ1EIBRC            03939099
039400*                   MOVE EIBRSRCE     TO L100-AQ1EIBRS            03940099
039410*                   PERFORM 033-INFORMAR-DATOS-ABEND              03941099
039420*                END-IF                                           03942099
039430*JO-17-02-05-fi                                                   03943099
039440*                END-IF                                           03944099
039450                    PERFORM 033-INFORMAR-DATOS-ABEND              03945099
039460              END-IF                                              03946099
039470                                                                  03947099
039480           WHEN OTHER                                             03948099
039490              PERFORM 033-INFORMAR-DATOS-ABEND                    03949099
039500           END-EVALUATE                                           03950099
039510        END-IF                                                    03951099
039520*tracet4->                                                        03952099
039530        IF WS-TRACE > '0'                                         03953099
039540           MOVE WS-TRACE TO L100-AQSWJFIM                         03954099
039550        END-IF                                                    03955099
039560*tracet4<-                                                        03956099
039570     END-IF                                                       03957099
039580*                                                                 03958099
039590*I014->                                                           03959099
039600     INITIALIZE L100-AQSWFIRM                                     03960099
039610*<-I014                                                           03961099
039620*                                                                 03962099
039630*--> Mover el puntero del area de atributos del canal             03963099
039640*                                                                 03964099
039650*                                                                 03965099
039660     MOVE W-POINTER         TO L100-AQPTCANL                      03966099
039670     MOVE W-POINTER-AREAUSU TO L100-AQPTUSUA                      03967099
039680*                                                                 03968099
039690*--> MOURE IDIOMA A L'IDIOMA D'USUARI                             03969099
039700*                                                                 03970099
039710     MOVE L100-AQIDIOMA     TO L078-AQCDIDIO                      03971099
039720*                                                                 03972099
039730*--> Si terminal fisico <> logico se han de obtener los atributos 03973099
039740*--> del canal/tipo terminal/producto                             03974099
039750*                                                                 03975099
039760     EVALUATE TRUE                                                03976099
039770     WHEN L121-CANAL-TFIS-ES-TLOG                                 03977099
039780          CONTINUE                                                03978099
039790     WHEN L121-CANAL-TFIS-NO-ES-TLO                               03979099
039800          INITIALIZE L120-CAQL120                                 03980099
039810          MOVE L100-AQTIPCON TO L120-AQCDCPRO                     03981099
039820          PERFORM 005-OBTENER-ATRIBUTOS-CANAL                     03982099
039830     WHEN OTHER                                                   03983099
039840          MOVE C-ABEND-TIPO-CONEXION TO L100-AQ1ABNCD             03984099
039850          MOVE L121-AQTPCONE TO L045-AQTXMENS (1)                 03985099
039860          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  03986099
039870          SET SW-ABEND-ARQUITECTURAL TO TRUE                      03987099
039880          PERFORM 099-ABEND-PROC                                  03988099
039890     END-EVALUATE                                                 03989099
039900*                                                                 03990099
039910*--> PARCHE FRANCIA                                               03991099
039920*                                                                 03992099
039930     IF L100-STCDPAIS = 1                                         03993099
039940        MOVE L100-AQTIPCON TO WS-TIPO-CONEXION                    03994099
039950        IF L100-AQTIPCON = '10' OR '11' OR '12'                   03995099
039960           SET L100-IBP-INTERNET TO TRUE                          03996099
039970        END-IF                                                    03997099
039980     END-IF                                                       03998099
039990                                                                  03999099
040000     MOVE W-AQPTL310 TO L100-AQPTL310                             04000099
040010                                                                  04001099
040020     PERFORM 050-ACCES-RAQW370                                    04002099
040030*                                                                 04003099
040040     INITIALIZE L100-AQ1DAFDF                                     04004099
040050*A303 MLV-25-05-05 INICIO                                         04005099
040060*    INITIALIZE L100-AQ1MENSA                                     04006099
040070     PERFORM 051-RECUPERAR-TECLAS                                 04007099
040080*A303 MLV-25-05-05 FINAL                                          04008099
040090     PERFORM 042-INFORMAR-DATOS-TERMINAL                          04009099
040100     MOVE EIBDATE       TO L100-AQ1FESES                          04010099
040110     MOVE EIBTIME       TO L100-AQ1HOSES                          04011099
040120*I013->                                                           04012099
040130*    MOVE EIBTRMID      TO L100-AQCDTRFI                          04013099
040140     IF L300-ENTORNO-ECDL                                         04014099
040150        MOVE F060-AQCDTRFI TO L100-AQCDTRFI                       04015099
040160     ELSE                                                         04016099
040170        MOVE EIBTRMID      TO L100-AQCDTRFI                       04017099
040180     END-IF                                                       04018099
040190*<-I013                                                           04019099
040200     MOVE W-EIBTRMID    TO L100-AQ1WSTID                          04020099
040210     MOVE SPACES        TO L100-AQ1MSTOI                          04021099
040220     MOVE SPACES        TO L100-AQCRCAMP                          04022099
040230     MOVE '0'           TO L100-AQ1MSTOD                          04023099
040240     MOVE 0             TO L100-AQPTCPAD                          04024099
040250     MOVE 0             TO L100-AQCROCUR                          04025099
040260     MOVE 0             TO L100-AQCDQULL                          04026099
040270     MOVE 0             TO L100-AQPTL135                          04027099
040280     MOVE 0             TO L100-AQPTQULL                          04028099
040290     MOVE 0             TO L100-AQPTAQPF                          04029099
040300*MLV261102 INICIO                                                 04030099
040310     MOVE 0             TO L100-AQ1MPRTI                          04031099
040320     MOVE 0             TO L100-AQ1PTRAV                          04032099
040330*MLV261102 FINAL                                                  04033099
040340     MOVE W-AQPTL310    TO L100-AQPTL310                          04034099
040350     MOVE L310-CAQF150P TO L100-AQPTAUDI                          04035099
040360     MOVE W-PTR-CAQL155 TO L100-AQPTLOG                           04036099
040370* jvb270502 ini  LOPD                                             04037099
040380     MOVE 0             TO L100-AQSWROLB                          04038099
040390* jvb270502 fin                                                   04039099
040400*                                                                 04040099
040410*A336->                                                           04041099
040420     MOVE SPACES        TO L100-AQSWPRTD                          04042099
040430*A336<-                                                           04043099
040440*                                                                 04044099
040450*MLV-03-07-03 INICIO                                              04045099
040460*                                                                 04046099
040470*    IF W-TERM-TCPIP =  'TCPI' OR 'AQTF'                          04047099
040480*       MOVE 'S'        TO L100-AQTRTCPI                          04048099
040490*    ELSE                                                         04049099
040500*       MOVE 'N'        TO L100-AQTRTCPI                          04050099
040510*    END-IF                                                       04051099
040520*                                                                 04052099
040530* Activar el switch del SCR                                       04053099
040540*                                                                 04054099
040550*P1000->                                                          04055099
040560*    IF W-TERM-TCPIP =  'TCPI' OR 'AQTF'                          04056099
040570     IF W-TERM-TCPIP =  'AQTF'                                    04057099
040580*P1000<-                                                          04058099
040590        MOVE 'S'        TO L100-AQTRTCPI                          04059099
040600     ELSE                                                         04060099
040610        IF L300-ENTORNO-ECDL                                      04061099
040620           SET L100-ENTORNO-ECDL TO TRUE                          04062099
040630           MOVE L000-AQPTFDFC TO L100-AQ1FDPTR                    04063099
040640        ELSE                                                      04064099
040650           MOVE 'N'        TO L100-AQTRTCPI                       04065099
040660        END-IF                                                    04066099
040670     END-IF                                                       04067099
040680*                                                                 04068099
040690*MLV-03-07-03 FINAL                                               04069099
040700*                                                                 04070099
040710     IF L100-VAL-IDIOMA-NO                                        04071099
040720        MOVE SPACES        TO L100-AQCDIDIM                       04072099
040730     END-IF                                                       04073099
040740*    MOVE W-AQ1TRANT    TO L100-AQ1TRANT                          04074099
040750     MOVE L082-STCDPAIS TO L100-STCDPAIS                          04075099
040760     MOVE L082-AQCDCICS TO L100-AQSYSID                           04076099
040770     MOVE L082-AQIDCICS TO L100-AQIDCICS                          04077099
040780     MOVE L082-AQCICTOR TO L100-AQCICTOR                          04078099
040790     MOVE L082-AQNUMEMO TO L100-AQNUMEMO                          04079099
040800     PERFORM 044-FORMATEAR-FECHAS                                 04080099
040810     MOVE W-LONG-RECEIVE TO L100-AQ1MLONI                         04081099
040820                                                                  04082099
040830*                                                                 04083099
040840* JO23072002 *CONTROL NU.SEQUENCIA PER EVITAR DUMPS A RAQW090     04084099
040850*                                                                 04085099
040860*    IF F060-TERM-FINANCIERO AND L100-AQ1MLONI > 0                04086099
040870*       IF T040-ESTADO = 'C'                                      04087099
040880*          MOVE 'SECUEN SCR NO = T040'  TO W-LETAL                04088099
040890*          MOVE 'XXXX'                  TO W-TRA25                04089099
040900*          PERFORM 333-CONTROL-SEQUENCIA-CAS                      04090099
040910*       END-IF                                                    04091099
040920*    END-IF                                                       04092099
040930*                                                                 04093099
040940*                                                                 04094099
040950*    IF F060-TERM-FINANCIERO AND L100-AQ1MLONI = 0                04095099
040960*       IF NOT L100-SWITCH-TRANSACC                               04096099
040970*          MOVE 'LONG= 0,I NO RECANVI'  TO W-LETAL                04097099
040980*          MOVE 'YYYY'                  TO W-TRA25                04098099
040990*          PERFORM 334-ERROR-RECANVI                              04099099
041000*       END-IF                                                    04100099
041010*    END-IF                                                       04101099
041020*                                                                 04102099
041030*                                                                 04103099
041040*    IF L100-AQ1MLONI NOT = 0                                     04104099
041050*       IF L100-SWITCH-TRANSACC                                   04105099
041060*          MOVE 'LONG> 0,I ES RECANVI'  TO W-LETAL                04106099
041070*          MOVE 'ZZZZ'                  TO W-TRA25                04107099
041080*          PERFORM 335-ERROR-SWITCH                               04108099
041090*       END-IF                                                    04109099
041100*    END-IF                                                       04110099
041110*                                                                 04111099
041120* JO23072002 FINAL CONTROL NUM.SEQUENCIA                          04112099
041130*                                                                 04113099
041140*I005 INICIO                                                      04114099
041150*                                                                 04115099
041160*    Si se esta iniciando una transaccion desde eCDL en estado    04116099
041170*    inicio y caso 1 habiendose solicitado por la aplicacion      04117099
041180*    por recambio, se debe hacer la simulacion del inicio         04118099
041190*    para que actuar de la misma manera que se haria para TF      04119099
041200*                                                                 04120099
041210     IF L300-ENTORNO-ECDL AND L100-SWITCH-TRANSACC AND            04121099
041220        L100-ESTADO-INICIO AND L100-AQ1DCASO = 1 AND              04122099
041230        L100-CAMBIO-POR-APLICACION                                04123099
041240        SET SW-SIMULAR-INICIO-ECDL TO TRUE                        04124099
041250     END-IF                                                       04125099
041260*                                                                 04126099
041270*I005 FINAL                                                       04127099
041280*                                                                 04128099
041290     IF L100-AQ1MLONI NOT = 0                                     04129099
041300         SET L100-NO-SWITCH-TRANS TO TRUE                         04130099
041310     END-IF                                                       04131099
041320*                                                                 04132099
041330*--> MLV2905 Si proceso 'D' (Autorizacion especial) el tipo de    04133099
041340*--> proceso sera 'N' (On-Line)                                   04134099
041350     IF (F060-TERM-FINANCIERO AND L100-NO-SWITCH-TRANS) OR        04135099
041360*MLV-03-07-03 INICIO                                              04136099
041370*       (W-TERM-TCPIP = 'TCPI' OR 'AQTF')                         04137099
041380*P1000->                                                          04138099
041390*       (W-TERM-TCPIP = 'TCPI' OR 'AQTF') OR                      04139099
041400         W-TERM-TCPIP = 'AQTF' OR                                 04140099
041410*P1000<-                                                          04141099
041420        L300-ENTORNO-ECDL                                         04142099
041430*MLV-03-07-03 FINAL                                               04143099
041440        SET W-PUNTER-POINTER     TO ADDRESS OF T040-AREA          04144099
041450        MOVE W-PUNTER-COMP       TO L100-AQ1FMSGP                 04145099
041460        MOVE W-PUNTER-COMP       TO L100-AQ1FPTRP                 04146099
041470        IF T040-TIPO-PROCESO = 'E' OR = 'D'                       04147099
041480           MOVE 'N'              TO L100-AQ1PROCE                 04148099
041490           MOVE 'N'              TO L100-AQ1TIPRO                 04149099
041500        ELSE                                                      04150099
041600           IF T040-TIPO-PROCESO = 'Q'                             04160099
041610              MOVE 'A' TO L100-AQ1PROCE                           04161099
041620              MOVE 'A' TO L100-AQ1TIPRO                           04162099
041630           ELSE                                                   04163099
041640              MOVE T040-TIPO-PROCESO TO L100-AQ1PROCE             04164099
041650              MOVE T040-TIPO-PROCESO TO L100-AQ1TIPRO             04165099
041660           END-IF                                                 04166099
041670        END-IF                                                    04167099
041680        MOVE T040-SECUENCIA-TRAN TO L100-AQ1SECTR                 04168099
041690        IF T040-ESTADO = 'I'                                      04169099
041700           SET L100-CONFIRMACION-MONEDA-NO TO TRUE                04170099
041710        END-IF                                                    04171099
041720*       MLV-20-10-04 INICIO                                       04172099
041730*       MOVE T040-ESTADO         TO L100-AQ1ESTAD                 04173099
041740*       MOVE T040-CASO           TO L100-AQ1DCASO                 04174099
041750        IF L100-ENTORNO-ECDL                                      04175099
041760           MOVE L000-AQCDESTD TO L100-AQ1ESTAD                    04176099
041770           MOVE L000-AQCDCASO TO L100-AQ1DCASO                    04177099
041780        ELSE                                                      04178099
041790           MOVE T040-ESTADO   TO L100-AQ1ESTAD                    04179099
041800           MOVE T040-CASO     TO L100-AQ1DCASO                    04180099
041810        END-IF                                                    04181099
041820*       MLV-20-10-04 FINAL                                        04182099
041830*tracet->                       +                                 04183099
041840        IF WS-TRACE > '0'                                         04184099
041850           MOVE '015-ACCESO-SCR (2)         ' TO WS-AQNBDTRA      04185099
041860           MOVE L100-AQ1DCASO   TO   WS-CAS                       04186099
041870           STRING 'RECIBIDO TRAN/EST/CAS: ' L000-AQCDTRAN, '/',   04187099
041880              L100-AQ1ESTAD, '/', WS-CAS                          04188099
041890              DELIMITED BY SIZE INTO WS-AQINFORM                  04189099
041900           END-STRING                                             04190099
041910           PERFORM 131-TRACE-TECNIC                               04191099
041920        END-IF                                                    04192099
041930*tracet<-                                                         04193099
041940        IF NOT L100-AUTORIZACION                                  04194099
041950           IF T040-TIPO-PROCESO = 'E' OR = 'D'                    04195099
041960              MOVE 'N'           TO L100-AQ1PRINI                 04196099
041970           ELSE                                                   04197099
041980              MOVE T040-TIPO-PROCESO TO L100-AQ1PRINI             04198099
041990           END-IF                                                 04199099
042000*                                                                 04200099
042010*-->  CORRESPONDE AL NUM DE PAG.I SI TE EFECTIU POSICIO TERCERA   04201099
042020*MLV-30-09-03                                                     04202099
042030           IF NOT L100-ENTORNO-ECDL                               04203099
042040              MOVE T040-PANTALLA-PC(1:3) TO L100-AQ1PANTA (1:3)   04204099
042050           END-IF                                                 04205099
042060        END-IF                                                    04206099
042070     END-IF                                                       04207099
042080*                                                                 04208099
042090*--> Obtenir un àrea aplicativa de 200 bytes                      04209099
042100* (a utilitzar en principi per passar dades de                    04210099
042110* la totalització de les transaccions)                            04211099
042120*                                                                 04212099
042130*A366->                                                           04213099
042140*                                                                 04214099
042150*     IF L121-AQSWTOTA-SI                                         04215099
042160*                                                                 04216099
042170*        EXEC CICS GETMAIN SET (ADDRESS OF AREA-AQ-ADINAL)        04217099
042180*             INITIMG (C-LOW-VALUES)                              04218099
042190*             FLENGTH (LENGTH OF AREA-AQ-ADINAL) RESP (COD-RESP)  04219099
042200*             NOSUSPEND                                           04220099
042210*        END-EXEC                                                 04221099
042220*                                                                 04222099
042230*        IF COD-RESP NOT = DFHRESP (NORMAL)                       04223099
042240*            PERFORM 033-INFORMAR-DATOS-ABEND                     04224099
042250*        END-IF                                                   04225099
042260*        SET  W-PUNTER-POINTER  TO  ADDRESS OF AREA-AQ-ADINAL     04226099
042270*        MOVE W-PUNTER-COMP     TO  L100-AQPTAPLI                 04227099
042280*     ELSE                                                        04228099
042290*        MOVE 0          TO L100-AQPTAPLI                         04229099
042300*     END-IF                                                      04230099
042310*                                                                 04231099
042320*    Area datos adicional SCR                                     04232099
042330*                                                                 04233099
042340     SET  W-PUNTER-POINTER TO ADDRESS OF AREA-AQ-ADINAL           04234099
042350     MOVE W-PUNTER-COMP    TO L100-AQPTAPLI                       04235099
042360                                                                  04236099
042370     IF L300-ENTORNO-ECDL                                         04237099
042380        MOVE L000-AQTPDOCU TO L101-AQTPDOCU                       04238099
042390*GFTÑ01-I                                                         04239099
042400*    Traspaso del detalle del billetaje de una operacion          04240099
042410        MOVE L000-AQDETABE TO L101-AQDETABE                       04241099
042420*GFTÑ01-F                                                         04242099
042430*ADS-I                                                            04243099
042440        MOVE ZEROS         TO L101-AQPTADSC                       04244099
042450*ADS-F                                                            04245099
042460     END-IF                                                       04246099
042470*A366<-                                                           04247099
042480*                                                                 04248099
042490*A325->                                                           04249099
042500*    Activar el switch del tipo de control LOPD aplicado en la    04250099
042510*    ultima transaccion ejecutada                                 04251099
042520     EVALUATE TRUE                                                04252099
042530     WHEN L100-LOPD-CONTROL-PARCIAL                               04253099
042540          SET L100-LOPD-ANT-CONTROL-PARCIAL TO TRUE               04254099
042550     WHEN L100-LOPD-CONTROL-TOTAL                                 04255099
042560          SET L100-LOPD-ANT-CONTROL-TOTAL TO TRUE                 04256099
042570     END-EVALUATE                                                 04257099
042580*<-A325                                                           04258099
042590*                                                                 04259099
042600     PERFORM 052-GRAVAR-SCR-ADICI.                                04260099
042610*                                                                 04261099
042620*----------------------------------------------------------------*04262099
042630*   -  ACCES QUAN HI HA RECANVI                                  *04263099
042640*----------------------------------------------------------------*04264099
042650 016-ACCES-SCR-RECANVI.                                           04265099
042660*----------------------                                           04266099
042670*tracet->                       +                                 04267099
042680     IF WS-TRACE > '1'                                            04268099
042690        MOVE '016-ACCES-SCR-RECANVI.          ' TO WS-AQNBDTRA    04269099
042700        PERFORM 131-TRACE-TECNIC                                  04270099
042710     END-IF                                                       04271099
042720*tracet<-                                                         04272099
042730     MOVE W-AQPTL310 TO L100-AQPTL310                             04273099
042740     PERFORM 050-ACCES-RAQW370                                    04274099
042750     INITIALIZE L100-AQ1DAFDF                                     04275099
042760     MOVE EIBTIME       TO L100-AQ1HOSES                          04276099
042770*I013->                                                           04277099
042780*    MOVE EIBTRMID      TO L100-AQCDTRFI                          04278099
042790     IF L300-ENTORNO-ECDL                                         04279099
042800        MOVE F060-AQCDTRFI TO L100-AQCDTRFI                       04280099
042810     ELSE                                                         04281099
042820        MOVE EIBTRMID      TO L100-AQCDTRFI                       04282099
042830     END-IF                                                       04283099
042840*<-I013                                                           04284099
042850     MOVE SPACES        TO L100-AQ1MSTOI                          04285099
042860     MOVE SPACES        TO L100-AQCRCAMP                          04286099
042870     MOVE SPACES        TO L100-AQ1AVCD1                          04287099
042880     MOVE SPACES        TO L100-AQ1AVCD2                          04288099
042890     MOVE SPACES        TO L100-AQ1ERRCD                          04289099
042900     MOVE SPACES        TO L100-AQ1ABNCD                          04290099
042910     MOVE '0'           TO L100-AQ1MSTOD                          04291099
042920     MOVE 0             TO L100-AQPTCPAD                          04292099
042930     MOVE 0             TO L100-AQCROCUR                          04293099
042940     MOVE 0             TO L100-AQCDQULL                          04294099
042950     MOVE 0             TO L100-AQPTQULL                          04295099
042960     MOVE 0             TO L100-AQPTAQPF                          04296099
042970     MOVE 0             TO L100-AQSWROLB                          04297099
042980                                                                  04298099
042990     PERFORM 051-RECUPERAR-TECLAS                                 04299099
043000                                                                  04300099
043010     IF L100-VAL-IDIOMA-NO                                        04301099
043020        MOVE SPACES        TO L100-AQCDIDIM                       04302099
043030     END-IF                                                       04303099
043040                                                                  04304099
043050     MOVE +280 TO LONGET                                          04305099
043060     EXEC CICS GETMAIN SET (L100-AQ1PTRAV) FLENGTH (LONGET)       04306099
043070          INITIMG (C-SPACES) RESP (COD-RESP)                      04307099
043080          NOSUSPEND                                               04308099
043090     END-EXEC                                                     04309099
043100     IF COD-RESP NOT = DFHRESP (NORMAL)                           04310099
043110        PERFORM 033-INFORMAR-DATOS-ABEND                          04311099
043120     END-IF                                                       04312099
043130     MOVE L100-AQ1PTRAV          TO W-PUNTER-COMP                 04313099
043140     SET ADDRESS OF CGTL015-AREA TO W-PUNTER-POINTER              04314099
043150*    PERFORM 066-FORMAT-DEFORM-MENS                               04315099
043160     IF L100-AQ1ABNCD NOT = SPACES                                04316099
043170        SET SW-ABEND-ARQUITECTURAL TO TRUE                        04317099
043180        PERFORM 099-ABEND-PROC                                    04318099
043190     END-IF                                                       04319099
043200                                                                  04320099
043210     PERFORM 052-GRAVAR-SCR-ADICI.                                04321099
043220*                                                                 04322099
043230*----------------------------------------------------------------*04323099
043240*    LLAMADA AL MODULO RAQWP01 PARA INCREMENTAR EL NUMERO        *04324099
043250*    DE OPERACION                                                *04325099
043260*----------------------------------------------------------------*04326099
043270 017-INCREM-NUM-OPERACION.                                        04327099
043280*-------------------------                                        04328099
043290*tracet->                       +                                 04329099
043300     IF WS-TRACE > '1'                                            04330099
043310        MOVE '017-INCREM-NUM-OPERACION.       ' TO WS-AQNBDTRA    04331099
043320        PERFORM 131-TRACE-TECNIC                                  04332099
043330     END-IF                                                       04333099
043340*tracet<-                                                         04334099
043350*M023->                                                           04335099
043360*                                                                 04336099
043370*    IF L121-AQASGNOP = 'S' AND F060-AQCDCLID > SPACES            04337099
043380*       INITIALIZE LP01-CAQLP01                                   04338099
043390*       SET LP01-INCREMENTAR TO TRUE                              04339099
043400*       MOVE F060-AQCDCLID   TO LP01-AQCDPTO                      04340099
043410*       EXEC CICS LINK PROGRAM ('RAQWP01') RESP (COD-RESP)        04341099
043420*            COMMAREA (LP01-CAQLP01)                              04342099
043430*       END-EXEC                                                  04343099
043440*       IF COD-RESP NOT = DFHRESP (NORMAL)                        04344099
043450*          PERFORM 033-INFORMAR-DATOS-ABEND                       04345099
043460*       END-IF                                                    04346099
043470*       EVALUATE TRUE                                             04347099
043480*       WHEN LP01-CORRECTE                                        04348099
043490*            MOVE LP01-AQNUOPER TO L100-AQ1SECTR                  04349099
043500*       WHEN OTHER                                                04350099
043510*            INITIALIZE L045-CAQL045                              04351099
043520*            MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                 04352099
043530*            MOVE 'RAQWP01'      TO L045-AQTXMENS (1)             04353099
043540*            MOVE LP01-AQRETCOD  TO L045-AQTXMENS (2)             04354099
043550*            SET SW-ABEND-ARQUITECTURAL TO TRUE                   04355099
043560*            PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               04356099
043570*            PERFORM 099-ABEND-PROC                               04357099
043580*       END-EVALUATE                                              04358099
043590*    END-IF                                                       04359099
043600*                                                                 04360099
043610     IF L121-AQASGNOP = 'S'                                       04361099
043620        IF F060-AQCDCLID = F060-AQCDTRFI OR = SPACES              04362099
043630           IF L100-AQ1SECTR IS NUMERIC                            04363099
043640              COMPUTE L100-AQ1SECTR = L100-AQ1SECTR + 1           04364099
043650           ELSE                                                   04365099
043660              MOVE 1 TO L100-AQ1SECTR                             04366099
043670           END-IF                                                 04367099
043680        ELSE                                                      04368099
043690           INITIALIZE LP01-CAQLP01                                04369099
043700           SET LP01-INCREMENTAR TO TRUE                           04370099
043710           MOVE F060-AQCDCLID   TO LP01-AQCDPTO                   04371099
043720           EXEC CICS LINK PROGRAM ('RAQWP01') RESP (COD-RESP)     04372099
043730                COMMAREA (LP01-CAQLP01)                           04373099
043740           END-EXEC                                               04374099
043750           IF COD-RESP NOT = DFHRESP (NORMAL)                     04375099
043760              PERFORM 033-INFORMAR-DATOS-ABEND                    04376099
043770           END-IF                                                 04377099
043780           EVALUATE TRUE                                          04378099
043790           WHEN LP01-CORRECTE                                     04379099
043800                MOVE LP01-AQNUOPER TO L100-AQ1SECTR               04380099
043810           WHEN OTHER                                             04381099
043820                INITIALIZE L045-CAQL045                           04382099
043830                MOVE C-ERROR-MODULO TO L100-AQ1ABNCD              04383099
043840                MOVE 'RAQWP01'      TO L045-AQTXMENS (1)          04384099
043850                MOVE LP01-AQRETCOD  TO L045-AQTXMENS (2)          04385099
043860                SET SW-ABEND-ARQUITECTURAL TO TRUE                04386099
043870                PERFORM 037-FORMATEAR-MENSAJE-VARIABLE            04387099
043880                PERFORM 099-ABEND-PROC                            04388099
043890           END-EVALUATE                                           04389099
043900        END-IF                                                    04390099
043910     END-IF                                                       04391099
043920     .                                                            04392099
043930*                                                                 04393099
043940*<-M023                                                           04394099
043950*                                                                 04395099
043960******************************************************************04396099
043970*    Invoca al modulo de lectura del fichero de parametros FAQ400*04397099
043980******************************************************************04398099
043990 018-LEER-PARAMETROS.                                             04399099
044000*--------------------                                             04400099
044010*tracet->                       +                                 04401099
044020     IF WS-TRACE > '1'                                            04402099
044030        MOVE '018-LEER-PARAMETROS.            ' TO WS-AQNBDTRA    04403099
044040        PERFORM 131-TRACE-TECNIC                                  04404099
044050     END-IF                                                       04405099
044060*tracet<-                                                         04406099
044070     INITIALIZE AREA-CAQL127                                      04407099
044080     MOVE 'L'            TO L127-AQCDO127                         04408099
044090     MOVE '99RW999'      TO L127-AQCLV127                         04409099
044100     MOVE 'RAQW999'      TO L127-AQPROGRA                         04410099
044110                                                                  04411099
044120     EXEC CICS LINK PROGRAM ('RAQW127') COMMAREA (AREA-CAQL127)   04412099
044130          RESP (COD-RESP)                                         04413099
044140     END-EXEC                                                     04414099
044150                                                                  04415099
044160     IF COD-RESP NOT = DFHRESP(NORMAL)                            04416099
044170        MOVE 'B'             TO L140-AQCODOPE                     04417099
044180        MOVE SPACES          TO L140-AQRETORN                     04418099
044190        MOVE 'RAQW001 '      TO L140-AQPROGRA                     04419099
044200        MOVE 'AQ  '          TO L140-AQ19APLI                     04420099
044210        MOVE SPACES          TO L140-AQ1ERRCD                     04421099
044220        MOVE SPACES          TO L140-AQ1ABNCD                     04422099
044230        MOVE 'ERROR EN LA LECTURA DEL FAQ400'                     04423099
044240                             TO L140-AQMSGTXT                     04424099
044250                                                                  04425099
044260        EXEC CICS LINK                                            04426099
044270                  PROGRAM  ('RAQW140')                            04427099
044280                  COMMAREA (CAQL140-AREA)                         04428099
044290                  LENGTH   (LENGTH OF CAQL140-AREA)               04429099
044300                  RESP     (COD-RESP)                             04430099
044310        END-EXEC                                                  04431099
044320                                                                  04432099
044330        MOVE 0  TO SW-FAQ400                                      04433099
044340     ELSE                                                         04434099
044350        MOVE L127-AQREG127 TO F400-CAQF400                        04435099
044360        MOVE 1  TO SW-FAQ400                                      04436099
044370     END-IF.                                                      04437099
044380*hm1                                                              04438099
044390                                                                  04439099
044400******************************************************************04440099
044410*     Primera llamada al servicio de trace para consultar si el  *04441099
044420*     trace está activo o no. Si lo está, el campo de timestamp  *04442099
044430*     del area de enlace estará informado.                       *04443099
044440******************************************************************04444099
044450 019-PETICION-NUEVO-TRACE.                                        04445099
044460*-------------------------                                        04446099
044470*tracet->                       +                                 04447099
044480     IF WS-TRACE > '1'                                            04448099
044490        MOVE '019-PETICION-NUEVO-TRACE.       ' TO WS-AQNBDTRA    04449099
044500        PERFORM 131-TRACE-TECNIC                                  04450099
044510     END-IF                                                       04451099
044520*tracet<-                                                         04452099
044530     MOVE 0  TO  L100-AQHMALPC                                    04453099
044540     MOVE 0  TO  L100-AQCTMINU                                    04454099
044550                                                                  04455099
044560     INITIALIZE CAQLT00-AREA                                      04456099
044570     MOVE 'C'                TO LT00-AQCDOPC                      04457099
044580     MOVE L100-AQ1USCIC      TO LT00-AQCDUSIN                     04458099
044590     MOVE 'CD'               TO LT00-AQCDLAYR                     04459099
044600     MOVE L100-AQ1TRANT      TO LT00-AQCDTRAN                     04460099
044610     MOVE SPACES             TO LT00-AQIDPROD                     04461099
044620                                LT00-AQIDOPER                     04462099
044630     MOVE 'RAQW001'          TO LT00-AQCDPROG                     04463099
044640     PERFORM 053-LLAMAR-RAQWT00                                   04464099
044650     IF LT00-AQRCMAJ = 'OK'                                       04465099
044660        MOVE LT00-AQHMALPC   TO L100-AQHMALPC                     04466099
044670        MOVE LT00-AQCTMINU   TO L100-AQCTMINU                     04467099
044680        MOVE LT00-AQCDLAYR   TO L100-AQCDLAYR                     04468099
044690     END-IF                                                       04469099
044700     .                                                            04470099
044710                                                                  04471099
044720*----------------------------------------------------------------*04472099
044730*    COMPRUEBA LA NOMENCLATURA DEL USUARIO                       *04473099
044740*----------------------------------------------------------------*04474099
044750 020-VALIDAR-RANGO-USUARIO.                                       04475099
044760*--------------------------                                       04476099
044770*tracet->                       +                                 04477099
044780     IF WS-TRACE > '1'                                            04478099
044790        MOVE '020-VALIDAR-RANGO-USUARIO       ' TO WS-AQNBDTRA    04479099
044800        PERFORM 131-TRACE-TECNIC                                  04480099
044810     END-IF                                                       04481099
044820*tracet<-                                                         04482099
044830*--> Evaluar nomenclatura usuario Fisico                          04483099
044840*                                                                 04484099
044850     IF L100-AQTRTCPI = 'N'                                       04485099
044860        SET SW-USER-OK        TO TRUE                             04486099
044870        MOVE 'FI'          TO L130-AQCDOPCI                       04487099
044880        MOVE L100-AQPTCANL TO L130-AQPTCANL                       04488099
044890        MOVE W-USERID      TO L130-AQCDUSFD                       04489099
044900                                                                  04490099
044910        EXEC CICS LINK PROGRAM ('RAQW130')                        04491099
044920             COMMAREA (L130-CAQL130) RESP (COD-RESP)              04492099
044930             LENGTH (LENGTH OF L130-CAQL130)                      04493099
044940        END-EXEC                                                  04494099
044950        IF COD-RESP NOT = DFHRESP (NORMAL)                        04495099
044960           PERFORM 033-INFORMAR-DATOS-ABEND                       04496099
044970        END-IF                                                    04497099
044980                                                                  04498099
044990        EVALUATE L130-AQRETORN                                    04499099
045000        WHEN ' '                                                  04500099
045010             CONTINUE                                             04501099
045020        WHEN 'F'                                                  04502099
045030             SET SW-ERROR-USER-FISICO TO TRUE                     04503099
045031*MACRO-I                                                          04503199
045032*            Tech users might not follow the pre-defined          04503299
045033*            channel nomenclature for users, but they must        04503399
045034*            be allowed to operate nevertheless                   04503499
045035             IF TECH-USER-UNKNOWN                                 04503599
045036                PERFORM CHECK-TECH-USER                           04503699
045037             END-IF                                               04503799
045038             IF NOT-TECH-USER                                     04503899
045039*MACRO-E                                                          04503999
045040                PERFORM 056-ERROR-RANGO-USUARIO                   04504099
045050                PERFORM 099-ABEND-PROC                            04505099
045051*MACRO-I                                                          04505199
045052             END-IF                                               04505299
045053*MACRO-E                                                          04505399
045054        WHEN '1'                                                  04505499
045055             MOVE C-ABEND-OPE-USU-FISICO TO L100-AQ1ABNCD         04505599
045056             MOVE L121-AQOPUSFI          TO L045-AQTXMENS(1)      04505699
045057             PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               04505799
045058             SET SW-ABEND-ARQUITECTURAL TO TRUE                   04505899
045059             PERFORM 099-ABEND-PROC                               04505999
045060        WHEN OTHER                                                04506099
045070             MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                 04507099
045080             MOVE 'RAQW130'      TO L045-AQTXMENS (1)             04508099
045090             MOVE L130-AQRETORN  TO L045-AQTXMENS (2)             04509099
045100             SET SW-ABEND-ARQUITECTURAL TO TRUE                   04510099
045110             PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               04511099
045120             PERFORM 099-ABEND-PROC                               04512099
045130        END-EVALUATE                                              04513099
045140     END-IF                                                       04514099
045150*                                                                 04515099
045160*--> Evaluar nomenclatura usuario logico                          04516099
045170     SET SW-USER-OK        TO TRUE                                04517099
045180     MOVE 'LO'          TO L130-AQCDOPCI                          04518099
045190     MOVE L100-AQPTCANL TO L130-AQPTCANL                          04519099
045200     MOVE L100-AQ1USCIC TO L130-AQCDUSLD                          04520099
045210                                                                  04521099
045220     EXEC CICS LINK PROGRAM ('RAQW130') COMMAREA (L130-CAQL130)   04522099
045230          LENGTH (LENGTH OF L130-CAQL130) RESP (COD-RESP)         04523099
045240     END-EXEC                                                     04524099
045250     IF COD-RESP NOT = DFHRESP (NORMAL)                           04525099
045260        PERFORM 033-INFORMAR-DATOS-ABEND                          04526099
045270     END-IF                                                       04527099
045280                                                                  04528099
045290     EVALUATE L130-AQRETORN                                       04529099
045300        WHEN ' '                                                  04530099
045310             CONTINUE                                             04531099
045320        WHEN 'L'                                                  04532099
045330             SET SW-ERROR-USER-LOGICO TO TRUE                     04533099
045340*MACRO-I                                                          04534099
045350*            Tech users might not follow the pre-defined          04535099
045360*            channel nomenclature for users, but they must        04536099
045370*            be allowed to operate nevertheless                   04537099
045380             IF TECH-USER-UNKNOWN                                 04538099
045390                PERFORM CHECK-TECH-USER                           04539099
045391             END-IF                                               04539199
045392             IF NOT-TECH-USER                                     04539299
045393*MACRO-E                                                          04539399
045394                PERFORM 056-ERROR-RANGO-USUARIO                   04539499
045395                PERFORM 099-ABEND-PROC                            04539599
045396*MACRO-I                                                          04539699
045397             END-IF                                               04539799
045398*MACRO-E                                                          04539899
045399        WHEN '2'                                                  04539999
045400             MOVE C-ABEND-OPE-USU-LOGICO TO L100-AQ1ABNCD         04540099
045410             MOVE L121-AQOPUSLO          TO L045-AQTXMENS(1)      04541099
045420             PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               04542099
045430             SET SW-ABEND-ARQUITECTURAL TO TRUE                   04543099
045440             PERFORM 099-ABEND-PROC                               04544099
045450        WHEN OTHER                                                04545099
045460             MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                 04546099
045470             MOVE 'RAQW130'      TO L045-AQTXMENS (1)             04547099
045480             MOVE L130-AQRETORN  TO L045-AQTXMENS (2)             04548099
045490             SET SW-ABEND-ARQUITECTURAL TO TRUE                   04549099
045500             PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               04550099
045510             PERFORM 099-ABEND-PROC                               04551099
045520     END-EVALUATE.                                                04552099
045530                                                                  04553099
045540*----------------------------------------------------------------*04554099
045550*    LLAMADA AL MODULO RAQW355 (ENVIO MENSAJES)                  *04555099
045560*----------------------------------------------------------------*04556099
045570 021-ENVIO-MENSAJES.                                              04557099
045580*-------------------                                              04558099
045590*tracet->                       +                                 04559099
045600     IF WS-TRACE > '1'                                            04560099
045610        MOVE '021-ENVIO-MENSAJES.             ' TO WS-AQNBDTRA    04561099
045620        PERFORM 131-TRACE-TECNIC                                  04562099
045630     END-IF                                                       04563099
045640*tracet<-                                                         04564099
045650     EXEC CICS LINK PROGRAM ('RAQW355') RESP (COD-RESP)           04565099
045660          COMMAREA (L100-CAQF100)                                 04566099
045670     END-EXEC                                                     04567099
045680     IF COD-RESP NOT = DFHRESP (NORMAL)                           04568099
045690        PERFORM 033-INFORMAR-DATOS-ABEND                          04569099
045700     END-IF                                                       04570099
045710     IF L100-AQ1ABNCD NOT = SPACES                                04571099
045720        SET SW-ABEND-ARQUITECTURAL TO TRUE                        04572099
045730        PERFORM 099-ABEND-PROC                                    04573099
045740     END-IF.                                                      04574099
045750*                                                                 04575099
045760*----------------------------------------------------------------*04576099
045770*    - LECTURA DE LA TRANSACCIO ACTUAL                           *04577099
045780*----------------------------------------------------------------*04578099
045790 022-LLEGIR-ARXIU-FAQ030.                                         04579099
045800*------------------------                                         04580099
045810*tracet->                       +                                 04581099
045820     IF WS-TRACE > '0'                                            04582099
045830        MOVE '022-LLEGIR-ARXIU-FAQ030.        ' TO WS-AQNBDTRA    04583099
045840        MOVE L100-AQ1DCASO   TO   WS-CAS                          04584099
045850        STRING                                                    04585099
045860           'T.act:' L100-AQ1TRANT '/'                             04586099
045870           'T.ant:' L100-AQTRANTR '/'                             04587099
045880           'T.aux:' W-AQ1TRANT                                    04588099
045890           '/E:' L100-AQ1ESTAD                                    04589099
045900           '/C:' WS-CAS                                           04590099
045910           '/Tec:' L100-AQ1MESAI                                  04591099
045920           '/rec:' L100-AQSWRECT                                  04592099
045930            DELIMITED BY SIZE INTO WS-AQINFORM                    04593099
045940        END-STRING                                                04594099
045950        PERFORM 131-TRACE-TECNIC                                  04595099
045960     END-IF                                                       04596099
045970*tracet<-                                                         04597099
045980*I005 INICIO                                                      04598099
045990*                                                                 04599099
046000*--> Si la transaccion actual no es igual a la anterior           04600099
046010*--> y no estamos tratanto un Fast-Path                           04601099
046020*                                                                 04602099
046030**** IF EIBTRNID NOT = L100-AQ1TRANT                              04603099
046040*    IF W-AQ1TRANT  NOT = L100-AQ1TRANT                           04604099
046050* A265 13/04/2004 INICIO                                          04605099
046060****     IF L100-AQ1NIVUS NOT = '777' AND NOT = '555'             04606099
046070*       IF (L100-AQ1NIVUS NOT = '777' AND NOT = '555')            04607099
046080*          AND (NOT L100-CAMBIO-POR-RETORNO)                      04608099
046090* A265 13/04/2004 FINAL                                           04609099
046100*          SET L100-ACCION-TERMINAL TO TRUE                       04610099
046110*          SET L100-ESTADO-INICIO   TO TRUE                       04611099
046120*          SET L100-CONFIRMACION-MONEDA-NO TO TRUE                04612099
046130*          MOVE 1                   TO L100-AQ1DCASO              04613099
046140*       END-IF                                                    04614099
046150*    END-IF                                                       04615099
046160*                                                                 04616099
046170*    CONTROL PARA FORZAR ESTADO INICIO Y CASO 1                   04617099
046180*    Se aplica cuando la transaccion en curso es diferente a la   04618099
046190*    ultima transaccion ejecutada, excepto cuando se trata de un  04619099
046200*    Fast-Path de 3270 o cuando se esta ejecutando una transaccion04620099
046210*    desde eCDL en Estado Inicio y Caso 1.                        04621099
046220*    Cuando se ha cambiado el estado y caso y el entorno es eCDL  04622099
046230*    excepcionalmente se tiene que hacer la simulacion del inicio 04623099
046240*    para tener el mismo comportamiento que TF.                   04624099
046250*                                                                 04625099
046260*    Si transaccion en curso igual a la anterior                  04626099
046270*                                                                 04627099
046280     SET SW-NO-FORZAR-INICIO-CASO-1 TO TRUE                       04628099
046290*                                                                 04629099
046300*SIMU-I                                                           04630099
046310     IF L100-AQFILL16 = 'SIMUFUSI'                                04631099
046320*       Queremos evitar el ELSE para que no nos sobrescriba       04632099
046330*       el estado y caso que nos envian por cabeceras HTTP        04633099
046340        CONTINUE                                                  04634099
046350     ELSE                                                         04635099
046360*SIMU-E                                                           04636099
046370     IF (W-AQ1TRANT = L100-AQ1TRANT)                              04637099
046380        IF L121-CANAL-NAVEGACION-SI AND                           04638099
046390           L100-TRANSACCION-RECUPERADA                            04639099
046400*A326b->                                                          04640099
046410*          IF (L100-ENTORNO-ECDL AND L100-ESTADO-INICIO AND       04641099
046420*              L100-AQ1DCASO = 1)                                 04642099
046430*             CONTINUE                                            04643099
046440*          ELSE                                                   04644099
046450*             SET SW-FORZAR-INICIO-CASO-1 TO TRUE                 04645099
046460*             SET SW-SIMULAR-INICIO-ECDL TO TRUE                  04646099
046470*          END-IF                                                 04647099
046480*                                                                 04648099
046490           IF L100-ENTORNO-ECDL                                   04649099
046500              IF L100-ESTADO-INICIO AND L100-AQ1DCASO = 1         04650099
046510                 CONTINUE                                         04651099
046520              ELSE                                                04652099
046530                 SET SW-FORZAR-INICIO-CASO-1 TO TRUE              04653099
046540                 SET SW-SIMULAR-INICIO-ECDL TO TRUE               04654099
046550              END-IF                                              04655099
046560           ELSE                                                   04656099
046570              CONTINUE                                            04657099
046580           END-IF                                                 04658099
046590*<-A326                                                           04659099
046600        ELSE                                                      04660099
046610           CONTINUE                                               04661099
046620        END-IF                                                    04662099
046630     ELSE                                                         04663099
046640*       Fast-Path de 3270                                         04664099
046650        IF (L100-AQ1NIVUS = '777' OR = '555')                     04665099
046660            CONTINUE                                              04666099
046670        ELSE                                                      04667099
046680*          Entorno eCDL en Estado Inicio y Caso 1                 04668099
046690*P122->                                                           04669099
046700*          IF (L100-ENTORNO-ECDL AND L100-ESTADO-INICIO AND       04670099
046710*              L100-AQ1DCASO = 1)                                 04671099
046720           IF L100-ENTORNO-ECDL AND                               04672099
046730             ((L100-ESTADO-INICIO AND L100-AQ1DCASO = 1) OR       04673099
046740              (L100-AQ1DCASO = 50 OR L100-AQ1DCASO = 51))         04674099
046750*P122<-                                                           04675099
046760              CONTINUE                                            04676099
046770           ELSE                                                   04677099
046780*             Retorno Fast-Path Terminal Financiero               04678099
046790              IF L121-CANAL-NAVEGACION-SI AND                     04679099
046800                 L100-CAMBIO-POR-RETORNO                          04680099
046810                 CONTINUE                                         04681099
046820              ELSE                                                04682099
046830*jfm06->                                                          04683099
046840                 IF L300-ENTORNO-ECDL                             04684099
046850                    PERFORM 142-CONTROL-NAVEGADOR-ATRAS           04685099
046860                 END-IF                                           04686099
046870*jfm06<-                                                          04687099
046880*                Se fuerza Estado Inicio y Caso 1                 04688099
046890                 SET L100-ACCION-TERMINAL TO TRUE                 04689099
046900                 SET L100-ESTADO-INICIO   TO TRUE                 04690099
046910                 MOVE 1                   TO L100-AQ1DCASO        04691099
046920                 SET L100-CONFIRMACION-MONEDA-NO TO TRUE          04692099
046930              END-IF                                              04693099
046940           END-IF                                                 04694099
046950        END-IF                                                    04695099
046960     END-IF                                                       04696099
046970*SIMU-I                                                           04697099
046980     END-IF                                                       04698099
046990*SIMU-E                                                           04699099
047000*                                                                 04700099
047010*I005 FINAL                                                       04701099
047020*                                                                 04702099
047030*MLV-03-07-03 INICIO                                              04703099
047040*                                                                 04704099
047050     IF L300-ENTORNO-ECDL                                         04705099
047060*MACRO-I                                                          04706099
047070        AND L000-AQPTCCTP NOT = NULL                              04707099
047080*MACRO-E                                                          04708099
047090* Direccionar los datos de la CCT leidos por eCDL y mover el      04709099
047100* puntero al area de punteros                                     04710099
047110        SET ADDRESS OF F030-CAQF030 TO L000-AQPTCCTP              04711099
047120        MOVE L000-AQPTCCTC TO L310-CAQF030AP                      04712099
047130     ELSE                                                         04713099
047140*P1000->                                                          04714099
047150*       IF W-TERM-TCPIP = 'TCPI' OR 'AQTF'                        04715099
047160        IF W-TERM-TCPIP = 'AQTF'                                  04716099
047170*P1000<-                                                          04717099
047180           MOVE T040-TRANID        TO L310-AQARGMNT               04718099
047190        ELSE                                                      04719099
047200           MOVE EIBTRNID           TO L310-AQARGMNT               04720099
047210        END-IF                                                    04721099
047220*                                                                 04722099
047230        MOVE '0'                TO  L310-AQCODOP1                 04723099
047240        MOVE '1'                TO  L310-AQCODOP2                 04724099
047250*                                                                 04725099
047260        IF L300-AQCODOPE  = 'S'                                   04726099
047270           MOVE L300-AQTRANRE   TO L310-AQARGMNT                  04727099
047280        END-IF                                                    04728099
047290*                                                                 04729099
047300        EXEC CICS LINK PROGRAM ('RAQW311')                        04730099
047310             COMMAREA (AREA-CAQL310) RESP (COD-RESP)              04731099
047320        END-EXEC                                                  04732099
047330*                                                                 04733099
047340        IF L310-AQCODRET EQUAL '00'                               04734099
047350           SET ADDRESS OF F030-CAQF030 TO L310-CAQF030A           04735099
047360        ELSE                                                      04736099
047370           IF L310-AQCODRET EQUAL '01'                            04737099
047380              IF F060-TERM-FINANCIERO AND L100-ESTADO-INICIO      04738099
047390                 AND L100-AQ1DCASO = 1                            04739099
047400                 MOVE C-TRANS-INVALIDA TO L100-AQ1ABNCD           04740099
047410                 MOVE C-E TO W-RESPUESTA                          04741099
047420                 PERFORM 049-ENVIAR-RESPUESTA                     04742099
047430                 MOVE '01-CCT-ACT'  TO  L392-FILLER(1:10)         04743099
047440*A271 26/07/04 INICIO                                             04744099
047450*                PERFORM 124-ESBORRA-REGIS-SCR-TASCA              04745099
047460*A271 26/07/04 FINAL                                              04746099
047470*tracet->                                                         04747099
047480                 IF WS-TRACE > '0'                                04748099
047490                    MOVE 'END-RAQW001-04' TO WS-AQNBDTRA          04749099
047500                    MOVE L100-AQ1DCASO    TO WS-AQ1DCASO          04750099
047510                    STRING                                        04751099
047520                      '<<==== Tran/estado/caso|ret: '             04752099
047530                       F030-AQ3TRNID '/'                          04753099
047540                       L100-AQ1ESTAD '/' WS-AQ1DCASO '|'          04754099
047550                       L300-AQCDFURE                              04755099
047560                       DELIMITED BY SIZE  INTO WS-AQINFORM        04756099
047570                    END-STRING                                    04757099
047580                    PERFORM 131-TRACE-TECNIC                      04758099
047590                 END-IF                                           04759099
047600*tracet<-                                                         04760099
047610                 EXEC CICS RETURN END-EXEC                        04761099
047620              ELSE                                                04762099
047630                 MOVE C-CCT-NO-EXISTE TO L100-AQ1ABNCD            04763099
047640                 MOVE F030-AQ3TRNID   TO L045-AQTXMENS (1)        04764099
047650                 SET SW-ABEND-ARQUITECTURAL TO TRUE               04765099
047660                 PERFORM 037-FORMATEAR-MENSAJE-VARIABLE           04766099
047670                 PERFORM 099-ABEND-PROC                           04767099
047680              END-IF                                              04768099
047690           ELSE                                                   04769099
047700              MOVE L310-MSGABEND  TO L100-AQ1ABNCD                04770099
047710              MOVE L310-AQ1EIBFN  TO L100-AQ1EIBFN                04771099
047720              MOVE L310-AQ1EIBRC  TO L100-AQ1EIBRC                04772099
047730              MOVE L310-AQ1EIBRS  TO L100-AQ1EIBRS                04773099
047740              SET SW-ABEND-ARQUITECTURAL TO TRUE                  04774099
047750              PERFORM 099-ABEND-PROC                              04775099
047760           END-IF                                                 04776099
047770        END-IF                                                    04777099
047780     END-IF                                                       04778099
047790*I093->                                                           04779099
047800*    Guardar indicador LOPD transaccion en curso                  04780099
047810*I093<-                                                           04781099
047820     MOVE F030-AQCDFUNC(03) TO SW-CONTROL-LOPD                    04782099
047830     .                                                            04783099
047840*                                                                 04784099
047850*----------------------------------------------------------------*04785099
047860*    - control de funcions                                       *04786099
047870*----------------------------------------------------------------*04787099
047880 023-CONTROL-DE-FUNCIONS.                                         04788099
047890*------------------------                                         04789099
047900*tracet->                       +                                 04790099
047910     IF WS-TRACE > '1'                                            04791099
047920        MOVE '023-CONTROL-DE-FUNCIONS.        ' TO WS-AQNBDTRA    04792099
047930        PERFORM 131-TRACE-TECNIC                                  04793099
047940     END-IF                                                       04794099
047950*tracet<-                                                         04795099
047960*--> controlar si indicadors de funcions de faq030 estan activats 04796099
047970     IF F030-AQCDFUNC(100)  =  'S'                                04797099
047980        IF F030-AQCDFUNC(99)  =  L100-AQIDCICS                    04798099
047990           IF F030-AQCDFUNC(1) = 'S'                              04799099
048000              MOVE 1  TO SW-ACCES-AUDIT                           04800099
048010           END-IF                                                 04801099
048020           IF F030-AQCDFUNC(2) = 'S'                              04802099
048030              MOVE 1  TO SW-ACCES-4ULLS                           04803099
048040           END-IF                                                 04804099
048050        ELSE                                                      04805099
048060           MOVE 1  TO SW-ACCES-4ULLS                              04806099
048070           MOVE 1  TO SW-ACCES-AUDIT                              04807099
048080        END-IF                                                    04808099
048090     ELSE                                                         04809099
048100        MOVE 1  TO SW-ACCES-4ULLS                                 04810099
048110        MOVE 1  TO SW-ACCES-AUDIT                                 04811099
048120     END-IF.                                                      04812099
048130*                                                                 04813099
048140*                                                                 04814099
048150*----------------------------------------------------------------*04815099
048160*    - LECTURA DEL REGISTRE DE CAMPS DISCRETS                    *04816099
048170*----------------------------------------------------------------*04817099
048180 024-LLEGIR-ARXIU-FAQ150.                                         04818099
048190*------------------------                                         04819099
048200*tracet->                       +                                 04820099
048210     IF WS-TRACE > '1'                                            04821099
048220        MOVE '024-LLEGIR-ARXIU-FAQ150.        ' TO WS-AQNBDTRA    04822099
048230        PERFORM 131-TRACE-TECNIC                                  04823099
048240     END-IF                                                       04824099
048250*tracet<-                                                         04825099
048260*--> ACCES AL MòDUL DE LECTURA ARXIU FAQ150                       04826099
048270*                                                                 04827099
048280     MOVE 'RAQW603 '    TO  L310-AQCALPGM                         04828099
048290     MOVE 'L0'          TO  L310-AQCODOPE                         04829099
048300     MOVE '  '          TO  L310-AQCODRET                         04830099
048310     MOVE W-AQ1TRANT    TO  L310-AQARGMNT(1:4)                    04831099
048320                                                                  04832099
048330     EXEC CICS LINK PROGRAM ('RAQW603') RESP (COD-RESP)           04833099
048340          COMMAREA (AREA-CAQL310)                                 04834099
048350     END-EXEC                                                     04835099
048360                                                                  04836099
048370     MOVE L310-CAQF150P TO L100-AQPTAUDI                          04837099
048380     MOVE 1 TO SW-CONTROL-AUDIT                                   04838099
048390*                                                                 04839099
048400*-->  Si el acceso no es correcto se anula el tipo de solucion    04840099
048410*-->  y el puntero al registro de AUDIT/TRAILS                    04841099
048420*                                                                 04842099
048430     IF COD-RESP NOT = DFHRESP (NORMAL)                           04843099
048440        MOVE 0 TO L310-CAQF150P                                   04844099
048450        MOVE 0 TO L100-AQPTAUDI                                   04845099
048460        MOVE 0 TO SW-CONTROL-AUDIT                                04846099
048470     END-IF                                                       04847099
048480                                                                  04848099
048490     IF L310-AQCODRET NOT = '  '                                  04849099
048500        MOVE 0 TO L310-CAQF150P                                   04850099
048510        MOVE 0 TO L100-AQPTAUDI                                   04851099
048520        MOVE 0 TO SW-CONTROL-AUDIT                                04852099
048530     END-IF.                                                      04853099
048540                                                                  04854099
048550*----------------------------------------------------------------*04855099
048560*         SE MONTA EL AREA CAQL999 PARA EJECUTAR EL TRACE        *04856099
048570*         DESPUES DEL RECEIVE DE T.F.                            *04857099
048580*----------------------------------------------------------------*04858099
048590 025-TRACE-RECEIVE.                                               04859099
048600*------------------                                               04860099
048610*tracet->                       +                                 04861099
048620     IF WS-TRACE > '1'                                            04862099
048630        MOVE '025-TRACE-RECEIVE.              ' TO WS-AQNBDTRA    04863099
048640        PERFORM 131-TRACE-TECNIC                                  04864099
048650     END-IF                                                       04865099
048660*tracet<-                                                         04866099
048670     IF F060-TERM-FINANCIERO                                      04867099
048680        MOVE 'TR'            TO L310-AQCODOPE                     04868099
048690        INITIALIZE W001-CAQW001                                   04869099
048700        MOVE W-LONG-RECEIVE  TO W001-LONGRECE                     04870099
048710        PERFORM 040-LINK-RAQW005                                  04871099
048720     END-IF.                                                      04872099
048730*                                                                 04873099
048740*----------------------------------------------------------------*04874099
048750*    - OBTENER DATOS DE TRANSACCION ACTUAL                       *04875099
048760*----------------------------------------------------------------*04876099
048770 026-TRACTAR-CCT-ACTUAL.                                          04877099
048780*-----------------------                                          04878099
048790*tracet->                       +                                 04879099
048800     IF WS-TRACE > '1'                                            04880099
048810        MOVE '026-TRACTAR-CCT-ACTUAL.         ' TO WS-AQNBDTRA    04881099
048820        PERFORM 131-TRACE-TECNIC                                  04882099
048830     END-IF                                                       04883099
048840*tracet<-                                                         04884099
048850*--> COMPROVAR SI ES TRANSACCIó QUE POT SER REALITZADA PER        04885099
048860*              UN AGENT FINANCER                                  04886099
048870     MOVE F030-AQ3IND04  TO  L100-AQ1STLIB                        04887099
048880     MOVE F030-AQ3TIP04  TO  L100-AQ1STIMP                        04888099
048890     IF F060-TERM-3270   AND  EIBTRNID NOT = 'AQ72'               04889099
048900        IF F030-AQ3IND04  = '1'                                   04890099
048910           IF F030-AQ3TIP04  =  EIBAID                            04891099
048920              MOVE '1'  TO  L100-AQ1STIMP                         04892099
048930           END-IF                                                 04893099
048940        ELSE                                                      04894099
048950           MOVE '0'  TO  L100-AQ1STIMP                            04895099
048960        END-IF                                                    04896099
048970     END-IF                                                       04897099
048980     IF F060-TERM-FINANCIERO                                      04898099
048990        IF F030-AQ3IND04  = '1'                                   04899099
049000           IF F030-AQ3TIP04  =  T040-TECLA-FUNCION                04900099
049010              MOVE '1'  TO  L100-AQ1STIMP                         04901099
049020           ELSE                                                   04902099
049030              MOVE '0'  TO  L100-AQ1STIMP                         04903099
049040           END-IF                                                 04904099
049050        ELSE                                                      04905099
049060           MOVE '0'  TO  L100-AQ1STIMP                            04906099
049070        END-IF                                                    04907099
049080     END-IF                                                       04908099
049090*                                                                 04909099
049100*--> COMPROBAR ESTADO DE LA TRANSACCION                           04910099
049110*                                                                 04911099
049120*--> Si es una transaccion de Arquitectura y esta inactiva        04912099
049130*--> se cambia el indicador de activad y se graba un aviso en     04913099
049140*--> el LOG de arquitectura                                       04914099
049150*                                                                 04915099
049160     IF F030-AQ3APLIC = 'AQ  '                                    04916099
049170        IF F030-TRN-INACTIVA                                      04917099
049180           MOVE 'S'               TO F030-AQ3INDAC                04918099
049190           MOVE 'V'               TO L085-AQCODOPE                04919099
049200           MOVE C-AVISO-TRANS-ARQ TO L085-AQ4CLAVE                04920099
049210           MOVE F030-AQ3TRNID     TO L085-AQTXMENS(1)             04921099
049220           PERFORM 047-LLAMADA-RAQW085                            04922099
049230           MOVE L085-AQTXME77     TO L145-AQMSGTXT                04923099
049240           PERFORM 048-GRABAR-LOG                                 04924099
049250           INITIALIZE L145-CAQL145                                04925099
049260        END-IF                                                    04926099
049270     END-IF                                                       04927099
049280     IF F030-AQ3DABAX = ZEROS                                     04928099
049290        IF F030-TRN-ACTIVA                                        04929099
049300            PERFORM 058-MOVER-DATOS-CCT                           04930099
049310        ELSE                                                      04931099
049320            IF F060-TERM-FINANCIERO                               04932099
049330                MOVE C-TRANS-INACT TO L100-AQ1ABNCD               04933099
049340                MOVE C-E TO W-RESPUESTA                           04934099
049350                PERFORM 049-ENVIAR-RESPUESTA                      04935099
049360                MOVE '02-CCT-ACT'  TO  L392-FILLER(1:10)          04936099
049370*A271 26/07/04 INICIO                                             04937099
049380*               PERFORM 124-ESBORRA-REGIS-SCR-TASCA               04938099
049390*A271 26/07/04 FINAL                                              04939099
049400*tracet->                                                         04940099
049410                IF WS-TRACE > '0'                                 04941099
049420                   MOVE 'END-RAQW001-05' TO WS-AQNBDTRA           04942099
049430                   MOVE L100-AQ1DCASO    TO WS-AQ1DCASO           04943099
049440                   STRING                                         04944099
049450                     '<<==== Tran/estado/caso|ret: '              04945099
049460                      F030-AQ3TRNID '/'                           04946099
049470                      L100-AQ1ESTAD '/' WS-AQ1DCASO '|'           04947099
049480                      L300-AQCDFURE                               04948099
049490                      DELIMITED BY SIZE  INTO WS-AQINFORM         04949099
049500                   END-STRING                                     04950099
049510                   PERFORM 131-TRACE-TECNIC                       04951099
049520                END-IF                                            04952099
049530*tracet<-                                                         04953099
049540                EXEC CICS RETURN END-EXEC                         04954099
049550            ELSE                                                  04955099
049560                IF L100-ESTADO-INICIO OR                          04956099
049570                   (EIBAID NOT = DFHPF3 AND DFHPF11)              04957099
049580                     MOVE C-TRANS-INACT TO L100-AQ1ERRCD          04958099
049590                     PERFORM 031-FINAL                            04959099
049600                END-IF                                            04960099
049610            END-IF                                                04961099
049620        END-IF                                                    04962099
049630     ELSE                                                         04963099
049640        IF F060-TERM-FINANCIERO AND L100-ESTADO-INICIO AND        04964099
049650           L100-AQ1DCASO = 1                                      04965099
049660           MOVE C-TRANS-INVALIDA TO L100-AQ1ABNCD                 04966099
049670           MOVE C-E TO W-RESPUESTA                                04967099
049680           PERFORM 049-ENVIAR-RESPUESTA                           04968099
049690           MOVE '03-CCT-ACT'  TO  L392-FILLER(1:10)               04969099
049700*A271 26/07/04 INICIO                                             04970099
049710*          PERFORM 124-ESBORRA-REGIS-SCR-TASCA                    04971099
049720*A271 26/07/04 FINAL                                              04972099
049730*tracet->                                                         04973099
049740           IF WS-TRACE > '0'                                      04974099
049750              MOVE 'END-RAQW001-06' TO WS-AQNBDTRA                04975099
049760              MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                04976099
049770              STRING                                              04977099
049780                '<<==== Tran/estado/caso|ret: '                   04978099
049790                 F030-AQ3TRNID '/'                                04979099
049800                 L100-AQ1ESTAD '/' WS-AQ1DCASO '|'                04980099
049810                 L300-AQCDFURE                                    04981099
049820                 DELIMITED BY SIZE  INTO WS-AQINFORM              04982099
049830              END-STRING                                          04983099
049840              PERFORM 131-TRACE-TECNIC                            04984099
049850           END-IF                                                 04985099
049860*tracet<-                                                         04986099
049870           EXEC CICS RETURN END-EXEC                              04987099
049880        ELSE                                                      04988099
049890           MOVE C-CCT-NO-EXISTE TO L100-AQ1ABNCD                  04989099
049900           MOVE F030-AQ3TRNID   TO L045-AQTXMENS (1)              04990099
049910           SET SW-ABEND-ARQUITECTURAL TO TRUE                     04991099
049920           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 04992099
049930           PERFORM 099-ABEND-PROC                                 04993099
049940        END-IF                                                    04994099
049950     END-IF                                                       04995099
049960*                                                                 04996099
049970*--> COMPROBAR COMPATIBILIDAD DEL TERMINAL CON LA TRANSACCION     04997099
049980*                                                                 04998099
049990*MLV-15-07-03 INICIO                                              04999099
050000*                                                                 05000099
050010*    IF (NOT L300-ENTORNO-ECDL)                                   05001099
050020*                                                                 05002099
050030*MLV-15-07-03 FINAL                                               05003099
050040*                                                                 05004099
050050*       IF ( F030-P-TERMINAL AND NOT F060-TERM-FINANCIERO ) OR    05005099
050060*          ( F030-P-3270     AND NOT F060-TERM-3270 )             05006099
050070*           MOVE C-ABEND-NO-COMPATIB TO L100-AQ1ABNCD             05007099
050080*           SET SW-ABEND-ARQUITECTURAL TO TRUE                    05008099
050090*           PERFORM 099-ABEND-PROC                                05009099
050100*       END-IF                                                    05010099
050110*    END-IF                                                       05011099
050120*                                                                 05012099
050130*<-M021                                                           05013099
050140*                                                                 05014099
050150*--> COMPROBAR ESTADO DE LA APLICACION                            05015099
050160*                                                                 05016099
050170*--> Si la aplicacion es Arquitectura no se comprueba el estado   05017099
050180*                                                                 05018099
050190     IF F030-AQ3APLIC NOT = 'AQ  '                                05019099
050200        PERFORM 059-COMPROVAR-ESTAT-APLICACIO                     05020099
050210        IF SW-APL-NO-EXISTE OR                                    05021099
050220           (SW-APL-INACTIVA AND (NOT SW-BD-SOLO-CONSULTA)) OR     05022099
050230           (SW-APL-INACTIVA AND SW-BD-SOLO-CONSULTA AND           05023099
050240            (F030-AQ3TIPUS NOT = 4))                              05024099
050250            IF F060-TERM-FINANCIERO                               05025099
050260                PERFORM 060-ENVIAR-RESPUESTA                      05026099
050270                MOVE '04-CCT-ACT'  TO  L392-FILLER(1:10)          05027099
050280*A271 26/07/04 INICIO                                             05028099
050290*               PERFORM 124-ESBORRA-REGIS-SCR-TASCA               05029099
050300*A271 26/07/04 FINAL                                              05030099
050310*tracet->                                                         05031099
050320                IF WS-TRACE > '0'                                 05032099
050330                   MOVE 'END-RAQW001-07' TO WS-AQNBDTRA           05033099
050340                   MOVE L100-AQ1DCASO    TO WS-AQ1DCASO           05034099
050350                   STRING                                         05035099
050360                     '<<==== Tran/estado/caso|ret: '              05036099
050370                      F030-AQ3TRNID '/'                           05037099
050380                      L100-AQ1ESTAD '/' WS-AQ1DCASO '|'           05038099
050390                      L300-AQCDFURE                               05039099
050400                      DELIMITED BY SIZE  INTO WS-AQINFORM         05040099
050410                   END-STRING                                     05041099
050420                   PERFORM 131-TRACE-TECNIC                       05042099
050430                END-IF                                            05043099
050440*tracet<-                                                         05044099
050450                EXEC CICS RETURN END-EXEC                         05045099
050460            ELSE                                                  05046099
050470                MOVE C-APLIC-CERRADA-ST TO L100-AQ1ABNCD          05047099
050480                SET SW-ABEND-ARQUITECTURAL TO TRUE                05048099
050490                PERFORM 099-ABEND-PROC                            05049099
050500            END-IF                                                05050099
050510        END-IF                                                    05051099
050520     END-IF                                                       05052099
050530     .                                                            05053099
050540*                                                                 05054099
050550*----------------------------------------------------------------*05055099
050560*    CONTROL DE ACCESO USUARIO/TRANSACCION                       *05056099
050570*----------------------------------------------------------------*05057099
050580 027-CONTROL-ACCESO-TRANSACCION.                                  05058099
050590*-------------------------------                                  05059099
050600*tracet->                       +                                 05060099
050610     IF WS-TRACE > '1'                                            05061099
050620        MOVE '027-CONTROL-ACCESO-TRANSACCION-a' TO WS-AQNBDTRA    05062099
050630        PERFORM 131-TRACE-TECNIC                                  05063099
050640     END-IF                                                       05064099
050650*tracet<-                                                         05065099
050660     EVALUATE TRUE                                                05066099
050670        WHEN L121-CANAL-NO-CONTROL-TRA                            05067099
050680           CONTINUE                                               05068099
050690        WHEN L121-CANAL-CONTROL-RACF                              05069099
050700           INITIALIZE CSLW055                                     05070099
050710           SET CSLW055-VERIFY-OP   TO TRUE                        05071099
050720           MOVE F060-AQ9VTAM       TO CSLW055-NETID               05072099
050730           MOVE L100-AQ1USCIC      TO CSLW055-USERID              05073099
050740           MOVE SPACES             TO CSLW055-PWD                 05074099
050750           EXEC CICS LINK PROGRAM('RSLW055')                      05075099
050760                COMMAREA(CSLW055)                                 05076099
050770                LENGTH(LENGTH OF CSLW055)                         05077099
050780                RESP(COD-RESP)                                    05078099
050790           END-EXEC                                               05079099
050800           IF COD-RESP NOT = DFHRESP (NORMAL)                     05080099
050810              PERFORM 033-INFORMAR-DATOS-ABEND                    05081099
050820           END-IF                                                 05082099
050830                                                                  05083099
050840           EVALUATE TRUE                                          05084099
050850              WHEN CSLW055-AUTH-USER                              05085099
050860                 CONTINUE                                         05086099
050870              WHEN OTHER                                          05087099
050880*M009->                                                           05088099
050890                 IF CSLW055-NOT-AUTH-USER                         05089099
050900                    SET L100-USUARIO-NO-AUTORIZADO TO TRUE        05090099
050910                 END-IF                                           05091099
050920*<-M009                                                           05092099
050930                 MOVE C-ABEND-CONT-USU-TRAN-1 TO L100-AQ1ABNCD    05093099
050940                 MOVE L100-AQ1USCIC           TO L045-AQTXMENS(1) 05094099
050950                 MOVE F060-AQ9VTAM            TO L045-AQTXMENS(2) 05095099
050960                 MOVE CSLW055-RESULT          TO L045-AQTXMENS(3) 05096099
050970                 PERFORM 037-FORMATEAR-MENSAJE-VARIABLE           05097099
050980                 SET SW-ABEND-ARQUITECTURAL TO TRUE               05098099
050990                 PERFORM 099-ABEND-PROC                           05099099
051000           END-EVALUATE                                           05100099
051010*MLV-11-11-03 INICIO                                              05101099
051020        WHEN L121-CANAL-CONTROL-RSLW060                           05102099
051030*J9715-I                                                          05103099
051040        WHEN L121-CONTROL-USER-TECNICO                            05104099
051050*J9715-F                                                          05105099
051060           INITIALIZE CSLW060                                     05106099
051070           SET CSLW060-VERIFY-OP TO TRUE                          05107099
051080*J9715-I                                                          05108099
051090*          MOVE L100-AQ1USCIC    TO CSLW060-USERID                05109099
051100           EVALUATE TRUE                                          05110099
051110              WHEN L121-CANAL-CONTROL-RSLW060                     05111099
051120                MOVE L100-AQ1USCIC    TO CSLW060-USERID           05112099
051130              WHEN L121-CONTROL-USER-TECNICO                      05113099
051140                MOVE L100-AQUSTECN    TO CSLW060-USERID           05114099
051150           END-EVALUATE                                           05115099
051160*J9715-F                                                          05116099
051170*MLV-10-10-05 INICIO                                              05117099
051180*          MOVE L000-AQCDTRAN    TO CSLW060-TRANID                05118099
051190           MOVE L100-AQ1TRANT    TO CSLW060-TRANID                05119099
051200*MLV-10-10-05 FINAL                                               05120099
051210           EXEC CICS LINK PROGRAM('RSLW060')                      05121099
051220                COMMAREA(CSLW060)                                 05122099
051230                LENGTH(LENGTH OF CSLW060)                         05123099
051240                RESP(COD-RESP)                                    05124099
051250           END-EXEC                                               05125099
051260           IF COD-RESP NOT = DFHRESP (NORMAL)                     05126099
051270              PERFORM 033-INFORMAR-DATOS-ABEND                    05127099
051280           END-IF                                                 05128099
051290*                                                                 05129099
051300           EVALUATE TRUE                                          05130099
051310              WHEN CSLW060-AUTH-USER                              05131099
051320                 CONTINUE                                         05132099
051330              WHEN CSLW060-NOT-AUTH-USER                          05133099
051340*M009->                                                           05134099
051350                 SET L100-USUARIO-NO-AUTORIZADO TO TRUE           05135099
051360*<-M009                                                           05136099
051370                 INITIALIZE L045-CAQL045                          05137099
051380                 MOVE C-ABEND-TRANS-NO-AUTORI TO L100-AQ1ABNCD    05138099
051390                 SET SW-ABEND-ARQUITECTURAL TO TRUE               05139099
051400                 PERFORM 099-ABEND-PROC                           05140099
051410              WHEN OTHER                                          05141099
051420                 MOVE C-ABEND-CONT-USU-TRAN-2 TO L100-AQ1ABNCD    05142099
051430                 MOVE CSLW060-USERID          TO L045-AQTXMENS(1) 05143099
051440                 MOVE CSLW060-TRANID          TO L045-AQTXMENS(2) 05144099
051450                 MOVE CSLW060-RESULT          TO L045-AQTXMENS(3) 05145099
051460                 PERFORM 037-FORMATEAR-MENSAJE-VARIABLE           05146099
051470*I039->                                                           05147099
051480                 SET L100-USUARIO-NO-AUTORIZADO TO TRUE           05148099
051490*<-I039                                                           05149099
051500                 SET SW-ABEND-ARQUITECTURAL   TO TRUE             05150099
051510                 PERFORM 099-ABEND-PROC                           05151099
051520           END-EVALUATE                                           05152099
051530*MLV-11-11-03 FINAL                                               05153099
051540        WHEN OTHER                                                05154099
051550           MOVE C-ABEND-COD-ACC-TRAN   TO L100-AQ1ABNCD           05155099
051560           MOVE L121-AQSWACTR          TO L045-AQTXMENS(1)        05156099
051570           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 05157099
051580           SET SW-ABEND-ARQUITECTURAL TO TRUE                     05158099
051590           PERFORM 099-ABEND-PROC                                 05159099
051600     END-EVALUATE                                                 05160099
051610                                                                  05161099
051620*AQES00378->                                                      05162099
051630*    Si estat=INICI, Prod TeWeb (canals=000, 002, 003) i no te    05163099
051640*    impresora financiera, comprova si la trn. la necessita       05164099
051650*    IF (L100-AQ1ESTAD = 'I'  AND L121-CANAL-OFICINAS  AND        05165099
051660*        L121-AQCDCPRO = '18' AND L100-AQIMPFIN NOT = 'S')        05166099
051670     IF (L100-AQ1ESTAD = 'I'                                      05167099
051680         AND (L121-CANAL-OFICINAS       OR                        05168099
051690              L121-CANAL-BCA-TELEFONO-P OR                        05169099
051700              L121-CANAL-BCA-TELEFONO-E)                          05170099
051710         AND L121-AQCDCPRO = '18'                                 05171099
051720         AND L100-AQIMPFIN NOT = 'S')                             05172099
051730                                                                  05173099
051740        MOVE SPACES            TO L100-AQ1RESPR                   05174099
051750        MOVE 'VI'              TO L310-AQCODOPE                   05175099
051760        INITIALIZE W001-CAQW001                                   05176099
051770        MOVE L100-AQ1TRANT     TO W001-AQTRANID                   05177099
051780        PERFORM 041-LINK-RAQW008                                  05178099
051790                                                                  05179099
051800        IF L310-MSGABEND NOT = SPACES                             05180099
051810           MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                   05181099
051820           MOVE 'RAQW008'      TO L045-AQTXMENS (1)               05182099
051830           MOVE L310-AQCODRET  TO L045-AQTXMENS (2)               05183099
051840           SET SW-ABEND-ARQUITECTURAL TO TRUE                     05184099
051850           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 05185099
051860           PERFORM 099-ABEND-PROC                                 05186099
051870        END-IF                                                    05187099
051880     END-IF                                                       05188099
051890*AQES00378<-                                                      05189099
051900     .                                                            05190099
051910*                                                                 05191099
051920*----------------------------------------------------------------*05192099
051930*    - COMPRUEBA SI LA TRANSACCION TIENE CONTROL 4-OJOS          *05193099
051940*      EXCEPTO CUANDO ES 3270 Y ESTADO INICIO                    *05194099
051950*    - SE INVOCA AL MODULO RQOW002                               *05195099
051960*    - LA LECTURA Y DIRECCIONAMIENTO DEL REGISTRO DE AUDIT/TRAIL *05196099
051970*      SE EFECTUA SI 3270 Y NO ES ESTADO INICIO, O TERMINAL FINC.*05197099
051980*----------------------------------------------------------------*05198099
051990 028-ACCES-A-4ULLS.                                               05199099
052000*------------------                                               05200099
052010*tracet->                       +                                 05201099
052020     IF WS-TRACE > '1'                                            05202099
052030        MOVE '028-ACCES-A-4ULLS.              ' TO WS-AQNBDTRA    05203099
052040        PERFORM 131-TRACE-TECNIC                                  05204099
052050     END-IF                                                       05205099
052060*tracet<-                                                         05206099
052070     INITIALIZE W001-CAQW001                                      05207099
052080     MOVE 'QU'       TO L310-AQCODOPE                             05208099
052090                                                                  05209099
052100     IF F060-TERM-FINANCIERO                                      05210099
052110        MOVE T040-TECLA-FUNCION  TO W001-TECLA                    05211099
052120     END-IF                                                       05212099
052130                                                                  05213099
052140     PERFORM 063-LINK-RAQW009                                     05214099
052150                                                                  05215099
052160     IF W001-TECLA  = 'S'                                         05216099
052170        MOVE  1  TO SW-CONTROL-4ULLS                              05217099
052180*AllowAQDrivenOnline4Eyes-I                                       05218099
052190*AQDrivenOnl4EyesNoInvProg-I                                      05219099
052200        SET notArchOnline4EyesSolution TO TRUE                    05220099
052210*AQDrivenOnl4EyesNoInvProg-E                                      05221099
052220        IF L100-AQ1STAUT = '0' AND EIBAID NOT = '3'               05222099
052230           MOVE L100-AQPTQULL TO W-PUNTER-COMP                    05223099
052240           SET ADDRESS OF FQO-FQO010 TO W-PUNTER-POINTER          05224099
052250           IF L100-AQCDQULL = 1 AND                               05225099
052260              FQO-QOCDLLAM OF FQO-FQO010 NOT = 'T'                05226099
052270              SET archOnline4EyesSolution TO TRUE                 05227099
052280           END-IF                                                 05228099
052290        END-IF                                                    05229099
052300*AllowAQDrivenOnline4Eyes-E                                       05230099
052310     ELSE                                                         05231099
052320        MOVE  0  TO SW-CONTROL-4ULLS                              05232099
052330     END-IF.                                                      05233099
052340                                                                  05234099
052350*----------------------------------------------------------------*05235099
052360*    -  CONTROLA EL NUCLEO CENTRAL DEL PROGRAMA                  *05236099
052370*----------------------------------------------------------------*05237099
052380 029-PROCESO-PROGRAMA.                                            05238099
052390*---------------------                                            05239099
052400*tracet->                       +                                 05240099
052410     IF WS-TRACE > '1'                                            05241099
052420        MOVE '029-PROCESO-PROGRAMA.           ' TO WS-AQNBDTRA    05242099
052430        PERFORM 131-TRACE-TECNIC                                  05243099
052440     END-IF                                                       05244099
052450*tracet<-                                                         05245099
052460*A310 MLV-14-07-05 INICIO                                         05246099
052470     IF L100-ESTADO-INICIO OR L100-ACCION-PROGRAMA                05247099
052480        MOVE SPACES TO L100-AQFIPAGI                              05248099
052490     END-IF                                                       05249099
052500*A310 MLV-14-07-05 FINAL                                          05250099
052510     IF L100-AQCDAGFI NOT = SPACES                                05251099
052520        PERFORM 054-LINK-ABANS-RAQW392                            05252099
052530        PERFORM 055-LINK-DESPRES-RAQW392                          05253099
052540     END-IF                                                       05254099
052550*A310 MLV-14-07-05 INICIO                                         05255099
052560*    IF L100-AQ1ESTAD  =  'I'                                     05256099
052570*       MOVE ' '   TO  L100-AQFIPAGI                              05257099
052580*    END-IF                                                       05258099
052590*A310 MLV-14-07-05 FINAL                                          05259099
052600                                                                  05260099
052610* A265 24/03/2004 INICIO                                          05261099
052620*    MOVE L100-AQ1ESTAD TO W-PRIMER-ESTADO                        05262099
052630* A265 24/03/2004 FINAL                                           05263099
052640     MOVE L100-AQ1ESTAD TO W-ESTADO-INICIAL                       05264099
052650     MOVE L100-AQ1DCASO TO W-CASO-ENTRADA                         05265099
052660     MOVE L100-AQ1APLIC TO W-APLICACION                           05266099
052670     MOVE L100-AQ1APLIC TO W-ENT-MENU-APLIC                       05267099
052680     MOVE L100-AQ1PNLIN TO W-PANTALLA                             05268099
052690     MOVE L100-AQ1ENTRA TO W-ENTRADA-APLIC                        05269099
052700     MOVE F030-AQ3PGMID TO W-PROGRAMA                             05270099
052710*    MOVE L100-AQ1MESAI TO W-TECLA-CICS-EURO                      05271099
052720                                                                  05272099
052730*JO040902                                                         05273099
052740     MOVE 0             TO L100-AQ1PTRAV                          05274099
052750*JO040902                                                         05275099
052760                                                                  05276099
052770     IF L100-AQ1NIVUS = '555'                                     05277099
052780         PERFORM 064-RECUPERA-MAPA                                05278099
052790     ELSE                                                         05279099
052800         SET L100-MES-INICIO TO TRUE                              05280099
052810         PERFORM 065-VERIF-AUTORIZ-ENTRADA                        05281099
052820*A310 MLV-14-07-05 INICIO                                         05282099
052830*        IF L100-AQ1ESTAD  =  'I'                                 05283099
052840*           MOVE ' '   TO  L100-AQFIPAGI                          05284099
052850*        END-IF                                                   05285099
052860         IF L100-ESTADO-INICIO OR L100-ACCION-PROGRAMA            05286099
052870            MOVE SPACES TO L100-AQFIPAGI                          05287099
052880         END-IF                                                   05288099
052890*A310 MLV-14-07-05 FINAL                                          05289099
052900*                                                                 05290099
052910*--> Obtener el area de 40 avisos                                 05291099
052920*                                                                 05292099
052930         MOVE +280 TO LONGET                                      05293099
052940         EXEC CICS GETMAIN SET (L100-AQ1PTRAV) FLENGTH (LONGET)   05294099
052950              INITIMG (C-SPACES) RESP (COD-RESP)                  05295099
052960              NOSUSPEND                                           05296099
052970         END-EXEC                                                 05297099
052980         IF COD-RESP NOT = DFHRESP (NORMAL)                       05298099
052990             PERFORM 033-INFORMAR-DATOS-ABEND                     05299099
053000         END-IF                                                   05300099
053010         MOVE L100-AQ1PTRAV          TO W-PUNTER-COMP             05301099
053020         SET ADDRESS OF CGTL015-AREA TO W-PUNTER-POINTER          05302099
053030*                                                                 05303099
053040*AZ2FA-I                                                          05304099
053050         IF L100-AUTORIZ-AZ2FA-NOTACCEPTED                        05305099
053060            SET L100-ACCION-TERMINAL                              05306099
053070*DA             L100-ESTADO-INICIO                                05307099
053080                TO TRUE                                           05308099
053090         END-IF                                                   05309099
053100*AZ2FA-E                                                          05310099
053110         PERFORM 066-FORMAT-DEFORM-MENS                           05311099
053120*                                                                 05312099
053130*MLV-13-05-2005 INICIO                                            05313099
053140         IF L100-AQ1ERRCD NOT = SPACES                            05314099
053150            SET SW-ERROR-DETECTADO-AQ TO TRUE                     05315099
053160         END-IF                                                   05316099
053170*MLV-13-05-2005 FINAL                                             05317099
053180*                                                                 05318099
053190          IF L100-AQAVISOS     = 'P'                              05319099
053200             IF EIBAID = DFHPF3 OR DFHPF11 OR DFHPF14 OR DFHPF6   05320099
053210                MOVE DFHENTER  TO EIBAID                          05321099
053220                MOVE EIBAID    TO L100-AQ1MESAI                   05322099
053230             END-IF                                               05323099
053240          END-IF                                                  05324099
053250                                                                  05325099
053260         IF L100-AQ1ABNCD NOT = SPACES                            05326099
053270            SET SW-ABEND-ARQUITECTURAL TO TRUE                    05327099
053280            PERFORM 099-ABEND-PROC                                05328099
053290         END-IF                                                   05329099
053300                                                                  05330099
053310         MOVE  0  TO  L100-AQPTL135                               05331099
053320                                                                  05332099
053330         IF F060-TERM-FINANCIERO OR                               05333099
053340            (F060-TERM-3270 AND (L100-ESTADO-CONTIN               05334099
053350            OR L100-ESTADO-CONFIR))                               05335099
053360*I022->                                                           05336099
053370*           IF W-ENTRADA-APLIC (1:4) NOT = 'MEN-'                 05337099
053380*              MOVE 'AM'    TO L310-AQCODOPE                      05338099
053390*              PERFORM 067-PREPARA-CAQL135                        05339099
053400*           END-IF                                                05340099
053410            IF W-ENTRADA-APLIC NOT = W-ENTRADA-MENU-APLIC         05341099
053420               MOVE 'AM'    TO L310-AQCODOPE                      05342099
053430               PERFORM 067-PREPARA-CAQL135                        05343099
053440            END-IF                                                05344099
053450*<-I022                                                           05345099
053460         END-IF                                                   05346099
053470                                                                  05347099
053480*        IF L100-AQ1ERRCD = SPACES AND                            05348099
053490*           (L100-AQCDQULL = 1 OR = 2 OR = 9 OR = 4)              05349099
053500*            PERFORM 175-PREPARA-CAQL150                          05350099
053510*        END-IF                                                   05351099
053520*                                                                 05352099
053530         IF L100-AQ1ERRCD NOT = SPACES                            05353099
053540* JCF-2-I                                                         05354099
053550* Asteriscamos JCF-I                                              05355099
053560* JCF-I                                                           05356099
053570*         IF L100-AQAVISOS = 'P' AND                              05357099
053580*            F060-TERM-3270                                       05358099
053590*            CONTINUE                                             05359099
053600*         ELSE                                                    05360099
053610* JCF-F                                                           05361099
053620* JCF-2-F                                                         05362099
053630*                                                                 05363099
053640*--> SI SE SOLICITO AUTORIZACION Y SE ANULA (YA SEA PULSANDO F3   05364099
053650*--> O ALCANZANDO EL MAXIMO DE INTENTOS -AQ1STJOR = A- SE ACTIVA  05365099
053660*--> EL INDICADOR DE GRABAR EN EL DIARIO.                         05366099
053670*                                                                 05367099
053680            IF L100-AQ1STJOR = 'A'                                05368099
053690               SET SW-GRABAR-DIARIO TO TRUE                       05369099
053700            END-IF                                                05370099
053710                                                                  05371099
053720* JVB310101 INI                                                   05372099
053730*   COMPROVA SI S'HA DE RESTAURAR LA TECLA DE PF                  05373099
053740*  JVB130503   PERFORM 17490-RESTAURAR-TECLA-PF-EURO              05374099
053750* JVB310101 FIN                                                   05375099
053760                                                                  05376099
053770            PERFORM 031-FINAL                                     05377099
053780* JCF-2-I                                                         05378099
053790* JCF-I                                                           05379099
053800*         END-IF                                                  05380099
053810* JCF-F                                                           05381099
053820* JCF-2-F                                                         05382099
053830         END-IF                                                   05383099
053840     END-IF                                                       05384099
053850*                                                                 05385099
053860*    No tratar tecla F6 si se esta en la transaccion AQ72         05386099
053870*    (introduccion del NIT y coordenadas), solo en terminales     05387099
053880*    emulacion 3270                                               05388099
053890*                                                                 05389099
053900*--> JO250998                                                     05390099
053910*                                                                 05391099
053920*    ID.ANTERIOR SI ES AUTORITZACIO CANVI MONEDA                  05392099
053930*    27.12.99 JO-AFEGIR IDIOMA IMPRESSIO                          05393099
053940*                                                                 05394099
053950*<-A326                                                           05395099
053960*    IF (F060-TERM-3270 AND EIBAID = DFHPF6) AND                  05396099
053970*       (NOT L100-VAL-DBLINE-INICIADA)       AND                  05397099
053980*       (NOT L100-VAL-DBLINE-RE)             AND                  05398099
053990*       (NOT L100-VAL-DBLINE-ANULADA)        AND                  05399099
054000*       (NOT L100-VAL-IDIOMA-INICIADA)       AND                  05400099
054010*       (NOT L100-VAL-IDIOMA-RE)             AND                  05401099
054020*       (NOT L100-VAL-IDIOMA-ANULADA)        AND                  05402099
054030*       (NOT L100-CONFIRMACION-MONEDA-SI)    AND                  05403099
054040*       (NOT L100-CONFIRMACION-MONEDA-OK)                         05404099
054050*       PERFORM 173-TRATA-PF6-RETORN                              05405099
054060*    END-IF                                                       05406099
054070*<-A326                                                           05407099
054080*                                                                 05408099
054090*--> JO030399  INICI - AVERIGUAR SI S'HA DE SOL.LICITAR EL        05409099
054100*                      NúMERO D'AGENT EN ALTES DE CONTRACTES      05410099
054110*                                                                 05411099
054120     IF F060-TERM-FINANCIERO  AND NOT L100-VAL-AGENT-ACABADA      05412099
054130         IF L100-AQ1STIMP = '1'                                   05413099
054140*           IF  L100-AQPTCPAD = 0                                 05414099
054150*               PERFORM 175-PREPARA-CAQL150                       05415099
054160*           END-IF                                                05416099
054170            PERFORM  068-SIES-CONTRACTE-AGENT                     05417099
054180         END-IF                                                   05418099
054190     END-IF                                                       05419099
054200*                                                                 05420099
054210*M002->                                                           05421099
054220*MLV-20-10-05 M002 INICIO                                         05422099
054230     IF (L121-CANAL-OFICINAS AND L121-AQCDCPRO = '18') AND        05423099
054240        F060-AQTPIMPF = C-IBM4722 AND                             05424099
054250        (F060-AQTPPTO = C-PUESTO-OS2 OR = C-PUESTO-OS22)          05425099
054260        PERFORM 069-COMPATIBILIDAD-IMPRESORA                      05426099
054270     END-IF                                                       05427099
054280*MLV-20-10-05 FINAL                                               05428099
054290*<-M002                                                           05429099
054300*p101a-> Para eCDL revisar indicador de Autorización              05430099
054310     IF L300-ENTORNO-ECDL                                         05431099
054320*       direccionar área eCDL.                                    05432099
054330        SET ADDRESS OF LE00-CAQLE00 TO L000-AQPTSESP              05433099
054340*p122-> Mover cód.autorización para poder traspasarlo a CGTL0010  05434099
054350        MOVE LE00-AQIDAUTR TO L101-AQIDAUTR                       05435099
054360*p122<-                                                           05436099
054370                                                                  05437099
054380        EVALUATE LE00-AQMDAUTH                                    05438099
054390           WHEN X'00'                                             05439099
054400           WHEN ' '                                               05440099
054410           WHEN '0'                                               05441099
054420*             autorizacion desactivada                            05442099
054430              SET L100-AUTH-SERV-NO       TO TRUE                 05443099
054440           WHEN '1'                                               05444099
054450*             autorizacion activada                               05445099
054460              SET L100-AUTH-SERV-SI       TO TRUE                 05446099
054470           WHEN '2'                                               05447099
054480*             Para rollout. Debe tener terminal activado en AQPA  05448099
054490              PERFORM 139A-AUTORIZ-X-TERMINAL                     05449099
054500*p115->                                                           05450099
054510           WHEN '3'                                               05451099
054520           WHEN '4'                                               05452099
054530*             Rollout BT21. Se mira si trx. está en tabla TG1103  05453099
054540              PERFORM 140A-AUTORIZ-X-TRANSACC                     05454099
054550*p115<-                                                           05455099
054560        END-EVALUATE                                              05456099
054570                                                                  05457099
054580*p122-> Revisar indicador de 'Plataforma Firma Digital'           05458099
054590        EVALUATE LE00-AQSWFIEV                                    05459099
054600           WHEN '0'                                               05460099
054610*             autorizacion desactivada                            05461099
054620              SET L100-AUTH-PLAT-FIRM-NO  TO TRUE                 05462099
054630           WHEN '1'                                               05463099
054640*p133-> Cheque si existe una excepción a solicitar la autorización05464099
054650* de Firma Digital                                                05465099
054660*             autorizacion activada                               05466099
054670*             SET L100-AUTH-PLAT-FIRM-SI  TO TRUE                 05467099
054680              PERFORM 144-CENTROEXP-PFD                           05468099
054690*p133<-                                                           05469099
054700           WHEN '2'                                               05470099
054710*             Para rollout. Debe tener terminal activado en AQPA  05471099
054720              PERFORM 139B-AUTORIZ-X-TERMINAL                     05472099
054730           WHEN '3'                                               05473099
054740           WHEN '4'                                               05474099
054750*             Rollout BT21. Se mira si trx. está en tabla TG1103  05475099
054760              PERFORM 140B-AUTORIZ-X-TRANSACC                     05476099
054770           WHEN OTHER                                             05477099
054780*             cualquier otro valor: autorizacion desactivada      05478099
054790              SET L100-AUTH-PLAT-FIRM-NO  TO TRUE                 05479099
054800        END-EVALUATE                                              05480099
054810*p122<-                                                           05481099
054820     END-IF                                                       05482099
054830*xxxx                                                             05483099
054840*p101a<-                                                          05484099
054850*                                                                 05485099
054860*M042->                                                           05486099
054870     IF (L121-CANAL-OFICINAS AND L121-AQCDCPRO = '18')            05487099
054880        IF L100-AQ1TRANT = 'TLD2' OR 'TLDA' OR 'EX6F'             05488099
054890              OR 'EXBC' OR 'TLF1' OR 'ATEF' OR 'TLD0' OR 'TFCP'   05489099
054900           IF F060-AQTPPTO = C-PUESTO-OS2 OR = C-PUESTO-OS22      05490099
054910              SET SW-GRABAR-DIARIO TO TRUE                        05491099
054920              SET SW-ERROR-ENTORNO-EJEC TO TRUE                   05492099
054930              MOVE 'JAQE261' TO L100-AQ1ERRCD                     05493099
054940              PERFORM 031-FINAL                                   05494099
054950           END-IF                                                 05495099
054960        END-IF                                                    05496099
054970     END-IF                                                       05497099
054980*<-M042                                                           05498099
054990*                                                                 05499099
055000*M021->                                                           05500099
055010*                                                                 05501099
055020     IF ( F030-P-TERMINAL AND NOT F060-TERM-FINANCIERO ) OR       05502099
055030        ( F030-P-3270     AND NOT F060-TERM-3270 )                05503099
055040          IF L300-ENTORNO-ECDL                                    05504099
055050             MOVE C-TERMI-NO-COMPATIB TO L100-AQ1ERRCD            05505099
055060             PERFORM 031-FINAL                                    05506099
055070          ELSE                                                    05507099
055080             SET SW-ABEND-ARQUITECTURAL TO TRUE                   05508099
055090             MOVE C-ABEND-NO-COMPATIB TO L100-AQ1ABNCD            05509099
055100             PERFORM 099-ABEND-PROC                               05510099
055110          END-IF                                                  05511099
055120     END-IF                                                       05512099
055130*                                                                 05513099
055140*<-M021                                                           05514099
055150*                                                                 05515099
055160     IF L100-ESTADO-INICIO AND L100-AQ1DCASO = 1                  05516099
055170        MOVE 'I'  TO  L100-AQECTANT                               05517099
055180     ELSE                                                         05518099
055190        IF L100-ESTADO-CONFIR                                     05519099
055200           MOVE L100-AQ1ESTAD TO L100-AQECTANT                    05520099
055210        ELSE                                                      05521099
055220           MOVE 'C'  TO  L100-AQECTANT                            05522099
055230        END-IF                                                    05523099
055240     END-IF                                                       05524099
055250                                                                  05525099
055260     IF F060-TERM-FINANCIERO                                      05526099
055270        IF L100-ESTADO-CONFIR                                     05527099
055280           MOVE L100-AQ1ESTAD TO L100-AQECTANT                    05528099
055290        ELSE                                                      05529099
055300           MOVE 'C'  TO  L100-AQECTANT                            05530099
055310        END-IF                                                    05531099
055320     END-IF                                                       05532099
055330                                                                  05533099
055340*                                                                 05534099
055350*--> JO030399  final                                              05535099
055360*                                                                 05536099
055370     PERFORM 070-INICIA-FAQ180-PAGINACIO                          05537099
055380*                                                                 05538099
055390*--> MLV200700 FINAL                                              05539099
055400*                                                                 05540099
055410*A265 20/04/04 INICIO                                             05541099
055420*                                                                 05542099
055430*    Si se ha producido un cambio de transaccion solicitado por la05543099
055440*    aplicacion, o por el usuario a traves del Fast-Path, o       05544099
055450*    como consecuencia de la solucitud de retorno a la transaccion05545099
055460*    anterior despues de navegar a una transaccion con relacion de05546099
055470*    Fast-Path con traspaso de datos, se invoca al Controlador de 05547099
055480*    Navegacion                                                   05548099
055490*                                                                 05549099
055500     IF L121-CANAL-NAVEGACION-SI                                  05550099
055510        IF L100-AQ1TRANT = L100-AQTRANTR                          05551099
055520*I045->                                                           05552099
055530*          CONTINUE                                               05553099
055540           IF L100-CAMBIO-POR-APLICACION                          05554099
055550              INITIALIZE LN09-CAQLN09                             05555099
055560              SET LN09-CAMBIO-TRANSACCION TO TRUE                 05556099
055570              PERFORM 071-NAVEGACION                              05557099
055580           ELSE                                                   05558099
055590              CONTINUE                                            05559099
055600           END-IF                                                 05560099
055610*<-I045                                                           05561099
055620        ELSE                                                      05562099
055630           IF L100-NO-HAY-CAMBIO OR L100-CAMBIO-POR-RETORNO OR    05563099
055640              L100-CAMBIO-POR-APLICACION                          05564099
055650              INITIALIZE LN09-CAQLN09                             05565099
055660              SET LN09-CAMBIO-TRANSACCION TO TRUE                 05566099
055670              PERFORM 071-NAVEGACION                              05567099
055680           END-IF                                                 05568099
055690        END-IF                                                    05569099
055700     END-IF                                                       05570099
055710*                                                                 05571099
055720*A265 20/04/04 FINAL                                              05572099
055730*                                                                 05573099
055740*AZ2FA-I                                                          05574099
055750*    IF F060-TERM-FINANCIERO OR L100-ESTADO-INICIO                05575099
055760     IF (F060-TERM-FINANCIERO OR L100-ESTADO-INICIO)              05576099
055770        AND                                                       05577099
055780*       If the user has a locked screen due to wrong 2FA          05578099
055790*       and she/he is navigating by a manual change of            05579099
055800*       transaction in the screen header, we do not wont to       05580099
055810*       invoke the current transaction, but to navigate out of it 05581099
055820*       so we add this condition in order to divert the flow      05582099
055830*       through the ELSE                                          05583099
055840*InvokeTargetOnEnd2FARefresh-I                                    05584099
055850      (                                                           05585099
055860*InvokeTargetOnEnd2FARefresh-E                                    05586099
055870       (L100-AUTORIZ-AZ2FA-NOTACCEPTED AND                        05587099
055880        L100-AQTRFAST = EIBTRNID)                                 05588099
055890       OR                                                         05589099
055900       L100-AUTORIZ-AZ2FA-END-REF                                 05590099
055910      )                                                           05591099
055920*InvokeTargetOnEnd2FARefresh-E                                    05592099
055930*AZ2FA-E                                                          05593099
055940*A265 18/04/04 INICIO                                             05594099
055950*    Para los canales que tienen navegacion, no se invocara al    05595099
055960*    programa de aplicacion cuando asi lo indique el controlador  05596099
055970*    de navegacion que ha sido llamado en el punto anterior       05597099
055980*       PERFORM 072-ENLAZAR-CON-APLIC                             05598099
055990        IF L121-CANAL-NAVEGACION-SI AND LN09-OK-NO-APLICACION     05599099
056000*A265 12/05/04 INICIO                                             05600099
056010*          CONTINUE                                               05601099
056020           SET SW-GRABAR-DIARIO TO TRUE                           05602099
056030*A265 12/05/04 FINAL                                              05603099
056040        ELSE                                                      05604099
056050           PERFORM 072-ENLAZAR-CON-APLIC                          05605099
056060        END-IF                                                    05606099
056070*A265 18/04/04 FINAL                                              05607099
056080     ELSE                                                         05608099
056090*                                                                 05609099
056100*AZ2FA-I                                                          05610099
056110        IF L100-AUTORIZ-AZ2FA-NOTACCEPTED AND                     05611099
056120           L100-AQTRFAST NOT = EIBTRNID   AND                     05612099
056130           L100-AQTRFAST NOT = SPACES                             05613099
056140*          We will be navigating out from EIBTRNID into           05614099
056150*          L100-AQTRFAST, so we deactivate the block              05615099
056160*          L100-AUTORIZ-AZ2FA-NOTACCEPTED                         05616099
056170           MOVE 0 TO L100-AQ1STAUT                                05617099
056180        END-IF                                                    05618099
056190*AZ2FA-E                                                          05619099
056200*--> MLV290598 INICIO                                             05620099
056210*                                                                 05621099
056220*        IF EIBAID = DFHPF3 OR DFHPF11 OR DFHPF14                 05622099
056230*                                                                 05623099
056240*    No tratar teclas standar si se esta en la transaccion AQ72   05624099
056250*    (introduccion del NIT y coordenadas), solo en terminales     05625099
056260*    emulacion 3270 de DB-Line.                                   05626099
056270*    NO TRACTAR TECLES DE FUNCIó QUAN S'ESTA EN OPERACIó DE       05627099
056280*    SOL.LICITAR EL NúMERO D'AGENT                                05628099
056290*                                                                 05629099
056300*    ID.ANTERIOR SI ES AUTORITZACIO CANVI MONEDA                  05630099
056310*                                                                 05631099
056320*                                                                 05632099
056330         IF (F060-TERM-3270) AND (NOT L100-SWITCH-TRANSACC) AND   05633099
056340            (NOT L100-VAL-DBLINE-INICIADA)                  AND   05634099
056350            (NOT L100-VAL-DBLINE-RE)                        AND   05635099
056360            (NOT L100-VAL-DBLINE-ANULADA)                   AND   05636099
056370            (NOT L100-VAL-IDIOMA-INICIADA)                  AND   05637099
056380            (NOT L100-VAL-IDIOMA-RE)                        AND   05638099
056390            (NOT L100-VAL-IDIOMA-ANULADA)                   AND   05639099
056400            (NOT L100-VAL-AGENT-INICIADA)                   AND   05640099
056410            (NOT L100-VAL-AGENT-RE)                         AND   05641099
056420            (NOT L100-VAL-AGENT-ANULADA)                    AND   05642099
056430            (NOT L100-CONFIRMACION-MONEDA-SI)               AND   05643099
056440            (NOT L100-CONFIRMACION-MONEDA-OK)               AND   05644099
056450*AZ2FA-I                                                          05645099
056460            (NOT L100-AUTORIZ-AZ2FA-NOTACCEPTED)            AND   05646099
056470            (NOT L100-AUTORIZ-AZ2FA-END)                    AND   05647099
056480*AZ2FA-E                                                          05648099
056490            (EIBAID = DFHPF3 OR DFHPF11 OR DFHPF14)               05649099
056500*                                                                 05650099
056510*--> MLV290598 FINAL                                              05651099
056520*                                                                 05652099
056530             IF L100-AQAVISOS NOT = 'P'                           05653099
056540                PERFORM 073-TRATA-PF-3270                         05654099
056550             END-IF                                               05655099
056560         ELSE                                                     05656099
056570*A326->                                                           05657099
056580*            PERFORM 074-PROCESO                                  05658099
056590            IF L121-CANAL-NAVEGACION-SI AND LN09-OK-NO-APLICACION 05659099
056600*          CONTINUE                                               05660099
056610               SET SW-GRABAR-DIARIO TO TRUE                       05661099
056620            ELSE                                                  05662099
056630               PERFORM 074-PROCESO                                05663099
056640            END-IF                                                05664099
056650*<-A326                                                           05665099
056660         END-IF                                                   05666099
056670*AZ2FA-I                                                          05667099
056680        IF L100-AUTORIZ-AZ2FA-NOTACCEPTED AND                     05668099
056690*DA        L100-AQTRFAST NOT = EIBTRNID   AND                     05669099
056700*DA        L100-AQTRFAST NOT = SPACES                             05670099
056710           L100-AQTRFAST NOT = EIBTRNID                           05671099
056720           MOVE SPACES TO L100-AQTRFAST                           05672099
056730        END-IF                                                    05673099
056740*AZ2FA-E                                                          05674099
056750     END-IF                                                       05675099
056760* A265 24/03/2004 Inicio                                          05676099
056770*    Si ha habido un cambio de transaccion como consecuencia de   05677099
056780*    una relacion de Fast-Path por tecla, se invoca al Controlador05678099
056790*    de navegacion para relizar, si corresponde, el traspaso de   05679099
056800*    datos y determinar si hay que llamar de nuevo a la aplicacion05680099
056810*    traspaso es de tipo total, para relizar la consulta          05681099
056820*                                                                 05682099
056830     IF (L121-CANAL-NAVEGACION-SI)                                05683099
056840        AND (L100-AQ1TRANT NOT = L100-AQTRANTR)                   05684099
056850*MLV-19-05-05 INICIO                                              05685099
056860*       AND (L100-CAMBIO-POR-TECLA)                               05686099
056870        AND (L100-CAMBIO-POR-TECLA OR L100-CAMBIO-POR-RELACION    05687099
056880*A326->                                                           05688099
056890             OR L100-CAMBIO-FAST-PATH-3270)                       05689099
056900*<-A326                                                           05690099
056910*BROADCAST4EYES-I                                                 05691099
056920        AND NOT L100-AUTORIZ-PEAU-DIST                            05692099
056930        AND NOT L100-AUTORIZ-PEAU-DIST-INIT                       05693099
056940        AND NOT L100-AUTORIZ-4OJOS-DIST                           05694099
056950        AND NOT L100-AUTORIZ-4OJOS-DIST-INIT                      05695099
056960*BROADCAST4EYES-E                                                 05696099
056970*MLV-19-05-05 FINAL                                               05697099
056980        INITIALIZE LN09-CAQLN09                                   05698099
056990        SET LN09-CAMBIO-TRANSACCION TO TRUE                       05699099
057000        PERFORM 071-NAVEGACION                                    05700099
057010        IF LN09-OK-SI-APLICACION                                  05701099
057020*          Se ha realizado traspaso de datos y es de tipo Total   05702099
057030*          por lo que se invoca de nuevo a la aplicacion simulando05703099
057040*          la consulta                                            05704099
057050*I018->                                                           05705099
057060           MOVE L100-AQ1ESTAD TO L100-AQECTANT                    05706099
057070           PERFORM 075-SALVAR-TRASPASO-TOTAL                      05707099
057080*<-I018                                                           05708099
057090           MOVE 'AM'    TO L310-AQCODOPE                          05709099
057100           PERFORM 067-PREPARA-CAQL135                            05710099
057110           PERFORM 076-INVOCA-PGM                                 05711099
057120        END-IF                                                    05712099
057130     END-IF                                                       05713099
057140* A265 24/03/2004 Final                                           05714099
057150     .                                                            05715099
057160*                                                                 05716099
057170*----------------------------------------------------------------*05717099
057180*    -  MARCAR A RAQW392 INICI TRANSACCIO                        *05718099
057190*----------------------------------------------------------------*05719099
057200 030-DESPRES-APLICA.                                              05720099
057210*-------------------                                              05721099
057220*tracet->                       +                                 05722099
057230     IF WS-TRACE > '1'                                            05723099
057240        MOVE '030-DESPRES-APLICA.             ' TO WS-AQNBDTRA    05724099
057250        PERFORM 131-TRACE-TECNIC                                  05725099
057260     END-IF                                                       05726099
057270*tracet<-                                                         05727099
057280     IF L100-AQTRACE  =  '1'                                      05728099
057290        PERFORM 125-DESPRES-APLICA                                05729099
057300     END-IF                                                       05730099
057310     .                                                            05731099
057320*                                                                 05732099
057330*----------------------------------------------------------------*05733099
057340*                                                                *05734099
057350*    -  CONTROLA LOS PASOS PARA FINALIZAR EL PROGRAMA            *05735099
057360*    -  CONTROL DE MENSAJES PENDIENTES                           *05736099
057370*                                                                *05737099
057380*----------------------------------------------------------------*05738099
057390 031-FINAL.                                                       05739099
057400*----------                                                       05740099
057410*tracet->                       +                                 05741099
057420     IF WS-TRACE > '1'                                            05742099
057430        MOVE '031-FINAL.                      ' TO WS-AQNBDTRA    05743099
057440        PERFORM 131-TRACE-TECNIC                                  05744099
057450     END-IF                                                       05745099
057460*tracet<-                                                         05746099
057470*--> ML010699 INICIO                                              05747099
057480*--> Comprobar si el canal admite solicitud de autorizacion       05748099
057490*--> (PEAU o 4-OJOS) o firma electronica                          05749099
057500*                                                                 05750099
057510     IF F060-TERM-FINANCIERO OR                                   05751099
057520        (F060-TERM-3270 AND (L100-ESTADO-CONTIN                   05752099
057530         OR L100-ESTADO-CONFIR))                                  05753099
057540*I022->                                                           05754099
057550*        IF W-ENTRADA-APLIC (1:4) NOT = 'MEN-'                    05755099
057560*           MOVE 'AM'    TO L310-AQCODOPE                         05756099
057570*           PERFORM 067-PREPARA-CAQL135                           05757099
057580*         END-IF                                                  05758099
057590         IF W-ENTRADA-APLIC NOT = W-ENTRADA-MENU-APLIC            05759099
057600            MOVE 'AM'    TO L310-AQCODOPE                         05760099
057610            PERFORM 067-PREPARA-CAQL135                           05761099
057620         END-IF                                                   05762099
057630*<-I022                                                           05763099
057640     END-IF                                                       05764099
057650*                                                                 05765099
057660     EVALUATE TRUE                                                05766099
057670     WHEN L100-TERMINAL-3270                                      05767099
057680          PERFORM 108-VERIF-AUTORIZ-SALIDA                        05768099
057690     WHEN L100-TERMINAL-TF                                        05769099
057700          IF L100-AQ1ERRCD = SPACES AND L100-AQ1ABNCD = SPACES    05770099
057710             PERFORM 108-VERIF-AUTORIZ-SALIDA                     05771099
057720          END-IF                                                  05772099
057730     END-EVALUATE                                                 05773099
057740*                                                                 05774099
057750*--> ML010699 FINAL                                               05775099
057760*                                                                 05776099
057770*--> FORZAR SIEMPRE ACCION TERMINAL.                              05777099
057780*--> FORZAR SIEMPRE ESTADO CONTINUACION ( SI NO ES CONFIRMACION ) 05778099
057790*                                                                 05779099
057800     IF L100-AQ1ERRCD NOT = SPACES                                05780099
057810         SET L100-ACCION-TERMINAL TO TRUE                         05781099
057820         IF NOT L100-ESTADO-CONFIR                                05782099
057830            SET L100-ESTADO-CONTIN TO TRUE                        05783099
057840         END-IF                                                   05784099
057850     END-IF                                                       05785099
057860*                                                                 05786099
057870*AZ2FA-I                                                          05787099
057880     IF L100-AUTORIZ-AZ2FA-ONGOING                                05788099
057890        AND L100-AQTRFAST = EIBTRNID                              05789099
057900        SET L100-ACCION-TERMINAL                                  05790099
057910            L100-ESTADO-INICIO TO TRUE                            05791099
057920     END-IF                                                       05792099
057930*AZ2FA-E                                                          05793099
057940*                                                                 05794099
057950*--> ACTUALIZAR DATOS TERMINAL                                    05795099
057960*                                                                 05796099
057970*    No actualizar datos del terminal cuando se solicita la vali- 05797099
057980*    dacion del NIT y coordenadas de Db-Line, i Núm. d'Agent      05798099
057990*                                                                 05799099
058000     IF L100-ESC-BD-TERM AND L100-AQ1ERRCD = SPACES AND           05800099
058010        L100-AQ1ABNCD = SPACES AND (NOT L100-NECESARIO-AUT) AND   05801099
058020        L100-AQSWFITR = 1 AND (NOT L100-VAL-DBLINE-INICIADA) AND  05802099
058030        (NOT L100-VAL-DBLINE-RE)  AND                             05803099
058040        (NOT L100-VAL-IDIOMA-RE)  AND                             05804099
058050        (NOT L100-VAL-IDIOMA-INICIADA)  AND                       05805099
058060        (NOT L100-VAL-AGENT-RE)   AND                             05806099
058070        (NOT L100-VAL-AGENT-INICIADA)                             05807099
058080         PERFORM 097-ACTUALIZA-TERMINAL                           05808099
058090     END-IF                                                       05809099
058100*                                                                 05810099
058110*--> Llamada a la exit de validaciones de salida                  05811099
058120*                                                                 05812099
058130     MOVE C-ESCRITURA TO L100-AQ1MESST                            05813099
058140*                                                                 05814099
058150*--> ML270499 INICIO                                              05815099
058160*                                                                 05816099
058170*    IF L100-DBORDER-DBDIRECT AND NOT L100-NECESARIO-FIRMAS AND   05817099
058180*       SW-APLICATIVO-LLAMADO AND                                 05818099
058190*       NOT L100-NECESARIO-AUT                                    05819099
058200*                                                                 05820099
058210     EVALUATE TRUE                                                05821099
058220     WHEN L121-CANAL-NO-CON-EXIT-SA                               05822099
058230          CONTINUE                                                05823099
058240     WHEN L121-CANAL-CONT-REBU103-S                               05824099
058250*M016->                                                           05825099
058260     WHEN L121-CANAL-CONT-REBU110-S                               05826099
058270*<-M016                                                           05827099
058280          IF SW-APLICATIVO-LLAMADO AND (NOT L100-NECESARIO-FIRMAS)05828099
058290*M016->                                                           05829099
058300*            PERFORM 10000-INVOCAR-REBU103                        05830099
058310             PERFORM 079-INVOCAR-EXIT-BE                          05831099
058320*<-M016                                                           05832099
058330             IF L100-AQ1ABNCD NOT = SPACES                        05833099
058340                SET SW-ABEND-APLICATIVO TO TRUE                   05834099
058350               PERFORM 099-ABEND-PROC                             05835099
058360             END-IF                                               05836099
058370          END-IF                                                  05837099
058380     END-EVALUATE                                                 05838099
058390*                                                                 05839099
058400*--> ML270499 FINAL                                               05840099
058410*                                                                 05841099
058420*--> 030399 AGENTS                                                05842099
058430*--> SI LA OPERACIó ES OK, S'HA SOL.LICITAT NúM. D'AGENT I LA     05843099
058440*--> TRANSACCIó APLICATIVA HA ACABAT BE, S'HA DE CRIDAR AL        05844099
058450*--> M,òDUL DE GRAVACIó DEL CONTRACTE I NúMERO D'AGENT.           05845099
058460*                                                                 05846099
058470*--> JO010699 GRAVACIO NUM.AGENT SI ES CORREUS I TRANSAC.ES ALTA  05847099
058480*    DE CONTRACTE                                                 05848099
058490*                                                                 05849099
058500* JO-11062004  QUAN ES AGENT CORREUS TORNAR A RESTAURAR INDICADOR 05850099
058510*                                                                 05851099
058520     IF L100-VAL-AGENT-CORREUS                                    05852099
058530        IF F030-AQ3IND04  = '1'                                   05853099
058540           IF F030-AQ3TIP04  =  L100-AQ1MESAI                     05854099
058550              MOVE '1'  TO  L100-AQ1STIMP                         05855099
058560           ELSE                                                   05856099
058570              MOVE '0'  TO  L100-AQ1STIMP                         05857099
058580           END-IF                                                 05858099
058590        ELSE                                                      05859099
058600           MOVE '0'  TO  L100-AQ1STIMP                            05860099
058610        END-IF                                                    05861099
058620     END-IF                                                       05862099
058630*                                                                 05863099
058640     IF L100-AQ1ERRCD = SPACES                                    05864099
058650        IF L100-AQ1STIMP = '1'                                    05865099
058660           IF L100-VAL-AGENT-CORREUS                              05866099
058670              IF L100-AQ1STAUT NOT = 9                            05867099
058680                 PERFORM 109-GRAVACIO-AGENTS                      05868099
058690              END-IF                                              05869099
058700           END-IF                                                 05870099
058710        END-IF                                                    05871099
058720     END-IF                                                       05872099
058730*                                                                 05873099
058740* JO-11062004  SI ES OK SI HIHA UN PEAU PENDENT NO GRAVAR AGENTS  05874099
058750     IF L100-AQ1STAUT  = 9                                        05875099
058760        CONTINUE                                                  05876099
058770     ELSE                                                         05877099
058780        IF L100-AQ1ERRCD = SPACES AND                             05878099
058790           L100-VAL-AGENT-OK       AND (EIBTRNID NOT = 'AQ72')    05879099
058800           PERFORM 109-GRAVACIO-AGENTS                            05880099
058810        END-IF                                                    05881099
058820     END-IF                                                       05882099
058830*                                                                 05883099
058840* JO-11062004  SI HIHA UN PEAU PENDENT NO RESTAURAR AGENTS        05884099
058850     IF L100-AQ1STAUT  = 9                                        05885099
058860        CONTINUE                                                  05886099
058870     ELSE                                                         05887099
058880        IF L100-VAL-AGENT-ACABADA  AND (EIBTRNID NOT = 'AQ72')    05888099
058890              PERFORM 082-RESTAURA-AGENTS                         05889099
058900        END-IF                                                    05890099
058910     END-IF                                                       05891099
058920*                                                                 05892099
058930*   27.12.99 JO-RESTAURA PETICIO IDIOMA                           05893099
058940     IF L100-VAL-IDIOMA-ACABADA  AND (EIBTRNID NOT = 'AQ72')      05894099
058950           PERFORM 083-RESTAURA-IDIOMA                            05895099
058960     END-IF                                                       05896099
058970*                                                                 05897099
058980*--> Si la operacion es OK, no se ha solicitado autorizacion,     05898099
058990*--> tipo de solucion 2 o 3 de 4-Ojos y canal requiere 4-ojos     05899099
059000*--> Control 4-ojos                                               05900099
059010*                                                                 05901099
059020     EVALUATE TRUE                                                05902099
059030     WHEN L121-CANAL-NO-CUATRO-OJOS                               05903099
059040          IF L100-AQCDQULL = 2 OR = 3 OR = 9  OR = 4              05904099
059050             MOVE C-ABEND-4OJOS-STANDARD TO L100-AQ1ABNCD         05905099
059060             MOVE L100-AQCDQULL TO L045-AQTXMENS (1)              05906099
059070             PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               05907099
059080             SET SW-ABEND-ARQUITECTURAL TO TRUE                   05908099
059090             PERFORM 099-ABEND-PROC                               05909099
059100          END-IF                                                  05910099
059110*QO2->                                                            05911099
059120***  WHEN L121-CANAL-4OJOS-STANDARD                               05912099
059130     WHEN L121-CANAL-SI-CUATRO-OJOS                               05913099
059140*QO2<-                                                            05914099
059150*MLV11->                                                          05915099
059160*         Si la transaccion tiene asociada la solución 1 de 4Ojos 05916099
059170*         (Verificacion On-Line) y se ha aceptado el cambio al    05917099
059180*         tipo 3 (Lotes) y el modulo de 4-ojos ha dado por finali-05918099
059190*         zada la operacion, se cambia a tipo de solucion 3 ( c ) 05919099
059200*         y se inicializan los campos involucrados                05920099
059210*                                                                 05921099
059220*MLV12->                                                          05922099
059230*         IF L100-AQCDQULL = 1           AND                      05923099
059240*MLV12<-                                                          05924099
059250          IF L100-4OJOS-CONVERSION-ACEPT AND                      05925099
059260             L100-4OJOS-FIN-OPER                                  05926099
059270             MOVE SPACES TO L100-AQTR4OJO                         05927099
059280             MOVE SPACES TO L100-AQSW4OJO                         05928099
059290*jfm03->                                                          05929099
059300*            MOVE 0      TO L100-AQCONV4O                         05930099
059310             MOVE '0'    TO L100-AQCONV4O                         05931099
059320*jfm03<-                                                          05932099
059330             MOVE 3      TO L100-AQCDQULL                         05933099
059340          END-IF                                                  05934099
059350*                                                                 05935099
059360*MLV11<-                                                          05936099
059370          IF L100-AQ1ABNCD = SPACES AND L100-AQ1ERRCD = SPACES    05937099
059380             AND (NOT L100-NECESARIO-AUT)                         05938099
059390*JVB151101I                                                       05939099
059400             AND (NOT L100-CONFIRMAR-MONEDA)                      05940099
059410*JVB151101F                                                       05941099
059420             IF L100-AQCDQULL = 2 OR = 3 OR = 9 OR = 4            05942099
059430*M044->                                                           05943099
059440*               IF SW-ENTORN-EBRANCH = ' '                        05944099
059450                IF SW-NO-EJECUTAR-MACROS                          05945099
059460*<-M044                                                           05946099
059470                   PERFORM 110-4OJOS-STANDARD                     05947099
059480                END-IF                                            05948099
059490             END-IF                                               05949099
059500          END-IF                                                  05950099
059510     WHEN OTHER                                                   05951099
059520          MOVE C-ABEND-TIPO-4OJOS TO L100-AQ1ABNCD                05952099
059530          MOVE L121-AQSWCUOJ TO L045-AQTXMENS (1)                 05953099
059540          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  05954099
059550          SET SW-ABEND-ARQUITECTURAL TO TRUE                      05955099
059560          PERFORM 099-ABEND-PROC                                  05956099
059570     END-EVALUATE                                                 05957099
059580*                                                                 05958099
059590*--> LLAMADA A MODULO GENERACION DOCUMENTOS AFP.                  05959099
059600*--> AFP                                                          05960099
059610* jvb290502 la llamada para tf se resuelve en el modulo raqw020   05961099
059620*           se inserta una if para llamar unimamente desde 3270   05962099
059630*                                                                 05963099
059640*--> JV150101 INICIO                                              05964099
059650*                                                                 05965099
059660     IF L100-AQ1ERRCD  = SPACES AND                               05966099
059670        L100-AQ1ABNCD  = SPACES AND                               05967099
059680        L121-AQSWPAFP-AFP       AND                               05968099
059690        L100-ESTADO-CONTIN      AND                               05969099
059700        L100-ESC-DNF            AND                               05970099
059710        L100-AQ1MPTOD  NOT = ZEROS                                05971099
059720                                                                  05972099
059730        EXEC CICS LINK PROGRAM ('RAQW022')                        05973099
059740             COMMAREA (AREA-CAQL310)                              05974099
059750             RESP (COD-RESP)                                      05975099
059760        END-EXEC                                                  05976099
059770                                                                  05977099
059780        IF COD-RESP NOT = DFHRESP (NORMAL)                        05978099
059790           PERFORM 033-INFORMAR-DATOS-ABEND                       05979099
059800        END-IF                                                    05980099
059810*                                                                 05981099
059820* INI-JLM-10/01/03                                                05982099
059830        IF L100-AQ1ABNCD NOT = SPACES                             05983099
059840            SET SW-ABEND-ARQUITECTURAL TO TRUE                    05984099
059850            PERFORM 099-ABEND-PROC                                05985099
059860        END-IF                                                    05986099
059870* FIN-JLM-10/01/03                                                05987099
059880*                                                                 05988099
059890     END-IF                                                       05989099
059900*--> JV150101 FINAL                                               05990099
059910*                                                                 05991099
059920*--> ML180599 FINAL                                               05992099
059930*--> LINK AL MODUL DE TOTALITZACIO                                05993099
059940*                                                                 05994099
059950     PERFORM 102-TOTALITZACIO                                     05995099
059960*                                                                 05996099
059970* RTA-20-02-04 INICIO                                             05997099
059980     IF L310-CAQLA99 = ZEROS   AND  L100-AQAVISOS NOT = 'P'       05998099
059990*--> Si no hay avisos bloqueantes, obtenemos los de PEAU o 4ojos  05999099
060000*                                                                 06000099
060010*--> SI EL CANAL TIENE EL PARAMETRO ACTIVO, Y LA TRANSACCION TIENE06001099
060020*--> LA FUNCION ACTIVA, OBTENER AVISOS A POSTERIORI               06002099
060030*                                                                 06003099
060040        IF (L100-AQ1STAUT = '1' OR '9')           AND             06004099
060050           (W-ESTADO-INICIAL NOT = C-ESTADO-INICIO) AND           06005099
060060           L121-AQSWAVIS-S                      AND               06006099
060070           F409-AQSWSTAT(9) = 'A'               AND               06007099
060080*          F030-AQCDFUNC(9) = 'A'               AND               06008099
060090           L100-AQ1MESAI NOT = SPACES                             06009099
060100*I099->                                                           06010099
060110           AND SW-ERROR-NO-DETECTADO-AQ                           06011099
060120*I099<-                                                           06012099
060130*rafa                                                             06013099
060140*          PERFORM 089-OBT-CAMPOS-ICP                             06014099
060150*          IF L222-CORRECTO OR                                    06015099
060160*             L222-NO-ENCONTRADO                                  06016099
060170*          IF L135-AQCGPANT = '1'                                 06017099
060180*jo-21.10.2004                                                    06018099
060190           IF F030-AQCDFUNC(9) = 'A'                              06019099
060200              INITIALIZE AREA-CAQLA11                             06020099
060210*                                                                 06021099
060220* AVIS 'A' DE TIPUS PEAU; AVIS 'V' PEAU DE 4 ULLS                 06022099
060230*                                                                 06023099
060240              IF L100-AQ1STAUT = '1'                              06024099
060250                 MOVE 'A'       TO LA11-AQSWCNMU-IN               06025099
060260              ELSE                                                06026099
060270                 MOVE 'V'       TO LA11-AQSWCNMU-IN               06027099
060280              END-IF                                              06028099
060290*             PERFORM 090-OBTENER-AVISOS-P                        06029099
060300*                                                                 06030099
060310*INI-18.04.2005-JO                                                06031099
060320*                                                                 06032099
060330              IF SW-NO-ERROR-ENTORNO-EJEC                         06033099
060340*I020->                                                           06034099
060350                 AND L135-AQCTACCC IS NUMERIC                     06035099
060360*<-I020                                                           06036099
060370*jfm02->                                                          06037099
060380                 AND L135-AQRET376 = 'OK'                         06038099
060390*jfm02<-                                                          06039099
060400*p148-I                                                           06040099
060410*Llamar a este parrafo si realmente tiene este tipo de avisos     06041099
060420                 AND (WS-AQTIPAVI-V> 0 OR WS-AQTIPAVI-A > 0)      06042099
060430*p148-F                                                           06043099
060440                 PERFORM 091-OBTENIR-AVISOS                       06044099
060450              END-IF                                              06045099
060460*                                                                 06046099
060470*             PERFORM 091-OBTENIR-AVISOS                          06047099
060480*FI-18.04.2005-JO                                                 06048099
060490*                                                                 06049099
060500           END-IF                                                 06050099
060510        ELSE                                                      06051099
060520* RTA-17-10-03 INICIO                                             06052099
060530           IF ((NOT L100-VAL-DBLINE-INICIADA)       AND           06053099
060540               (NOT L100-VAL-DBLINE-RE)             AND           06054099
060550               (NOT L100-VAL-IDIOMA-INICIADA)       AND           06055099
060560               (NOT L100-VAL-IDIOMA-RE)             AND           06056099
060570               (NOT L100-VAL-AGENT-INICIADA)        AND           06057099
060580               (NOT L100-VAL-AGENT-RE)              AND           06058099
060590               L100-AQ1STAUT = '0'                  AND           06059099
060600               (W-ESTADO-INICIAL NOT = C-ESTADO-INICIO) AND       06060099
060610               L121-AQSWAVIS-S                      AND           06061099
060620               F409-AQSWSTAT(9) = 'A'               AND           06062099
060630*              F030-AQCDFUNC(9) = 'A'               AND           06063099
060640               L100-AQ1MESAI NOT = SPACES                         06064099
060650*MLV-13-05-2005-INICIO                                            06065099
060660               AND SW-ERROR-NO-DETECTADO-AQ)                      06066099
060670*MLV-13-05-2005-FINAL                                             06067099
060680*NewSAMGbasedWarnings-I                                           06068099
060690              OR evalNavigWarnings                                06069099
060700              IF evalNavigWarnings                                06070099
060701                 if L100-AQPTL135 = 0                             06070199
060702                    MOVE 'AM'    TO L310-AQCODOPE                 06070299
060703                    PERFORM 067-PREPARA-CAQL135                   06070399
060704                 END-IF                                           06070499
060705                 IF L121-CANAL-NAVEGACION-SI AND                  06070599
060706                    L100-AQ1PTRI = 0                              06070699
060707                    MOVE L100-AQ1MPRTI TO L100-AQ1PTRI            06070799
060708                 END-IF                                           06070899
060709              END-IF                                              06070999
060710*NewSAMGbasedWarnings-E                                           06071099
060711*rafa                                                             06071199
060712*             PERFORM 089-OBT-CAMPOS-ICP                          06071299
060713*             IF L135-AQCGPANT = '1'                              06071399
060714*             IF L222-CORRECTO OR                                 06071499
060715*                L222-NO-ENCONTRADO                               06071599
060716*             IF L135-AQCGPANT = '1'                              06071699
060717*JO-21.10.2004                                                    06071799
060718*P148-I                                                           06071899
060719              IF F030-AQCDFUNC(9) = 'A'                           06071999
060720                    AND SW-NO-ERROR-ENTORNO-EJEC                  06072099
060730                    AND L135-AQCTACCC IS NUMERIC                  06073099
060740                    AND L135-AQRET376 = 'OK'                      06074099
060750                    AND (L100-AQ1MESAI NOT = '7' AND '8'          06075099
060760                                 AND 'G' AND 'H' AND ' ')         06076099
060770                    AND L100-AQAVISOS NOT = 'T'                   06077099
060780*NewSAMGbasedWarnings-I                                           06078099
060790                                                AND 'J' AND 'H'   06079099
060800                 IF evalNavigWarnings AND warningTypeStringPending06080099
060810                    INITIALIZE AREA-CAQLA11                       06081099
060820                    PERFORM 091A-OBTENIR-AVISOS                   06082099
060830                 END-IF                                           06083099
060840*NewSAMGbasedWarnings-E                                           06084099
060850*Si la transaccion realmente tiene avisos se llama a parrafo      06085099
060860* 091-                                                            06086099
060870* Primero obtener los avisos GDPR                                 06087099
060880                 IF WS-AQTIPAVI-G > 0                             06088099
060890                    INITIALIZE AREA-CAQLA11                       06089099
060900                    SET SW-GDPR-POSTER TO TRUE                    06090099
060910                    MOVE 'G'   TO LA11-AQSWCNMU-IN                06091099
060920                    PERFORM 091-OBTENIR-AVISOS                    06092099
060930*Si ha encontrado GDPR y no es excepcion se bloquea la operativa  06093099
060940                    IF LA11-AQRCMAJ = 'OK' AND                    06094099
060950                       WS-CONT-AV-BLOQ > ZERO                     06095099
060960*Activar flag para que despues sea tratado por RAQW370 (3270)     06096099
060970                       SET L100-AV-BLOQ-POSTERI TO TRUE           06097099
060980*                   MOVE 'B'        TO L100-AQAVISOS              06098099
060990                       EVALUATE TRUE                              06099099
061000                         WHEN L100-ENTORNO-ECDL                   06100099
061010                            MOVE 'JAQB096'  TO L100-AQ1ABNCD      06101099
061020                            MOVE ZERO  TO L000-AQPTAUTH           06102099
061030                            SET SW-ABEND-APLICATIVO TO TRUE       06103099
061040                            PERFORM 099-ABEND-PROC                06104099
061050                         WHEN F060-TERM-3270                      06105099
061060                            EXEC CICS SYNCPOINT ROLLBACK END-EXEC 06106099
061070                            MOVE 'JAQE226'  TO L100-AQ1ERRCD      06107099
061080                            PERFORM 092-LINK-RAQW370              06108099
061090                            PERFORM 032-CCT-CONT                  06109099
061100                       END-EVALUATE                               06110099
061110                    ELSE                                          06111099
061120*El aviso GDPR ha sido excepcion, se tiene informativos se buscan 06112099
061130*NewSAMGbasedWarnings-I                                           06113099
061131*                      No 'a posteriori' GDPR                     06113199
061132*                      warnings found so far, hence we            06113299
061133*                      try to locate SAMG-based ones              06113399
061134*                      In case there are more than one SAMG-based 06113499
061135*                      warning enabled for the ongoing            06113599
061136*                      transaction and key, we will evaluate them 06113699
061137*                      with a priority like this:                 06113799
061138*                       1) 'J-type' aka "justifiable" ones,       06113899
061139*                          first, so the user might opt into the  06113999
061140*                          data even if the SAMG model told us    06114099
061141*                          that she/he has not actual permission  06114199
061142*                       2) 'P-type' aka completely forbidden, if  06114299
061143*                          no 'J-type' at all, afterwards         06114399
061144*                       3) 'U-type' aka "unadvisable" ones, only  06114499
061145*                          when no 'J-type' or 'P-type' at all    06114599
061146*                                                                 06114699
061147*                      SAMG-based data access restriction         06114799
061148*                      warnings are applicable only to real users 06114899
061149                       IF TECH-USER-UNKNOWN                       06114999
061150                          PERFORM CHECK-TECH-USER                 06115099
061151                       END-IF                                     06115199
061152                       IF NOT-TECH-USER                           06115299
061153*                                                                 06115399
061154                       INITIALIZE AREA-CAQLA11                    06115499
061155                       IF WS-AQTIPAVI-J > 0                       06115599
061156                          MOVE 'J' TO LA11-AQSWCNMU-IN            06115699
061157                       ELSE                                       06115799
061158                          IF WS-AQTIPAVI-P > 0                    06115899
061159                             MOVE 'P' TO LA11-AQSWCNMU-IN         06115999
061160                          ELSE                                    06116099
061161                             IF WS-AQTIPAVI-U > 0                 06116199
061162                                MOVE 'U' TO LA11-AQSWCNMU-IN      06116299
061163                             END-IF                               06116399
061164                          END-IF                                  06116499
061165                       END-IF                                     06116599
061166                       IF LA11-AQSWCNMU-IN NOT = '  '             06116699
061167                          PERFORM 091-OBTENIR-AVISOS              06116799
061168                          IF LA11-AQCDPLAN-CNT > 0                06116899
061169                            ADD 1 TO WS-CONT-AV-SAMG              06116999
061170                            IF LA11-AQSWCNMU-IN = 'P' OR 'J'      06117099
061171                               ADD 1 TO WS-CONT-AV-BLOQ           06117199
061172                               SET L100-AV-BLOQ-POSTERI TO TRUE   06117299
061173*                                                                 06117399
061174                               EVALUATE TRUE                      06117499
061175                                 WHEN L100-ENTORNO-ECDL           06117599
061176*                                   TO-DO                         06117699
061177                                    CONTINUE                      06117799
061178                                 WHEN F060-TERM-3270              06117899
061179                                    PERFORM 092-LINK-RAQW370      06117999
061180                                    PERFORM 032-CCT-CONT          06118099
061181                               END-EVALUATE                       06118199
061182                            END-IF                                06118299
061183                          END-IF                                  06118399
061184                       END-IF                                     06118499
061185*                                                                 06118599
061186                       END-IF    *> CLOSING IF NOT-TECH-USER      06118699
061187*NewSAMGbasedWarnings-E                                           06118799
061188                       IF WS-AQTIPAVI-D > 0                       06118899
061189                          MOVE 'D'   TO LA11-AQSWCNMU-IN          06118999
061190                          PERFORM 091-OBTENIR-AVISOS              06119099
061191                       END-IF                                     06119199
061192                       PERFORM 137B-AGREGAR-GDPR                  06119299
061193                    END-IF                                        06119399
061194                 ELSE                                             06119499
061195*NewSAMGbasedWarnings-I                                           06119599
061196*                   No 'a posteriori' GDPR                        06119699
061197*                   warnings found so far, hence we               06119799
061198*                   try to locate SAMG-based ones                 06119899
061199*                                                                 06119999
061200*                   SAMG-based data access restriction            06120099
061201*                   warnings are applicable only to real users    06120199
061202                    IF TECH-USER-UNKNOWN                          06120299
061203                       PERFORM CHECK-TECH-USER                    06120399
061204                    END-IF                                        06120499
061205                    IF NOT-TECH-USER                              06120599
061206*                                                                 06120699
061207                    INITIALIZE AREA-CAQLA11                       06120799
061208*                   In case there are more than one SAMG-based    06120899
061209*                   warning enabled for the ongoing               06120999
061210*                   transaction and key, we will evaluate them    06121099
061211*                   with a priority like this:                    06121199
061212*                    1) 'J-type' aka "justifiable" ones,          06121299
061213*                       first, so the user might opt into the     06121399
061214*                       data even if the SAMG model told us       06121499
061215*                       that she/he has not actual permission     06121599
061216*                    2) 'P-type' aka completely forbidden, if     06121699
061217*                       no 'J-type' at all, afterwards            06121799
061218*                    3) 'U-type' aka "unadvisable" ones, only     06121899
061219*                       when no 'J-type' or 'P-type' at all       06121999
061220                    IF WS-AQTIPAVI-J > 0                          06122099
061221                       MOVE 'J' TO LA11-AQSWCNMU-IN               06122199
061222                    ELSE                                          06122299
061223                       IF WS-AQTIPAVI-P > 0                       06122399
061224                          MOVE 'P' TO LA11-AQSWCNMU-IN            06122499
061225                       ELSE                                       06122599
061226                          IF WS-AQTIPAVI-U > 0                    06122699
061227                             MOVE 'U' TO LA11-AQSWCNMU-IN         06122799
061228                          END-IF                                  06122899
061229                       END-IF                                     06122999
061230                    END-IF                                        06123099
061231                    IF LA11-AQSWCNMU-IN NOT = '  '                06123199
061232                       PERFORM 091-OBTENIR-AVISOS                 06123299
061233                       IF LA11-AQCDPLAN-CNT > 0                   06123399
061234                         ADD 1 TO WS-CONT-AV-SAMG                 06123499
061235                         IF LA11-AQSWCNMU-IN = 'P' OR 'J'         06123599
061236                            ADD 1 TO WS-CONT-AV-BLOQ              06123699
061237                            SET L100-AV-BLOQ-POSTERI TO TRUE      06123799
061238*                                                                 06123899
061239                            EVALUATE TRUE                         06123999
061240                              WHEN L100-ENTORNO-ECDL              06124099
061241*                                TO-DO                            06124199
061242                                 CONTINUE                         06124299
061243                              WHEN F060-TERM-3270                 06124399
061244                                 PERFORM 092-LINK-RAQW370         06124499
061245                                 PERFORM 032-CCT-CONT             06124599
061246                            END-EVALUATE                          06124699
061247                         END-IF                                   06124799
061248                       END-IF                                     06124899
061249                    END-IF                                        06124999
061250                                                                  06125099
061251                    END-IF    *> CLOSING IF NOT-TECH-USER         06125199
061252*NewSAMGbasedWarnings-E                                           06125299
061253*Si no hay avisos GDPR intenta obtener avisos informativos si los 06125399
061254*tiene                                                            06125499
061255                    IF WS-AQTIPAVI-D > 0                          06125599
061256                       INITIALIZE AREA-CAQLA11                    06125699
061257                       MOVE 'D'   TO LA11-AQSWCNMU-IN             06125799
061258                       PERFORM 091-OBTENIR-AVISOS                 06125899
061259                    END-IF                                        06125999
061260                 END-IF                                           06126099
061270*             IF F030-AQCDFUNC(9) = 'A'                           06127099
061280*                INITIALIZE AREA-CAQLA11                          06128099
061290*                                                                 06129099
061300* AVIS 'D' DE TIPUS A POSTERIORI                                  06130099
061310*                                                                 06131099
061320*                MOVE 'D'       TO LA11-AQSWCNMU-IN               06132099
061330*                PERFORM 090-OBTENER-AVISOS-P                     06133099
061340*                                                                 06134099
061350*INI-18.04.2005-JO                                                06135099
061360*                                                                 06136099
061370*                IF SW-NO-ERROR-ENTORNO-EJEC                      06137099
061380*I020->                                                           06138099
061390*                   AND L135-AQCTACCC IS NUMERIC                  06139099
061400*<-I020                                                           06140099
061410*jfm02->                                                          06141099
061420*                   AND L135-AQRET376 = 'OK'                      06142099
061430*jfm02<-                                                          06143099
061440*                Se realiza la llamada al modulo de avisos aunque 06144099
061450*                la aplicacion haya detectado un error            06145099
061460*                   PERFORM 091-OBTENIR-AVISOS                    06146099
061470*                END-IF                                           06147099
061480*                                                                 06148099
061490*             PERFORM 091-OBTENIR-AVISOS                          06149099
061500*                                                                 06150099
061510*FI-18.04.2005-JO                                                 06151099
061520*                                                                 06152099
061530*             END-IF                                              06153099
061540              END-IF                                              06154099
061550*p148-F                                                           06155099
061560           END-IF                                                 06156099
061570* RTA-17-10-03 FINAL                                              06157099
061580        END-IF                                                    06158099
061590     END-IF                                                       06159099
061600*                                                                 06160099
061610* RTA-20-02-04 FINAL                                              06161099
061620*                                                                 06162099
061630*                                                                 06163099
061640*17-01-2005-jo  INICI                                             06164099
061650*-->SI HI HA ACTIVAT SW D'AVISOS A PRIORI, POSTERIORI ETC, SI     06165099
061660* TERMINAL ES 3270, S'ANUL.LA EL SW-D'AVIS DE MISSATGE (AQ44)     06166099
061670*                                                                 06167099
061680*I004-1 INICIO                                                    06168099
061690*    IF F060-TERM-3270 AND L100-AQAVISOS > ' '                    06169099
061700*       MOVE SPACES  TO  L100-AQ1ERRCD                            06170099
061710*       SET  L100-SW-NO-HAY-MENSAJES TO TRUE                      06171099
061720*    END-IF                                                       06172099
061730*                                                                 06173099
061740*    IF F060-TERM-3270 AND L310-CAQLA99  > 0                      06174099
061750*       MOVE SPACES  TO  L100-AQ1ERRCD                            06175099
061760*       SET  L100-SW-NO-HAY-MENSAJES TO TRUE                      06176099
061770*    END-IF                                                       06177099
061780*                                                                 06178099
061790     IF F060-TERM-3270 AND L100-AQAVISOS > ' '                    06179099
061800        AND L100-SW-HAY-MENSAJES                                  06180099
061810        MOVE SPACES  TO  L100-AQ1ERRCD                            06181099
061820        SET  L100-SW-NO-HAY-MENSAJES TO TRUE                      06182099
061830     END-IF                                                       06183099
061840*                                                                 06184099
061850     IF F060-TERM-3270 AND L310-CAQLA99  > 0                      06185099
061860        AND L100-SW-HAY-MENSAJES                                  06186099
061870        MOVE SPACES  TO  L100-AQ1ERRCD                            06187099
061880        SET  L100-SW-NO-HAY-MENSAJES TO TRUE                      06188099
061890     END-IF                                                       06189099
061900*I004-1 FINAL                                                     06190099
061910*                                                                 06191099
061920*17-01-2005-jo  FINAL                                             06192099
061930*                                                                 06193099
061940*--> SI TERMINAL 3270 Y EL INDICADOR DE MENSAJES PENDIENTES ESTA  06194099
061950*--> ACTIVO SE LLAMADA AL MODULO RAQW355                          06195099
061960*                                                                 06196099
061970     IF F060-TERM-3270 AND L100-SW-HAY-MENSAJES                   06197099
061980        PERFORM 021-ENVIO-MENSAJES                                06198099
061990     END-IF                                                       06199099
062000*                                                                 06200099
062010*A325->                                                           06201099
062020*P148-I                                                           06202099
062030*    PERFORM 111-CONTROL-LOPD                                     06203099
062040     IF L100-AQAVISOS NOT = 'T'                                   06204099
062050*NewSAMGbasedWarnings-I                                           06205099
062060*       'J' = There are actionable messages and all of them have  06206099
062061*             been answered positively                            06206199
062062*       'H' = There are actionable messages and some of them have 06206299
062063*             been answered negatively. Completely prohibited     06206399
062064*             warnings are answered negatively by default.        06206499
062065         AND 'J' AND 'H'                                          06206599
062066*NewSAMGbasedWarnings-E                                           06206699
062067         PERFORM 111-CONTROL-LOPD                                 06206799
062068     END-IF                                                       06206899
062069*P148-F                                                           06206999
062070*<-A325                                                           06207099
062080*                                                                 06208099
062090* LLAMADA AL CONTROLADOR DE PAGINACION PARA ALMACENAR PAGINAS     06209099
062100*                                                                 06210099
062110     IF L100-AQ1ABNCD = SPACES AND L100-AQ1ERRCD = SPACES AND     06211099
062120        SW-APLICATIVO-LLAMADO                                     06212099
062130        IF L100-ACCION-TERMINAL AND                               06213099
062140           ( (W-ULTIMO-ESTADO-LINK = C-ESTADO-CONTINUACION) OR    06214099
062150             (W-ULTIMO-ESTADO-LINK = C-ESTADO-INICIO AND          06215099
062160*M029->                                                           06216099
062170*             W-ULTIMO-CASO-LINK > 1) )                           06217099
062180              W-ULTIMO-CASO-LINK > 1)                       OR    06218099
062190             (W-ULTIMO-ESTADO-LINK = C-ESTADO-INICIO AND          06219099
062200              L100-HAY-MAS-DATOS) )                               06220099
062210*M029->                                                           06221099
062220            PERFORM 112-LINK-RAQWN08-AP                           06222099
062230        END-IF                                                    06223099
062240     END-IF                                                       06224099
062250*                                                                 06225099
062260*I004-1 INICIO                                                    06226099
062270*                                                                 06227099
062280*    IF F060-TERM-3270                                            06228099
062290*       IF L100-AQ1ERRCD  > SPACES OR                             06229099
062300*          L100-AQ1ABNCD  > SPACES                                06230099
062310*          IF L310-CAQLA99 NOT = ZEROS                            06231099
062320*             MOVE ' ' TO  L100-AQAVISOS                          06232099
062330*             MOVE 0   TO  L310-CAQLA99                           06233099
062340*          END-IF                                                 06234099
062350*       END-IF                                                    06235099
062360*    END-IF                                                       06236099
062370     IF F060-TERM-3270 AND L100-AQ1ABNCD > SPACES                 06237099
062380        AND L310-CAQLA99 > ZEROS                                  06238099
062390        MOVE ' ' TO  L100-AQAVISOS                                06239099
062400        MOVE 0   TO  L310-CAQLA99                                 06240099
062410     END-IF                                                       06241099
062420*                                                                 06242099
062430*I004-1 FINAL                                                     06243099
062440*                                                                 06244099
062450*A348.I                                                           06245099
062460*A348.pruebas.i                                                   06246099
062470*    IF L100-AQ1USCIC = 'U823254' OR L100-AQ1USCIC = 'U823575' OR 06247099
062480*       L100-AQ1USCIC = 'U823410' OR L100-AQ1USCIC = 'U823489' OR 06248099
062490*       L100-AQ1USCIC = 'U104407'                                 06249099
062500*A348.pruebas.f                                                   06250099
062510*--> GESTION DE FIRMA (LINK SEGURO)                               06251099
062520*    SE LLAMARA A ESTE MODULO SIEMPRE QUE ESTE ACTIVA LA FUNCION  06252099
062530*    DE LINK SEGURO POR ICP Y LOS PARAMETROS POR CANAL PERMITA    06253099
062540*    HACER EL LINK SEGURO                                         06254099
062550     IF F030-AQCDFUNC(17) = 'A' AND L121-AQSWLNKS-SI              06255099
062560        PERFORM 113-LINK-SEGURO                                   06256099
062570     END-IF                                                       06257099
062580*    END-IF                                                       06258099
062590*A348.F                                                           06259099
062600*--> GRABACION EN EL DIARIO ELECTRONICO                           06260099
062610*                                                                 06261099
062620*NewSAMGbasedWarnings-I                                           06262099
062630* We delay this until after the call to 066-FORMAT-DEFORM-MENS    06263099
062640* that is RAQW110 or RAQW020, so we audit the masked data and     06264099
062650* not the clear data when under data restriction access           06265099
062651*--> GRABACION EN EL DIARIO ELECTRONICO                           06265199
062652*                                                                 06265299
062653*    PERFORM 105-TRATAMIENTO-DIARIO                               06265399
062654*NewSAMGbasedWarnings-E                                           06265499
062655                                                                  06265599
062656     IF F060-TERM-3270                                            06265699
062657        IF L310-CAQLA99 NOT = ZEROS                               06265799
062658           IF L100-AQAVISOS = ' '                                 06265899
062659              MOVE 'P'        TO L100-AQAVISOS                    06265999
062660           END-IF                                                 06266099
062670        END-IF                                                    06267099
062680     END-IF                                                       06268099
062690*                                                                 06269099
062700*AllowAQDrivenOnline4Eyes-I                                       06270099
062710     IF archOnline4EyesSolution                                   06271099
062720        PERFORM 110-4OJOS-STANDARD                                06272099
062730*       RAQW009 will have filled L100-AQ1STAUT & L100-AQ1NUMAU(5) 06273099
062740*       so that RAQW110/RAQW020 act accordingly and they show the 06274099
062750*       4eyes panel.                                              06275099
062760        SET notArchOnline4EyesSolution TO TRUE                    06276099
062770     END-IF                                                       06277099
062780*AllowAQDrivenOnline4Eyes-E                                       06278099
062790*                                                                 06279099
062800*--> ENVIAR DATOS PANTALLA, DOCUMENTOS ETC.                       06280099
062810*                                                                 06281099
062820     PERFORM 066-FORMAT-DEFORM-MENS                               06282099
062830                                                                  06283099
062840*NewSAMGbasedWarnings-I                                           06284099
062850*--> GRABACION EN EL DIARIO ELECTRONICO                           06285099
062860*                                                                 06286099
062870     PERFORM 105-TRATAMIENTO-DIARIO                               06287099
062880*NewSAMGbasedWarnings-E                                           06288099
062881                                                                  06288199
062882*I004-1 INICIO                                                    06288299
062883*                                                                 06288399
062884*    IF F060-TERM-3270                                            06288499
062885*       IF L100-AQ1ERRCD  = SPACES AND                            06288599
062886*          L100-AQ1ABNCD  = SPACES                                06288699
062887*          IF L100-AQAVISOS = 'P'                                 06288799
062888*             PERFORM  092-LINK-RAQW370                           06288899
062889*          END-IF                                                 06288999
062890*       END-IF                                                    06289099
062900*    END-IF                                                       06290099
062910     IF F060-TERM-3270 AND L100-AQ1ABNCD = SPACES                 06291099
062920        AND L100-AQAVISOS = 'P'                                   06292099
062930*I099->                                                           06293099
062940*i43->                                                            06294099
062950****    AND SW-ERROR-NO-DETECTADO-AQ                              06295099
062960*i43<-                                                            06296099
062970* JCF-2-I                                                         06297099
062980* JCF-I                                                           06298099
062990*       AND L100-AQ1ERRCD = SPACES                                06299099
063000* JCF-F                                                           06300099
063010* JCF-2-F                                                         06301099
063020*I099<-                                                           06302099
063030        PERFORM 092-LINK-RAQW370                                  06303099
063040     END-IF                                                       06304099
063050*                                                                 06305099
063060*I004-1 INICIO                                                    06306099
063070*                                                                 06307099
063080*A325->                                                           06308099
063090*    IF L100-AQSWROLB-SI                                          06309099
063100*       PERFORM 105-TRATAMIENTO-DIARIO                            06310099
063110*    END-IF                                                       06311099
063120*<-A325                                                           06312099
063130*                                                                 06313099
063140* ACCES AL MODUL DE PAGINACIO PER EMMAGATZEMAR LA PAGINA          06314099
063150*                                                                 06315099
063160*                                                                 06316099
063170* JO.280404 INICI                                                 06317099
063180* ENVIAMENT DE MISSATGES QUAN ENTORN ES ECDL                      06318099
063190*                                                                 06319099
063200     IF L100-AQ1ABNCD = SPACES                                    06320099
063210        IF L100-SW-HAY-MENSAJES                                   06321099
063220           IF L300-ENTORNO-ECDL AND L121-CANAL-MENS-JUNTO-RES     06322099
063230              PERFORM 114-LINK-RAQW450                            06323099
063240           END-IF                                                 06324099
063250        END-IF                                                    06325099
063260     END-IF                                                       06326099
063270*                                                                 06327099
063280* JO.280404 FI                                                    06328099
063290*                                                                 06329099
063300*A265 24/03/2004 Inicio                                           06330099
063310*                                                                 06331099
063320*--> Se guarda informacion de la transaccion que se acaba de      06332099
063330*--> ejecutar, ya que es necesaria retomarla si se produce un     06333099
063340*--> cambio de transaccion en la siguiente ejecucion              06334099
063350*                                                                 06335099
063360     MOVE L100-AQ1TRANT TO L100-AQTRANTR                          06336099
063370     MOVE L100-AQ1ESTAD TO L100-AQESTANT                          06337099
063380     MOVE L100-AQ1DCASO TO L100-AQCASANT                          06338099
063390     MOVE L100-AQ1APLIC TO L100-AQAPLANT                          06339099
063400     MOVE L100-AQ1ENTRA TO L100-AQENTANT                          06340099
063410     MOVE L100-AQNPAGEN TO L100-AQPACANT                          06341099
063420     MOVE L100-AQNPAGUL TO L100-AQPULANT                          06342099
063430     MOVE L100-AQFIPAGI TO L100-AQFPGANT                          06343099
063440*                                                                 06344099
063450*A265 24/03/2004 Final                                            06345099
063460                                                                  06346099
063470*                                                                 06347099
063480     IF L100-AQ1ABNCD NOT = SPACES                                06348099
063490         SET SW-ABEND-ARQUITECTURAL TO TRUE                       06349099
063500         PERFORM 099-ABEND-PROC                                   06350099
063510     END-IF                                                       06351099
063520     SET L100-NO-SWITCH-TRANS TO TRUE                             06352099
063530*                                                                 06353099
063540* MLV021202 INICIO                                                06354099
063550* BORRAR LA COLA TS DE LOS MENSAJES VARIABLES                     06355099
063560* INI-JLM-13/01/03                                                06356099
063570*    MOVE EIBTRMID TO W-TERMID-TS                                 06357099
063580     MOVE L100-AQ1TERML   TO W-TERMID-TS                          06358099
063590* FIN-JLM-13/01/03                                                06359099
063600     EXEC CICS DELETEQ TS QUEUE (W-COLA) RESP (COD-RESP)          06360099
063610     END-EXEC                                                     06361099
063620* MLV021202 FINAL                                                 06362099
063630*                                                                 06363099
063640*JO-14.04.2005                                                    06364099
063650*                                                                 06365099
063660*    PERFORM 222-ESBORRAR-CUA-VARIABLES                           06366099
063670*                                                                 06367099
063680     PERFORM 103-ACTUALIZ-SCR                                     06368099
063690*                                                                 06369099
063700*tracet->                       +                                 06370099
063710     IF WS-TRACE > '1'                                            06371099
063720        MOVE 'RAQW001-031-FINAL. POS 103-ACT' TO WS-AQNBDTRA      06372099
063730        PERFORM 131-TRACE-TECNIC                                  06373099
063740     END-IF                                                       06374099
063750*tracet<-                                                         06375099
063760*tracet->                                                         06376099
063770     IF WS-TRACE > '0'                                            06377099
063780        MOVE 'RAQW001-031-END' TO WS-AQNBDTRA                     06378099
063790        MOVE L100-AQ1DCASO     TO WS-AQ1DCASO                     06379099
063800        STRING                                                    06380099
063810           '<----- Tran/estado/caso|ret: ' F030-AQ3TRNID '/'      06381099
063820            L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE       06382099
063830            DELIMITED BY SIZE  INTO WS-AQINFORM                   06383099
063840        END-STRING                                                06384099
063850        PERFORM 131-TRACE-TECNIC                                  06385099
063860     END-IF                                                       06386099
063870*tracet<-                                                         06387099
063880     IF F060-TERM-FINANCIERO                                      06388099
063890*                                                                 06389099
063900*P1008->                                                          06390099
063910*       IF NOT TERM-TCPIP                                         06391099
063920*          EXEC CICS SYNCPOINT END-EXEC                           06392099
063930*       END-IF                                                    06393099
063940*                                                                 06394099
063950        EXEC CICS SYNCPOINT END-EXEC                              06395099
063960*P1008<-                                                          06396099
063970     END-IF                                                       06397099
063980*                                                                 06398099
063990     MOVE '01-18-FINA'  TO  L392-FILLER(1:10)                     06399099
064000*A271 26/07/04 INICIO                                             06400099
064010*    PERFORM 124-ESBORRA-REGIS-SCR-TASCA                          06401099
064020*A271 26/07/04 FINAL                                              06402099
064030*                                                                 06403099
064040     IF F060-TERM-FINANCIERO                                      06404099
064050         EXEC CICS RETURN END-EXEC                                06405099
064060     ELSE                                                         06406099
064070         MOVE C-INDICADOR  TO L300-AQCOMMAR                       06407099
064080         SET L300-RETURN-TRANSID  TO TRUE                         06408099
064090         MOVE L100-AQ1TRANT TO  L300-AQTRANRE                     06409099
064100         EXEC CICS RETURN                                         06410099
064110         END-EXEC                                                 06411099
064120*        EXEC CICS RETURN TRANSID (L100-AQ1TRANT)                 06412099
064130*             COMMAREA (C-INDICADOR)                              06413099
064140*        END-EXEC                                                 06414099
064150     END-IF                                                       06415099
064160     .                                                            06416099
064170*                                                                 06417099
064180*----------------------------------------------------------------*06418099
064190*    -   BUSQUEDA DE LOS DATOS DE LA CCT DE CONTINUACION         *06419099
064200*    -   START TRANSID DE LA NUEVA CCT O ENVIO DE RECONEXION AL  *06420099
064210*        TERMINAL FINANCIERO.                                    *06421099
064220*----------------------------------------------------------------*06422099
064230 032-CCT-CONT.                                                    06423099
064240*-------------                                                    06424099
064250*tracet->                       +                                 06425099
064260     IF WS-TRACE > '1'                                            06426099
064270        MOVE '032-CCT-CONT.                   ' TO WS-AQNBDTRA    06427099
064280        PERFORM 131-TRACE-TECNIC                                  06428099
064290     END-IF                                                       06429099
064300*tracet<-                                                         06430099
064310*M039->                                                           06431099
064320     IF L100-ENTORNO-ECDL AND L100-AQ1ENTRA (1:4) = 'MEN-'        06432099
064330*M062=>                                                           06433099
064340        IF L100-AQ1ENTRA (1:8) = 'MEN-VACV'                       06434099
064350           CONTINUE                                               06435099
064360        ELSE                                                      06436099
064370           MOVE C-ACCION-NO-VALIDA TO L100-AQ1ERRCD               06437099
064380           PERFORM 031-FINAL                                      06438099
064390        END-IF                                                    06439099
064400     END-IF                                                       06440099
064410*<-M039                                                           06441099
064420*                                                                 06442099
064430     IF L100-ESC-BD-TERM AND L100-AQ1ERRCD = SPACES               06443099
064440        AND L100-AQ1ABNCD = SPACES AND L100-AQSWFITR = 1          06444099
064450        PERFORM 097-ACTUALIZA-TERMINAL                            06445099
064460     END-IF                                                       06446099
064470                                                                  06447099
064480     IF F060-TERM-FINANCIERO OR                                   06448099
064490        (F060-TERM-3270 AND (L100-ESTADO-CONTIN                   06449099
064500         OR L100-ESTADO-CONFIR))                                  06450099
064510*I022->                                                           06451099
064520*        IF W-ENTRADA-APLIC (1:4) NOT = 'MEN-'                    06452099
064530*           MOVE 'AC'    TO L310-AQCODOPE                         06453099
064540*           PERFORM 067-PREPARA-CAQL135                           06454099
064550*        END-IF                                                   06455099
064560         IF W-ENTRADA-APLIC NOT = W-ENTRADA-MENU-APLIC            06456099
064570            MOVE 'AC'    TO L310-AQCODOPE                         06457099
064580            PERFORM 067-PREPARA-CAQL135                           06458099
064590         END-IF                                                   06459099
064600*<-I022                                                           06460099
064610     END-IF                                                       06461099
064620                                                                  06462099
064630     MOVE ' '   TO  L100-AQFIPAGI                                 06463099
064640*                                                                 06464099
064650*--> SI SE HA PULSADO F3 (VOLVER AL MENU DE LA APLICACION) Y NO   06465099
064660*--> NO SE ENCUENTRA LA TRANSACCION DE ENTRADA, SE CAMBIA A LA    06466099
064670*--> TRANSACCION 'GT05' (MENU GENERAL APLICACIONES).              06467099
064680*                                                                 06468099
064690     PERFORM 098-BUSCAR-ENTRADA                                   06469099
064700*MLV251002 INICIO                                                 06470099
064710     MOVE F030-AQ3TRNID TO L100-AQTXTRAN                          06471099
064720*MLV251002 FINAL                                                  06472099
064730     IF COD-RESP = DFHRESP (NOTFND)                               06473099
064740        IF EIBAID = DFHPF3                                        06474099
064750           MOVE C-ENTRADA-APLIC TO L100-AQ1ENTRA                  06475099
064760           MOVE C-APL-GENERAL   TO L100-AQ1APLIC                  06476099
064770           PERFORM 098-BUSCAR-ENTRADA                             06477099
064780           IF COD-RESP = DFHRESP (NOTFND)                         06478099
064790              MOVE C-ABEND-NO-CCT TO L100-AQ1ABNCD                06479099
064800              MOVE L100-AQ1ENTRA  TO L045-AQTXMENS (1)            06480099
064810              MOVE L100-AQ1APLIC  TO L045-AQTXMENS (2)            06481099
064820              SET SW-ABEND-ARQUITECTURAL TO TRUE                  06482099
064830              MOVE '02'           TO W-NUM-ABEND                  06483099
064840              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              06484099
064850              PERFORM 099-ABEND-PROC                              06485099
064860           END-IF                                                 06486099
064870        ELSE                                                      06487099
064880           MOVE C-ABEND-NO-CCT TO L100-AQ1ABNCD                   06488099
064890           MOVE L100-AQ1ENTRA  TO L045-AQTXMENS (1)               06489099
064900           MOVE L100-AQ1APLIC  TO L045-AQTXMENS (2)               06490099
064910           MOVE '02'           TO W-NUM-ABEND                     06491099
064920           SET SW-ABEND-ARQUITECTURAL TO TRUE                     06492099
064930           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 06493099
064940           PERFORM 099-ABEND-PROC                                 06494099
064950        END-IF                                                    06495099
064960     END-IF                                                       06496099
064970*                                                                 06497099
064980*--> COMPROBAR EL ESTADO DE LA APLICACION                         06498099
064990*                                                                 06499099
065000     IF F030-AQ3APLIC NOT = 'AQ  '                                06500099
065010        PERFORM 059-COMPROVAR-ESTAT-APLICACIO                     06501099
065020        IF SW-APL-NO-EXISTE OR                                    06502099
065030           (SW-APL-INACTIVA AND (NOT SW-BD-SOLO-CONSULTA)) OR     06503099
065040           (SW-APL-INACTIVA AND SW-BD-SOLO-CONSULTA AND           06504099
065050            (F030-AQ3TIPUS NOT = 4))                              06505099
065060            MOVE W-CASO-ENTRADA TO L100-AQ1DCASO                  06506099
065070            IF F060-TERM-FINANCIERO                               06507099
065080                PERFORM 060-ENVIAR-RESPUESTA                      06508099
065090                MOVE '01-CCT-CON'  TO  L392-FILLER(1:10)          06509099
065100*A271 26/07/04 INICIO                                             06510099
065110*               PERFORM 124-ESBORRA-REGIS-SCR-TASCA               06511099
065120*A271 26/07/04 FINAL                                              06512099
065130*tracet->                                                         06513099
065140                IF WS-TRACE > '0'                                 06514099
065150                   MOVE 'END-RAQW001-08' TO WS-AQNBDTRA           06515099
065160                   MOVE L100-AQ1DCASO    TO WS-AQ1DCASO           06516099
065170                   STRING                                         06517099
065180                     '<<==== Tran/estado/caso|ret: '              06518099
065190                      F030-AQ3TRNID '/'                           06519099
065200                      L100-AQ1ESTAD '/' WS-AQ1DCASO '|'           06520099
065210                      L300-AQCDFURE                               06521099
065220                      DELIMITED BY SIZE  INTO WS-AQINFORM         06522099
065230                   END-STRING                                     06523099
065240                   PERFORM 131-TRACE-TECNIC                       06524099
065250                END-IF                                            06525099
065260*tracet<-                                                         06526099
065270                EXEC CICS RETURN END-EXEC                         06527099
065280            ELSE                                                  06528099
065290                MOVE C-APLIC-CERRADA TO L100-AQ1ERRCD             06529099
065300                PERFORM 031-FINAL                                 06530099
065310            END-IF                                                06531099
065320        END-IF                                                    06532099
065330     END-IF                                                       06533099
065340*                                                                 06534099
065350*--> Comprobar si el usuario esta autorizado a ejecutar la        06535099
065360*--> transaccion                                                  06536099
065370*                                                                 06537099
065380*BROADCAST4EYES-DonotcheckAuth-I                                  06538099
065390*    When L100-AQFILL16 NOT = SPACES is when we know that         06539099
065400*    the transaction is being executed triggered from AQ44        06540099
065410*    for a remote verification.                                   06541099
065420     IF L100-AQFILL16 = SPACES                                    06542099
065430*BROADCAST4EYES-DonotcheckAuth-E                                  06543099
065440        MOVE F030-AQ3TRNID TO LK-TRANSAC                          06544099
065450        PERFORM 100-ACCESO-TRAN                                   06545099
065460        IF LK-POSTA = 'V'                                         06546099
065470            MOVE W-CASO-ENTRADA TO L100-AQ1DCASO                  06547099
065480*           MOVE C-NO-AUTORIZADO TO L100-AQ1ERRCD                 06548099
065490*                                                                 06549099
065500            INITIALIZE L045-CAQL045                               06550099
065510            MOVE F030-AQ3TRNID TO L045-AQTXMENS (1)               06551099
065520            MOVE C-TRANS-NO-AUTORI TO L100-AQ1ERRCD               06552099
065530            PERFORM 101-FORMATEIG-ERROR-VARIABLE                  06553099
065540            PERFORM 031-FINAL                                     06554099
065550        END-IF                                                    06555099
065560*BROADCAST4EYES-DonotcheckAuth-I                                  06556099
065570     END-IF                                                       06557099
065580*BROADCAST4EYES-DonotcheckAuth-E                                  06558099
065590*                                                                 06559099
065600*--> Comprobar si la transaccion esta inactiva                    06560099
065610*                                                                 06561099
065620     IF F030-TRN-INACTIVA                                         06562099
065630        MOVE W-CASO-ENTRADA TO L100-AQ1DCASO                      06563099
065640        MOVE C-TRANS-INACT TO L100-AQ1ERRCD                       06564099
065650        PERFORM 031-FINAL                                         06565099
065660     END-IF                                                       06566099
065670                                                                  06567099
065680* JO-18062004                                                     06568099
065690                                                                  06569099
065700     IF (NOT L300-ENTORNO-ECDL)                                   06570099
065710        IF ( F030-P-TERMINAL AND NOT F060-TERM-FINANCIERO ) OR    06571099
065720           ( F030-P-3270     AND NOT F060-TERM-3270 )             06572099
065730            SET L100-ACCION-TERMINAL TO TRUE                      06573099
065740            MOVE 'JAQE047'           TO L100-AQ1ERRCD             06574099
065750            PERFORM 031-FINAL                                     06575099
065760        END-IF                                                    06576099
065770     END-IF                                                       06577099
065780*                                                                 06578099
065790*i032->                                                           06579099
065800*                                                                 06580099
065810*INI-18.04.2005-JO                                                06581099
065820*                                                                 06582099
065830*    IF (NOT L300-ENTORNO-ECDL) AND F060-TERM-FINANCIERO          06583099
065840*       IF  F030-AQ3TIP07 = 'B'                                   06584099
065850*           SET L100-ACCION-TERMINAL TO TRUE                      06585099
065860*           SET SW-ERROR-ENTORNO-EJEC TO TRUE                     06586099
065870*           MOVE 'JAQE260'           TO L100-AQ1ERRCD             06587099
065880*           PERFORM 031-FINAL                                     06588099
065890*       END-IF                                                    06589099
065900*    END-IF                                                       06590099
065910*                                                                 06591099
065920*    IF L300-ENTORNO-ECDL                                         06592099
065930*       IF  F030-AQ3TIP07 = 'F'                                   06593099
065940*           SET L100-ACCION-TERMINAL TO TRUE                      06594099
065950*           SET SW-ERROR-ENTORNO-EJEC TO TRUE                     06595099
065960*           MOVE 'JAQE260'           TO L100-AQ1ERRCD             06596099
065970*           PERFORM 031-FINAL                                     06597099
065980*       END-IF                                                    06598099
065990*    END-IF                                                       06599099
066000*                                                                 06600099
066010     IF L121-CANAL-OFICINAS AND F060-TERM-FINANCIERO              06601099
066020        IF F030-AQ3TIP07 = 'B'                                    06602099
066030*          Ejecucion solo permitida en TWEB                       06603099
066040           IF L100-AQTIPCON = '18'                                06604099
066050              CONTINUE                                            06605099
066060           ELSE                                                   06606099
066070              SET L100-ACCION-TERMINAL TO TRUE                    06607099
066080              SET SW-ERROR-ENTORNO-EJEC TO TRUE                   06608099
066090              MOVE 'JAQE260'           TO L100-AQ1ERRCD           06609099
066100              PERFORM 031-FINAL                                   06610099
066110           END-IF                                                 06611099
066120        END-IF                                                    06612099
066130*                                                                 06613099
066140        IF F030-AQ3TIP07 = 'F'                                    06614099
066150*          Ejecucion solo permitida en TF                         06615099
066160           IF L100-AQTIPCON = '  '                                06616099
066170              CONTINUE                                            06617099
066180           ELSE                                                   06618099
066190              SET L100-ACCION-TERMINAL TO TRUE                    06619099
066200              SET SW-ERROR-ENTORNO-EJEC TO TRUE                   06620099
066210              MOVE 'JAQE260'           TO L100-AQ1ERRCD           06621099
066220              PERFORM 031-FINAL                                   06622099
066230           END-IF                                                 06623099
066240        END-IF                                                    06624099
066250     END-IF                                                       06625099
066260*                                                                 06626099
066270*FI-18.04.2005-JO                                                 06627099
066280*                                                                 06628099
066290*<-i032                                                           06629099
066300*                                                                 06630099
066310*                                                                 06631099
066320*--> LINK AL MODUL DE TOTALITZACIO                                06632099
066330*                                                                 06633099
066340     PERFORM 102-TOTALITZACIO                                     06634099
066350*                                                                 06635099
066360*--> Llamada a la rutina de validacion de salida                  06636099
066370*                                                                 06637099
066380     EVALUATE TRUE                                                06638099
066390     WHEN L121-CANAL-NO-CON-EXIT-SA                               06639099
066400          CONTINUE                                                06640099
066410     WHEN L121-CANAL-CONT-REBU103-S                               06641099
066420*M016->                                                           06642099
066430     WHEN L121-CANAL-CONT-REBU110-S                               06643099
066440*<-M016                                                           06644099
066450          MOVE C-ESCRITURA TO L100-AQ1MESST                       06645099
066460*M016->                                                           06646099
066470*         PERFORM 10000-INVOCAR-REBU103                           06647099
066480          PERFORM 079-INVOCAR-EXIT-BE                             06648099
066490*<-M016                                                           06649099
066500          IF L100-AQ1ABNCD NOT = SPACES                           06650099
066510             SET SW-ABEND-APLICATIVO TO TRUE                      06651099
066520             PERFORM 099-ABEND-PROC                               06652099
066530          END-IF                                                  06653099
066540     WHEN OTHER                                                   06654099
066550          MOVE C-ABEND-RUTINA-SALIDA TO L100-AQ1ABNCD             06655099
066560          MOVE L121-AQCOEXSA         TO L045-AQTXMENS (1)         06656099
066570          SET SW-ABEND-ARQUITECTURAL TO TRUE                      06657099
066580          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  06658099
066590          PERFORM 099-ABEND-PROC                                  06659099
066600     END-EVALUATE                                                 06660099
066610*                                                                 06661099
066620*M059->                                                           06662099
066630     SET L100-SWITCH-TRANSACC TO TRUE                             06663099
066640*                                                                 06664099
066650     IF ( L121-CANAL-IMPRES-REMOTA AND (NOT L100-OFF-LINE ) AND   06665099
066660        L100-AQ1ERRCD = SPACES AND L100-AQ1ABNCD = SPACES )       06666099
066670*P1000->                                                          06667099
066680*I082->                                                           06668099
066690*       AND NOT L300-ENTORNO-CAL390                               06669099
066700*I082<-                                                           06670099
066710*P1000<-                                                          06671099
066720        MOVE C-IMPRIMIR-DOCUMENTOS TO L100-AQ1MESST               06672099
066730        PERFORM 066-FORMAT-DEFORM-MENS                            06673099
066740        IF L100-AQ1ABNCD NOT = SPACES                             06674099
066750           SET SW-ABEND-ARQUITECTURAL TO TRUE                     06675099
066760           PERFORM 099-ABEND-PROC                                 06676099
066770        END-IF                                                    06677099
066780     END-IF                                                       06678099
066790*M059<-                                                           06679099
066800*                                                                 06680099
066810*--> ML270499 INICIO                                              06681099
066820*                                                                 06682099
066830     PERFORM 058-MOVER-DATOS-CCT                                  06683099
066840*                                                                 06684099
066850*--> ML270499 FINAL                                               06685099
066860*                                                                 06686099
066870*M059->                                                           06687099
066880*    SET L100-SWITCH-TRANSACC TO TRUE                             06688099
066890*M059<-                                                           06689099
066900*                                                                 06690099
066910     PERFORM 103-ACTUALIZ-SCR                                     06691099
066920*                                                                 06692099
066930*                                                                 06693099
066940*--> ML270499 FINAL                                               06694099
066950*                                                                 06695099
066960*                                                                 06696099
066970*--> ML270499 INICIO                                              06697099
066980*                                                                 06698099
066990*    PERFORM 058-MOVER-DATOS-CCT                                  06699099
067000*                                                                 06700099
067010*--> ML270499 FINAL                                               06701099
067020*                                                                 06702099
067030* A265 31/03/2004 INICIO                                          06703099
067040*                                                                 06704099
067050*    Si el recambio es solicitado por la Arquitectura como        06705099
067060*    consecuencia de un Fast-Path con traspaso de datos se        06706099
067070*    ha de salvar el area interna de pantalla, ya que sera        06707099
067080*    necesaria en la siguiente ejecucion para realizar el         06708099
067090*    traspaso de campos                                           06709099
067100*                                                                 06710099
067110     IF L121-CANAL-NAVEGACION-SI AND                              06711099
067120*MLV-19-05-05 INICIO                                              06712099
067130*       (L100-CAMBIO-POR-TECLA OR L100-CAMBIO-POR-RETORNO)        06713099
067140        (L100-CAMBIO-POR-TECLA OR L100-CAMBIO-POR-RETORNO OR      06714099
067150         L100-CAMBIO-POR-RELACION)                                06715099
067160*MLV-19-05-05 FINAL                                               06716099
067170*A326->                                                           06717099
067180        OR L100-CAMBIO-FAST-PATH-3270                             06718099
067190*<-A326                                                           06719099
067200*NewSAMGbasedWarnings-I                                           06720099
067210        OR evalNavigWarnings                                      06721099
067220*NewSAMGbasedWarnings-E                                           06722099
067230        MOVE C-SALVAR-MAPA TO L100-AQ1MESST                       06723099
067240        PERFORM 066-FORMAT-DEFORM-MENS                            06724099
067250*BROADCAST4EYES-I                                                 06725099
067260*       Para la verificacion remota, estamos usando los ultimos   06726099
067270*       3 caracteres L100-AQ1ABNCD, por causa del redefines de    06727099
067280*       L100-AQ1AVCD1-BCK introducido en la copy CAQL100          06728099
067290*       IF L100-AQ1ABNCD NOT = SPACES                             06729099
067300        IF L100-AQ1ABNCD(1:4) NOT = SPACES                        06730099
067310*BROADCAST4EYES-I                                                 06731099
067320           SET SW-ABEND-ARQUITECTURAL TO TRUE                     06732099
067330           PERFORM 099-ABEND-PROC                                 06733099
067340        END-IF                                                    06734099
067350     END-IF                                                       06735099
067360*                                                                 06736099
067370* A265 31/03/2004 INICIO                                          06737099
067380*                                                                 06738099
067390     IF F060-TERM-FINANCIERO                                      06739099
067400*                                                                 06740099
067410*P1008->                                                          06741099
067420*       IF NOT TERM-TCPIP                                         06742099
067430*          EXEC CICS SYNCPOINT END-EXEC                           06743099
067440*       END-IF                                                    06744099
067450*                                                                 06745099
067460        EXEC CICS SYNCPOINT END-EXEC                              06746099
067470*P1008<-                                                          06747099
067480     END-IF                                                       06748099
067490     MOVE 999 TO L100-AQ1NIVUS                                    06749099
067500     MOVE F030-AQ3TRNID TO W-TRANID                               06750099
067510     MOVE F030-AQ3TRNID TO L100-AQ1TRANT                          06751099
067520     IF L100-AQ1ENTRA (1:2) = 'XX' OR                             06752099
067530        (F060-TERM-FINANCIERO AND L121-CANAL-TFIS-ES-TLOG)        06753099
067540        SET SW-TRAN-NO-ARQUITEC TO TRUE                           06754099
067550     ELSE                                                         06755099
067560        SET SW-TRAN-ARQUITEC TO TRUE                              06756099
067570     END-IF                                                       06757099
067580*                                                                 06758099
067590*MLV-03-07-03 INICIO                                              06759099
067600*                                                                 06760099
067610*    IF W-TERM-TCPIP  NOT = 'TCPI' AND                            06761099
067620*       W-TERM-TCPIP  NOT = 'AQTF'                                06762099
067630*       PERFORM 104-ARRANCAR-TRANSACCION                          06763099
067640*    END-IF                                                       06764099
067650*                                                                 06765099
067660*P1000->                                                          06766099
067670*    IF (W-TERM-TCPIP NOT = 'TCPI') AND                           06767099
067680*       (W-TERM-TCPIP NOT = 'AQTF') AND                           06768099
067690     IF (W-TERM-TCPIP NOT = 'AQTF') AND                           06769099
067700*P1000<-                                                          06770099
067710        (NOT L300-ENTORNO-ECDL)                                   06771099
067720        PERFORM 104-ARRANCAR-TRANSACCION                          06772099
067730     END-IF                                                       06773099
067740*                                                                 06774099
067750*MLV-03-07-03 FINAL                                               06775099
067760*                                                                 06776099
067770     IF W001-RETORNOK = 'PA'                                      06777099
067780        SET L300-RETURN-TRANSID  TO TRUE                          06778099
067790     END-IF                                                       06779099
067800                                                                  06780099
067810     IF W001-RETORNOK = 'PR'                                      06781099
067820        SET L300-RETURN          TO TRUE                          06782099
067830     END-IF                                                       06783099
067840                                                                  06784099
067850     IF SW-TRAN-ARQUITEC                                          06785099
067860        IF L300-AQCSTART = 'NS'  AND F060-TERM-3270               06786099
067870           SET L300-NO-START-TRANSID TO TRUE                      06787099
067880        END-IF                                                    06788099
067890                                                                  06789099
067900        IF L300-AQCSTART = 'NS'  AND F060-TERM-3270               06790099
067910           AND L100-AQ1ACCIO NOT = 'PRG'                          06791099
067920           SET L300-RETURN-TRANSID TO TRUE                        06792099
067930        END-IF                                                    06793099
067940     END-IF                                                       06794099
067950                                                                  06795099
067960     MOVE ' 177-CONT- AQCDFURE:' TO DADES-START(1:20)             06796099
067970     MOVE L300-AQCDFURE          TO DADES-START(22:2)             06797099
067980     MOVE 'AQCOMMAR-AQTRANRE:  ' TO DADES-START(26:20)            06798099
067990     MOVE L300-AQCOMMAR          TO DADES-START(48:5)             06799099
068000     MOVE ' - '                  TO DADES-START(55:3)             06800099
068010     MOVE L300-AQTRANRE          TO DADES-START(60:4)             06801099
068020     MOVE ' W-EIBTRNID:'         TO DADES-START(66:12)            06802099
068030     MOVE W-EIBTRNID             TO DADES-START(79:4)             06803099
068040                                                                  06804099
068050*                                                                 06805099
068060*--> ENVIO DEL MENSAJE DE RECONEXION SI ES T.F.                   06806099
068070*                                                                 06807099
068080     IF F060-TERM-FINANCIERO                                      06808099
068090        MOVE 'RX'          TO L310-AQCODOPE                       06809099
068100        INITIALIZE W001-CAQW001                                   06810099
068110        PERFORM 040-LINK-RAQW005                                  06811099
068120     END-IF                                                       06812099
068130*                                                                 06813099
068140     PERFORM 105-TRATAMIENTO-DIARIO                               06814099
068150*                                                                 06815099
068160     MOVE '02-CCT-CON'  TO  L392-FILLER(1:10)                     06816099
068170*A271 26/07/04 INICIO                                             06817099
068180*    PERFORM 124-ESBORRA-REGIS-SCR-TASCA                          06818099
068190*A271 26/07/04 FINAL                                              06819099
068200*                                                                 06820099
068210* A271 04/10/2004 INICIO                                          06821099
068220     IF L300-ENTORNO-ECDL                                         06822099
068230        EXEC CICS SYNCPOINT END-EXEC                              06823099
068240     END-IF                                                       06824099
068250* A271 04/10/2004 FINAL                                           06825099
068260*                                                                 06826099
068270*tracet->                                                         06827099
068280     IF WS-TRACE > '0'                                            06828099
068290        MOVE 'END-RAQW001-09' TO WS-AQNBDTRA                      06829099
068300        MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                      06830099
068310        STRING                                                    06831099
068320           '<<==== Tran/estado/caso|ret: ' F030-AQ3TRNID '/'      06832099
068330            L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE       06833099
068340            DELIMITED BY SIZE  INTO WS-AQINFORM                   06834099
068350        END-STRING                                                06835099
068360        PERFORM 131-TRACE-TECNIC                                  06836099
068370     END-IF                                                       06837099
068380*tracet<-                                                         06838099
068390     EXEC CICS RETURN END-EXEC.                                   06839099
068400*                                                                 06840099
068410*----------------------------------------------------------------*06841099
068420*    INFORMAR LOS DATOS NECESARIOS PARA FORMATEAR UN ABEND CICS  *06842099
068430*    DETECTADO DENTRO DEL RAQW001.                               *06843099
068440*----------------------------------------------------------------*06844099
068450 033-INFORMAR-DATOS-ABEND.                                        06845099
068460*-------------------------                                        06846099
068470*tracet->                       +                                 06847099
068480     IF WS-TRACE > '1'                                            06848099
068490        MOVE '033-INFORMAR-DATOS-ABEND.       ' TO WS-AQNBDTRA    06849099
068500        PERFORM 131-TRACE-TECNIC                                  06850099
068510     END-IF                                                       06851099
068520*tracet<-                                                         06852099
068530     MOVE C-ABEND-CICS TO L100-AQ1ABNCD                           06853099
068540     MOVE EIBFN        TO L100-AQ1EIBFN                           06854099
068550     MOVE EIBRCODE     TO L100-AQ1EIBRC                           06855099
068560     MOVE EIBRSRCE     TO L100-AQ1EIBRS                           06856099
068570     SET SW-ABEND-ARQUITECTURAL TO TRUE                           06857099
068580     PERFORM 099-ABEND-PROC.                                      06858099
068590*                                                                 06859099
068600*----------------------------------------------------------------*06860099
068610*   -  DIRECCIONAR AREA DE DESCRIPCION DE APLICACIONES           *06861099
068620*----------------------------------------------------------------*06862099
068630 034-DIRECCIONAR-AREA-CAQL310.                                    06863099
068640*-----------------------------                                    06864099
068650*tracet->                       +                                 06865099
068660     IF WS-TRACE > '1'                                            06866099
068670        MOVE '034-DIRECCIONAR-AREA-CAQL310.   ' TO WS-AQNBDTRA    06867099
068680        MOVE L100-AQ1DCASO TO  WS-CAS                             06868099
068690        PERFORM 131-TRACE-TECNIC                                  06869099
068700     END-IF                                                       06870099
068710*tracet<-                                                         06871099
068720*--> Moure el punter  de la copy d'enllaç entre moduls            06872099
068730*                                                                 06873099
068740     IF L300-AQPTARE1  > 0                                        06874099
068750        MOVE L300-AQPTARE1     TO  W-PUNTER-COMP                  06875099
068760        SET ADDRESS OF AREA-CAQL310 TO W-PUNTER-POINTER           06876099
068770        MOVE L300-AQPTARE1     TO  L100-AQPTL310                  06877099
068780        MOVE L300-AQPTARE1     TO  W-AQPTL310                     06878099
068790*       MOVE  0                TO  L310-AQPTACVT                  06879099
068800     ELSE                                                         06880099
068810        EXEC CICS GETMAIN SET (ADDRESS OF AREA-CAQL310)           06881099
068820             FLENGTH (LENGTH OF AREA-CAQL310) RESP (COD-RESP)     06882099
068830             NOSUSPEND                                            06883099
068840             INITIMG (C-LOW-VALUES)                               06884099
068850        END-EXEC                                                  06885099
068860*                                                                 06886099
068870        IF COD-RESP = DFHRESP (NORMAL)                            06887099
068880           SET  W-PUNTER-POINTER  TO  ADDRESS OF AREA-CAQL310     06888099
068890           INITIALIZE L310-L310PARM                               06889099
068900           MOVE W-PUNTER-COMP     TO  L300-AQPTARE1               06890099
068910           MOVE L300-AQPTARE1     TO  L100-AQPTL310               06891099
068920           MOVE L300-AQPTARE1     TO  W-AQPTL310                  06892099
068930        ELSE                                                      06893099
068940           MOVE 0 TO L300-AQPTARE1                                06894099
068950           MOVE 0 TO L100-AQPTL310                                06895099
068960           MOVE 0 TO    W-AQPTL310                                06896099
068970           PERFORM 033-INFORMAR-DATOS-ABEND                       06897099
068980        END-IF                                                    06898099
068990     END-IF.                                                      06899099
069000                                                                  06900099
069010*----------------------------------------------------------------*06901099
069020*    ACCEDIR A FAQ400 PER LES DADES DEL CICS                     *06902099
069030*----------------------------------------------------------------*06903099
069040 035-ACCES-RAQW082.                                               06904099
069050*------------------                                               06905099
069060*tracet->                       +                                 06906099
069070     IF WS-TRACE > '1'                                            06907099
069080        MOVE '035-ACCES-RAQW082.              ' TO WS-AQNBDTRA    06908099
069090        PERFORM 131-TRACE-TECNIC                                  06909099
069100     END-IF                                                       06910099
069110*tracet<-                                                         06911099
069120*-->Llamada al modulo RAQW082 para obtener parametros del CICS    06912099
069130*                                                                 06913099
069140     EXEC CICS GETMAIN SET (L310-CAQL082P)                        06914099
069150          INITIMG (C-SPACES)                                      06915099
069160          NOSUSPEND                                               06916099
069170          FLENGTH (LENGTH OF AREA-CAQL082)                        06917099
069180     END-EXEC                                                     06918099
069190                                                                  06919099
069200     MOVE L310-CAQL082P          TO W-PUNTER-COMP                 06920099
069210     SET ADDRESS OF AREA-CAQL082 TO W-PUNTER-POINTER              06921099
069220*                                                                 06922099
069230     INITIALIZE L082-CAQL082                                      06923099
069240     EXEC CICS LINK PROGRAM ('RAQW082') COMMAREA (L082-CAQL082)   06924099
069250          RESP (COD-RESP)                                         06925099
069260     END-EXEC                                                     06926099
069270*                                                                 06927099
069280     IF COD-RESP NOT = DFHRESP (NORMAL)                           06928099
069290        PERFORM 033-INFORMAR-DATOS-ABEND                          06929099
069300     END-IF                                                       06930099
069310     EVALUATE L082-AQRETORN                                       06931099
069320     WHEN ' '                                                     06932099
069330          CONTINUE                                                06933099
069340     WHEN 'B'                                                     06934099
069350          SET SW-ABEND-ARQUITECTURAL TO TRUE                      06935099
069360          MOVE L082-AQ1EIBFN         TO L100-AQ1EIBFN             06936099
069370          MOVE L082-AQ1EIBRC         TO L100-AQ1EIBRC             06937099
069380          MOVE L082-AQ1EIBRS         TO L100-AQ1EIBRS             06938099
069390          MOVE C-ABEND-CICS          TO L100-AQ1ABNCD             06939099
069400          PERFORM 099-ABEND-PROC                                  06940099
069410     WHEN 'N'                                                     06941099
069420          SET SW-ABEND-ARQUITECTURAL TO TRUE                      06942099
069430          MOVE C-CICS-NO-DEFINIDO    TO L100-AQ1ABNCD             06943099
069440          PERFORM 099-ABEND-PROC                                  06944099
069450     WHEN OTHER                                                   06945099
069460          MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                    06946099
069470          MOVE 'RAQW082'      TO L045-AQTXMENS (1)                06947099
069480          MOVE L082-AQRETORN  TO L045-AQTXMENS (2)                06948099
069490          SET SW-ABEND-ARQUITECTURAL TO TRUE                      06949099
069500          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  06950099
069510          PERFORM 099-ABEND-PROC                                  06951099
069520     END-EVALUATE.                                                06952099
069530*                                                                 06953099
069540*----------------------------------------------------------------*06954099
069550*    -  LECTURA DE LOS DATOS DEL TERMINAL                        *06955099
069560**********************************************************        06956099
069570 036-SI-ES-PF15.                                                  06957099
069580*---------------                                                  06958099
069590*tracet->                       +                                 06959099
069600     IF WS-TRACE > '1'                                            06960099
069610        MOVE '036-SI-ES-PF15.                 ' TO WS-AQNBDTRA    06961099
069620        PERFORM 131-TRACE-TECNIC                                  06962099
069630     END-IF                                                       06963099
069640*tracet<-                                                         06964099
069650*--> SI SE HA PULSADO S+F3 DESDE MENU PRINCIPAL ( GT05 O AQM1 )   06965099
069660*--> SE HACE LA DESCONEXION DEL SISTEMA                           06966099
069670*--> NO HACER LA DESCONEXION A LOS USUARIOS DE BANCA ELECTRONICA  06967099
069680*--> (ID. USUARIO='ENNNNNN').                                     06968099
069690*                                                                 06969099
069700     IF (SW-MENU-GNRAL-APLIC OR SW-MENU-GNRAL-AGRUP) AND          06970099
069710        EIBAID = DFHPF15 AND (NOT SW-USUARIO-BE)                  06971099
069720*                                                                 06972099
069730* CRIDA A RCIU000 PER PETICIO M.MORALES                           06973099
069740*                                                                 06974099
069750         MOVE 'D'        TO L004-WOPCION                          06975099
069760         MOVE EIBTRMID   TO L004-WTERMID                          06976099
069770         EXEC CICS ASSIGN USERID(L004-WUSERID) END-EXEC           06977099
069780         EXEC CICS LINK PROGRAM('RCIU000') COMMAREA(L004-CCIL004) 06978099
069790         RESP (COD-RESP)  END-EXEC                                06979099
069800*                                                                 06980099
069810*                                                                 06981099
069820         EXEC CICS ISSUE DISCONNECT RESP (COD-RESP) END-EXEC      06982099
069830*tracet->                                                         06983099
069840         IF WS-TRACE > '0'                                        06984099
069850            MOVE 'END-RAQW001-10' TO WS-AQNBDTRA                  06985099
069860            MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                  06986099
069870            STRING                                                06987099
069880              '<<==== Tran/estado/caso|ret: '                     06988099
069890               F030-AQ3TRNID '/'                                  06989099
069900               L100-AQ1ESTAD '/' WS-AQ1DCASO '|'                  06990099
069910               L300-AQCDFURE                                      06991099
069920               DELIMITED BY SIZE  INTO WS-AQINFORM                06992099
069930            END-STRING                                            06993099
069940            PERFORM 131-TRACE-TECNIC                              06994099
069950         END-IF                                                   06995099
069960*tracet<-                                                         06996099
069970         EXEC CICS RETURN END-EXEC                                06997099
069980     END-IF                                                       06998099
069990*                                                                 06999099
070000*--> OBTENER FECHA Y HORA ACTUAL                                  07000099
070010*                                                                 07001099
070020     EXEC CICS ASKTIME ABSTIME (W-ABSTIME) RESP (COD-RESP)        07002099
070030     END-EXEC                                                     07003099
070040     IF COD-RESP NOT = DFHRESP (NORMAL)                           07004099
070050        PERFORM 033-INFORMAR-DATOS-ABEND                          07005099
070060     END-IF                                                       07006099
070070     EXEC CICS FORMATTIME ABSTIME (W-ABSTIME) RESP (COD-RESP)     07007099
070080          YYMMDD (W-YYMMDD) DDMMYY (W-DDMMYY) MMDDYY (W-MMDDYY)   07008099
070090          YEAR (W-YEAR) TIME (W-HORA-ACTUAL)                      07009099
070100     END-EXEC                                                     07010099
070110     IF COD-RESP NOT = DFHRESP (NORMAL)                           07011099
070120        PERFORM 033-INFORMAR-DATOS-ABEND                          07012099
070130     END-IF                                                       07013099
070140     MOVE W-YEAR TO W1-YYYY-ACTUAL                                07014099
070150     MOVE W-YEAR TO W4-YYYY-ACTUAL                                07015099
070160     MOVE W-YEAR TO W6-YYYY-ACTUAL.                               07016099
070170*                                                                 07017099
070180*----------------------------------------------------------------*07018099
070190*    LLAMADA AL MODULO DE FORMATEO DE MENSAJES VARIABLES         *07019099
070200*----------------------------------------------------------------*07020099
070210 037-FORMATEAR-MENSAJE-VARIABLE.                                  07021099
070220*-------------------------------                                  07022099
070230*tracet->                       +                                 07023099
070240     IF WS-TRACE > '1'                                            07024099
070250        MOVE '037-FORMATEAR-MENSAJE-VARIABLE  ' TO WS-AQNBDTRA    07025099
070260        PERFORM 131-TRACE-TECNIC                                  07026099
070270     END-IF                                                       07027099
070280*tracet<-                                                         07028099
070290     MOVE L100-AQ1ABNCD TO L045-AQ4CLAVE                          07029099
070300     EXEC CICS LINK PROGRAM ('RAQW045') COMMAREA (L045-CAQL045)   07030099
070310          RESP (COD-RESP)                                         07031099
070320     END-EXEC                                                     07032099
070330     IF COD-RESP NOT = DFHRESP (NORMAL)                           07033099
070340        PERFORM 033-INFORMAR-DATOS-ABEND                          07034099
070350     END-IF                                                       07035099
070360     IF L045-AQRETORN = 'B'                                       07036099
070370         MOVE L045-AQ1EIBFN TO L100-AQ1EIBFN                      07037099
070380         MOVE L045-AQ1EIBRC TO L100-AQ1EIBRC                      07038099
070390         MOVE L045-AQ1EIBRS TO L100-AQ1EIBRS                      07039099
070400         MOVE C-ABEND-CICS  TO L100-AQ1ABNCD                      07040099
070410         PERFORM 099-ABEND-PROC                                   07041099
070420     END-IF.                                                      07042099
070430*                                                                 07043099
070440*----------------------------------------------------------------*07044099
070450*    -  TRACTAMENT INICIAL SI ORIGEN ES TCPIP                    *07045099
070460*----------------------------------------------------------------*07046099
070470 038-TRACTAR-TCPIP.                                               07047099
070480*------------------                                               07048099
070490*tracet->                       +                                 07049099
070500     IF WS-TRACE > '1'                                            07050099
070510        MOVE '038-TRACTAR-TCPIP.              ' TO WS-AQNBDTRA    07051099
070520        PERFORM 131-TRACE-TECNIC                                  07052099
070530     END-IF                                                       07053099
070540*tracet<-                                                         07054099
070550*MLV-03-07-03 INICIO                                              07055099
070560*                                                                 07056099
070570* Informar el puntero al area de enlace con eCDL                  07057099
070580*                                                                 07058099
070590     IF L300-ENTORNO-ECDL                                         07059099
070600        SET L100-ENTORNO-ECDL TO TRUE                             07060099
070610        MOVE L300-AQPTARE2 TO L310-CAQL000                        07061099
070620     END-IF                                                       07062099
070630*                                                                 07063099
070640*MLV-03-07-03 FINAL                                               07064099
070650*                                                                 07065099
070660     MOVE 'IE'           TO L310-AQCODOPE                         07066099
070670     INITIALIZE W001-CAQW001                                      07067099
070680     MOVE L300-AQPTARE2  TO W001-AQPUNTER                         07068099
070690     PERFORM 040-LINK-RAQW005                                     07069099
070700     MOVE  W001-AQTRDEST TO  W-AQ1TRANT                           07070099
070710     MOVE  W001-AQTRDEST TO  W-EIBTRNID                           07071099
070720     MOVE  W001-AQTERMI  TO  W-TERM-TCPIP                         07072099
070730*tracet->                       +                                 07073099
070740     IF WS-TRACE > '1'                                            07074099
070750        MOVE '038-TRACTAR-TCPIP (2)           ' TO WS-AQNBDTRA    07075099
070760        STRING                                                    07076099
070770          'W-AQ1TRANT: ' W-AQ1TRANT '/'                           07077099
070780          'L100-AQ1TRANT: ' L100-AQ1TRANT '/'                     07078099
070790          'EIBTRNID: ' EIBTRNID '/'                               07079099
070800           DELIMITED BY SIZE  INTO WS-AQINFORM                    07080099
070810        END-STRING                                                07081099
070820        PERFORM 131-TRACE-TECNIC                                  07082099
070830     END-IF                                                       07083099
070840     .                                                            07084099
070850*tracet<-                                                         07085099
070860*                                                                 07086099
070870*----------------------------------------------------------------*07087099
070880*    PREPARA AREES I LINK A RAQW392 ABANS DE LINK ALS APLICATIUS *07088099
070890*----------------------------------------------------------------*07089099
070900 039-LINK-DADES-PAIS.                                             07090099
070910*--------------------                                             07091099
070920*tracet->                       +                                 07092099
070930     IF WS-TRACE > '1'                                            07093099
070940        MOVE '039-LINK-DADES-PAIS.            ' TO WS-AQNBDTRA    07094099
070950        PERFORM 131-TRACE-TECNIC                                  07095099
070960     END-IF                                                       07096099
070970*tracet<-                                                         07097099
070980     MOVE L100-AREA    TO   L392-SCR-AQ                           07098099
070990     MOVE 'DP'         TO   L392-OPCIONS                          07099099
071000                                                                  07100099
071010     PERFORM 127-LINK-RAQW392                                     07101099
071020                                                                  07102099
071030*    MOVE EIBTASKN     TO   L100-AQNTASCA                         07103099
071040     MOVE L392-SCR-AQ  TO   L100-AREA                             07104099
071050     IF L392-AQ1ABNCD  >  SPACES                                  07105099
071060        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07106099
071070        MOVE L392-AQ1ABNCD TO  L100-AQ1ABNCD                      07107099
071080        PERFORM 099-ABEND-PROC                                    07108099
071090     END-IF.                                                      07109099
071100*                                                                 07110099
071110*----------------------------------------------------------------*07111099
071120*   LINK PROGRAMA RAQW005 (receives, send i trace)              .*07112099
071130*----------------------------------------------------------------*07113099
071140 040-LINK-RAQW005.                                                07114099
071150*-----------------                                                07115099
071160*tracet->                       +                                 07116099
071170     IF WS-TRACE > '1'                                            07117099
071180        MOVE '040-LINK-RAQW005.               ' TO WS-AQNBDTRA    07118099
071190        STRING                                                    07119099
071200           'Cod.op.: ' L310-AQCODOPE                              07120099
071210            DELIMITED BY SIZE  INTO WS-AQINFORM                   07121099
071220        END-STRING                                                07122099
071230        PERFORM 131-TRACE-TECNIC                                  07123099
071240     END-IF                                                       07124099
071250*tracet<-                                                         07125099
071260     MOVE W-ENVIO        TO W001-AQTRACE                          07126099
071270     MOVE W-RESPUESTA    TO W001-AQ3IND01                         07127099
071280     MOVE L300-AQPTARE2  TO W001-AQPUNTER                         07128099
071290     MOVE W001-CAQW001   TO L310-AQARPARM                         07129099
071300     MOVE SPACES         TO L310-MSGABEND                         07130099
071310                                                                  07131099
071320* JVB 20020225 INI                                                07132099
071330*    SET ADDRESS OF LK-AREA-SCR   TO  L310-AQSCRAR                07133099
071340*    MOVE L100-AREA-TOTAL         TO  LK-AREA-SCR                 07134099
071350* JVB 20020225 fin                                                07135099
071360                                                                  07136099
071370     EXEC CICS LINK PROGRAM ('RAQW005') RESP (COD-RESP)           07137099
071380          COMMAREA (L310-CAQL310)                                 07138099
071390     END-EXEC                                                     07139099
071400                                                                  07140099
071410*                                                                 07141099
071420     IF COD-RESP NOT = DFHRESP (NORMAL)                           07142099
071430        PERFORM 033-INFORMAR-DATOS-ABEND                          07143099
071440     END-IF                                                       07144099
071450                                                                  07145099
071460* JVB 20020225 INI                                                07146099
071470*    MOVE LK-AREA-SCR             TO  L100-AREA-TOTAL             07147099
071480* JVB 20020225 fin                                                07148099
071490*                                                                 07149099
071500     IF L310-MSGABEND NOT = SPACES                                07150099
071510*       PERFORM 033-INFORMAR-DATOS-ABEND                          07151099
071520        SET SW-ABEND-ARQUITECTURAL  TO TRUE                       07152099
071530        PERFORM 099-ABEND-PROC                                    07153099
071540     END-IF                                                       07154099
071550                                                                  07155099
071560     IF L310-AQCODRET  NOT = '  '                                 07156099
071570        MOVE 'RAQW005'      TO L045-AQTXMENS (1)                  07157099
071580        PERFORM 129-ERROR-MODULS-RAQWNNN                          07158099
071590     END-IF                                                       07159099
071600                                                                  07160099
071610     MOVE L310-AQARPARM  TO  W001-CAQW001.                        07161099
071620*                                                                 07162099
071630*----------------------------------------------------------------*07163099
071640*   LINK PROGRAMA RAQW008                                       .*07164099
071650*----------------------------------------------------------------*07165099
071660 041-LINK-RAQW008.                                                07166099
071670*-----------------                                                07167099
071680*tracet->                       +                                 07168099
071690     IF WS-TRACE > '1'                                            07169099
071700        MOVE '041-LINK-RAQW008.               ' TO WS-AQNBDTRA    07170099
071710        PERFORM 131-TRACE-TECNIC                                  07171099
071720     END-IF                                                       07172099
071730*tracet<-                                                         07173099
071740     MOVE SPACES       TO L310-MSGABEND                           07174099
071750     MOVE W001-CAQW001 TO L310-AQARPARM                           07175099
071760* JVB 20020225 INI                                                07176099
071770*    SET ADDRESS OF LK-AREA-SCR   TO  L310-AQSCRAR                07177099
071780*    MOVE L100-AREA-TOTAL         TO  LK-AREA-SCR                 07178099
071790* JVB 20020225 INI                                                07179099
071800                                                                  07180099
071810     EXEC CICS LINK PROGRAM ('RAQW008') RESP (COD-RESP)           07181099
071820          COMMAREA (L310-CAQL310)                                 07182099
071830     END-EXEC                                                     07183099
071840                                                                  07184099
071850     IF COD-RESP NOT = DFHRESP (NORMAL)                           07185099
071860        PERFORM 033-INFORMAR-DATOS-ABEND                          07186099
071870     END-IF                                                       07187099
071880                                                                  07188099
071890*tracet<-                                                         07189099
071900* JVB 20020225 INI                                                07190099
071910*    MOVE LK-AREA-SCR             TO  L100-AREA-TOTAL             07191099
071920* JVB 20020225 FIN                                                07192099
071930                                                                  07193099
071940*MLV01->                                                          07194099
071950                                                                  07195099
071960*    IF L310-MSGABEND = 'JGTB101'                                 07196099
071970*       PERFORM 033-INFORMAR-DATOS-ABEND                          07197099
071980*    END-IF                                                       07198099
071990                                                                  07199099
072000     IF L310-AQCODRET = 'CI'                                      07200099
072010*       Error CICS                                                07201099
072020*       El codigo de Abend y los valores EIB han sido informado   07202099
072030*       por el RAQW008 en los campos de la copy CAQL100           07203099
072040        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07204099
072050        PERFORM 099-ABEND-PROC                                    07205099
072060     END-IF                                                       07206099
072070                                                                  07207099
072080*MLV01->                                                          07208099
072090                                                                  07209099
072100     IF L310-AQCODRET  NOT = '  '                                 07210099
072110        MOVE 'RAQW008'      TO L045-AQTXMENS (1)                  07211099
072120        PERFORM 129-ERROR-MODULS-RAQWNNN                          07212099
072130     END-IF                                                       07213099
072140                                                                  07214099
072150     MOVE L310-AQARPARM  TO  W001-CAQW001.                        07215099
072160*                                                                 07216099
072170*----------------------------------------------------------------*07217099
072180*     MOVER AL SCR LOS DATOS ASOCIADOS AL TERMINAL               *07218099
072190*----------------------------------------------------------------*07219099
072200 042-INFORMAR-DATOS-TERMINAL.                                     07220099
072210*----------------------------                                     07221099
072220*tracet->                       +                                 07222099
072230     IF WS-TRACE > '1'                                            07223099
072240        MOVE '042-INFORMAR-DATOS-TERMINAL.    ' TO WS-AQNBDTRA    07224099
072250        PERFORM 131-TRACE-TECNIC                                  07225099
072260     END-IF                                                       07226099
072270*tracet<-                                                         07227099
072280*--> Si transaccion GT03 y TF, se informa la entidad/oficina      07228099
072290*--> de instalacion en entidad/oficina operante del SCR para      07229099
072300*--> que el modulo RAQW361 compruebe que conincide con los de     07230099
072310*--> la cabecera del protocolo. Cuando retorna de este modulo     07231099
072320*--> se informa correctamente                                     07232099
072330*                                                                 07233099
072340*MLV-03-09-03 INICIO                                              07234099
072350*    IF SW-LOGON-GT03 AND F060-TERM-FINANCIERO                    07235099
072360     IF SW-LOGON-GT03 AND F060-TERM-FINANCIERO AND                07236099
072370        (NOT L100-ENTORNO-ECDL)                                   07237099
072380*MLV-03-09-03 FINAL                                               07238099
072390        MOVE F060-AQNUENTI TO L100-AQ1BANOP                       07239099
072400        MOVE F060-STOFICIN TO L100-AQ1OFIOP                       07240099
072410     ELSE                                                         07241099
072420*A288-I llamada exit raqwc01                                      07242099
072430        IF NOT SW-LOGON-GT03                                      07243099
072440*MOD01-I                                                          07244099
072450               AND L100-STCDPAIS = 005                            07245099
072460*MOD01-F                                                          07246099
072470           PERFORM 057-OBTENER-OFICINA-USUARIO                    07247099
072480        END-IF                                                    07248099
072490*A288-F                                                           07249099
072500        MOVE F060-AQ9ENTOP TO L100-AQ1BANOP                       07250099
072510        MOVE F060-AQ9OFICO TO L100-AQ1OFIOP                       07251099
072520     END-IF                                                       07252099
072530     IF F060-TERM-FINANCIERO                                      07253099
072540        MOVE F060-AQNULLOC TO L100-AQLLOCTM                       07254099
072550     ELSE                                                         07255099
072560        MOVE 0             TO L100-AQLLOCTM                       07256099
072570     END-IF                                                       07257099
072580*                                                                 07258099
072590     MOVE F060-AQCDCANL      TO L100-AQCDCANL                     07259099
072600     MOVE F060-AQ9FIL1       TO L100-AQSWMENS                     07260099
072610     MOVE F060-AQ9TPUS       TO L100-AQ1TIPTM                     07261099
072620     MOVE F060-AQ9IMP1(1:4)  TO L100-AQIMPR01                     07262099
072630     MOVE F060-AQ9IMP2(1:4)  TO L100-AQIMPR02                     07263099
072640     MOVE F060-AQ9IMP3(1:4)  TO L100-AQIMPR03                     07264099
072650     MOVE F060-AQ9IMP5       TO L100-AQCDDIMP                     07265099
072660     IF L100-AQIMPR01 = LOW-VALUES                                07266099
072670        MOVE SPACES  TO L100-AQIMPR01                             07267099
072680     END-IF                                                       07268099
072690     IF L100-AQIMPR02 = LOW-VALUES                                07269099
072700        MOVE SPACES  TO L100-AQIMPR02                             07270099
072710     END-IF                                                       07271099
072720     IF L100-AQIMPR03 = LOW-VALUES                                07272099
072730        MOVE SPACES  TO L100-AQIMPR03                             07273099
072740     END-IF                                                       07274099
072750     IF L100-AQCDDIMP = LOW-VALUES                                07275099
072760        MOVE SPACES  TO L100-AQCDDIMP                             07276099
072770     END-IF.                                                      07277099
072780*                                                                 07278099
072790*----------------------------------------------------------------*07279099
072800*    -  LOCALITZA LES DADES DE DISTRIBUCIO I TECNOLOGIA DEL CANAL*07280099
072810*----------------------------------------------------------------*07281099
072820 043-DADES-CANAL.                                                 07282099
072830*----------------                                                 07283099
072840*tracet->                       +                                 07284099
072850     IF WS-TRACE > '1'                                            07285099
072860        MOVE '043-DADES-CANAL.                ' TO WS-AQNBDTRA    07286099
072870        PERFORM 131-TRACE-TECNIC                                  07287099
072880     END-IF                                                       07288099
072890*tracet<-                                                         07289099
072900     INITIALIZE CTGL000                                           07290099
072910     MOVE '0367'             TO CTGL000-CDTABLA                   07291099
072920*                                                                 07292099
072930*MLV-03-09-03 INICIO                                              07293099
072940*                                                                 07294099
072950*    MOVE '    '             TO CTGL000-STBANCO                   07295099
072960*    MOVE F060-AQCDCANL      TO CTGL000-CLAVTAB(1:3)              07296099
072970*                                                                 07297099
072980     MOVE L100-AQCDCANL TO CTGL000-CLAVTAB(1:3)                   07298099
072990*                                                                 07299099
073000     IF CTGL000-CLAVTAB(1:3) = '100'                              07300099
073010        MOVE '0205'          TO CTGL000-STBANCO                   07301099
073020     ELSE                                                         07302099
073030        MOVE '    '          TO CTGL000-STBANCO                   07303099
073040     END-IF                                                       07304099
073050*                                                                 07305099
073060*MLV-03-09-03 FINAL                                               07306099
073070*                                                                 07307099
073080     MOVE 1                  TO CTGL000-NUCLAVE                   07308099
073090     PERFORM 046-INVOCAR-RTGU000                                  07309099
073100     IF CTGL000-CDRETORN = '00'                                   07310099
073110        MOVE 0                TO L100-AQTECNOL                    07311099
073120        MOVE SPACES           TO L100-AQCADIST                    07312099
073130        MOVE CTGL000-CONTOCUR TO T367-DATOS                       07313099
073140        IF T367-AGCDTECN(1:1) >  W-EF  AND NOT > '9'              07314099
073150           IF T367-AGCDTECN(2:1) >  W-EF  AND NOT > '9'           07315099
073160              IF T367-AGCDTECN(3:1) >  W-EF  AND NOT > '9'        07316099
073170                 MOVE T367-AGCDTECN    TO L100-AQTECNOL           07317099
073180              END-IF                                              07318099
073190           END-IF                                                 07319099
073200        END-IF                                                    07320099
073210        IF T367-AGCDCAND  > SPACES                                07321099
073220           MOVE T367-AGCDCAND    TO L100-AQCADIST                 07322099
073230        END-IF                                                    07323099
073240     ELSE                                                         07324099
073250        MOVE 0                TO L100-AQTECNOL                    07325099
073260        MOVE SPACES           TO L100-AQCADIST                    07326099
073270     END-IF.                                                      07327099
073280*                                                                 07328099
073290*----------------------------------------------------------------*07329099
073300*    FORMATEAR LAS FECHAS DE SESION                              *07330099
073310*----------------------------------------------------------------*07331099
073320 044-FORMATEAR-FECHAS.                                            07332099
073330*---------------------                                            07333099
073340*tracet->                       +                                 07334099
073350     IF WS-TRACE > '1'                                            07335099
073360        MOVE '044-FORMATEAR-FECHAS.           ' TO WS-AQNBDTRA    07336099
073370        PERFORM 131-TRACE-TECNIC                                  07337099
073380     END-IF                                                       07338099
073390*tracet<-                                                         07339099
073400     MOVE W-DDMMYY   TO L100-AQ1FDMAX                             07340099
073410     MOVE W-YYMMDD   TO L100-AQ1FAMDX                             07341099
073420     MOVE W-MMDDYY   TO L100-AQ1FMDAX                             07342099
073430     MOVE W-DDMMYYYY-ACTUAL TO L100-AQFHDMA8                      07343099
073440     MOVE W-YYYYMMDD-ACTUAL TO L100-AQFHAMD8                      07344099
073450     MOVE W-MMDDYYYY-ACTUAL TO L100-AQFHMDA8                      07345099
073460     MOVE W-YYMMDD (1:2)    TO L100-AQ1FDMAX  (5:2)               07346099
073470     MOVE W-YYMMDD (1:2)    TO L100-AQ1FMDAX  (5:2).              07347099
073480*                                                                 07348099
073490*----------------------------------------------------------------*07349099
073500*    LLAMADA AL MODULO RAQW163                                   *07350099
073510*----------------------------------------------------------------*07351099
073520 045-LLAMADA-RAQW163.                                             07352099
073530*--------------------                                             07353099
073540*tracet->                       +                                 07354099
073550     IF WS-TRACE > '1'                                            07355099
073560        MOVE '045-LLAMADA-RAQW163.            ' TO WS-AQNBDTRA    07356099
073570        PERFORM 131-TRACE-TECNIC                                  07357099
073580     END-IF                                                       07358099
073590*tracet<-                                                         07359099
073600     INITIALIZE  W001-CAQW001                                     07360099
073610                                                                  07361099
073620     MOVE 'AD'           TO L310-AQCODOPE                         07362099
073630     MOVE W-EIBTRMID     TO W001-AQTERMI                          07363099
073640     MOVE W-EIBTRNID     TO W001-AQTRDEST                         07364099
073650     MOVE L100-AQ1FDPTR  TO W001-AQPUNTER                         07365099
073660     MOVE F030-AQ3IND01  TO W001-AQ3IND01                         07366099
073670     MOVE F030-AQ3PNLIN  TO W001-AQ3PNLIN                         07367099
073680* JVB 20020225 INI                                                07368099
073690*    SET ADDRESS OF LK-AREA-SCR   TO  L310-AQSCRAR                07369099
073700*    MOVE L100-AREA-TOTAL         TO  LK-AREA-SCR                 07370099
073710* JVB 20020225 FIN                                                07371099
073720     MOVE W-YYYYMMDD-ACTUAL       TO  W001-DATA                   07372099
073730     MOVE W-HORA-ACTUAL           TO  W001-HORA                   07373099
073740     MOVE W-APLICACION            TO  W001-APLICA                 07374099
073750     MOVE W-PANTALLA              TO  W001-AQ3PNLIN               07375099
073760     MOVE W-PROGRAMA              TO  W001-ENTRADA                07376099
073770                                                                  07377099
073780*P1000->                                                          07378099
073790*    IF TERM-TCPIP                                                07379099
073800*       MOVE  '1'        TO  W001-SIESTCPI                        07380099
073810*       MOVE T040-TRANID TO  W001-AQTRDEST                        07381099
073820*    ELSE                                                         07382099
073830*       MOVE  '0'        TO  W001-SIESTCPI                        07383099
073840*    END-IF                                                       07384099
073850     MOVE  '0'        TO  W001-SIESTCPI                           07385099
073860*P1000<-                                                          07386099
073870*                                                                 07387099
073880     EXEC CICS GETMAIN SET (ADDRESS OF AREA-MISSATGES)            07388099
073890          INITIMG (C-SPACES)                                      07389099
073900          FLENGTH (LENGTH OF AREA-MISSATGES) RESP (COD-RESP)      07390099
073910          NOSUSPEND                                               07391099
073920     END-EXEC                                                     07392099
073930                                                                  07393099
073940     IF COD-RESP = DFHRESP (NORMAL)                               07394099
073950        INITIALIZE AREA-MISSATGES                                 07395099
073960        SET  W-PUNTER-POINTER TO ADDRESS OF AREA-MISSATGES        07396099
073970        MOVE W-PUNTER-COMP     TO W001-AQPUNTER                   07397099
073980        MOVE W-MENSAJE-ABEND   TO AREA-MISSATGES                  07398099
073990     ELSE                                                         07399099
074000        MOVE 0 TO W001-AQPUNTER                                   07400099
074010     END-IF                                                       07401099
074020                                                                  07402099
074030     MOVE W001-CAQW001            TO  L310-AQARPARM               07403099
074040*MLV021202 INICIO                                                 07404099
074050*    SET SW-NO-GRABAR-DIARIO      TO TRUE                         07405099
074060*MLV021202 FINAL                                                  07406099
074070*jfm05->Puntero área firma autorizaciones                         07407099
074080*     ->Este puntero solo puede haber sido informado por RAQWS05  07408099
074090     IF L101-AQPTDAUH > 0                                         07409099
074100        MOVE L101-AQPTDAUH TO L100-AQPTRVEF                       07410099
074110        SET L100-NECESARIO-AUTORIZ TO TRUE                        07411099
074120     END-IF                                                       07412099
074130*tracet->                       +                                 07413099
074140     IF WS-TRACE > '1' AND L101-AQPTDAUH > 0                      07414099
074150        MOVE '045-LLAMADA-RAQW163-PUNTERO OK  ' TO WS-AQNBDTRA    07415099
074160        PERFORM 131-TRACE-TECNIC                                  07416099
074170     END-IF                                                       07417099
074180*tracet<-                                                         07418099
074190*jfm05<-                                                          07419099
074200                                                                  07420099
074210     EXEC CICS LINK PROGRAM ('RAQW163') RESP (COD-RESP)           07421099
074220          COMMAREA (L310-CAQL310)                                 07422099
074230     END-EXEC                                                     07423099
074240                                                                  07424099
074250     IF COD-RESP  = DFHRESP (NORMAL)                              07425099
074260        IF L310-AQCODRET   = '  '                                 07426099
074270* JVB 20020225 INI                                                07427099
074280*          MOVE LK-AREA-SCR    TO  L100-AREA-TOTAL(1:860)         07428099
074290* JVB 20020225 FIN                                                07429099
074300           MOVE L310-AQARPARM  TO  W001-CAQW001                   07430099
074310*P1008->                                                          07431099
074320*          IF TERM-TCPIP                                          07432099
074330*             MOVE W001-AQPUNTER  TO  T040-ADDR-AUDIT             07433099
074340*          END-IF                                                 07434099
074350*P1008<-                                                          07435099
074360        ELSE                                                      07436099
074370* INI-JLM-30/09/02                                                07437099
074380*         SI EL MODULO DE GRABACION EN DIARIO/AUDIT NO RETORNA OK 07438099
074390*         SE DEBE ABENDAR.                                        07439099
074400           MOVE C-ABEND-DIARIO TO L100-AQ1ABNCD                   07440099
074410           SET SW-ABEND-ARQUITECTURAL TO TRUE                     07441099
074420*         SE PREVIENE QUE NO VUELVA A GRABAR DIARIO (SERIA BUCLE) 07442099
074430           SET SW-NO-GRABAR-DIARIO    TO TRUE                     07443099
074440           PERFORM 099-ABEND-PROC                                 07444099
074450* FIN-JLM-30/09/02                                                07445099
074460        END-IF                                                    07446099
074470     ELSE                                                         07447099
074480*                                                                 07448099
074490* INI-JLM-19/05/03                                                07449099
074500*      SE BUSCA ERROR DE CICS                                     07450099
074510        INITIALIZE L085-CAQL085                                   07451099
074520        MOVE 'F'                TO L085-AQCODOPE                  07452099
074530        MOVE C-ABEND-CICS       TO L085-AQ4CLAVE                  07453099
074540        IF F060-TERM-3270                                         07454099
074550           MOVE L078-AQCDIDIO   TO L085-AQCDIDIO                  07455099
074560        END-IF                                                    07456099
074570        PERFORM 047-LLAMADA-RAQW085                               07457099
074580        INITIALIZE L145-CAQL145                                   07458099
074590        MOVE 'AQ'                  TO L145-AQ19APLI               07459099
074600        MOVE 'RAQW001'             TO L145-AQPROGRA               07460099
074610        MOVE 'F'                   TO L145-AQCODOPE               07461099
074620        MOVE L085-AQTXME77         TO L145-AQMSGTXT               07462099
074630        MOVE 'ERROR EN LLAMADA A MODULO RAQW163' TO L145-AQMESTXT 07463099
074640        PERFORM 048-GRABAR-LOG                                    07464099
074650*      SI EL SWITCH DE FUNCION DIARIO ELECT.='B' -> ABENDAR       07465099
074660        IF F409-AQSWSTAT(W-FUNCDIA) EQUAL 'B'                     07466099
074670           MOVE C-ABEND-DIARIO TO L100-AQ1ABNCD                   07467099
074680           MOVE 'ERROR EN LLAMADA A MODULO RAQW163'               07468099
074690                TO L145-AQMESTXT                                  07469099
074700           PERFORM 048-GRABAR-LOG                                 07470099
074710           SET SW-ABEND-ARQUITECTURAL TO TRUE                     07471099
074720*         SE PREVIENE QUE NO VUELVA A GRABAR DIARIO (SERIA BUCLE) 07472099
074730           SET SW-NO-GRABAR-DIARIO    TO TRUE                     07473099
074740           PERFORM 099-ABEND-PROC                                 07474099
074750        ELSE                                                      07475099
074760           MOVE 'ERROR EN LLAMADA A MODULO RAQW163'               07476099
074770                TO L145-AQMESTXT                                  07477099
074780           PERFORM 048-GRABAR-LOG                                 07478099
074790        END-IF                                                    07479099
074800     END-IF.                                                      07480099
074810* FIN-JLM-19/05/03                                                07481099
074820*                                                                 07482099
074830*----------------------------------------------------------------*07483099
074840*    ACCESO AL MODULO DE DE CONSULTA DE TABLAS GENERALES         *07484099
074850*----------------------------------------------------------------*07485099
074860 046-INVOCAR-RTGU000.                                             07486099
074870*--------------------                                             07487099
074880*tracet->                       +                                 07488099
074890     IF WS-TRACE > '1'                                            07489099
074900        MOVE '046-INVOCAR-RTGU000.            ' TO WS-AQNBDTRA    07490099
074910        PERFORM 131-TRACE-TECNIC                                  07491099
074920     END-IF                                                       07492099
074930*tracet<-                                                         07493099
074940     EXEC CICS LINK PROGRAM  ('RTGU000') COMMAREA (CTGL000)       07494099
074950          RESP (COD-RESP)                                         07495099
074960     END-EXEC                                                     07496099
074970     IF COD-RESP NOT = DFHRESP (NORMAL)                           07497099
074980        MOVE '99' TO  CTGL000-CDRETORN                            07498099
074990     END-IF                                                       07499099
075000*p133->                                                           07500099
075010     MOVE CTGL000-CDRETORN             TO WS-CDRETORN             07501099
075020*p133-<                                                           07502099
075030     EVALUATE CTGL000-CDRETORN                                    07503099
075040         WHEN '00'                                                07504099
075050             CONTINUE                                             07505099
075060         WHEN OTHER                                               07506099
075070             MOVE '99'                 TO  CTGL000-CDRETORN       07507099
075080     END-EVALUATE.                                                07508099
075090*                                                                 07509099
075100*----------------------------------------------------------------*07510099
075110*    LLAMADA MODULO RAQW085 OBTENCION TEXTO MENSAJES             *07511099
075120*----------------------------------------------------------------*07512099
075130 047-LLAMADA-RAQW085.                                             07513099
075140*--------------------                                             07514099
075150*tracet->                       +                                 07515099
075160     IF WS-TRACE > '1'                                            07516099
075170        MOVE '047-LLAMADA-RAQW085.            ' TO WS-AQNBDTRA    07517099
075180        PERFORM 131-TRACE-TECNIC                                  07518099
075190     END-IF                                                       07519099
075200*tracet<-                                                         07520099
075210*A283->                                                           07521099
075220     MOVE L100-AQCDCANL TO L085-AQCDCNAL                          07522099
075230     MOVE L100-AQTIPCON TO L085-AQCDPRDT                          07523099
075240     IF L100-ENTORNO-ECDL                                         07524099
075250        MOVE L000-AQIDOPER TO L085-AQIDOPER                       07525099
075260     ELSE                                                         07526099
075270        MOVE SPACES        TO L085-AQIDOPER                       07527099
075280     END-IF                                                       07528099
075290*<-A283                                                           07529099
075300*                                                                 07530099
075310     EXEC CICS LINK PROGRAM ('RAQW085') COMMAREA (L085-CAQL085)   07531099
075320          RESP (COD-RESP)                                         07532099
075330     END-EXEC.                                                    07533099
075340*                                                                 07534099
075350*----------------------------------------------------------------*07535099
075360*    LLAMADA AL MODULO DE INSERCCION DE MENSAJES EN EL LOG DE    *07536099
075370*    ARQUITECTURA                                                *07537099
075380*----------------------------------------------------------------*07538099
075390 048-GRABAR-LOG.                                                  07539099
075400*---------------                                                  07540099
075410*tracet->                       +                                 07541099
075420     IF WS-TRACE > '1'                                            07542099
075430        MOVE '048-GRABAR-LOG.                 ' TO WS-AQNBDTRA    07543099
075440        PERFORM 131-TRACE-TECNIC                                  07544099
075450     END-IF                                                       07545099
075460*tracet<-                                                         07546099
075470     MOVE 'F'           TO L145-AQCODOPE                          07547099
075480*                                                                 07548099
075490*MLV13->                                                          07549099
075500*                                                                 07550099
075510*    MOVE 'RAQW001'     TO L145-AQPROGRA                          07551099
075520     IF SW-SI-MENSAJE-4OJOS                                       07552099
075530        MOVE '4OJOS'    TO L145-AQPROGRA                          07553099
075540        SET SW-NO-MENSAJE-4OJOS TO TRUE                           07554099
075550     ELSE                                                         07555099
075560        MOVE 'RAQW001'  TO L145-AQPROGRA                          07556099
075570     END-IF                                                       07557099
075580*                                                                 07558099
075590*MLV13<-                                                          07559099
075600*                                                                 07560099
075610     MOVE L100-AQ1APLIC TO L145-AQ19APLI                          07561099
075620     MOVE F060-AQCDTERM TO L145-AQCDTERM                          07562099
075630     MOVE F060-AQ9TPUS  TO L145-AQ1TIPTM                          07563099
075640*                                                                 07564099
075650*--> Si el puntero del area de datos adicional del Log esta       07565099
075660*--> informado, se mueve a la parte correspondiente del area de   07566099
075670*--> enlace.                                                      07567099
075680*                                                                 07568099
075690     IF W-PTR-CAQL155 NOT = 0                                     07569099
075700        MOVE L155-CAQL155 TO L145-AQCPNOS                         07570099
075710        MOVE 0            TO L145-AQCDFTRA                        07571099
075720     END-IF                                                       07572099
075730     MOVE F060-AQNUENTI TO L145-AQENTNOS                          07573099
075740     MOVE F060-STOFICIN TO L145-AQOFINOS                          07574099
075750     MOVE W-EIBTRNID    TO L145-AQRETRAN                          07575099
075760     IF F060-TERM-FINANCIERO                                      07576099
075770        MOVE F060-AQNULLOC TO L145-AQLLOCTM                       07577099
075780     END-IF                                                       07578099
075790     EXEC CICS LINK PROGRAM ('RAQW140')                           07579099
075800          COMMAREA (L145-CAQL145) RESP (COD-RESP)                 07580099
075810     END-EXEC.                                                    07581099
075820*                                                                 07582099
075830*----------------------------------------------------------------*07583099
075840*    -  ENVIAR RESPUESTA NO-OK AL TERMINAL FINANCIERO            *07584099
075850*----------------------------------------------------------------*07585099
075860 049-ENVIAR-RESPUESTA.                                            07586099
075870*---------------------                                            07587099
075880*tracet->                       +                                 07588099
075890     IF WS-TRACE > '1'                                            07589099
075900        MOVE '049-ENVIAR-RESPUESTA.           ' TO WS-AQNBDTRA    07590099
075910        PERFORM 131-TRACE-TECNIC                                  07591099
075920     END-IF                                                       07592099
075930*tracet<-                                                         07593099
075940     MOVE 'SE'          TO L310-AQCODOPE                          07594099
075950     INITIALIZE W001-CAQW001                                      07595099
075960     PERFORM 040-LINK-RAQW005.                                    07596099
075970*                                                                 07597099
075980*hm1                                                              07598099
075990*=============================================================    07599099
076000 050-ACCES-RAQW370.                                               07600099
076010*------------------                                               07601099
076020*tracet->                       +                                 07602099
076030     IF WS-TRACE > '1'                                            07603099
076040        MOVE '050-ACCES-RAQW370.              ' TO WS-AQNBDTRA    07604099
076050        PERFORM 131-TRACE-TECNIC                                  07605099
076060     END-IF                                                       07606099
076070*tracet<-                                                         07607099
076080*    SI TERMINAL 3270 I LA VALIDACIó DEL NúMERO D'AGENT éS        07608099
076090*    OK O S'HA CANCEL.LAT, ES CRIDA AL MòDUL RAQW370 PER          07609099
076100*    RECUPERAR EL SCR DE LA TRANSACCIó ORIGINAL DES D'ON ES VA    07610099
076110*    PROVOCAR LA SOL.LICITUD DEL NúMERO D'AGENT                   07611099
076120*                                                                 07612099
076130*    Si terminal 3270 y la validacion del NIT y coordenadas ha    07613099
076140*    acabado (OK, KO o Cancelada) llamada al modulo RAQW370 para  07614099
076150*    recuperar el SCR de la transaccion original desde donde se   07615099
076160*    provoco la solicitud del NIT                                 07616099
076170*    27.12.99-afegir idioma-solicitat                             07617099
076180*                                                                 07618099
076190     IF F060-TERM-3270 AND                                        07619099
076200        (L100-VAL-AGENT-ACABADA OR L100-VAL-DBLINE-ACABADA        07620099
076210                                OR L100-VAL-IDIOMA-ACABADA        07621099
076220                                OR L100-AQAVISOS = 'R')           07622099
076230        PERFORM 054-LINK-ABANS-RAQW392                            07623099
076240        PERFORM 055-LINK-DESPRES-RAQW392                          07624099
076250        EXEC CICS LINK PROGRAM ('RAQW370') RESP (COD-RESP)        07625099
076260             COMMAREA (L100-AREA-TOTAL)                           07626099
076270        END-EXEC                                                  07627099
076280        IF COD-RESP NOT = DFHRESP (NORMAL)                        07628099
076290           PERFORM 033-INFORMAR-DATOS-ABEND                       07629099
076300        END-IF                                                    07630099
076310        IF L100-AQ1ABNCD NOT = SPACES                             07631099
076320           SET SW-ABEND-ARQUITECTURAL TO TRUE                     07632099
076330           PERFORM 099-ABEND-PROC                                 07633099
076340        END-IF                                                    07634099
076350     END-IF.                                                      07635099
076360*                                                                 07636099
076370******************************************************************07637099
076380*    Obtener el area de memoria para almacenar el vector de las  *07638099
076390*    teclas, y mover sobre esta area el estado de las teclas que *07639099
076400*    se ha recuperado al leer el SCR                             *07640099
076410******************************************************************07641099
076420 051-RECUPERAR-TECLAS.                                            07642099
076430*---------------------                                            07643099
076440*tracet->                       +                                 07644099
076450     IF WS-TRACE > '1'                                            07645099
076460        MOVE '051-RECUPERAR-TECLAS.           ' TO WS-AQNBDTRA    07646099
076470        PERFORM 131-TRACE-TECNIC                                  07647099
076480     END-IF                                                       07648099
076490*tracet<-                                                         07649099
076500*    Mover el vector de teclas recuperado del SCR                 07650099
076510     MOVE L100-AQGRTECL TO L017-AQGRTECL                          07651099
076520*BROADCAST4EYES-I                                                 07652099
076530     IF L100-AQ1AVCD1-BCK NOT = SPACES                            07653099
076540        MOVE 'JAQA' TO WS-AQ1AVCD1(1:4)                           07654099
076550        MOVE L100-AQ1AVCD1-BCK TO WS-AQ1AVCD1(5:3)                07655099
076560     ELSE                                                         07656099
076570        MOVE SPACES TO WS-AQ1AVCD1                                07657099
076580     END-IF                                                       07658099
076590*BROADCAST4EYES-E                                                 07659099
076600*    Se inicializa el grupo de mensajes                           07660099
076610     INITIALIZE L100-AQ1MENSA                                     07661099
076620*BROADCAST4EYES-I                                                 07662099
076630     IF WS-AQ1AVCD1 NOT = SPACES                                  07663099
076640        MOVE WS-AQ1AVCD1 TO L100-AQ1AVCD1                         07664099
076650     END-IF                                                       07665099
076660*BROADCAST4EYES-E                                                 07666099
076670     .                                                            07667099
076680*                                                                 07668099
076690*----------------------------------------------------------------*07669099
076700*                                                                *07670099
076710*    PREPARA la gravació registres adicional a scr               *07671099
076720*                                                                *07672099
076730*----------------------------------------------------------------*07673099
076740 052-GRAVAR-SCR-ADICI.                                            07674099
076750*---------------------                                            07675099
076760*tracet->                       +                                 07676099
076770     IF WS-TRACE > '1'                                            07677099
076780        MOVE '052-GRAVAR-SCR-ADICI.           ' TO WS-AQNBDTRA    07678099
076790        PERFORM 131-TRACE-TECNIC                                  07679099
076800     END-IF                                                       07680099
076810*tracet<-                                                         07681099
076820     MOVE EIBTASKN     TO   L100-AQNTASCA                         07682099
076830     MOVE L100-AREA    TO   L392-SCR-AQ                           07683099
076840     MOVE 'SC'         TO   L392-OPCIONS                          07684099
076850                                                                  07685099
076860     PERFORM 127-LINK-RAQW392                                     07686099
076870                                                                  07687099
076880     MOVE L392-SCR-AQ    TO   L100-AREA                           07688099
076890                                                                  07689099
076900     IF L392-AQ1ABNCD  >  SPACES                                  07690099
076910        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07691099
076920        MOVE L392-AQ1ABNCD         TO  L100-AQ1ABNCD              07692099
076930        PERFORM 099-ABEND-PROC                                    07693099
076940     END-IF.                                                      07694099
076950*                                                                 07695099
076960*----------------------------------------------------------------*07696099
076970*    Realiza el link al modulo y el control de errores           *07697099
076980*----------------------------------------------------------------*07698099
076990 053-LLAMAR-RAQWT00.                                              07699099
077000*-------------------                                              07700099
077010*tracet->                       +                                 07701099
077020     IF WS-TRACE > '1'                                            07702099
077030        MOVE '053-LLAMAR-RAQWT00.             ' TO WS-AQNBDTRA    07703099
077040        PERFORM 131-TRACE-TECNIC                                  07704099
077050     END-IF                                                       07705099
077060*tracet<-                                                         07706099
077070     EXEC CICS                                                    07707099
077080          LINK PROGRAM ('RAQWT00')                                07708099
077090          COMMAREA     (CAQLT00-AREA)                             07709099
077100          LENGTH       (LENGTH OF CAQLT00-AREA)                   07710099
077110          RESP         (COD-RESP)                                 07711099
077120     END-EXEC                                                     07712099
077130                                                                  07713099
077140     IF COD-RESP NOT = DFHRESP(NORMAL)                            07714099
077150        MOVE 'B'             TO L140-AQCODOPE                     07715099
077160        MOVE SPACES          TO L140-AQRETORN                     07716099
077170        MOVE 'RAQW001 '      TO L140-AQPROGRA                     07717099
077180        MOVE 'AQ  '          TO L140-AQ19APLI                     07718099
077190        MOVE SPACES          TO L140-AQ1ERRCD                     07719099
077200        MOVE SPACES          TO L140-AQ1ABNCD                     07720099
077210        MOVE 'ERROR EN LA LLAMADA AL RAQWT00'                     07721099
077220                             TO L140-AQMSGTXT                     07722099
077230                                                                  07723099
077240        EXEC CICS LINK                                            07724099
077250                  PROGRAM  ('RAQW140')                            07725099
077260                  COMMAREA (CAQL140-AREA)                         07726099
077270                  LENGTH   (LENGTH OF CAQL140-AREA)               07727099
077280                  RESP     (COD-RESP)                             07728099
077290        END-EXEC                                                  07729099
077300     ELSE                                                         07730099
077310        IF LT00-AQRCMAJ NOT = 'OK' AND                            07731099
077320           LT00-AQRCMAJ NOT = 'NF'                                07732099
077330           MOVE 'B'                TO L140-AQCODOPE               07733099
077340           MOVE SPACES             TO L140-AQRETORN               07734099
077350           MOVE 'RAQW001 '         TO L140-AQPROGRA               07735099
077360           MOVE 'AQ  '             TO L140-AQ19APLI               07736099
077370           MOVE SPACES             TO L140-AQ1ERRCD               07737099
077380           MOVE SPACES             TO L140-AQ1ABNCD               07738099
077390           MOVE 'RAQWT00'          TO WS-MODULO-E                 07739099
077400           MOVE LT00-AQRETCOD(1:4) TO WS-RETORNO-E                07740099
077410           MOVE WS-ERROR-MODULO    TO L140-AQMSGTXT               07741099
077420                                                                  07742099
077430           EXEC CICS LINK                                         07743099
077440                     PROGRAM  ('RAQW140')                         07744099
077450                     COMMAREA (CAQL140-AREA)                      07745099
077460                     LENGTH   (LENGTH OF CAQL140-AREA)            07746099
077470                     RESP     (COD-RESP)                          07747099
077480           END-EXEC                                               07748099
077490                                                                  07749099
077500        END-IF                                                    07750099
077510     END-IF                                                       07751099
077520     .                                                            07752099
077530*                                                                 07753099
077540*----------------------------------------------------------------*07754099
077550*    PREPARA AREES I LINK A RAQW392 ABANS DE LINK ALS APLICATIUS *07755099
077560*----------------------------------------------------------------*07756099
077570 054-LINK-ABANS-RAQW392.                                          07757099
077580*-----------------------                                          07758099
077590*tracet->                       +                                 07759099
077600     IF WS-TRACE > '1'                                            07760099
077610        MOVE '054-LINK-ABANS-RAQW392.         ' TO WS-AQNBDTRA    07761099
077620        PERFORM 131-TRACE-TECNIC                                  07762099
077630     END-IF                                                       07763099
077640*tracet<-                                                         07764099
077650*    MOVE EIBTASKN     TO   L100-AQNTASCA                         07765099
077660                                                                  07766099
077670     MOVE L100-AREA    TO   L392-SCR-AQ                           07767099
077680     MOVE 'FA'         TO   L392-OPCIONS                          07768099
077690                                                                  07769099
077700     PERFORM 127-LINK-RAQW392                                     07770099
077710                                                                  07771099
077720     MOVE L100-AREA         TO   L100-AREA-SALVADA                07772099
077730     MOVE L392-SCR-APL      TO   L100-AREA                        07773099
077740*    MOVE L392-SCR-APL      TO   CGTL0010-SCR-APLI                07774099
077750*    MOVE CGTL0010-SCR-APLI TO   L100-AREA                        07775099
077760                                                                  07776099
077770     IF L392-AQ1ABNCD  >  SPACES                                  07777099
077780        MOVE L392-SCR-AQ   TO   L100-AREA                         07778099
077790        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07779099
077800        MOVE L392-AQ1ABNCD TO  L100-AQ1ABNCD                      07780099
077810        PERFORM 099-ABEND-PROC                                    07781099
077820     END-IF.                                                      07782099
077830*                                                                 07783099
077840*----------------------------------------------------------------*07784099
077850*   RESTAURA AREES I LINK A RAQW392 DESPRES DEL LINK ALS APLICAT.*07785099
077860*----------------------------------------------------------------*07786099
077870 055-LINK-DESPRES-RAQW392.                                        07787099
077880*-------------------------                                        07788099
077890*tracet->                       +                                 07789099
077900     IF WS-TRACE > '1'                                            07790099
077910        MOVE '055-LINK-DESPRES-RAQW392.       ' TO WS-AQNBDTRA    07791099
077920        PERFORM 131-TRACE-TECNIC                                  07792099
077930     END-IF                                                       07793099
077940*tracet<-                                                         07794099
077950     MOVE L100-AREA         TO   L392-SCR-APL                     07795099
077960     MOVE L100-AREA-SALVADA TO   L392-SCR-AQ                      07796099
077970     MOVE 'AQ'              TO   L392-OPCIONS                     07797099
077980                                                                  07798099
077990     PERFORM 127-LINK-RAQW392                                     07799099
078000                                                                  07800099
078010*    MOVE L392-SCR-APL      TO   CGTL0010-SCR-APLI                07801099
078020     MOVE L392-SCR-AQ       TO   L100-AREA                        07802099
078030                                                                  07803099
078040     IF L392-AQ1ABNCD  >  SPACES                                  07804099
078050        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07805099
078060        MOVE L392-AQ1ABNCD         TO  L100-AQ1ABNCD              07806099
078070        PERFORM 099-ABEND-PROC                                    07807099
078080     END-IF.                                                      07808099
078090*                                                                 07809099
078100*----------------------------------------------------------------*07810099
078110*    GRABAR EN EL LOG UN MENSAJE CON EL CODIGO DE USURIO         *07811099
078120*----------------------------------------------------------------*07812099
078130 056-ERROR-RANGO-USUARIO.                                         07813099
078140*------------------------                                         07814099
078150*tracet->                       +                                 07815099
078160     IF WS-TRACE > '1'                                            07816099
078170        MOVE '056-ERROR-RANGO-USUARIO.        ' TO WS-AQNBDTRA    07817099
078180        PERFORM 131-TRACE-TECNIC                                  07818099
078190     END-IF                                                       07819099
078200*tracet<-                                                         07820099
078210*--> Formatea mensaje variable                                    07821099
078220*                                                                 07822099
078230     INITIALIZE L085-CAQL085                                      07823099
078240     MOVE 'V' TO L085-AQCODOPE                                    07824099
078250     EVALUATE TRUE                                                07825099
078260     WHEN SW-ERROR-USER-FISICO                                    07826099
078270          MOVE C-ABEND-US-FIS-NO-AUT TO L085-AQ4CLAVE             07827099
078280          MOVE W-USERID              TO L085-AQTXMENS (1)         07828099
078290     WHEN SW-ERROR-USER-LOGICO                                    07829099
078300          MOVE C-ABEND-US-LOG-NO-AUT TO L085-AQ4CLAVE             07830099
078310          MOVE L100-AQ1USCIC         TO L085-AQTXMENS (1)         07831099
078320     END-EVALUATE                                                 07832099
078330     PERFORM 047-LLAMADA-RAQW085                                  07833099
078340*                                                                 07834099
078350*--> LLamada al modulo de insercion en el LOG                     07835099
078360*                                                                 07836099
078370     INITIALIZE L145-CAQL145                                      07837099
078380     MOVE L085-AQTXME77 TO L145-AQMSGTXT                          07838099
078390     PERFORM 048-GRABAR-LOG                                       07839099
078400*                                                                 07840099
078410     MOVE C-USUA-NO-AUTORIZ TO L100-AQ1ABNCD                      07841099
078420     SET SW-ABEND-ARQUITECTURAL TO TRUE.                          07842099
078430*A288-I                                                           07843099
078440*                                                                 07844099
078450*----------------------------------------------------------------*07845099
078460*  requerimiento italia                                          *07846099
078470*   se obtiene la oficina del usuario facilitada por modulo exit *07847099
078480*   y se mueve a la oficina operante                             *07848099
078490*   es espa¦a el modulo exit mueve los datos de entrada a los    *07849099
078500*   datos de salida                                              *07850099
078510*----------------------------------------------------------------*07851099
078520 057-OBTENER-OFICINA-USUARIO.                                     07852099
078530*----------------------------                                     07853099
078540*tracet->                       +                                 07854099
078550     IF WS-TRACE > '1'                                            07855099
078560        MOVE '057-OBTENER-OFICINA-USUARIO.    ' TO WS-AQNBDTRA    07856099
078570        PERFORM 131-TRACE-TECNIC                                  07857099
078580     END-IF                                                       07858099
078590*tracet<-                                                         07859099
078600     MOVE L100-AQ1USCIC  TO LC01-AQIUSER                          07860099
078610     MOVE F060-AQ9ENTOP  TO LC01-AQIENTIT                         07861099
078620     MOVE F060-AQ9OFICO  TO LC01-AQIBRANC                         07862099
078630     MOVE L310-AQSCRARC  TO LC01-AQSCRPTR                         07863099
078640     EXEC CICS LINK PROGRAM ('RAQWC01') RESP (COD-RESP)           07864099
078650          COMMAREA (AREA-CAQLC01)                                 07865099
078660     END-EXEC                                                     07866099
078670     IF LC01-AQORETCD = 'OK'                                      07867099
078680*       MOVE LC01-AQOENTIT  TO F060-AQ9ENTOP                      07868099
078690        MOVE LC01-AQOBRANC  TO F060-AQ9OFICO                      07869099
078700     ELSE                                                         07870099
078710        INITIALIZE L045-CAQL045                                   07871099
078720        MOVE 'JGTB143'      TO L100-AQ1ABNCD                      07872099
078730        MOVE 'JGTB143'      TO L045-AQ4CLAVE                      07873099
078740        MOVE 'RAQWC01'      TO L045-AQTXMENS (1)                  07874099
078750        MOVE LC01-AQORETCD  TO L045-AQTXMENS (2)                  07875099
078760        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07876099
078770        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    07877099
078780        PERFORM 099-ABEND-PROC                                    07878099
078790     END-IF                                                       07879099
078800     .                                                            07880099
078810*A288-F                                                           07881099
078820*                                                                 07882099
078830*----------------------------------------------------------------*07883099
078840*    -  MOVER LOS DATOS DE LA CCT AL SCR                         *07884099
078850*----------------------------------------------------------------*07885099
078860 058-MOVER-DATOS-CCT.                                             07886099
078870*--------------------                                             07887099
078880*tracet->                       +                                 07888099
078890     IF WS-TRACE > '1'                                            07889099
078900        MOVE '058-MOVER-DATOS-CCT.            ' TO WS-AQNBDTRA    07890099
078910        PERFORM 131-TRACE-TECNIC                                  07891099
078920     END-IF                                                       07892099
078930*tracet<-                                                         07893099
078940     MOVE SPACES        TO L100-AQ1MSTOI                          07894099
078950     MOVE F030-AQ3TRNID TO L100-AQ1TRANT                          07895099
078960     MOVE F030-AQ3APLIC TO L100-AQ1APLIC                          07896099
078970     MOVE F030-AQ3ENTRA TO L100-AQ1ENTRA                          07897099
078980*J9715-I                                                          07898099
078990*    MOVE F030-AQ3WKAIN TO L100-AQ1WAINT                          07899099
079000*J9715-F                                                          07900099
079010     MOVE F030-AQ3IND03 TO L100-AQ1STTRM                          07901099
079020     MOVE F030-AQ3IND03 TO L100-AQ1STTER                          07902099
079030     MOVE F030-AQ3TIP01 TO L100-AQ1ST32P                          07903099
079040     MOVE F030-AQ3TIP02 TO L100-AQ1STTRN                          07904099
079050     MOVE F030-AQ3NUMPA TO L100-AQ1NUMPA                          07905099
079060     MOVE F030-AQ3PNLIN TO L100-AQ1PNLIN.                         07906099
079070*                                                                 07907099
079080*----------------------------------------------------------------*07908099
079090*    COMPROBAR ESTADO DE LA APLICACION A LA QUE PERTENECE LA     *07909099
079100*    LA TRASACCION.                                              *07910099
079110*----------------------------------------------------------------*07911099
079120 059-COMPROVAR-ESTAT-APLICACIO.                                   07912099
079130*------------------------------                                   07913099
079140*tracet->                       +                                 07914099
079150     IF WS-TRACE > '1'                                            07915099
079160        MOVE '059-COMPROVAR-ESTAT-APLICACIO.  ' TO WS-AQNBDTRA    07916099
079170        PERFORM 131-TRACE-TECNIC                                  07917099
079180     END-IF                                                       07918099
079190*tracet<-                                                         07919099
079200     MOVE 'AP'            TO L310-AQCODOPE                        07920099
079210     INITIALIZE W001-CAQW001                                      07921099
079220     MOVE F030-AQ3APLIC   TO W001-APLICA                          07922099
079230                                                                  07923099
079240     PERFORM 041-LINK-RAQW008                                     07924099
079250                                                                  07925099
079260     IF L310-MSGABEND NOT = SPACES                                07926099
079270        MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                      07927099
079280        MOVE 'RAQW008'      TO L045-AQTXMENS (1)                  07928099
079290        MOVE L310-AQCODRET  TO L045-AQTXMENS (2)                  07929099
079300        SET SW-ABEND-ARQUITECTURAL TO TRUE                        07930099
079310        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    07931099
079320        PERFORM 099-ABEND-PROC                                    07932099
079330     END-IF                                                       07933099
079340*                                                                 07934099
079350*30-03-2005-JO                                                    07935099
079360     MOVE SPACES TO L100-AQTRFAST                                 07936099
079370*                                                                 07937099
079380                                                                  07938099
079390     IF L310-AQCODRET = 'ER'                                      07939099
079400        PERFORM 031-FINAL                                         07940099
079410     END-IF                                                       07941099
079420                                                                  07942099
079430     MOVE W001-ESTAT-BASES     TO SW-ESTADO-BD-APL                07943099
079440                                                                  07944099
079450     IF W001-APLICA-EXISTEIX = '0'                                07945099
079460        MOVE '2'               TO SW-APLICACION                   07946099
079470     ELSE                                                         07947099
079480        MOVE W001-ESTAT-APLICA TO SW-APLICACION                   07948099
079490     END-IF.                                                      07949099
079500*                                                                 07950099
079510*----------------------------------------------------------------*07951099
079520*     ENVIO DE LA RESPUESTA AL TERMINAL FINANCIERO               *07952099
079530*----------------------------------------------------------------*07953099
079540 060-ENVIAR-RESPUESTA.                                            07954099
079550*---------------------                                            07955099
079560*tracet->                       +                                 07956099
079570     IF WS-TRACE > '1'                                            07957099
079580        MOVE '060-ENVIAR-RESPUESTA.           ' TO WS-AQNBDTRA    07958099
079590        PERFORM 131-TRACE-TECNIC                                  07959099
079600     END-IF                                                       07960099
079610*tracet<-                                                         07961099
079620     MOVE 'SN'          TO L310-AQCODOPE                          07962099
079630     INITIALIZE W001-CAQW001                                      07963099
079640     PERFORM 040-LINK-RAQW005.                                    07964099
079650*                                                                 07965099
079660* INI-JLM-11/06/02                                                07966099
079670*----------------------------------------------------------------*07967099
079680*20-REGRAVA-FAQ030.                                               07968099
079690*                                                                 07969099
079700*                                                                 07970099
079710*    MOVE '0'                TO  F030-AQSWPAGI                    07971099
079720*                                                                 07972099
079730*    MOVE SPACES             TO  L310-AQARGMNT                    07973099
079740*    MOVE F030-CAQF030(1:4)  TO  L310-AQARGMNT(1:4)               07974099
079750*    MOVE '0'                TO  L310-AQCODOP1                    07975099
079760*    MOVE '4'                TO  L310-AQCODOP2                    07976099
079770*                                                                 07977099
079780*    EXEC CICS LINK PROGRAM ('RAQW311') COMMAREA (AREA-CAQL310)   07978099
079790*         RESP (COD-RESP)                                         07979099
079800*    END-EXEC.                                                    07980099
079810*                                                                 07981099
079820*                                                                 07982099
079830*----------------------------------------------------------------*07983099
079840*    ACCESO AL MODULO DE DE CONSULTA DE TABLAS GENERALES         *07984099
079850*----------------------------------------------------------------*07985099
079860 061-INVOCAR-RTGU005.                                             07986099
079870*--------------------                                             07987099
079880*tracet->                       +                                 07988099
079890     IF WS-TRACE > '1'                                            07989099
079900        MOVE '061-INVOCAR-RTGU005.            ' TO WS-AQNBDTRA    07990099
079910        PERFORM 131-TRACE-TECNIC                                  07991099
079920     END-IF                                                       07992099
079930*tracet<-                                                         07993099
079940     EXEC CICS LINK PROGRAM  ('RTGU005') COMMAREA (AREA-CTGL005)  07994099
079950          RESP (COD-RESP)                                         07995099
079960     END-EXEC                                                     07996099
079970                                                                  07997099
079980     IF COD-RESP NOT = DFHRESP (NORMAL)                           07998099
079990        PERFORM 033-INFORMAR-DATOS-ABEND                          07999099
080000     END-IF                                                       08000099
080010                                                                  08001099
080020     EVALUATE CTGL005-CDRETORN                                    08002099
080030     WHEN '00'                                                    08003099
080040     WHEN '10'                                                    08004099
080050          CONTINUE                                                08005099
080060     WHEN OTHER                                                   08006099
080070          MOVE C-ERROR-MODULO   TO L100-AQ1ABNCD                  08007099
080080          MOVE 'RTGU005'        TO L045-AQTXMENS (1)              08008099
080090          MOVE CTGL005-CDRETORN TO L045-AQTXMENS (2)              08009099
080100          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  08010099
080110          PERFORM 099-ABEND-PROC                                  08011099
080120     END-EVALUATE                                                 08012099
080130     .                                                            08013099
080140*                                                                 08014099
080150*----------------------------------------------------------------*08015099
080160*    BUSCAR EL CODIGO DE TRANSACCION EN EL REGISTRO DE TABLA 600 *08016099
080170*----------------------------------------------------------------*08017099
080180 062-BUSCAR-TRANSACCION.                                          08018099
080190*-----------------------                                          08019099
080200*tracet->                       +                                 08020099
080210     IF WS-TRACE > '1'                                            08021099
080220        MOVE '062-BUSCAR-TRANSACCION.         ' TO WS-AQNBDTRA    08022099
080230        PERFORM 131-TRACE-TECNIC                                  08023099
080240     END-IF                                                       08024099
080250*tracet<-                                                         08025099
080260     SET SW-SEGUIR-BUCLE TO TRUE                                  08026099
080270     MOVE CTGL005-CONTOCUR TO WS-TABLA-TRAN                       08027099
080280                                                                  08028099
080290     PERFORM VARYING WS-IND1 FROM 1 BY 1                          08029099
080300     UNTIL WS-IND1 > 10 OR SW-ENCONTRADO OR SW-FIN-BUCLE          08030099
080310        IF L100-AQ1TRANT = WS-TRAN-1 (WS-IND1) OR                 08031099
080320           L100-AQ1TRANT = WS-TRAN-2 (WS-IND1) OR                 08032099
080330           L100-AQ1TRANT = WS-TRAN-3 (WS-IND1) OR                 08033099
080340           L100-AQ1TRANT = WS-TRAN-4 (WS-IND1) OR                 08034099
080350           L100-AQ1TRANT = WS-TRAN-5 (WS-IND1)                    08035099
080360           SET SW-ENCONTRADO TO TRUE                              08036099
080370        ELSE                                                      08037099
080380           IF WS-TRAN-1 (WS-IND1) = '****' OR                     08038099
080390              WS-TRAN-2 (WS-IND1) = '****' OR                     08039099
080400              WS-TRAN-3 (WS-IND1) = '****' OR                     08040099
080410              WS-TRAN-4 (WS-IND1) = '****' OR                     08041099
080420              WS-TRAN-5 (WS-IND1) = '****'                        08042099
080430              SET SW-FIN-BUCLE TO TRUE                            08043099
080440           END-IF                                                 08044099
080450        END-IF                                                    08045099
080460     END-PERFORM                                                  08046099
080470     .                                                            08047099
080480*                                                                 08048099
080490*----------------------------------------------------------------*08049099
080500*   LINK PROGRAMA RAQW009                                       .*08050099
080510*----------------------------------------------------------------*08051099
080520 063-LINK-RAQW009.                                                08052099
080530*-----------------                                                08053099
080540*tracet->                       +                                 08054099
080550     IF WS-TRACE > '1'                                            08055099
080560        MOVE '063-LINK-RAQW009.               ' TO WS-AQNBDTRA    08056099
080570        PERFORM 131-TRACE-TECNIC                                  08057099
080580     END-IF                                                       08058099
080590*tracet<-                                                         08059099
080600     MOVE SPACES       TO L310-MSGABEND                           08060099
080610     MOVE W001-CAQW001 TO L310-AQARPARM                           08061099
080620                                                                  08062099
080630* JVB 20020225 INI                                                08063099
080640*    SET ADDRESS OF LK-AREA-SCR   TO  L310-AQSCRAR                08064099
080650*    MOVE L100-AREA-TOTAL         TO  LK-AREA-SCR                 08065099
080660* JVB 20020225 FIN                                                08066099
080670                                                                  08067099
080680     EXEC CICS LINK PROGRAM ('RAQW009') RESP (COD-RESP)           08068099
080690          COMMAREA (L310-CAQL310)                                 08069099
080700     END-EXEC                                                     08070099
080710                                                                  08071099
080720     IF COD-RESP NOT = DFHRESP (NORMAL)                           08072099
080730        PERFORM 033-INFORMAR-DATOS-ABEND                          08073099
080740     END-IF                                                       08074099
080750                                                                  08075099
080760* JVB 20020225 INI                                                08076099
080770*    MOVE LK-AREA-SCR             TO  L100-AREA-TOTAL             08077099
080780* JVB 20020225 INI                                                08078099
080790*                                                                 08079099
080800     IF L310-MSGABEND NOT = SPACES                                08080099
080810        PERFORM 033-INFORMAR-DATOS-ABEND                          08081099
080820     END-IF                                                       08082099
080830                                                                  08083099
080840     IF L310-AQCODRET  NOT = '  '                                 08084099
080850        MOVE 'RAQW009'      TO L045-AQTXMENS (1)                  08085099
080860        PERFORM 129-ERROR-MODULS-RAQWNNN                          08086099
080870     END-IF                                                       08087099
080880                                                                  08088099
080890     MOVE L310-AQARPARM  TO  W001-CAQW001.                        08089099
080900*                                                                 08090099
080910*----------------------------------------------------------------*08091099
080920*    RETORN TRANSACCIO AMB TRASPASSOS TOTALS                     *08092099
080930*----------------------------------------------------------------*08093099
080940 064-RECUPERA-MAPA.                                               08094099
080950*------------------                                               08095099
080960*tracet->                       +                                 08096099
080970     IF WS-TRACE > '1'                                            08097099
080980        MOVE '064-RECUPERA-MAPA.              ' TO WS-AQNBDTRA    08098099
080990        PERFORM 131-TRACE-TECNIC                                  08099099
081000     END-IF                                                       08100099
081010*tracet<-                                                         08101099
081020     INITIALIZE  W001-CAQW001                                     08102099
081030     MOVE 'RM'           TO L310-AQCODOPE                         08103099
081040     MOVE F030-AQ3PGMID  TO W001-ENTRADA                          08104099
081050     MOVE W-EIBTRMID     TO W001-AQTERMI                          08105099
081060                                                                  08106099
081070     PERFORM 095-LINK-RAQW007                                     08107099
081080                                                                  08108099
081090     IF L310-AQCODRET = 'ER'                                      08109099
081100        PERFORM 107-ERROR-PF6                                     08110099
081110     ELSE                                                         08111099
081120        MOVE L100-AQPTL135 TO  W-PUNTER-COMP                      08112099
081130        SET ADDRESS OF AREA-CAQL135  TO  W-PUNTER-POINTER         08113099
081140     END-IF.                                                      08114099
081150*                                                                 08115099
081160*----------------------------------------------------------------*08116099
081170*--> SI EN LA TRANSACCION ANTERIOR SE SOLICITO AUTORIZACION      *08117099
081180*--> (PEAU O 4OJOS) Y EL CANAL NO LO ADMITE SE DESACTIVA         *08118099
081190*--> EL INDICADOR.                                               *08119099
081200*----------------------------------------------------------------*08120099
081210 065-VERIF-AUTORIZ-ENTRADA.                                       08121099
081220*--------------------------                                       08122099
081230*tracet->                       +                                 08123099
081240     IF WS-TRACE > '1'                                            08124099
081250        MOVE '065-VERIF-AUTORIZ-ENTRADA.      ' TO WS-AQNBDTRA    08125099
081260        PERFORM 131-TRACE-TECNIC                                  08126099
081270     END-IF                                                       08127099
081280*tracet<-                                                         08128099
081290     EVALUATE TRUE                                                08129099
081300     WHEN L100-AUTORIZ-PEAU                                       08130099
081310     WHEN L100-AUTORIZ-USUARI                                     08131099
081320          EVALUATE TRUE                                           08132099
081330          WHEN L121-CANAL-SI-PEAU                                 08133099
081340               CONTINUE                                           08134099
081350          WHEN L121-CANAL-NO-PEAU                                 08135099
081360               MOVE '0' TO L100-AQ1STAUT                          08136099
081370               INITIALIZE L100-AQ1INCU8                           08137099
081380          WHEN OTHER                                              08138099
081390               MOVE C-ABEND-TIPO-PEAU TO L100-AQ1ABNCD            08139099
081400               MOVE L121-AQSWPEAU     TO L045-AQTXMENS (1)        08140099
081410               PERFORM 037-FORMATEAR-MENSAJE-VARIABLE             08141099
081420          END-EVALUATE                                            08142099
081430     WHEN L100-AUTORIZ-4OJOS                                      08143099
081440     WHEN L100-AUTORIZ-4OJOS-8                                    08144099
081450*BROADCAST4EYES-I                                                 08145099
081460     WHEN L100-AUTORIZ-PEAU-DIST                                  08146099
081470     WHEN L100-AUTORIZ-PEAU-DIST-INIT                             08147099
081480     WHEN L100-AUTORIZ-4OJOS-DIST                                 08148099
081490     WHEN L100-AUTORIZ-4OJOS-DIST-INIT                            08149099
081500*BROADCAST4EYES-E                                                 08150099
081510          EVALUATE TRUE                                           08151099
081520*QO2->                                                            08152099
081530***       WHEN L121-CANAL-4OJOS-STANDARD                          08153099
081540          WHEN L121-CANAL-SI-CUATRO-OJOS                          08154099
081550*QO2->                                                            08155099
081560               CONTINUE                                           08156099
081570          WHEN L121-CANAL-NO-CUATRO-OJOS                          08157099
081580               MOVE '0' TO L100-AQ1STAUT                          08158099
081590               INITIALIZE L100-AQ1INCU8                           08159099
081600          WHEN OTHER                                              08160099
081610               MOVE C-ABEND-TIPO-4OJOS TO L100-AQ1ABNCD           08161099
081620               MOVE L121-AQSWCUOJ      TO L045-AQTXMENS (1)       08162099
081630               PERFORM 037-FORMATEAR-MENSAJE-VARIABLE             08163099
081640          END-EVALUATE                                            08164099
081650     END-EVALUATE                                                 08165099
081660*                                                                 08166099
081670     IF L100-AQ1ABNCD NOT = SPACES                                08167099
081680        SET SW-ABEND-ARQUITECTURAL TO TRUE                        08168099
081690        PERFORM 099-ABEND-PROC                                    08169099
081700     END-IF.                                                      08170099
081710*                                                                 08171099
081720*----------------------------------------------------------------*08172099
081730*    -  FORMATEAR O DEFORMATEAR EL AREA DE PANTALLA              *08173099
081740*----------------------------------------------------------------*08174099
081750 066-FORMAT-DEFORM-MENS.                                          08175099
081760*-----------------------                                          08176099
081770*tracet->                       +                                 08177099
081780     IF WS-TRACE > '1'                                            08178099
081790        MOVE '066-FORMAT-DEFORM-MENS.         ' TO WS-AQNBDTRA    08179099
081800        PERFORM 131-TRACE-TECNIC                                  08180099
081810     END-IF                                                       08181099
081820*tracet<-                                                         08182099
081830     IF F060-TERM-FINANCIERO                                      08183099
081840         MOVE C-MES-TF TO W-MODULO                                08184099
081850     ELSE                                                         08185099
081860         MOVE C-MES-3270 TO W-MODULO                              08186099
081870     END-IF                                                       08187099
081880*                                                                 08188099
081890     EXEC CICS LINK PROGRAM (W-MODULO)                            08189099
081900          COMMAREA (L100-AREA) RESP (COD-RESP)                    08190099
081910     END-EXEC                                                     08191099
081920     IF COD-RESP NOT = DFHRESP (NORMAL)                           08192099
081930         PERFORM 033-INFORMAR-DATOS-ABEND                         08193099
081940     END-IF.                                                      08194099
081950*----------------------------------------------------------------*08195099
081960 067-PREPARA-CAQL135.                                             08196099
081970*--------------------                                             08197099
081980*tracet->                       +                                 08198099
081990     IF WS-TRACE > '1'                                            08199099
082000        MOVE '067-PREPARA-CAQL135.            ' TO WS-AQNBDTRA    08200099
082010        PERFORM 131-TRACE-TECNIC                                  08201099
082020     END-IF                                                       08202099
082030*tracet<-                                                         08203099
082040     INITIALIZE W001-CAQW001                                      08204099
082050     MOVE SPACES            TO L310-MSGABEND                      08205099
082060     MOVE W001-CAQW001      TO L310-AQARPARM                      08206099
082070                                                                  08207099
082080     EXEC CICS LINK PROGRAM ('RAQW135') COMMAREA (L310-CAQL310)   08208099
082090          RESP (COD-RESP)                                         08209099
082100     END-EXEC                                                     08210099
082110                                                                  08211099
082120     IF L310-MSGABEND NOT = SPACES                                08212099
082130        MOVE L310-MSGABEND  TO  L100-AQ1ABNCD                     08213099
082140        PERFORM 099-ABEND-PROC                                    08214099
082150     ELSE                                                         08215099
082160        MOVE L100-AQPTL135 TO  W-PUNTER-COMP                      08216099
082170        SET ADDRESS OF AREA-CAQL135  TO  W-PUNTER-POINTER         08217099
082180     END-IF.                                                      08218099
082190*                                                                *08219099
082200******************************************************************08220099
082210 068-SIES-CONTRACTE-AGENT.                                        08221099
082220*-------------------------                                        08222099
082230*tracet->                       +                                 08223099
082240     IF WS-TRACE > '1'                                            08224099
082250        MOVE '068-SIES-CONTRACTE-AGENT.       ' TO WS-AQNBDTRA    08225099
082260        PERFORM 131-TRACE-TECNIC                                  08226099
082270     END-IF                                                       08227099
082280*tracet<-                                                         08228099
082290* JO-11062004  SI INDICADOR ES OK NO FER AQUEST PARAGRAF          08229099
082300     IF L100-VAL-AGENT-OK                                         08230099
082310*BROADCAST4EYES-I                                                 08231099
082320*       Si estamos en proceso de verificacion remota              08232099
082330        OR L100-AQFILL16 NOT = SPACES                             08233099
082340*BROADCAST4EYES-E                                                 08234099
082350        CONTINUE                                                  08235099
082360     ELSE                                                         08236099
082370        SET  L100-VAL-AGENT-EN-PROCESO TO TRUE                    08237099
082380        PERFORM 054-LINK-ABANS-RAQW392                            08238099
082390        PERFORM 055-LINK-DESPRES-RAQW392                          08239099
082400        EXEC CICS LINK PROGRAM ('RAQW370') RESP (COD-RESP)        08240099
082410             COMMAREA (L100-AREA-TOTAL)                           08241099
082420        END-EXEC                                                  08242099
082430        IF COD-RESP NOT = DFHRESP (NORMAL)                        08243099
082440           PERFORM 033-INFORMAR-DATOS-ABEND                       08244099
082450        END-IF                                                    08245099
082460        IF L100-AQ1ABNCD NOT = SPACES                             08246099
082470           SET SW-ABEND-APLICATIVO TO TRUE                        08247099
082480           PERFORM 099-ABEND-PROC                                 08248099
082490        END-IF                                                    08249099
082500        IF L100-AQ1STLIB  = '0'                                   08250099
082510           SET  L100-VAL-AGENT-NO         TO TRUE                 08251099
082520        END-IF                                                    08252099
082530     END-IF.                                                      08253099
082540*                                                                 08254099
082550*----------------------------------------------------------------*08255099
082560*    COMPROBAR SI EL TERMINAL PUEDE IMPRIMIR                     *08256099
082570*                                                                *08257099
082580*    ACCESO A LA TABLA GENERAL 600 PARA OBTENER TODAS LAS TRAN - *08258099
082590*    SACCIONES QUE NO SE PUEDEN IMPRIMIR POR EL TIPO DE IMPRESORA*08259099
082600*    'IBM 4722'                                                  *08260099
082610*----------------------------------------------------------------*08261099
082620 069-COMPATIBILIDAD-IMPRESORA.                                    08262099
082630*-----------------------------                                    08263099
082640*tracet->                       +                                 08264099
082650     IF WS-TRACE > '1'                                            08265099
082660        MOVE '069-COMPATIBILIDAD-IMPRESORA.   ' TO WS-AQNBDTRA    08266099
082670        PERFORM 131-TRACE-TECNIC                                  08267099
082680     END-IF                                                       08268099
082690*tracet<-                                                         08269099
082700      SET SW-NO-ENCONTRADO TO TRUE                                08270099
082710      SET SW-SEGUIR-BUCLE  TO TRUE                                08271099
082720      INITIALIZE AREA-CTGL005                                     08272099
082730      INITIALIZE T600-CTGT0600                                    08273099
082740      MOVE 1             TO W-ITEM                                08274099
082750      MOVE '0600'        TO CTGL005-CDTABLA                       08275099
082760      MOVE '0019'        TO CTGL005-STBANCO                       08276099
082770      MOVE 1             TO CTGL005-NUCLAVE                       08277099
082780      MOVE 'AQ'          TO T600-TGCDAPL3                         08278099
082790      MOVE 'NOIMPRES'    TO T600-TGCDPRO8                         08279099
082800      MOVE W-ITEM        TO T600-TGNUSEC3                         08280099
082810      MOVE T600-CLAT0600 TO CTGL005-CLAVTAB                       08281099
082820***   Lectura adelantada de la tabla 600                          08282099
082830      PERFORM 061-INVOCAR-RTGU005                                 08283099
082840***   Bucle para la lectura de todos los registros                08284099
082850      PERFORM UNTIL CTGL005-CDRETORN = '10'                       08285099
082860      OR SW-ENCONTRADO OR SW-FIN-BUCLE                            08286099
082870          PERFORM 062-BUSCAR-TRANSACCION                          08287099
082880          COMPUTE W-ITEM = W-ITEM + 1                             08288099
082890          MOVE W-ITEM        TO T600-TGNUSEC3                     08289099
082900          MOVE T600-CLAT0600 TO CTGL005-CLAVTAB                   08290099
082910          PERFORM 061-INVOCAR-RTGU005                             08291099
082920      END-PERFORM                                                 08292099
082930***                                                               08293099
082940      IF SW-ENCONTRADO                                            08294099
082950***      Este SET es para evitar que se invoque a RAQWA11 para    08295099
082960***      obtener avisos a posteriori, ya que de lo contrario      08296099
082970***      este modulo daria un error de parametros                 08297099
082980         SET SW-GRABAR-DIARIO TO TRUE                             08298099
082990         SET SW-ERROR-ENTORNO-EJEC TO TRUE                        08299099
083000         MOVE 'JAQE261' TO L100-AQ1ERRCD                          08300099
083010         PERFORM 031-FINAL                                        08301099
083020      END-IF                                                      08302099
083030      .                                                           08303099
083040*                                                                 08304099
083050*----------------------------------------------------------------*08305099
083060*    INICIALITZAR ARXIU FAQ180 DE PAGINACIO                      *08306099
083070*--> MLV200700 INICIO                                             08307099
083080*    En estado inicio caso 1 invocar al modulo RAQW180 para       08308099
083090*    eliminar datos de paginacion                                 08309099
083100*    El modulo RAQW170 necesita la direccion del SCR. Debido a que08310099
083110*    en este programa el SCR (CAQL100) esta en Working se necesita08311099
083120*    obtener un area especial en Linkage donde se movera un       08312099
083130*----------------------------------------------------------------*08313099
083140 070-INICIA-FAQ180-PAGINACIO.                                     08314099
083150*----------------------------                                     08315099
083160*tracet->                       +                                 08316099
083170     IF WS-TRACE > '1'                                            08317099
083180        MOVE '070-INICIA-FAQ180-PAGINACIO.    ' TO WS-AQNBDTRA    08318099
083190        PERFORM 131-TRACE-TECNIC                                  08319099
083200     END-IF                                                       08320099
083210*tracet<-                                                         08321099
083220*M028b->                                                          08322099
083230     IF L100-ESTADO-INICIO OR L100-CAMBIO-POR-APLICACION          08323099
083240        PERFORM 077-ESBORRA-PAGINACIO-2                           08324099
083250     END-IF                                                       08325099
083260*<-M028b                                                          08326099
083270*                                                                 08327099
083280     IF L100-ESTADO-INICIO                                        08328099
083290*JSP01->                                                          08329099
083300*       IF L100-AQ1DCASO = 1                                      08330099
083310        IF L100-AQ1DCASO = 1 AND L100-AQ1TRANT  NOT = 'AQLM'      08331099
083320*JSP01<-                                                          08332099
083330           INITIALIZE L170-CAQL170                                08333099
083340*       PASSA LA ADREÇA DE LA SCR L310-AQSCRAR -> L170-AQPTRSCR   08334099
083350           SET L170-AQPTRSCR TO L310-AQSCRAR                      08335099
083360           MOVE 'B' TO L170-AQCODOPE                              08336099
083370           MOVE 'P' TO L170-AQTPDATO                              08337099
083380           EXEC CICS LINK PROGRAM ('RAQW170') RESP (COD-RESP)     08338099
083390                COMMAREA (L170-CAQL170)                           08339099
083400                LENGTH (LENGTH OF L170-CAQL170)                   08340099
083410           END-EXEC                                               08341099
083420           IF COD-RESP NOT = DFHRESP (NORMAL)                     08342099
083430              PERFORM 033-INFORMAR-DATOS-ABEND                    08343099
083440           END-IF                                                 08344099
083450           IF L170-AQRETORN NOT = SPACES                          08345099
083460              MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                08346099
083470              MOVE 'RAQW170'      TO L045-AQTXMENS (1)            08347099
083480              MOVE L170-AQRETORN  TO L045-AQTXMENS (2)            08348099
083490              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              08349099
083500              PERFORM 099-ABEND-PROC                              08350099
083510           END-IF                                                 08351099
083520                                                                  08352099
083530*       BORRAT DE REGISTES LOPD tipus b                           08353099
083540                                                                  08354099
083550           MOVE 'P' TO L170-AQCODOPE                              08355099
083560           MOVE 'B' TO L170-AQTPDATO                              08356099
083570           EXEC CICS LINK PROGRAM ('RAQW170') RESP (COD-RESP)     08357099
083580                COMMAREA (L170-CAQL170)                           08358099
083590                LENGTH (LENGTH OF L170-CAQL170)                   08359099
083600           END-EXEC                                               08360099
083610           IF COD-RESP NOT = DFHRESP (NORMAL)                     08361099
083620              PERFORM 033-INFORMAR-DATOS-ABEND                    08362099
083630           END-IF                                                 08363099
083640           IF L170-AQRETORN NOT = SPACES                          08364099
083650              MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                08365099
083660              MOVE 'RAQW170'      TO L045-AQTXMENS (1)            08366099
083670              MOVE L170-AQRETORN  TO L045-AQTXMENS (2)            08367099
083680              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              08368099
083690              PERFORM 099-ABEND-PROC                              08369099
083700           END-IF                                                 08370099
083710       END-IF                                                     08371099
083720     END-IF.                                                      08372099
083730*                                                                *08373099
083740*----------------------------------------------------------------*08374099
083750 071-NAVEGACION.                                                  08375099
083760*----------------                                                 08376099
083770*tracet->                       +                                 08377099
083780     IF WS-TRACE > '1'                                            08378099
083790        MOVE '071-NAVEGACION.                 ' TO WS-AQNBDTRA    08379099
083800        PERFORM 131-TRACE-TECNIC                                  08380099
083810     END-IF                                                       08381099
083820*tracet<-                                                         08382099
083830*--> Informar el puntero del SCR                                  08383099
083840*                                                                 08384099
083850     MOVE L310-AQSCRARC TO LN09-AQSCRPTR                          08385099
083860*                                                                 08386099
083870     EXEC CICS LINK PROGRAM ('RAQWN09') COMMAREA (LN09-CAQLN09)   08387099
083880          LENGTH (LENGTH OF LN09-CAQLN09) RESP (COD-RESP)         08388099
083890     END-EXEC                                                     08389099
083900*                                                                 08390099
083910     IF COD-RESP NOT = DFHRESP (NORMAL)                           08391099
083920        PERFORM 033-INFORMAR-DATOS-ABEND                          08392099
083930     END-IF                                                       08393099
083940*                                                                 08394099
083950     EVALUATE TRUE                                                08395099
083960     WHEN LN09-OK-SI-APLICACION                                   08396099
083970          SET SW-SI-LLAMAR-PGM-APLIC TO TRUE                      08397099
083980     WHEN LN09-OK-NO-APLICACION                                   08398099
083990          SET SW-NO-LLAMAR-PGM-APLIC TO TRUE                      08399099
084000     WHEN LN09-NO-EXISTE-CCT                                      08400099
084010          PERFORM 031-FINAL                                       08401099
084020     WHEN OTHER                                                   08402099
084030          MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                    08403099
084040          MOVE 'RAQWN09'      TO L045-AQTXMENS (1)                08404099
084050          MOVE LN09-AQRETCOD  TO L045-AQTXMENS (2)                08405099
084060          SET SW-ABEND-ARQUITECTURAL TO TRUE                      08406099
084070          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  08407099
084080          PERFORM 099-ABEND-PROC                                  08408099
084090     END-EVALUATE                                                 08409099
084100     .                                                            08410099
084110*                                                                 08411099
084120*----------------------------------------------------------------*08412099
084130*    ANTE DE LLAMAR AL PROGRAMA DE APLICACION SE COMPRUEBA SI    *08413099
084140*    EXISTE UNA POSIBLE NAVEGACION A OTRA TRANSACCION            *08414099
084150*----------------------------------------------------------------*08415099
084160 072-ENLAZAR-CON-APLIC.                                           08416099
084170*----------------------                                           08417099
084180*tracet->                       +                                 08418099
084190     IF WS-TRACE > '1'                                            08419099
084200        MOVE '072-ENLAZAR-CON-APLIC.          ' TO WS-AQNBDTRA    08420099
084210        PERFORM 131-TRACE-TECNIC                                  08421099
084220     END-IF                                                       08422099
084230*tracet<-                                                         08423099
084240     SET SW-SI-LLAMAR-PGM-APLIC TO TRUE                           08424099
084250*                                                                 08425099
084260     INITIALIZE LN09-CAQLN09                                      08426099
084270     IF L121-CANAL-NAVEGACION-SI                                  08427099
084280        IF L100-AQ1MESAI = DFHPF6                                 08428099
084290           SET LN09-NIVEL-ANTERIOR TO TRUE                        08429099
084300           PERFORM 071-NAVEGACION                                 08430099
084310        ELSE                                                      08431099
084320           IF L300-ENTORNO-ECDL                                   08432099
084330              MOVE L100-AQ1MESAI TO WS-TECLA                      08433099
084340              IF SW-TECLA-CON-RELACION                            08434099
084350                 SET LN09-RELACION-TECLA TO TRUE                  08435099
084360                 PERFORM 071-NAVEGACION                           08436099
084370              ELSE                                                08437099
084380                 IF L000-AQCDCHTR NOT = SPACES                    08438099
084390                    SET LN09-TRANSACCION-RELACIONADA TO TRUE      08439099
084400                    PERFORM 071-NAVEGACION                        08440099
084410                 END-IF                                           08441099
084420              END-IF                                              08442099
084430           END-IF                                                 08443099
084440        END-IF                                                    08444099
084450     END-IF                                                       08445099
084460*                                                                 08446099
084470*                                                                 08447099
084480*I005 INICIO                                                      08448099
084490*                                                                 08449099
084500*    Si el canal no tiene activo el servicio de navegacion        08450099
084510*     o el canal tiene activo el servicio de navegacion y no se   08451099
084520*     ha de pasar el control a la Aplicacion porque hay que       08452099
084530*     enlazar con otra transaccion                                08453099
084540     IF (NOT L121-CANAL-NAVEGACION-SI) OR                         08454099
084550        (L121-CANAL-NAVEGACION-SI AND SW-SI-LLAMAR-PGM-APLIC)     08455099
084560        PERFORM 076-INVOCA-PGM                                    08456099
084570     END-IF                                                       08457099
084580     .                                                            08458099
084590*                                                                 08459099
084600*----------------------------------------------------------------*08460099
084610*    -  CONTROLA TECLAS DE FUNCION SOPORTADAS POR ARQUITECTURA   *08461099
084620*       SISTEMA APLICACIONES                                     *08462099
084630*         USUARIO AUTORIZADO AL SISTEMA AGRUPACIONES Y TRAN -    *08463099
084640*         SACCION ACTUAL 'GT05'                                  *08464099
084650*           PF3  - IR AL MENU DE AGRUPACION ANTERIOR             *08465099
084660*           PF11 - IR AL MENU INICIAL DE AGRUPACIONES            *08466099
084670*         EN CUALQUIER OTRO CASO:                                *08467099
084680*           PF3  - IR AL MENU DE LA APLICACION                   *08468099
084690*           PF11 - IR AL MENU DE APLICACIONES DE ARQUITECTURA    *08469099
084700*                                                                *08470099
084710*       SISTEMA AGRUPACIONES                                     *08471099
084720*       PF3  - IR AL MENU ANTERIOR                               *08472099
084730*       PF11 - IR AL MENU INICIAL DE AGRUPACIONES                *08473099
084740*----------------------------------------------------------------*08474099
084750 073-TRATA-PF-3270.                                               08475099
084760*------------------                                               08476099
084770*tracet->                       +                                 08477099
084780     IF WS-TRACE > '1'                                            08478099
084790        MOVE '073-TRATA-PF-3270.              ' TO WS-AQNBDTRA    08479099
084800        PERFORM 131-TRACE-TECNIC                                  08480099
084810     END-IF                                                       08481099
084820*tracet<-                                                         08482099
084830     IF L100-SISTEMA-APLICACIONES                                 08483099
084840        SET L100-ACCION-PROGRAMA TO TRUE                          08484099
084850        SET L100-ESTADO-INICIO   TO TRUE                          08485099
084860        SET L100-CONFIRMACION-MONEDA-NO TO TRUE                   08486099
084870*MLV120201 Inicio                                                 08487099
084880*       MOVE 1 TO L100-AQ1DCASO                                   08488099
084890*                                                                 08489099
084900*       Si la transaccion actual es AQPF se ha de respetar el caso08490099
084910*       ya que la transaccion origen necesita reposicionarse      08491099
084920        IF NOT SW-AQPF                                            08492099
084930           MOVE 1 TO L100-AQ1DCASO                                08493099
084940        END-IF                                                    08494099
084950*MLV120201 Final                                                  08495099
084960        IF EIBTRNID = C-MENU-APLICACIONES                         08496099
084970           IF L100-AUT-SISTEMA-AGRUP AND                          08497099
084980              (EIBAID = DFHPF3 OR DFHPF11)                        08498099
084990              SET L100-SISTEMA-AGRUPACIONES TO TRUE               08499099
085000              MOVE C-ENTRADA-AGRUP          TO L100-AQ1ENTRA      08500099
085010              IF EIBAID = DFHPF11                                 08501099
085020                 MOVE 'MENGR' TO L100-AQCDAGRP                    08502099
085030              END-IF                                              08503099
085040           END-IF                                                 08504099
085050        ELSE                                                      08505099
085060           EVALUATE EIBAID                                        08506099
085070              WHEN DFHPF3                                         08507099
085080***RT              MOVE L100-AQ1APLIC   TO W-APLICAC              08508099
085090***RT              MOVE W-ENTRADA       TO L100-AQ1ENTRA          08509099
085100                   PERFORM 096-BUSCAR-ENTRADA-APLIC               08510099
085110              WHEN DFHPF11                                        08511099
085120                   MOVE C-APL-GENERAL   TO L100-AQ1APLIC          08512099
085130                   MOVE C-ENTRADA-APLIC TO L100-AQ1ENTRA          08513099
085140              WHEN DFHPF14                                        08514099
085150                   SET L100-ACCION-PROGRAMA TO TRUE               08515099
085160                   SET L100-ESTADO-INICIO   TO TRUE               08516099
085170                   SET L100-CONFIRMACION-MONEDA-NO TO TRUE        08517099
085180                   MOVE 1                   TO L100-AQ1DCASO      08518099
085190                   INITIALIZE L100-AQECTANT                       08519099
085200                   PERFORM 070-INICIA-FAQ180-PAGINACIO            08520099
085210                   PERFORM 013-ESBORRA-PAGINACIO                  08521099
085220                                                                  08522099
085230           END-EVALUATE                                           08523099
085240        END-IF                                                    08524099
085250     ELSE                                                         08525099
085260        EVALUATE EIBAID                                           08526099
085270           WHEN DFHPF3                                            08527099
085280                IF SW-MENU-GNRAL-AGRUP                            08528099
085290                   PERFORM 074-PROCESO                            08529099
085300                ELSE                                              08530099
085310                   SET L100-ACCION-PROGRAMA TO TRUE               08531099
085320                   SET L100-ESTADO-INICIO   TO TRUE               08532099
085330                   SET L100-CONFIRMACION-MONEDA-NO TO TRUE        08533099
085340                   MOVE C-APL-GENERAL       TO L100-AQ1APLIC      08534099
085350                   MOVE C-ENTRADA-AGRUP     TO L100-AQ1ENTRA      08535099
085360                   MOVE 1                   TO L100-AQ1DCASO      08536099
085370                END-IF                                            08537099
085380           WHEN DFHPF11                                           08538099
085390                SET L100-ACCION-PROGRAMA TO TRUE                  08539099
085400                SET L100-ESTADO-INICIO   TO TRUE                  08540099
085410                SET L100-CONFIRMACION-MONEDA-NO TO TRUE           08541099
085420                MOVE C-APL-GENERAL       TO L100-AQ1APLIC         08542099
085430                MOVE C-ENTRADA-AGRUP     TO L100-AQ1ENTRA         08543099
085440                MOVE 'MENGR'             TO L100-AQCDAGRP         08544099
085450                MOVE 1                   TO L100-AQ1DCASO         08545099
085460           WHEN DFHPF14                                           08546099
085470                SET L100-ACCION-PROGRAMA TO TRUE                  08547099
085480                SET L100-ESTADO-INICIO   TO TRUE                  08548099
085490                SET L100-CONFIRMACION-MONEDA-NO TO TRUE           08549099
085500                MOVE 1                   TO L100-AQ1DCASO         08550099
085510                INITIALIZE L100-AQECTANT                          08551099
085520                PERFORM 070-INICIA-FAQ180-PAGINACIO               08552099
085530                PERFORM 013-ESBORRA-PAGINACIO                     08553099
085540        END-EVALUATE                                              08554099
085550     END-IF.                                                      08555099
085560*                                                                 08556099
085570*----------------------------------------------------------------*08557099
085580*    -  COMPROBAR SI SE HA CAMBIADO DE TRANSACCION POR EL        *08558099
085590*       FAST-PATH.                                               *08559099
085600*----------------------------------------------------------------*08560099
085610 074-PROCESO.                                                     08561099
085620*------------                                                     08562099
085630*tracet->                       +                                 08563099
085640     IF WS-TRACE > '1'                                            08564099
085650        MOVE '074-PROCESO.                    ' TO WS-AQNBDTRA    08565099
085660        PERFORM 131-TRACE-TECNIC                                  08566099
085670     END-IF                                                       08567099
085680*tracet<-                                                         08568099
085690*  SUBSTITUIR LA BUSQUEDA DEL CANVI DE TRANSACCIó DE LA CAPSALERA 08569099
085700*  DE LA PANTALLA PER LA INFORMACIó DEL CAMP M100-AQTRFAST QUE ES 08570099
085710*  CUMPLIMENTAT PEL PROGRAMA RAQW110 JO.02.03.99                  08571099
085720*                                                                 08572099
085730*                                                                 08573099
085740     IF L100-AQTRFAST NOT = EIBTRNID AND NOT = SPACES             08574099
085750        AND NOT = HIGH-VALUES AND NOT = LOW-VALUES                08575099
085760*A326->                                                           08576099
085770*       MOVE L100-AQTRFAST TO FAST-PATH                           08577099
085780*       PERFORM 1751-TRATA-FAST-PATH                              08578099
085790        INITIALIZE LN09-CAQLN09                                   08579099
085800        SET LN09-FAST-PATH-3270 TO TRUE                           08580099
085810        MOVE L100-AQTRFAST TO LN09-AQCDTRAN                       08581099
085820        PERFORM 071-NAVEGACION                                    08582099
085830*<-A326                                                           08583099
085840     ELSE                                                         08584099
085850*                                                                 08585099
085860*--> JO030399  INICI - AVERIGUAR SI S'HA DE SOL.LICITAR EL        08586099
085870*                      NúMERO D'AGENT EN ALTES DE CONTRACTES      08587099
085880*                                                                 08588099
085890         IF L100-AQ1STIMP = '1'                                   08589099
085900*           IF  L100-AQPTCPAD = 0                                 08590099
085910*               PERFORM 175-PREPARA-CAQL150                       08591099
085920*           END-IF                                                08592099
085930            PERFORM 068-SIES-CONTRACTE-AGENT                      08593099
085940         END-IF                                                   08594099
085950*                                                                 08595099
085960*--> JO030399  final                                              08596099
085970*                                                                 08597099
085980*                                                                 08598099
085990         PERFORM 072-ENLAZAR-CON-APLIC                            08599099
086000     END-IF                                                       08600099
086010     IF L100-AQ1ERRCD NOT = SPACES                                08601099
086020         PERFORM 031-FINAL                                        08602099
086030     END-IF.                                                      08603099
086040*                                                                 08604099
086050*----------------------------------------------------------------*08605099
086060*                                                                *08606099
086070*    CONSOLIDACION TRASPASO TOTAL                                *08607099
086080*    DESPUES DE HABER LLAMADO A LA APLICACION EN ESTADO INICIO   *08608099
086090*    Y ANTES DE VOLVER LAMADO A LA APLICACION EN ESTADO INICIO   *08609099
086100*                                                                *08610099
086110*----------------------------------------------------------------*08611099
086120 075-SALVAR-TRASPASO-TOTAL.                                       08612099
086130*--------------------------                                       08613099
086140*tracet->                       +                                 08614099
086150     IF WS-TRACE > '1'                                            08615099
086160        MOVE '075-SALVAR-TRASPASO-TOTAL.      ' TO WS-AQNBDTRA    08616099
086170        PERFORM 131-TRACE-TECNIC                                  08617099
086180     END-IF                                                       08618099
086190*tracet<-                                                         08619099
086200     MOVE C-SALVAR-MAPA TO L100-AQ1MESST                          08620099
086210     PERFORM 066-FORMAT-DEFORM-MENS                               08621099
086220     IF L100-AQ1ABNCD NOT = SPACES                                08622099
086230        SET SW-ABEND-ARQUITECTURAL TO TRUE                        08623099
086240        PERFORM 099-ABEND-PROC                                    08624099
086250     END-IF                                                       08625099
086260     MOVE L100-AQ1TRANT TO L100-AQTRANTR                          08626099
086270     MOVE L100-AQ1ESTAD TO L100-AQESTANT                          08627099
086280     MOVE L100-AQ1DCASO TO L100-AQCASANT                          08628099
086290     MOVE L100-AQ1APLIC TO L100-AQAPLANT                          08629099
086300     MOVE L100-AQ1ENTRA TO L100-AQENTANT                          08630099
086310     MOVE L100-AQNPAGEN TO L100-AQPACANT                          08631099
086320     MOVE L100-AQNPAGUL TO L100-AQPULANT                          08632099
086330     MOVE L100-AQFIPAGI TO L100-AQFPGANT                          08633099
086340     PERFORM 103-ACTUALIZ-SCR                                     08634099
086350*                                                                 08635099
086360     EXEC CICS SYNCPOINT END-EXEC                                 08636099
086370     .                                                            08637099
086380*                                                                 08638099
086390*----------------------------------------------------------------*08639099
086400*       REALIZA LA LLAMADA A LOS PROGRAMAS DE APLICACION         *08640099
086410*----------------------------------------------------------------*08641099
086420 076-INVOCA-PGM.                                                  08642099
086430*---------------                                                  08643099
086440*tracet->                       +                                 08644099
086450     IF WS-TRACE > '1'                                            08645099
086460        MOVE '076-INVOCA-PGM.                 ' TO WS-AQNBDTRA    08646099
086470        PERFORM 131-TRACE-TECNIC                                  08647099
086480     END-IF                                                       08648099
086490*tracet<-                                                         08649099
086500* EN ESTAT INICI LLEGEIX FAQ400 PER SABER SI S'HA DE PROCEDIR     08650099
086510* A LA INICIALITZACIO DE PANTALLES PER PART D'ARQUITECTURA        08651099
086520*                                                                 08652099
086530*M044->                                                           08653099
086540*    MOVE ' '  TO  SW-ENTORN-EBRANCH                              08654099
086550*                                                                 08655099
086560*    IF L100-ESTADO-INICIO AND L100-AQ1DCASO = 1 AND              08656099
086570*       L121-CANAL-OFICINAS                                       08657099
086580*       PERFORM 176-DETERMINA-EBRANCH                             08658099
086590*    END-IF                                                       08659099
086600                                                                  08660099
086610     IF L100-ESTADO-INICIO AND L100-AQ1DCASO = 1 AND              08661099
086620        L121-AQCDCPRO = '18'                                      08662099
086630        SET SW-SI-EJECUTAR-MACROS TO TRUE                         08663099
086640     ELSE                                                         08664099
086650        SET SW-NO-EJECUTAR-MACROS TO TRUE                         08665099
086660     END-IF                                                       08666099
086670                                                                  08667099
086680*<-M044                                                           08668099
086690*    IF (L121-CANAL-OFICINAS) AND (L100-SWITCH-TRANSACC)          08669099
086700*                             AND (F060-TERM-FINANCIERO)          08670099
086710*       MOVE ' '  TO  SW-INI-PANTA                                08671099
086720*    END-IF                                                       08672099
086730*                                                                 08673099
086740*I005 INICIO                                                      08674099
086750     IF SW-FORZAR-INICIO-CASO-1                                   08675099
086760        SET L100-ACCION-TERMINAL TO TRUE                          08676099
086770        SET L100-ESTADO-INICIO   TO TRUE                          08677099
086780        MOVE 1                   TO L100-AQ1DCASO                 08678099
086790        SET SW-NO-FORZAR-INICIO-CASO-1 TO TRUE                    08679099
086800     END-IF                                                       08680099
086810*I005 FINAL                                                       08681099
086820*                                                                 08682099
086830* INI-20.04.2005                                                  08683099
086840* SI ESTAT D'INICI + CAS 1 + PROTOCOL TF PROCEDIR A               08684099
086850* SIMULAR INICI, INICIALITZACIó PANTALLES SEGONS ENTORN           08685099
086860*                                                                 08686099
086870     IF (L100-ESTADO-INICIO) AND (F060-TERM-FINANCIERO) AND       08687099
086880        (L100-AQ1DCASO = 1)                                       08688099
086890        PERFORM 078-FUNCIO-INICIAL                                08689099
086900     END-IF                                                       08690099
086910*                                                                 08691099
086920* FI-20.04.2005                                                   08692099
086930*                                                                 08693099
086940*MLV-03-07-03 INICIO                                              08694099
086950*                                                                 08695099
086960*    IF L100-ESTADO-INICIO AND F060-TERM-FINANCIERO AND           08696099
086970*       L100-AQ1DCASO = 1 AND L100-AQ1APLIC NOT = 'TYA '          08697099
086980*    IF (L100-ESTADO-INICIO) AND (F060-TERM-FINANCIERO) AND       08698099
086990*       (L100-AQ1DCASO = 1) AND (L100-AQ1APLIC NOT = 'TYA ')      08699099
087000*A265 24/03/2004 INICIO                                           08700099
087010*       AND (NOT L300-ENTORNO-ECDL)                               08701099
087020*       PERFORM 084-SIMULAR-INICIO                                08702099
087030*       IF NOT L300-ENTORNO-ECDL                                  08703099
087040*          PERFORM 084-SIMULAR-INICIO                             08704099
087050*       END-IF                                                    08705099
087060*A265 24/03/2004 FINAL                                            08706099
087070*       IF EIBTRMID  NOT = 'TCPI' AND L121-CANAL-OFICINAS         08707099
087080*          IF SW-INI-PANTA = 'F'                                  08708099
087090*A265 24/03/2004 INICIO                                           08709099
087100*             IF L300-ENTORNO-ECDL                                08710099
087110*                PERFORM 084-SIMULAR-INICIO                       08711099
087120*                PERFORM  085-INICIA-PANTA                        08712099
087130*                MOVE SPACES TO L100-AQ1AVCD1                     08713099
087140*                MOVE SPACES TO L100-AQ1AVCD2                     08714099
087150*                MOVE SPACES TO L100-AQ1ERRCD                     08715099
087160*                MOVE SPACES TO L100-AQ1ABNCD                     08716099
087170*             END-IF                                              08717099
087180*A265 24/03/2004 FINAL                                            08718099
087190*             IF SW-INI-PANTA = 'F'                               08719099
087200*                PERFORM  085-INICIA-PANTA                        08720099
087210*                MOVE SPACES TO L100-AQ1AVCD1                     08721099
087220*                MOVE SPACES TO L100-AQ1AVCD2                     08722099
087230*                MOVE SPACES TO L100-AQ1ERRCD                     08723099
087240*                MOVE SPACES TO L100-AQ1ABNCD                     08724099
087250*             END-IF                                              08725099
087260*          END-IF                                                 08726099
087270*       END-IF                                                    08727099
087280*    END-IF                                                       08728099
087290*                                                                 08729099
087300*MLV-03-07-03 FINAL                                               08730099
087310*                                                                 08731099
087320*--> 071093                                                       08732099
087330*                                                                 08733099
087340     IF L100-AQ1STTRM = '1'                                       08734099
087350        MOVE 'S' TO L100-AQ1STTRM                                 08735099
087360     ELSE                                                         08736099
087370        MOVE 'N' TO L100-AQ1STTRM                                 08737099
087380     END-IF                                                       08738099
087390*                                                                 08739099
087400*--> LLAMADA A LA RUTINA DE VALIDACION DE ENTRADA                 08740099
087410*                                                                 08741099
087420     EVALUATE TRUE                                                08742099
087430     WHEN L121-CANAL-NO-CON-EXIT-EN                               08743099
087440          CONTINUE                                                08744099
087450     WHEN L121-CANAL-CONT-REBU103-E                               08745099
087460*M016->                                                           08746099
087470     WHEN L121-CANAL-CONT-REBU110-E                               08747099
087480*<-M016                                                           08748099
087490          IF NOT L100-ESTADO-INICIO                               08749099
087500*M016->                                                           08750099
087510*            PERFORM 10000-INVOCAR-REBU103                        08751099
087520             PERFORM 079-INVOCAR-EXIT-BE                          08752099
087530*<-M016                                                           08753099
087540             IF L100-AQ1ABNCD NOT = SPACES                        08754099
087550                SET SW-ABEND-APLICATIVO TO TRUE                   08755099
087560                PERFORM 099-ABEND-PROC                            08756099
087570             END-IF                                               08757099
087580          END-IF                                                  08758099
087590     WHEN L121-CANAL-CONT-RAQW065-E                               08759099
087600          INITIALIZE L165-CAQL165                                 08760099
087610          MOVE L100-AQTIPCON TO L165-AQTIPCON                     08761099
087620          MOVE L100-AQ1TRANT TO L165-AQ1TRANT                     08762099
087630          EXEC CICS LINK PROGRAM ('RAQW065')                      08763099
087640               RESP (COD-RESP) COMMAREA (L165-CAQL165)            08764099
087650          END-EXEC                                                08765099
087660          IF COD-RESP NOT = DFHRESP (NORMAL)                      08766099
087670             PERFORM 033-INFORMAR-DATOS-ABEND                     08767099
087680          END-IF                                                  08768099
087690          IF L165-AQRETORN = '1'                                  08769099
087700             MOVE C-USUA-NO-AUTORIZ TO L100-AQ1ABNCD              08770099
087710             SET SW-ABEND-ARQUITECTURAL TO TRUE                   08771099
087720             PERFORM 099-ABEND-PROC                               08772099
087730          END-IF                                                  08773099
087740     WHEN OTHER                                                   08774099
087750          MOVE C-ABEND-RUTINA-ENTRADA TO L100-AQ1ABNCD            08775099
087760          MOVE L121-AQCOEXEN TO L045-AQTXMENS (1)                 08776099
087770          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  08777099
087780          SET SW-ABEND-APLICATIVO TO TRUE                         08778099
087790          PERFORM 099-ABEND-PROC                                  08779099
087800     END-EVALUATE                                                 08780099
087810*                                                                 08781099
087820*--> ML270499 FINAL                                               08782099
087830*                                                                 08783099
087840*--> Se activa el indicador para grabar en el LOG                 08784099
087850*                                                                 08785099
087860     SET SW-GRABAR-DIARIO TO TRUE                                 08786099
087870*                                                                 08787099
087880*--> Llamada al modulo RAQW370 para comfirmar validacion NIT      08788099
087890*--> y coordenadas de Db-Line o la solicitud del num. de agente   08789099
087900*    27.12.99 JO-AFEGIR SOL.LICITUD IDIOMA                        08790099
087910*                                                                 08791099
087920     IF L100-ESTADO-CONTIN AND                                    08792099
087930* MLV131101 Inicio                                                08793099
087940*       (L100-VAL-DBLINE-PENDIENTE OR L100-VAL-AGENT-PENDIENTE    08794099
087950*                                  OR L100-VAL-IDIOMA-PENDIENTE)  08795099
087960        (L100-VAL-DBLINE-PENDIENTE OR L100-VAL-AGENT-PENDIENTE)   08796099
087970* MLV131101 Final                                                 08797099
087980        PERFORM 054-LINK-ABANS-RAQW392                            08798099
087990        PERFORM 055-LINK-DESPRES-RAQW392                          08799099
088000        EXEC CICS LINK PROGRAM ('RAQW370') RESP (COD-RESP)        08800099
088010             COMMAREA (L100-AREA-TOTAL)                           08801099
088020        END-EXEC                                                  08802099
088030        IF COD-RESP NOT = DFHRESP (NORMAL)                        08803099
088040           PERFORM 033-INFORMAR-DATOS-ABEND                       08804099
088050        END-IF                                                    08805099
088060                                                                  08806099
088070        IF L100-AQ1ABNCD NOT = SPACES                             08807099
088080           SET SW-ABEND-APLICATIVO TO TRUE                        08808099
088090           PERFORM 099-ABEND-PROC                                 08809099
088100        END-IF                                                    08810099
088110     END-IF                                                       08811099
088120*                                                                 08812099
088130*--> ML270499 FINAL                                               08813099
088140*                                                                 08814099
088150*--> Si la validacion de Db-line ha terminado (OK O KO)           08815099
088160*--> activar de nuevo el switch L100-VAL-DBLINE-PENDIENTE por si  08816099
088170*--> hubiera que solicitar de nuevo el NIT en una transaccion     08817099
088180*--> POSTERIOR.                                                   08818099
088190*                                                                 08819099
088200     IF L100-VAL-DBLINE-OK OR L100-VAL-DBLINE-KO                  08820099
088210        SET L100-VAL-DBLINE-PENDIENTE TO TRUE                     08821099
088220     END-IF                                                       08822099
088230*                                                                 08823099
088240                                                                  08824099
088250* JVB130503 INI                                                   08825099
088260* ---> LLAMADA A FUNCION CONTROL OPERACIONES CUENTAS DE EMPLEADOS 08826099
088270     PERFORM 080-CNTL-OPER-CTA-EMPL                               08827099
088280* JVB130503 FIN                                                   08828099
088290                                                                  08829099
088300     IF L100-ESTADO-INICIO                                        08830099
088310        MOVE 'I'  TO W-ESTADO                                     08831099
088320     ELSE                                                         08832099
088330        MOVE ' '  TO W-ESTADO                                     08833099
088340     END-IF                                                       08834099
088350*                                                                 08835099
088360*INI-18.04.2005-JO                                                08836099
088370*                                                                 08837099
088380     SET SW-NO-ERROR-ENTORNO-EJEC TO TRUE                         08838099
088390*                                                                 08839099
088400*I032->                                                           08840099
088410*    IF (NOT L300-ENTORNO-ECDL) AND F060-TERM-FINANCIERO          08841099
088420*       IF  F030-AQ3TIP07 = 'B'                                   08842099
088430**          MOVE 'JAQB260'           TO L100-AQ1ABNCD             08843099
088440**          SET SW-ABEND-ARQUITECTURAL TO TRUE                    08844099
088450**          PERFORM 099-ABEND-PROC                                08845099
088460*           SET L100-ACCION-TERMINAL TO TRUE                      08846099
088470*           SET SW-ERROR-ENTORNO-EJEC TO TRUE                     08847099
088480*           MOVE 'JAQE260'           TO L100-AQ1ERRCD             08848099
088490*           PERFORM 031-FINAL                                     08849099
088500*       END-IF                                                    08850099
088510*    END-IF                                                       08851099
088520*                                                                 08852099
088530*    IF L300-ENTORNO-ECDL                                         08853099
088540*       IF  F030-AQ3TIP07 = 'F'                                   08854099
088550*           SET L100-ACCION-TERMINAL TO TRUE                      08855099
088560*           SET SW-ERROR-ENTORNO-EJEC TO TRUE                     08856099
088570*           MOVE 'JAQE260'           TO L100-AQ1ERRCD             08857099
088580*           PERFORM 031-FINAL                                     08858099
088590**          MOVE 'JAQB260'           TO L100-AQ1ABNCD             08859099
088600**          SET SW-ABEND-ARQUITECTURAL TO TRUE                    08860099
088610**          PERFORM 099-ABEND-PROC                                08861099
088620*       END-IF                                                    08862099
088630*    END-IF                                                       08863099
088640*                                                                 08864099
088650*FI-18.04.2005-JO                                                 08865099
088660*                                                                 08866099
088670     IF L121-CANAL-OFICINAS AND F060-TERM-FINANCIERO              08867099
088680        IF F030-AQ3TIP07 = 'B'                                    08868099
088690*          Ejecucion solo permitida en TWEB                       08869099
088700           IF L100-AQTIPCON = '18'                                08870099
088710              CONTINUE                                            08871099
088720           ELSE                                                   08872099
088730              SET L100-ACCION-TERMINAL TO TRUE                    08873099
088740              SET SW-ERROR-ENTORNO-EJEC TO TRUE                   08874099
088750              MOVE 'JAQE260'           TO L100-AQ1ERRCD           08875099
088760              PERFORM 031-FINAL                                   08876099
088770           END-IF                                                 08877099
088780        END-IF                                                    08878099
088790*                                                                 08879099
088800        IF F030-AQ3TIP07 = 'F'                                    08880099
088810*          Ejecucion solo permitida en TF                         08881099
088820           IF L100-AQTIPCON = '  '                                08882099
088830              CONTINUE                                            08883099
088840           ELSE                                                   08884099
088850              SET L100-ACCION-TERMINAL TO TRUE                    08885099
088860              SET SW-ERROR-ENTORNO-EJEC TO TRUE                   08886099
088870              MOVE 'JAQE260'           TO L100-AQ1ERRCD           08887099
088880              PERFORM 031-FINAL                                   08888099
088890           END-IF                                                 08889099
088900        END-IF                                                    08890099
088910     END-IF                                                       08891099
088920*                                                                 08892099
088930*<-I032                                                           08893099
088940*                                                                 08894099
088950*--> Si hay que solicitar el NIT y coordenadas o firma electronica08895099
088960*--> no se invoca al programa asociado a la transaccion           08896099
088970*    27.12.99 JO-AFEGIR SOL-LICITUD IDIOMA                        08897099
088980*                                                                 08898099
088990* JVB310101 AFEGIR cond CONF MONEDA  L100-CONFIRMACION-MONEDA-SI  08899099
089000*                                                                 08900099
089010*NoRACFControlForRemoteVerifier-I                                 08901099
089020*  We need this before in the program flow, so to even decide if  08902099
089030*  RACF access control is going to be performed                   08903099
089040*BROADCAST4EYES-MoreFixes-I                                       08904099
089050*    This is needed only for TeWeb remote verification            08905099
089060*    as for 3270, the -INIT state is correctly activated          08906099
089070*    SET invokeTargetUnderRemote TO TRUE                          08907099
089080*    IF L300-ENTORNO-ECDL                                         08908099
089090*       SET ADDRESS OF LE00-CAQLE00 TO L000-AQPTSESP              08909099
089100*       SET ADDRESS OF LE98-CAQLE98 TO ADDRESS OF LE00-AQAQBUFF   08910099
089110*       IF LE98-AQPERSKY(1:2) = 'VE'                              08911099
089120*          SET notInvokeTargetUnderRemote TO TRUE                 08912099
089130*       END-IF                                                    08913099
089140*    END-IF                                                       08914099
089150*BROADCAST4EYES-MoreFixes-E                                       08915099
089160*NoRACFControlForRemoteVerifier-E                                 08916099
089170*AZ2FA-I                                                          08917099
089180     IF L100-AUTORIZ-AZ2FA-ONGOING                                08918099
089190        OR                                                        08919099
089200        (F030-REQUEST-2FA-YES AND                                 08920099
089210         (L100-AUTORIZ-AZ2FA-ONGOING OR                           08921099
089220          L100-AUTORIZ-AZ2FA-NOTACCEPTED OR                       08922099
089230*InvokeTargetOnEnd2FARefresh-I                                    08923099
089240*         L100-AUTORIZ-AZ2FA-END))                                08924099
089250          L100-AUTORIZ-AZ2FA-END-INI))                            08925099
089260*InvokeTargetOnEnd2FARefresh-E                                    08926099
089270*AQDrivenOnl4EyesNoInvProg-I                                      08927099
089280        OR archOnline4EyesSolution                                08928099
089290*AQDrivenOnl4EyesNoInvProg-E                                      08929099
089300        SET notInvokeTargetUnderRemote TO TRUE                    08930099
089310     END-IF                                                       08931099
089320*AZ2FA-E                                                          08932099
089330*                                                                 08933099
089340     IF L100-AQ1ERRCD = SPACES AND                                08934099
089350*BROADCAST4EYES-MoreFixes-I                                       08935099
089360        invokeTargetUnderRemote AND                               08936099
089370*BROADCAST4EYES-MoreFixes-E                                       08937099
089380        (NOT L100-CONFIRMACION-MONEDA-SI) AND                     08938099
089390        (NOT L100-NECESARIO-FIRMAS) AND                           08939099
089400        (NOT L100-VAL-IDIOMA-EN-PROCESO) AND                      08940099
089410        (NOT L100-VAL-IDIOMA-CANCELADA)  AND                      08941099
089420        (NOT L100-VAL-DBLINE-EN-PROCESO) AND                      08942099
089430        (NOT L100-VAL-DBLINE-CANCELADA)  AND                      08943099
089440        (NOT L100-VAL-AGENT-EN-PROCESO) AND                       08944099
089450        (NOT L100-VAL-AGENT-CANCELADA)                            08945099
089460*BROADCAST4EYES-I                                                 08946099
089470*       No queremos invocar al programa aplicativo si             08947099
089480*       estamos haciendo "polling" durante un 4ojos distribuido   08948099
089490        AND (NOT L100-AUTORIZ-PEAU-DIST)                          08949099
089500        AND (NOT L100-AUTORIZ-PEAU-DIST-INIT)                     08950099
089510        AND (NOT L100-AUTORIZ-4OJOS-DIST)                         08951099
089520        AND (NOT L100-AUTORIZ-4OJOS-DIST-INIT)                    08952099
089530*       Ni tampoco cuando se ha finalizado una verificacion       08953099
089540*       remota por parte del verificador                          08954099
089550        AND (NOT L100-AUTORIZ-PEAU-DIST-END)                      08955099
089560        AND (NOT L100-AUTORIZ-4OJOS-DIST-END)                     08956099
089570*BROADCAST4EYES-E                                                 08957099
089580*                                                                 08958099
089590        SET SW-APLICATIVO-LLAMADO TO TRUE                         08959099
089600                                                                  08960099
089610        IF F060-TERM-FINANCIERO                                   08961099
089620*M044->                                                           08962099
089630*          IF (SW-ENTORN-EBRANCH = 'F' AND  F030-AQ3TIP05 =  'I') 08963099
089640           IF (SW-SI-EJECUTAR-MACROS AND  F030-AQ3TIP05 =  'I')   08964099
089650*<-M044                                                           08965099
089660*             Se ha inicializado la pantalla mediante macros      08966099
089670*I005 INICIO                                                      08967099
089680              AND SW-NO-SIMULAR-INICIO-ECDL                       08968099
089690*I005 FINAL                                                       08969099
089700*          IF SW-ENTORN-EBRANCH = 'F'                             08970099
089710              CONTINUE                                            08971099
089720           ELSE                                                   08972099
089730              PERFORM 081-LLAMAR-PGM-APLICACION                   08973099
089740           END-IF                                                 08974099
089750        ELSE                                                      08975099
089760           PERFORM 081-LLAMAR-PGM-APLICACION                      08976099
089770        END-IF                                                    08977099
089780*                                                                 08978099
089790*MLV091202 INICIO                                                 08979099
089800*  LLAMADA AL MODULO DE VERIFICACION DE ATRIBUTOS DE MAPA         08980099
089810*                                                                 08981099
089820        EXEC CICS LINK PROGRAM ('RAQW029')                        08982099
089830             COMMAREA (L100-AREA-TOTAL) RESP (COD-RESP)           08983099
089840        END-EXEC                                                  08984099
089850                                                                  08985099
089860        IF COD-RESP NOT = DFHRESP (NORMAL)                        08986099
089870            PERFORM 033-INFORMAR-DATOS-ABEND                      08987099
089880        END-IF                                                    08988099
089890*                                                                 08989099
089900*MLV091202 FINAL                                                  08990099
089910*                                                                 08991099
089920*       PERFORM 082-RESTAURA-AGENTS                               08992099
089930* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     08993099
089940*                                                                 08994099
089950*       IF EIBTRNID= 'CL11' AND L100-AQ1ABNCD NOT = SPACES        08995099
089960*          MOVE SPACES TO L100-AQ1ABNCD                           08996099
089970*       END-IF                                                    08997099
089980*                                                                 08998099
089990* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++     08999099
090000*                                                                 09000099
090010        IF L100-AQ1ABNCD NOT = SPACES                             09001099
090020           SET SW-ABEND-APLICATIVO TO TRUE                        09002099
090030           PERFORM 099-ABEND-PROC                                 09003099
090040        END-IF                                                    09004099
090050*                                                                 09005099
090060* JVB130503  ELIMINAR INI                                         09006099
090070** JVB310101 ini confirmacion moneda automatica                   09007099
090080**    se traslada la llamada a confirmacion automatica dentro del 09008099
090090**    bloque if/end-if                                            09009099
090100*        IF L100-CONFIRMAR-MONEDA AND L100-AQ1ERRCD = SPACES      09010099
090110*           PERFORM 1748-CONFIRMACION-AUTOMATICA                  09011099
090120*        END-IF                                                   09012099
090130** JVB310101 fin                                                  09013099
090140* JVB130503  ELIMINAR FIN                                         09014099
090150                                                                  09015099
090160     ELSE                                                         09016099
090170*                                                                 09017099
090180*BROADCAST4EYES-I                                                 09018099
090190        IF L100-AUTORIZ-PEAU-DIST-END OR                          09019099
090200           L100-AUTORIZ-4OJOS-DIST-END                            09020099
090210           SET L100-NO-ES-AUTORIZ TO TRUE                         09021099
090220        END-IF                                                    09022099
090230*BROADCAST4EYES-E                                                 09023099
090240                                                                  09024099
090250*--> Cambiar a validacion Db-Line pendiente cuando se ha retornado09025099
090260*--> a la transaccion original desde la transaccion AQ72          09026099
090270*                                                                 09027099
090280        IF L100-VAL-DBLINE-CANCELADA                              09028099
090290           SET L100-VAL-DBLINE-PENDIENTE TO TRUE                  09029099
090300        END-IF                                                    09030099
090310*                                                                 09031099
090320*--> Cambiar a validacion AGENTS  pendiente cuando se ha retornado09032099
090330*--> a la transaccion original desde la transaccion AQ72          09033099
090340*                                                                 09034099
090350        IF L100-VAL-AGENT-CANCELADA                               09035099
090360           PERFORM 082-RESTAURA-AGENTS                            09036099
090370        END-IF                                                    09037099
090380*                                                                 09038099
090390        IF L100-VAL-IDIOMA-CANCELADA                              09039099
090400           PERFORM 083-RESTAURA-IDIOMA                            09040099
090410        END-IF                                                    09041099
090420     END-IF                                                       09042099
090430*                                                                 09043099
090440* MLV131101 Inicio                                                09044099
090450* SOLO EMULACION 3270                                             09045099
090460* Si se ha solicitado peticion idioma de impresion se invoca      09046099
090470* al modulo RAQW370 para que salve los datos de la sesion actual  09047099
090480* y activar el cambio a la transaccion AQ72                       09048099
090490     IF F060-TERM-3270 AND                                        09049099
090500        L100-AQ1ERRCD = SPACES AND L100-VAL-IDIOMA-PENDIENTE      09050099
090510        EXEC CICS LINK PROGRAM ('RAQW370') RESP (COD-RESP)        09051099
090520             COMMAREA (L100-AREA-TOTAL)                           09052099
090530        END-EXEC                                                  09053099
090540        IF COD-RESP NOT = DFHRESP (NORMAL)                        09054099
090550           PERFORM 033-INFORMAR-DATOS-ABEND                       09055099
090560        END-IF                                                    09056099
090570        IF L100-AQ1ABNCD NOT = SPACES                             09057099
090580           SET SW-ABEND-ARQUITECTURAL TO TRUE                     09058099
090590           PERFORM 099-ABEND-PROC                                 09059099
090600        END-IF                                                    09060099
090610     END-IF                                                       09061099
090620*MLV131101 Final                                                  09062099
090630*                                                                 09063099
090640*--> Cambiar a validacion Db-Line iniciada si se ha confirmado    09064099
090650*--> la solicitud del NIT y coordenadas                           09065099
090660*                                                                 09066099
090670     IF L100-VAL-DBLINE-EN-PROCESO                                09067099
090680        SET L100-VAL-DBLINE-INICIADA TO TRUE                      09068099
090690     END-IF                                                       09069099
090700*                                                                 09070099
090710*--> MLV290598 FINAL                                              09071099
090720*                                                                 09072099
090730     IF L100-VAL-AGENT-EN-PROCESO                                 09073099
090740        SET L100-VAL-AGENT-INICIADA TO TRUE                       09074099
090750     END-IF                                                       09075099
090760*                                                                 09076099
090770*--> CAMVIAR VALIDACIó IDIOMA A INICIADA SI S'HA CONFIRMAT        09077099
090780*--> LA SOL-LICITUD DEL CODI IDIOMA                               09078099
090790*                                                                 09079099
090800     IF L100-VAL-IDIOMA-EN-PROCESO                                09080099
090810        SET L100-VAL-IDIOMA-INICIADA TO TRUE                      09081099
090820     END-IF                                                       09082099
090830*                                                                 09083099
090840* JVB130503  ELIMINAR INI vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv         09084099
090850**   jo250998   inici, restaura  confirmacio moneda si es = 2     09085099
090860**                                                                09086099
090870*     IF L100-CONFIRMACION-MONEDA-OK                              09087099
090880*        SET L100-CONFIRMACION-MONEDA-NO TO TRUE                  09088099
090890*     END-IF                                                      09089099
090900**                                                                09090099
090910**   JO250998   FINAL  RESTAURA  CONFIRMACIO MONEDA SI ES = 2     09091099
090920* JVB130503  ELIMINAR FIN ÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝÝ        09092099
090930*                                                                 09093099
090940*--> 071093                                                       09094099
090950*                                                                 09095099
090960     IF L100-AQ1STTRM = 'S'                                       09096099
090970        MOVE 1 TO L100-AQ1STTRM                                   09097099
090980     ELSE                                                         09098099
090990        MOVE 0 TO L100-AQ1STTRM                                   09099099
091000     END-IF.                                                      09100099
091010*                                                                 09101099
091020*----------------------------------------------------------------*09102099
091030 077-ESBORRA-PAGINACIO-2.                                         09103099
091040*------------------------                                         09104099
091050*tracet->                       +                                 09105099
091060     IF WS-TRACE > '1'                                            09106099
091070        MOVE '077-ESBORRA-PAGINACIO-2.        ' TO WS-AQNBDTRA    09107099
091080        PERFORM 131-TRACE-TECNIC                                  09108099
091090     END-IF                                                       09109099
091100*tracet<-                                                         09110099
091110     INITIALIZE LN08-CAQLN08.                                     09111099
091120     MOVE 'EO'             TO LN08-AQFUNCIO                       09112099
091130                                                                  09113099
091140     IF L300-ENTORNO-ECDL                                         09114099
091150        MOVE L300-AQPTARE2    TO LN08-AQPTR000                    09115099
091160        MOVE L310-AQSCRARC    TO LN08-AQPTRSCR                    09116099
091170     ELSE                                                         09117099
091180        MOVE L300-AQPTARE3    TO LN08-AQPTRSCR                    09118099
091190     END-IF                                                       09119099
091200                                                                  09120099
091210     MOVE L300-AQPTARE1       TO LN08-AQPTR310                    09121099
091220*                                                                 09122099
091230*M057->                                                           09123099
091240*    IF L121-PAGINA-SI  AND  F030-AQSWPAGI = '1'                  09124099
091250     IF L121-PAGINA-SI                                            09125099
091260     AND ((F030-AQSWPAGI = '1') OR                                09126099
091270          (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))         09127099
091280*M057-<                                                           09128099
091290        EXEC CICS LINK PROGRAM ('RAQWN08')                        09129099
091300             RESP (COD-RESP)                                      09130099
091310             COMMAREA (LN08-CAQLN08)                              09131099
091320        END-EXEC                                                  09132099
091330                                                                  09133099
091340        IF COD-RESP NOT = DFHRESP (NORMAL)                        09134099
091350           PERFORM 033-INFORMAR-DATOS-ABEND                       09135099
091360        ELSE                                                      09136099
091370           IF LN08-AQRETCOD  = 'OK' OR 'NF' OR 'NP'               09137099
091380              CONTINUE                                            09138099
091390           ELSE                                                   09139099
091400              MOVE  'JSTB081'        TO  L100-AQ1ABNCD            09140099
091410              SET  SW-ABEND-APLICATIVO  TO TRUE                   09141099
091420              MOVE  LN08-AQRETCOD    TO  L045-AQTXMENS (3)        09142099
091430              MOVE  'PROCESO BORRADO PAGINACION'                  09143099
091440                                     TO  L045-AQTXMENS (1)        09144099
091450              MOVE  ',RETORNO ERRONEO DE RAQWN08 :'               09145099
091460                                     TO  L045-AQTXMENS (2)        09146099
091470              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              09147099
091480              PERFORM 099-ABEND-PROC                              09148099
091490           END-IF                                                 09149099
091500        END-IF                                                    09150099
091510     END-IF.                                                      09151099
091520*                                                                 09152099
091530*----------------------------------------------------------------*09153099
091540*    -  INICIALITZACIO PANTALLES 3270                            *09154099
091550*----------------------------------------------------------------*09155099
091560 078-FUNCIO-INICIAL.                                              09156099
091570*-------------------                                              09157099
091580*tracet->                       +                                 09158099
091590     IF WS-TRACE > '1'                                            09159099
091600        MOVE '078-FUNCIO-INICIAL.             ' TO WS-AQNBDTRA    09160099
091610        PERFORM 131-TRACE-TECNIC                                  09161099
091620     END-IF                                                       09162099
091630*tracet<-                                                         09163099
091640*INI-20.04.2005-JO                                                09164099
091650*P1000->                                                          09165099
091660*QUAN ES TRACTA DE L'ENTORN TCPI-CAL390                           09166099
091670*    IF EIBTRMID  = 'TCPI'                                        09167099
091680*       PERFORM 084-SIMULAR-INICIO                                09168099
091690*    END-IF                                                       09169099
091700*P1000<-                                                          09170099
091710                                                                  09171099
091720*I005 INICIO                                                      09172099
091730*                                                                 09173099
091740*    IF SW-ENTORN-EBRANCH = 'F' AND  F030-AQ3TIP05 =  'I'         09174099
091750*       PERFORM 084-SIMULAR-INICIO                                09175099
091760*       PERFORM  085-INICIA-PANTA                                 09176099
091770*    END-IF                                                       09177099
091780*                                                                 09178099
091790*    Si entorno ECDL y se ha forzado Estado Inicio y Caso 1       09179099
091800*       o se está iniciando una transaccion por recambio con      09180099
091810*       Estado Inicio y Caso 1                                    09181099
091820*                                                                 09182099
091830     IF L300-ENTORNO-ECDL AND SW-SIMULAR-INICIO-ECDL              09183099
091840        SET L100-NO-HAY-CAMBIO TO TRUE                            09184099
091850        PERFORM 084-SIMULAR-INICIO                                09185099
091860     ELSE                                                         09186099
091870*QUAN ES TRACTA DE L'ENTORN EBRANCH I HI HA INICILITZA.DE MACROS  09187099
091880*M044->                                                           09188099
091890*       IF SW-ENTORN-EBRANCH = 'F' AND  F030-AQ3TIP05 =  'I'      09189099
091900        IF SW-SI-EJECUTAR-MACROS AND  F030-AQ3TIP05 =  'I'        09190099
091910*<-M044                                                           09191099
091920           PERFORM 084-SIMULAR-INICIO                             09192099
091930           PERFORM 085-INICIA-PANTA                               09193099
091940        END-IF                                                    09194099
091950     END-IF                                                       09195099
091960*                                                                 09196099
091970*I005 FINAL                                                       09197099
091980*                                                                 09198099
091990*QUAN ES TRACTA DE L'ENTORN TERMINAL FINANCER                     09199099
092000*    IF (EIBTRMID NOT = 'TCPI') AND (SW-ENTORN-EBRANCH NOT = 'F') 09200099
092010*       PERFORM 084-SIMULAR-INICIO                                09201099
092020*    END-IF                                                       09202099
092030                                                                  09203099
092040*P1000->                                                          09204099
092050*    IF EIBTRMID  = 'TCPI' OR   L300-ENTORNO-ECDL                 09205099
092060     IF L300-ENTORNO-ECDL                                         09206099
092070*P1000<-                                                          09207099
092080        CONTINUE                                                  09208099
092090     ELSE                                                         09209099
092100        PERFORM 084-SIMULAR-INICIO                                09210099
092110     END-IF                                                       09211099
092120     .                                                            09212099
092130*-----------------------------------------------------            09213099
092140 079-INVOCAR-EXIT-BE.                                             09214099
092150*--------------------                                             09215099
092160*--> Si se invoca a la rutina en modo O (Output) se activa el in- 09216099
092170*--> dicador para que en caso de que la rutina detecte un error o 09217099
092180*--> abend no se le vuelva a invocar.                             09218099
092190     IF L100-AQ1MESST = C-ESCRITURA                               09219099
092200        SET SW-EXIT-BE-OUT-SI-INVOCADO TO TRUE                    09220099
092210     END-IF                                                       09221099
092220*                                                                 09222099
092230     INITIALIZE WS-EXIT-BE                                        09223099
092240     EVALUATE TRUE                                                09224099
092250     WHEN L121-CANAL-CONT-REBU103-E                               09225099
092260          MOVE 'REBU103' TO WS-EXIT-BE                            09226099
092270     WHEN L121-CANAL-CONT-REBU110-E                               09227099
092280          MOVE 'REBU110' TO WS-EXIT-BE                            09228099
092290     END-EVALUATE                                                 09229099
092300*tracet->                       +                                 09230099
092310     IF WS-TRACE > '1'                                            09231099
092320        MOVE WS-TRACE                           TO L100-AQSWJFIM  09232099
092330        MOVE '079-INVOCAR-EXIT-BE-->ida       ' TO WS-AQNBDTRA    09233099
092340        STRING                                                    09234099
092350          'Módul: ' WS-EXIT-BE '. I/O: ' L100-AQ1MESST '. '       09235099
092360          'Trx: '   L100-AQ1TRANT '. Tecla: ' L100-AQ1MESAI '. '  09236099
092370          'Conex:'  L100-AQTIPCON '. Trace: ' WS-TRACE            09237099
092380           DELIMITED BY SIZE INTO WS-AQINFORM                     09238099
092390        END-STRING                                                09239099
092400        PERFORM 131-TRACE-TECNIC                                  09240099
092410     END-IF                                                       09241099
092420*tracet<-                                                         09242099
092430*                                                                 09243099
092440     EXEC CICS LINK PROGRAM (WS-EXIT-BE) RESP (COD-RESP)          09244099
092450          COMMAREA (L100-AREA-TOTAL)                              09245099
092460     END-EXEC                                                     09246099
092470                                                                  09247099
092480     IF COD-RESP NOT = DFHRESP (NORMAL)                           09248099
092490        PERFORM 033-INFORMAR-DATOS-ABEND                          09249099
092500     END-IF                                                       09250099
092510*tracet->                       +                                 09251099
092520     IF WS-TRACE > '1'                                            09252099
092530        MOVE SPACES                             TO L100-AQSWJFIM  09253099
092540        MOVE '079-INVOCAR-EXIT-BE<--vuelta    ' TO WS-AQNBDTRA    09254099
092550        PERFORM 131-TRACE-TECNIC                                  09255099
092560     END-IF                                                       09256099
092570*tracet<-                                                         09257099
092580     .                                                            09258099
092590*<-M016                                                           09259099
092600*                                                                 09260099
092610* JVB130503 INI                                                   09261099
092620*----------------------------------------------------------------*09262099
092630*  Control de operaciones con cuentas de empleados               *09263099
092640*----------------------------------------------------------------*09264099
092650 080-CNTL-OPER-CTA-EMPL.                                          09265099
092660*-----------------------                                          09266099
092670*tracet->                       +                                 09267099
092680     IF WS-TRACE > '1'                                            09268099
092690        MOVE '080-CNTL-OPER-CTA-EMPL.         ' TO WS-AQNBDTRA    09269099
092700        PERFORM 131-TRACE-TECNIC                                  09270099
092710     END-IF                                                       09271099
092720*tracet<-                                                         09272099
092730     IF L121-AQSWOPER-S                   AND                     09273099
092740        L100-ESTADO-CONTIN                AND                     09274099
092750        (NOT L100-CONFIRMACION-MONEDA-OK) AND                     09275099
092760        (NOT L100-NECESARIO-FIRMAS)       AND                     09276099
092770        (NOT L100-VAL-IDIOMA-EN-PROCESO)  AND                     09277099
092780        (NOT L100-VAL-IDIOMA-CANCELADA)   AND                     09278099
092790        (NOT L100-VAL-DBLINE-EN-PROCESO)  AND                     09279099
092800        (NOT L100-VAL-DBLINE-CANCELADA)   AND                     09280099
092810        (NOT L100-VAL-AGENT-EN-PROCESO)   AND                     09281099
092820        (NOT L100-VAL-AGENT-CANCELADA)                            09282099
092830                                                                  09283099
092840        MOVE 'RAQW221 '    TO  L310-AQCALPGM                      09284099
092850        MOVE SPACES        TO  L310-AQCODOPE                      09285099
092860        MOVE SPACES        TO  L310-AQCODRET                      09286099
092870                                                                  09287099
092880        EXEC CICS LINK PROGRAM ('RAQW221') COMMAREA (AREA-CAQL310)09288099
092890             RESP (COD-RESP)                                      09289099
092900        END-EXEC                                                  09290099
092910                                                                  09291099
092920        IF L310-AQCODRET = '89'                                   09292099
092930           MOVE 'JAQE190'         TO L100-AQ1ERRCD                09293099
092940        END-IF                                                    09294099
092950     END-IF                                                       09295099
092960     .                                                            09296099
092970* JVB130503 FIN                                                   09297099
092980*                                                                 09298099
092990*----------------------------------------------------------------*09299099
093000*    -  LLAMADA AL PROGRAMA ASOCIADO A LA CCT                    *09300099
093010*----------------------------------------------------------------*09301099
093020 081-LLAMAR-PGM-APLICACION.                                       09302099
093030*--------------------------                                       09303099
093040*tracet->                       +                                 09304099
093050     IF WS-TRACE > '1'                                            09305099
093060        MOVE '081-LLAMAR-PGM-APLICACION       ' TO WS-AQNBDTRA    09306099
093070        PERFORM 131-TRACE-TECNIC                                  09307099
093080     END-IF                                                       09308099
093090*tracet<-                                                         09309099
093100*                                                                 09310099
093110     PERFORM 086-LINK-RAQWN08-LP                                  09311099
093120*                                                                 09312099
093130*M057b->                                                          09313099
093140*    IF (L121-PAGINA-SI AND F030-AQSWPAGI = '1' AND               09314099
093150*       LN08-AQRETCOD = 'OK')                                     09315099
093160*                                                                 09316099
093170     IF  L121-PAGINA-SI                                           09317099
093180     AND ((F030-AQSWPAGI = '1')     OR                            09318099
093190          (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))         09319099
093200     AND LN08-AQRETCOD = 'OK'                                     09320099
093210*                                                                 09321099
093220*M057b<-                                                          09322099
093230     OR (L121-CANAL-NAVEGACION-SI AND LN09-OK-NO-APLICACION)      09323099
093240*A327->                                                           09324099
093250     OR L100-POSPONER-OPERACION                                   09325099
093260*<-A327                                                           09326099
093270        CONTINUE                                                  09327099
093280     ELSE                                                         09328099
093290        PERFORM 087-LINK-PGM-APLICACION                           09329099
093300     END-IF                                                       09330099
093310     .                                                            09331099
093320*                                                                 09332099
093330*----------------------------------------------------------------*09333099
093340*    -  restaurar indicadors si hi ha error/abends               *09334099
093350*----------------------------------------------------------------*09335099
093360 082-RESTAURA-AGENTS.                                             09336099
093370*--------------------                                             09337099
093380*tracet->                       +                                 09338099
093390     IF WS-TRACE > '1'                                            09339099
093400        MOVE '082-RESTAURA-AGENTS             ' TO WS-AQNBDTRA    09340099
093410        PERFORM 131-TRACE-TECNIC                                  09341099
093420     END-IF                                                       09342099
093430*tracet<-                                                         09343099
093440     IF EIBTRNID NOT = 'AQ72'                                     09344099
093450           MOVE ' '  TO  L100-AQCDAGFI                            09345099
093460           MOVE 0    TO  L100-AQNUAGFI                            09346099
093470     END-IF.                                                      09347099
093480*                                                                 09348099
093490*----------------------------------------------------------------*09349099
093500*    -  restaurar indicadors si hi ha error/abends               *09350099
093510*----------------------------------------------------------------*09351099
093520 083-RESTAURA-IDIOMA.                                             09352099
093530*--------------------                                             09353099
093540*tracet->                       +                                 09354099
093550     IF WS-TRACE > '1'                                            09355099
093560        MOVE '083-RESTAURA-IDIOMA.            ' TO WS-AQNBDTRA    09356099
093570        PERFORM 131-TRACE-TECNIC                                  09357099
093580     END-IF                                                       09358099
093590*tracet<-                                                         09359099
093600     IF EIBTRNID NOT = 'AQ72'                                     09360099
093610        SET L100-VAL-IDIOMA-NO TO TRUE                            09361099
093620     END-IF.                                                      09362099
093630*                                                                 09363099
093640*----------------------------------------------------------------*09364099
093650*    -  LLAMADA EN ESTADO INICIO AL PGM DEL APLICATIVO CON UN    *09365099
093660*       AREA DE PANTALLA FICTICIA.                                09366099
093670*                                                                *09367099
093680*    -  EL APLICATIVO DEVOLVERA DE NUEVO EL CONTROL PERO EN      *09368099
093690*       ESTADO DE CONTINUACION.                                  *09369099
093700*----------------------------------------------------------------*09370099
093710 084-SIMULAR-INICIO.                                              09371099
093720*-------------------                                              09372099
093730*tracet->                       +                                 09373099
093740     IF WS-TRACE > '1'                                            09374099
093750        MOVE '084-SIMULAR-INICIO.             ' TO WS-AQNBDTRA    09375099
093760        PERFORM 131-TRACE-TECNIC                                  09376099
093770     END-IF                                                       09377099
093780*tracet<-                                                         09378099
093790*--> Se guarda el puntero del mapa                                09379099
093800     MOVE L100-AQ1MPRTI TO W-PUNTER-SAVE                          09380099
093810*                                                                 09381099
093820*--> Obtener el area ficticia                                     09382099
093830     MOVE +1920  TO LONGET                                        09383099
093840     EXEC CICS GETMAIN SET (ADDRESS OF AREA-MAPA-FICTICIA)        09384099
093850          FLENGTH (LONGET) INITIMG (C-LOW-VALUES)                 09385099
093860          RESP (COD-RESP)                                         09386099
093870          NOSUSPEND                                               09387099
093880     END-EXEC                                                     09388099
093890     IF COD-RESP NOT = DFHRESP (NORMAL)                           09389099
093900         PERFORM 033-INFORMAR-DATOS-ABEND                         09390099
093910     END-IF                                                       09391099
093920     SET W-PUNTER-POINTER TO ADDRESS OF AREA-MAPA-FICTICIA        09392099
093930*                                                                 09393099
093940*--> Se informa el puntero del area ficticia                      09394099
093950     IF L100-AQ1TRANT = 'T001' OR 'R001'                          09395099
093960        CONTINUE                                                  09396099
093970     ELSE                                                         09397099
093980        MOVE W-PUNTER-COMP TO L100-AQ1MPRTI                       09398099
093990     END-IF                                                       09399099
094000                                                                  09400099
094010     PERFORM 081-LLAMAR-PGM-APLICACION                            09401099
094020*                                                                 09402099
094030*MLV-14-08-03 INICIO                                              09403099
094040     MOVE L100-AQ1ESTAD TO W-ESTADO-INICIAL                       09404099
094050     MOVE L100-AQ1DCASO TO W-CASO-ENTRADA                         09405099
094060*                                                                 09406099
094070*MLV-14-08-03 FINAL                                               09407099
094080     IF L100-AQ1ABNCD NOT = SPACES                                09408099
094090*--> Se activa el indicador sw-aplicativo-llamado para que la exit09409099
094100*--> REBU103 sea llamada en el procedimiento 099-ABEND-PROC       09410099
094110*--> ML070999 INICIO                                              09411099
094120        SET SW-APLICATIVO-LLAMADO TO TRUE                         09412099
094130*--> ML070999 FINAL                                               09413099
094140        SET SW-ABEND-APLICATIVO TO TRUE                           09414099
094150        PERFORM 099-ABEND-PROC                                    09415099
094160     END-IF                                                       09416099
094170     MOVE SPACES TO L100-AQ1ERRCD                                 09417099
094180     MOVE SPACES TO L100-AQ1AVCD1                                 09418099
094190     MOVE SPACES TO L100-AQ1AVCD2                                 09419099
094200*                                                                 09420099
094210*--> Recuperar el puntero del mapa                                09421099
094220*                                                                 09422099
094230     MOVE L100-AQ1MPRTI TO L100-AQPTMAPA                          09423099
094240     IF L100-AQ1TRANT = 'T001' OR 'R001'                          09424099
094250        CONTINUE                                                  09425099
094260     ELSE                                                         09426099
094270        MOVE W-PUNTER-SAVE TO L100-AQ1MPRTI                       09427099
094280     END-IF.                                                      09428099
094290*                                                                 09429099
094300* A265 24/03/2004 FINAL                                           09430099
094310*                                                                 09431099
094320*----------------------------------------------------------------*09432099
094330*    -  INICIALITZACIO PANTALLES 3270                            *09433099
094340*----------------------------------------------------------------*09434099
094350 085-INICIA-PANTA.                                                09435099
094360*-----------------                                                09436099
094370*tracet->                       +                                 09437099
094380     IF WS-TRACE > '1'                                            09438099
094390        MOVE '085-INICIA-PANTA.               ' TO WS-AQNBDTRA    09439099
094400        PERFORM 131-TRACE-TECNIC                                  09440099
094410     END-IF                                                       09441099
094420*tracet<-                                                         09442099
094430*    IF F030-AQ3TIP05 =  'I' OR 'T'                               09443099
094440*                                                                 09444099
094450       MOVE SPACES       TO  L310-MSGABEND                        09445099
094460       MOVE 'IN'         TO  L310-AQCODOPE                        09446099
094470                                                                  09447099
094480       EXEC CICS LINK PROGRAM ('RAQW015')                         09448099
094490            RESP (COD-RESP)                                       09449099
094500            COMMAREA (AREA-CAQL310)                               09450099
094510       END-EXEC                                                   09451099
094520                                                                  09452099
094530       IF L310-MSGABEND NOT = SPACES                              09453099
094540          SET SW-ABEND-ARQUITECTURAL  TO TRUE                     09454099
094550          PERFORM 099-ABEND-PROC                                  09455099
094560       END-IF                                                     09456099
094570*    END-IF                                                       09457099
094580     .                                                            09458099
094590*                                                                 09459099
094600*----------------------------------------------------------------*09460099
094610*   LINK PROGRAMA RAQWN08 LOCALITZACIO PAGINA                   .*09461099
094620*----------------------------------------------------------------*09462099
094630 086-LINK-RAQWN08-LP.                                             09463099
094640*--------------------                                             09464099
094650*tracet->                       +                                 09465099
094660     IF WS-TRACE > '1'                                            09466099
094670        MOVE '086-LINK-RAQWN08-LP.            ' TO WS-AQNBDTRA    09467099
094680*>>>    PERFORM 131-TRACE-TECNIC                                  09468099
094690     END-IF                                                       09469099
094700*tracet<-                                                         09470099
094710*JO-08.03.2004                                                    09471099
094720     INITIALIZE LN08-CAQLN08.                                     09472099
094730     MOVE 'LP'             TO LN08-AQFUNCIO                       09473099
094740                                                                  09474099
094750     IF L300-ENTORNO-ECDL                                         09475099
094760*       MOVE  1               TO L100-AQNUNIVE                    09476099
094770        MOVE L300-AQPTARE2    TO LN08-AQPTR000                    09477099
094780        MOVE L310-AQSCRARC    TO LN08-AQPTRSCR                    09478099
094790     ELSE                                                         09479099
094800        MOVE L300-AQPTARE3    TO LN08-AQPTRSCR                    09480099
094810     END-IF                                                       09481099
094820                                                                  09482099
094830     MOVE L300-AQPTARE1       TO LN08-AQPTR310                    09483099
094840*                                                                 09484099
094850*M057-->                                                          09485099
094860*    IF L121-PAGINA-SI  AND  F030-AQSWPAGI = '1'                  09486099
094870*M057b->                                                          09487099
094880*    IF (L121-PAGINA-SI  AND  F030-AQSWPAGI = '1') OR             09488099
094890*       (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE)            09489099
094900     IF L121-PAGINA-SI                                            09490099
094910     AND ((F030-AQSWPAGI = '1') OR                                09491099
094920          (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))         09492099
094930*M057b-<                                                          09493099
094940*M057<--                                                          09494099
094950        EXEC CICS LINK PROGRAM ('RAQWN08')                        09495099
094960             RESP (COD-RESP)                                      09496099
094970             COMMAREA (LN08-CAQLN08)                              09497099
094980        END-EXEC                                                  09498099
094990                                                                  09499099
095000        IF COD-RESP NOT = DFHRESP (NORMAL)                        09500099
095010           PERFORM 033-INFORMAR-DATOS-ABEND                       09501099
095020        ELSE                                                      09502099
095030           IF LN08-AQRETCOD  = 'OK' OR 'NP'                       09503099
095040              CONTINUE                                            09504099
095050           ELSE                                                   09505099
095060              MOVE  'JSTB081'        TO  L100-AQ1ABNCD            09506099
095070              SET  SW-ABEND-APLICATIVO  TO TRUE                   09507099
095080              MOVE  LN08-AQRETCOD    TO  L045-AQTXMENS (3)        09508099
095090              MOVE  'FUNCIO LP : PAGINA ACT.   ' TO               09509099
095100                    W-TEXT-08                                     09510099
095110              MOVE  L100-AQNPAGEN  TO W-TEXT-08(25:2)             09511099
095120              MOVE  W-TEXT-08        TO  L045-AQTXMENS (1)        09512099
095130              MOVE  ' ,ULT.PAG.                  '  TO            09513099
095140                    W-TEXT-08                                     09514099
095150              MOVE  L100-AQNPAGUL  TO W-TEXT-08(12:2)             09515099
095160              MOVE  W-TEXT-08        TO  L045-AQTXMENS (2)        09516099
095170              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              09517099
095180              PERFORM 099-ABEND-PROC                              09518099
095190           END-IF                                                 09519099
095200        END-IF                                                    09520099
095210*tracet->                       +                                 09521099
095220        IF WS-TRACE > '1'                                         09522099
095230           STRING                                                 09523099
095240             'Invocado RAQWN08. Resultado: ' LN08-AQRETCOD        09524099
095250              DELIMITED BY SIZE INTO WS-AQINFORM                  09525099
095260           END-STRING                                             09526099
095270        END-IF                                                    09527099
095280*tracet<-                                                         09528099
095290     END-IF                                                       09529099
095300*tracet->                       +                                 09530099
095310     IF WS-TRACE > '1'                                            09531099
095320        PERFORM 131-TRACE-TECNIC                                  09532099
095330     END-IF                                                       09533099
095340     .                                                            09534099
095350*                                                                 09535099
095360*----------------------------------------------------------------*09536099
095370*    -  LLAMADA AL PROGRAMA ASOCIADO A LA CCT                    *09537099
095380*----------------------------------------------------------------*09538099
095390 087-LINK-PGM-APLICACION.                                         09539099
095400*------------------------                                         09540099
095410*tracet->                       +                                 09541099
095420     IF WS-TRACE > '0'                                            09542099
095430        MOVE '087-LINK-PGM-APLICACION. ---->  ' TO WS-AQNBDTRA    09543099
095440        MOVE L100-AQ1DCASO   TO   WS-CAS                          09544099
095450        STRING                                                    09545099
095460           F030-AQ3PGMID '/E:' L100-AQ1ESTAD '/C:' WS-CAS         09546099
095470                         '/T:' L100-AQ1MESAI                      09547099
095480           DELIMITED BY SIZE   INTO WS-AQINFORM                   09548099
095490        END-STRING                                                09549099
095500        PERFORM 131-TRACE-TECNIC                                  09550099
095510     END-IF                                                       09551099
095520*tracet<-                                                         09552099
095530*A265 22/04/2004 INICIO                                           09553099
095540     MOVE L100-AQ1ESTAD TO W-ULTIMO-ESTADO-LINK                   09554099
095550     MOVE L100-AQ1DCASO TO W-ULTIMO-CASO-LINK                     09555099
095560*A265 22/04/2004 FINAL                                            09556099
095570*                                                                 09557099
095580*M057b->                                                          09558099
095590*    IF (L121-PAGINA-SI AND F030-AQSWPAGI = '1' AND               09559099
095600*       LN08-AQRETCOD = 'NP')                                     09560099
095610     IF L121-PAGINA-SI                                            09561099
095620     AND ((F030-AQSWPAGI = '1') OR                                09562099
095630          (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))         09563099
095640     AND LN08-AQRETCOD = 'NP'                                     09564099
095650*M057b<-                                                          09565099
095660        MOVE L100-AQNPAGEN  TO  L100-AQ1PANTA(1:2)                09566099
095670     END-IF                                                       09567099
095680                                                                  09568099
095690     IF L100-AQ1NIVUS = '777'                                     09569099
095700         SET L100-ESTADO-CONTIN TO TRUE                           09570099
095710         MOVE  '999' TO L100-AQ1NIVUS                             09571099
095720     END-IF                                                       09572099
095730     MOVE C-E TO W-ENVIO                                          09573099
095740     PERFORM 088-PANTALLA-TRACE                                   09574099
095750     MOVE L100-AQ1ESTAD TO W-ESTADO-INICIAL                       09575099
095760     MOVE L100-AQ1DCASO TO W-CASO-ENTRADA                         09576099
095770     MOVE L100-AQ1APLIC TO W-APLICACION                           09577099
095780     MOVE L100-AQ1PNLIN TO W-PANTALLA                             09578099
095790     MOVE F030-AQ3PGMID TO W-PROGRAMA                             09579099
095800     MOVE 1             TO L100-AQSWFITR                          09580099
095810     MOVE SPACES        TO L100-AQTXTRAN                          09581099
095820*                                                                 09582099
095830* RTA-20-02-04                                                    09583099
095840*--> SI EL CANAL TIENE EL PARAMETRO ACTIVO, Y LA TRANSACCION TIENE09584099
095850*--> LA FUNCION ACTIVA, OBTENER AVISOS A PRIORI BLOQUEANTES       09585099
095860*                                                                 09586099
095870* Para las teclas de paginación no llamamos. Para las que no      09587099
095880* se cede control a la aplicación, ya no se llega hasta aquí.     09588099
095890*                                                                 09589099
095900     IF (W-ESTADO-INICIAL NOT = C-ESTADO-INICIO AND               09590099
095910        (L100-AQ1MESAI NOT = '7' AND '8' AND 'G' AND 'H' AND ' '))09591099
095920*NewSAMGbasedWarnings-I                                           09592099
095930*       For any kind of navigation from another transaction       09593099
095940*       the 'a priori' warnings must be evaluated. It is          09594099
095950*       incomprehensible that this was not implemented from       09595099
095960*       the beginning all together, but we need it now atleast    09596099
095961*       for evaluation of SAMG-based data access restrictions     09596199
095962*       warnings. In order to contain its effects and do not      09596299
095963*       break any existance transactional flow when no warnings   09596399
095964*       were being evaluated before, this will be "mapped" to a   09596499
095965*       virtual key only when calling RAQWA11, without            09596599
095966*       really changing the key that we have at L100-AQ1MESAI     09596699
095967*       This key that is never handed control over to the         09596799
095968*       target application, so no application whatsever will      09596899
095969*       currently have it mapped for warnings evaluation.         09596999
095970*       With this, this key will represent "navigations" from one 09597099
095971*       transaction to another, when warnings want to be          09597199
095972*       evaluated on entering the target one.                     09597299
095973*       When L100-CAMBIO-POR-APLICACION, the input screen is      09597399
095974*       filled by the application itself from its own spad, so    09597499
095975*       there is nothing for RAQW135 to evaluate on 'a priori'    09597599
095976*       For other kinds of navigations which are architectural    09597699
095977*       the RAQWN09 will have already moved (TRASPASO) the data   09597799
095978*       from the source screen to the target screen.              09597899
095979        OR (evalNavigWarnings AND NOT L100-CAMBIO-POR-APLICACION  09597999
095980            AND LN09-OK-SI-APLICACION)                            09598099
095981        IF evalNavigWarnings AND L100-AQPTL135 = 0                09598199
095982           MOVE 'AM'    TO L310-AQCODOPE                          09598299
095983           PERFORM 067-PREPARA-CAQL135                            09598399
095984        END-IF                                                    09598499
095985*NewSAMGbasedWarnings-E                                           09598599
095986        IF L121-AQSWAVIS-S                                        09598699
095987           IF F409-AQSWSTAT(9) = 'A'                              09598799
095988*rafa                                                             09598899
095989***           IF SW-INUTIL = X'CC'                                09598999
095990***              PERFORM 089-OBT-CAMPOS-ICP                       09599099
096000***              PERFORM 090-OBTENER-AVISOS-P                     09600099
096010***           END-IF                                              09601099
096020                                                                  09602099
096030*             PERFORM 089-OBT-CAMPOS-ICP                          09603099
096040*             IF L222-CORRECTO                                    09604099
096050*                INITIALIZE AREA-CAQLA11                          09605099
096060              IF F030-AQCDFUNC(9) = 'A'                           09606099
096070                 INITIALIZE AREA-CAQLA11                          09607099
096080*                                                                 09608099
096090* AVIS 'X' DE TIPUS BLOQUEJANTS                                   09609099
096100*P148-I                                                           09610099
096110*                MOVE 'X'       TO LA11-AQSWCNMU-IN               09611099
096120*Buscar avisos en general                                         09612099
096130                 PERFORM 091A-OBTENIR-AVISOS                      09613099
096140*P148-F                                                           09614099
096150*I82->                                                            09615099
096160**               IF L100-AQAVISOS NOT = 'R'                       09616099
096170*jfm02->                                                          09617099
096180**                  AND (L135-AQRET376 = 'OK')                    09618099
096190**                  PERFORM 091-OBTENIR-AVISOS                    09619099
096200                    IF L100-AQAVISOS = 'R'                        09620099
096210*p148->                                                           09621099
096220                       OR 'T'                                     09622099
096230*p148<-                                                           09623099
096240*NewSAMGbasedWarnings-I                                           09624099
096250*       'J' = There are actionable messages and all of them have  09625099
096251*             been answered positively                            09625199
096252*       'H' = There are actionable messages and some of them have 09625299
096253*             been answered negatively. Completely prohibited     09625399
096254*             warnings are answered negatively by default.        09625499
096255                       OR 'J' OR 'H'                              09625599
096256*NewSAMGbasedWarnings-I                                           09625699
096257                       CONTINUE                                   09625799
096258                    ELSE                                          09625899
096259                       IF L135-AQSWAVCT = 'N' OR                  09625999
096260                         (L135-AQSWAVCT = 'S' AND                 09626099
096270                          L135-AQRET376 = 'OK')                   09627099
096280*P148-I                                                           09628099
096290*Se obtienen los avisos GDPR                                      09629099
096300                          IF WS-AQTIPAVI-G > 0                    09630099
096310                             SET SW-GDPR-PRIORI TO TRUE           09631099
096320                             MOVE 'G'       TO LA11-AQSWCNMU-IN   09632099
096330*P148-F                                                           09633099
096340                             PERFORM 091-OBTENIR-AVISOS           09634099
096350*P148-I,Si los avisos GDPR son excepciones, se intenta obtener    09635099
096360* los avisos bloqueantes                                          09636099
096370*JAR02-I                                                          09637099
096380*                            IF LA11-AQRCMAJ = 'NF' OR            09638099
096390*                               LA11-AQCDPLAN-CNT = 0             09639099
096400                             IF WS-CONT-AV-BLOQ = 0               09640099
096410*JAR02-F                                                          09641099
096420*Solo accede a WA11 si realmente hay avisos bloqueantes para la tx09642099
096430                                IF WS-AQTIPAVI-X > 0              09643099
096440                                   INITIALIZE AREA-CAQLA11        09644099
096450                                   MOVE 'X'    TO LA11-AQSWCNMU-IN09645099
096460                                   PERFORM 091-OBTENIR-AVISOS     09646099
096470                                END-IF                            09647099
096480                             END-IF                               09648099
096490*Sino hay avisos GDPR se verifica si hay avisos bloqueantes       09649099
096500                          ELSE                                    09650099
096510                             IF WS-AQTIPAVI-X > 0                 09651099
096520                                INITIALIZE AREA-CAQLA11           09652099
096530                                MOVE 'X'    TO LA11-AQSWCNMU-IN   09653099
096540                                PERFORM 091-OBTENIR-AVISOS        09654099
096550                             END-IF                               09655099
096560                          END-IF                                  09656099
096570*NewSAMGbasedWarnings-I                                           09657099
096580                          IF WS-CONT-AV-BLOQ = 0                  09658099
096590*                            No 'a priori' GDPR or Blocking       09659099
096591*                            warnings found so far, hence we      09659199
096592*                            try to locate SAMG-based ones        09659299
096593*                                                                 09659399
096594*                            SAMG-based data access restriction   09659499
096595*                            warnings are applicable only to real 09659599
096596*                            users                                09659699
096597                             IF TECH-USER-UNKNOWN                 09659799
096598                                PERFORM CHECK-TECH-USER           09659899
096599                             END-IF                               09659999
096600                             IF NOT-TECH-USER                     09660099
096601*                                                                 09660199
096602                             INITIALIZE AREA-CAQLA11              09660299
096603*                       In case there are more than one SAMG-based09660399
096604*                        warning enabled for the ongoing          09660499
096605*                        transaction and key, we will evaluate    09660599
096606*                        them with a priority like this:          09660699
096607*                         1) 'J-type' aka "justifiable" ones,     09660799
096608*                            first, so the user might opt into the09660899
096609*                            data even if the SAMG model told us  09660999
096610*                            that she/he has not actual permission09661099
096611*                         2) 'P-type' aka completely forbidden,   09661199
096612*                            if no 'J-type' at all, afterwards    09661299
096613*                         3) 'U-type' aka "unadvisable" ones, only09661399
096614*                              when no 'J-type' or 'P-type' at all09661499
096615                             IF WS-AQTIPAVI-J > 0                 09661599
096616                                MOVE 'J' TO LA11-AQSWCNMU-IN      09661699
096617                             ELSE                                 09661799
096618                                IF WS-AQTIPAVI-P > 0              09661899
096619                                   MOVE 'P' TO LA11-AQSWCNMU-IN   09661999
096620                                ELSE                              09662099
096621                                   IF WS-AQTIPAVI-U > 0           09662199
096622                                      MOVE 'U' TO LA11-AQSWCNMU-IN09662299
096623                                   END-IF                         09662399
096624                                END-IF                            09662499
096625                             END-IF                               09662599
096626                             IF LA11-AQSWCNMU-IN NOT = '  '       09662699
096627                                PERFORM 091-OBTENIR-AVISOS        09662799
096628                                IF LA11-AQCDPLAN-CNT > 0          09662899
096629                                   ADD 1 TO WS-CONT-AV-SAMG       09662999
096630                                  IF LA11-AQSWCNMU-IN = 'P' OR 'J'09663099
096631*                                    Needed for control to be     09663199
096632*                                    transfered to AQLM for       09663299
096633*                                    showing them 'a priori'      09663399
096634                                     ADD 1 TO WS-CONT-AV-BLOQ     09663499
096635                                  END-IF                          09663599
096636                                END-IF                            09663699
096637                             END-IF                               09663799
096638                             END-IF    *> CLOSING IF NOT-TECH-USER09663899
096639                          END-IF                                  09663999
096640*NewSAMGbasedWarnings-E                                           09664099
096641                       END-IF                                     09664199
096642*P148-F                                                           09664299
096643*jfm02<-                                                          09664399
096644*I82<-                                                            09664499
096645*jfm04->                                                          09664599
096646*El contador = 0 indica que no hay que bloquear, a pesar de haber 09664699
096647*podido encontrar mensajes bloqueantes,todos son excepciones(P101)09664799
096648                       IF WS-CONT-AV-BLOQ = 0                     09664899
096649*NewSAMGbasedWarnings-I                                           09664999
096650*                         In case WS-CONT-AV-BLOQ is > 0 due to   09665099
096651*                         any SAMG based warning restricting data 09665199
096652*                         access to the operating userid, we need 09665299
096653*                         transfer flow to AQLM so to show them   09665399
096654*                         'a priori', even if the restriction is  09665499
096655*                         justifiable or simply audited.          09665599
096656                          AND WS-CONT-AV-SAMG = 0                 09665699
096657*NewSAMGbasedWarnings-E                                           09665799
096658                          MOVE 0    TO  L310-CAQLA99              09665899
096659                          MOVE 'NF' TO LA11-AQRCMAJ               09665999
096660                       END-IF                                     09666099
096670*jfm02->                                                          09667099
096671                    END-IF                                        09667199
096672*jfm02<-                                                          09667299
096673*jfm04<-                                                          09667399
096674*p148-I                                                           09667499
096675*                END-IF                                           09667599
096676*p148-F                                                           09667699
096677              END-IF                                              09667799
096678           END-IF                                                 09667899
096679        END-IF                                                    09667999
096680     END-IF                                                       09668099
096690*                                                                 09669099
096700* RTA-20-02-04 FINAL                                              09670099
096710*                                                                 09671099
096720*jfm03->                                                          09672099
096730     IF L100-ESTADO-INICIO AND L100-AQ1DCASO = 1                  09673099
096740        MOVE SPACES        TO L100-AQTR4OJO                       09674099
096750        SET L100-4OJOS-NO-APLICA TO TRUE                          09675099
096760*MLV13->                                                          09676099
096770        MOVE '0' TO L100-AQCONV4O                                 09677099
096780*MLV13-<                                                          09678099
096790     END-IF                                                       09679099
096800*jfm03<-                                                          09680099
096810     MOVE L100-AQAVISOS   TO WS-AVISOS                            09681099
096820     PERFORM 054-LINK-ABANS-RAQW392                               09682099
096830     MOVE WS-AVISOS       TO  L100-AQAVISOS                       09683099
096840*                                                                 09684099
096850*P35->                                                            09685099
096860*    Tratamiento para ver si hay Avisos Especiales                09686099
096870     IF LA11-AQRCMAJ = 'OK' AND LA11-AQCDPLAN-CNT > 0             09687099
096880*NewSAMGbasedWarnings-I                                           09688099
096890        IF WS-CONT-AV-SAMG = ZEROES                               09689099
096900*NewSAMGbasedWarnings-E                                           09690099
096910           PERFORM 133-TRACTA-AVISOS-ESPECIALS                    09691099
096920*NewSAMGbasedWarnings-I                                           09692099
096930        END-IF                                                    09693099
096940*NewSAMGbasedWarnings-E                                           09694099
096950*LCO01.I                                                          09695099
096960*Si no quedan avisos bloqueantes se borra el puntero de avisos y  09696099
096970*se consulta si ha habido excepciones, en cuyo caso se enviará un 09697099
096980*mensaje con todos los avisos con los que se ha evitado el bloqueo09698099
096990        IF WS-CONT-AV-BLOQ > ZEROES                               09699099
097000*NewSAMGbasedWarnings-I                                           09700099
097010*          To avoid L310-CAQLA99 being zeroed, otherwise          09701099
097011*          L100-AQAVISOS will not get valued to 'P' (a priori     09701199
097012*          warnings exist) and flow will not be transfered to     09701299
097013*          AQLM for showing them                                  09701399
097014           OR WS-CONT-AV-SAMG > ZEROES                            09701499
097015*NewSAMGbasedWarnings-E                                           09701599
097016           CONTINUE                                               09701699
097017        ELSE                                                      09701799
097018           MOVE ZEROES       TO L310-CAQLA99                      09701899
097019           IF WS-CONT-EX-BLOQ > ZEROES                            09701999
097020              MOVE C-AVISO-EXC-BLOQUEO TO L100-AQ1ERRCD           09702099
097030              MOVE W-CASO-ENTRADA       TO L100-AQ1DCASO          09703099
097040              INITIALIZE L045-CAQL045                             09704099
097050              MOVE W-AQCDAVIS-GRUP      TO L045-AQTXMENS (1)      09705099
097060              MOVE C-AVISO-EXC-BLOQUEO  TO L100-AQ1ERRCD          09706099
097070              PERFORM 101-FORMATEIG-ERROR-VARIABLE                09707099
097080              PERFORM 031-FINAL                                   09708099
097090           END-IF                                                 09709099
097100        END-IF                                                    09710099
097110*LCO01.F                                                          09711099
097120     END-IF                                                       09712099
097130*P35<-                                                            09713099
097140*                                                                 09714099
097150                                                                  09715099
097160* RTA-20-02-04                                                    09716099
097170     IF L310-CAQLA99 NOT = ZEROS                                  09717099
097180*NewSAMGbasedWarnings-I                                           09718099
097190        AND (WS-CONT-AV-BLOQ > ZEROES AND                         09719099
097200             WS-CONT-AV-SAMG = WS-CONT-AV-BLOQ AND                09720099
097210             NOT F060-TERM-FINANCIERO)                            09721099
097220*NewSAMGbasedWarnings-E                                           09722099
097230        IF L100-AQAVISOS NOT =  'R' AND NOT =  'T'                09723099
097240*--> Si hay avisos bloqueantes, inactivamos cualquier tipo de PEAU09724099
097250*--> y validaciones existentes que pudieran estar en marcha.      09725099
097260           MOVE 'B'        TO L100-AQAVISOS                       09726099
097261           MOVE 'JAQE226'  TO L100-AQ1ERRCD                       09726199
097262           SET L100-NO-ES-AUTORIZ      TO TRUE                    09726299
097263           SET L100-NO-HAY-VALIDACION  TO TRUE                    09726399
097264           SET L100-VAL-IDIOMA-NO      TO TRUE                    09726499
097265           SET L100-VAL-AGENT-NO       TO TRUE                    09726599
097266           MOVE L100-AQ1APLIC          TO W-APLI-SAL              09726699
097267           IF F060-TERM-3270                                      09726799
097268              MOVE SPACES     TO L100-AQ1ERRCD                    09726899
097269              PERFORM 055-LINK-DESPRES-RAQW392                    09726999
097270*                                                                 09727099
097280              MOVE 'B'        TO L100-AQAVISOS                    09728099
097290              MOVE W-APLI-SAL  TO  L100-AQ1APLIC                  09729099
097300              PERFORM 092-LINK-RAQW370                            09730099
097310           END-IF                                                 09731099
097320        END-IF                                                    09732099
097330     ELSE                                                         09733099
097340*NewSAMGbasedWarnings-I                                           09734099
097350        IF L100-AQAVISOS = 'H'                                    09735099
097360           SET totalMasking TO TRUE                               09736099
097370           IF NOT F060-TERM-FINANCIERO                            09737099
097380*             Exclusive to 3270:                                  09738099
097390*             Check whether ICP AQ022 (Data restriction masking)  09739099
097400*             is defined for this transaction. If not, then the   09740099
097410*             target program is not even invoked at all. If       09741099
097420*             defined however it will be invoked but its output   09742099
097430*             will be masked in accordance to contents of         09743099
097440*             ICP AQ022. When not under 3270, the target program  09744099
097450*             will always be invoked, its output masked, totally  09745099
097460*             or partially according to the existance or not of   09746099
097461*             ICP AQ022, but then demasked if PETCONF confirmed   09746199
097462*             positively                                          09746299
097463              PERFORM checkPartialMasking                         09746399
097464           END-IF                                                 09746499
097465        END-IF                                                    09746599
097466*NewSAMGbasedWarnings-E                                           09746699
097467        IF L100-AQAVISOS NOT =  'R' AND NOT =  'T'                09746799
097468*NewSAMGbasedWarnings-I                                           09746899
097469*       'H' = There are actionable messages and some of them have 09746999
097470*             been answered negatively, so it is considered as    09747099
097471*             blocking 'a priori' and the target program must not 09747199
097472*             be called if totalMasking is enabled.               09747299
097473*             Completely prohibited warnings are answered         09747399
097474*             negatively by default.                              09747499
097475           OR (L100-AQAVISOS = 'H' AND partialMasking)            09747599
097476*NewSAMGbasedWarnings-E                                           09747699
097477*          MOVE L100-AQ1ACCIO  TO  WS-ACCIO-ANT                   09747799
097478*----@Ñ@Ñ@Ñ@--- Es crida al programa aplicatiu------>             09747899
097479*tracet->                       +                                 09747999
097480           IF WS-TRACE > '0'                                      09748099
097481              MOVE '087-LINK-(2) (se llama===>  ' TO WS-AQNBDTRA  09748199
097482              PERFORM 131-TRACE-TECNIC                            09748299
097483           END-IF                                                 09748399
097484*tracet<-                                                         09748499
097485           EXEC CICS LINK PROGRAM (F030-AQ3PGMID)                 09748599
097486                COMMAREA (L100-AREA-TOTAL) RESP (COD-RESP)        09748699
097487           END-EXEC                                               09748799
097488*          <--- Retorn crida del programa aplicatiu--             09748899
097489*tracet->                       +                                 09748999
097490           IF WS-TRACE > '0'                                      09749099
097500              MOVE '087-LINK-(3) <=== retorno)  ' TO WS-AQNBDTRA  09750099
097510              PERFORM 131-TRACE-TECNIC                            09751099
097520           END-IF                                                 09752099
097530*tracet<-                                                         09753099
097540        END-IF                                                    09754099
097550     END-IF                                                       09755099
097560*                                                                 09756099
097570* FI CANVI                                                        09757099
097580*                                                                 09758099
097590     IF COD-RESP NOT = DFHRESP (NORMAL)                           09759099
097600         PERFORM 033-INFORMAR-DATOS-ABEND                         09760099
097610     END-IF                                                       09761099
097620*                                                                 09762099
097630     IF L100-AQAVISOS NOT =  'R' AND NOT =  'T'                   09763099
097640*NewSAMGbasedWarnings-I                                           09764099
097650*       'J' = There are actionable messages and all of them have  09765099
097660*             been answered positively                            09766099
097670*       'H' = There are actionable messages and some of them have 09767099
097680*             been answered negatively. Completely prohibited     09768099
097690*             warnings are answered negatively by default.        09769099
097700        AND NOT = 'J' AND NOT = 'H'                               09770099
097710*NewSAMGbasedWarnings-E                                           09771099
097720        MOVE ' '        TO L100-AQAVISOS                          09772099
097730     END-IF                                                       09773099
097740                                                                  09774099
097750* RTA-20-02-04 FINAL                                              09775099
097751                                                                  09775199
097752* JVB150402I                                                      09775299
097753     IF SPAD-WORK NOT = HIGH-VALUES                               09775399
097754        INITIALIZE L085-CAQL085                                   09775499
097755        MOVE 'V' TO L085-AQCODOPE                                 09775599
097756        MOVE 'JAQB059'      TO L085-AQ4CLAVE                      09775699
097757        MOVE 'RAQW001'      TO L085-AQTXMENS (1)                  09775799
097758        MOVE F030-AQ3PGMID  TO L085-AQTXMENS (2) (1:8)            09775899
097759        MOVE '-'            TO L085-AQTXMENS (2) (9:1)            09775999
097760        MOVE 'USO INCORECTO DE AREA SPAD'                         09776099
097770          TO L085-AQTXMENS (2) (11:30)                            09777099
097780        PERFORM 047-LLAMADA-RAQW085                               09778099
097790                                                                  09779099
097800                                                                  09780099
097810        INITIALIZE L145-CAQL145                                   09781099
097820        MOVE L085-AQTXME77 TO L145-AQMSGTXT                       09782099
097830        PERFORM 048-GRABAR-LOG                                    09783099
097840     END-IF                                                       09784099
097850* JVB150402F                                                      09785099
097860*                                                                 09786099
097870     PERFORM 055-LINK-DESPRES-RAQW392                             09787099
097880*                                                                 09788099
097890*tracet->                       +                                 09789099
097900     IF WS-TRACE > '0'                                            09790099
097910        MOVE '087-LINK-PGM-APLICACION. <----  ' TO WS-AQNBDTRA    09791099
097920        MOVE L100-AQ1DCASO   TO   WS-CAS                          09792099
097930        STRING                                                    09793099
097940           F030-AQ3PGMID '/E:' L100-AQ1ESTAD '/C:' WS-CAS         09794099
097950                         '/T:' L100-AQ1MESAI                      09795099
097960          '/ABN:'  L100-AQ1ABNCD  '/ERR:'  L100-AQ1ERRCD          09796099
097970          '/RECANVI:' L100-AQ1ACCIO '/' L100-AQ1ENTRA             09797099
097980           DELIMITED BY SPACE  INTO WS-AQINFORM                   09798099
097990        END-STRING                                                09799099
098000        PERFORM 131-TRACE-TECNIC                                  09800099
098010     END-IF                                                       09801099
098020*tracet<-                                                         09802099
098030*M079->                                                           09803099
098040*      Control para evitar bucles cuando la aplicacion no ha      09804099
098050*      cambiado de Estado Inicio a Estado Continuacion            09805099
098060     IF L100-ESTADO-INICIO                                        09806099
098070        AND (W-ESTADO-INICIAL = C-ESTADO-INICIO)                  09807099
098080        AND (L100-AQ1ENTRA = F030-AQ3ENTRA)                       09808099
098090*M083->                                                           09809099
098100*       MOVE C-ABEND-BUCLE-INICIO TO L100-AQ1ABNCD                09810099
098110*       PERFORM 099-ABEND-PROC                                    09811099
098120        IF L100-AQ1TRANT = 'SDPD'                                 09812099
098130           CONTINUE                                               09813099
098140        ELSE                                                      09814099
098150           MOVE C-ABEND-BUCLE-INICIO TO L100-AQ1ABNCD             09815099
098160           PERFORM 099-ABEND-PROC                                 09816099
098170        END-IF                                                    09817099
098180*M083<-                                                           09818099
098190     END-IF                                                       09819099
098200*M079<-                                                           09820099
098210*p101->                                                           09821099
098220     IF L300-ENTORNO-ECDL AND L101-AQPTAUTH > 0                   09822099
098230*       Si ECDL y puntero de autorización con contenido, se guarda09823099
098240        MOVE L101-AQPTAUTH TO L000-AQPTAUTH                       09824099
098250*p122->                                                           09825099
098260*       Si tiene activo indicador de 'Plataforma Firma Digital'...09826099
098270        IF L100-AUTH-PLAT-FIRM-SI                                 09827099
098280*       ...se mirará si el tipo de autorización es 'PFD'...       09828099
098290           PERFORM 143-VERIFICAR-PFD                              09829099
098300*       ...y en caso afirmativo se almacena operación en tabla    09830099
098310           IF W-PFD-SI                                            09831099
098320              PERFORM 141-GUARDAR-OPERACIO                        09832099
098330           END-IF                                                 09833099
098340        END-IF                                                    09834099
098350*p122<-                                                           09835099
098360     END-IF                                                       09836099
098370*ADS-I                                                            09837099
098380     IF L300-ENTORNO-ECDL                                         09838099
098390        MOVE L101-AQPTADSC TO L000-AQPTADSC                       09839099
098400     END-IF                                                       09840099
098410*ADS-F                                                            09841099
098420*p101<-                                                           09842099
098430*                                                                 09843099
098440* A265 24/03/2004 INICIO                                          09844099
098450* Si la aplicacion ha solicitado cambio de transaccion se activa  09845099
098460* el indicador para diferenciarlo de cuando lo solicita CDL       09846099
098470*                                                                 09847099
098480*I047->                                                           09848099
098490*    IF L100-ACCION-PROGRAMA                                      09849099
098500     IF L100-ACCION-PROGRAMA AND L121-CANAL-NAVEGACION-SI         09850099
098510*<-I047                                                           09851099
098520*                                                                 09852099
098530        SET L100-CAMBIO-POR-APLICACION TO TRUE                    09853099
098540     END-IF                                                       09854099
098550* A265 24/03/2004 FINAL                                           09855099
098560     IF L100-AQPTLOG > 0                                          09856099
098570        MOVE 'ERR/ABND PROG.        '                             09857099
098580             TO L155-AQBUSDET (40:22)                             09858099
098590        MOVE F030-AQ3PGMID TO L155-AQBUSDET(54:8)                 09859099
098600        MOVE L100-AQ1ERRCD TO L155-AQBUSDET(63:7)                 09860099
098610        MOVE '/'   TO L155-AQBUSDET(70:1)                         09861099
098620        MOVE L100-AQ1ABNCD TO L155-AQBUSDET(71:7)                 09862099
098630*p148-> Para evitar abend en TeWeb                                09863099
098640*       IF L300-ENTORNO-ECDL                                      09864099
098650*          MOVE ZERO  TO L000-AQPTAUTH                            09865099
098660*       END-IF                                                    09866099
098670*p148<-                                                           09867099
098680     END-IF                                                       09868099
098690     IF COD-RESP NOT = DFHRESP (NORMAL)                           09869099
098700         PERFORM 033-INFORMAR-DATOS-ABEND                         09870099
098710     END-IF                                                       09871099
098720     MOVE SPACES TO W-ENVIO                                       09872099
098730     IF  L100-AQPTAQPF > 0                                        09873099
098740         PERFORM 093-PANTALLA-RELACION                            09874099
098750     END-IF                                                       09875099
098760     PERFORM 088-PANTALLA-TRACE                                   09876099
098770     PERFORM 094-TRATA-MENSAJES                                   09877099
098780*    Activa indicador para grabar SCR a pesar de ROLB_SI en lopd  09878099
098790*    L100-AQ1NIVUS hay fast-path                                  09879099
098800*    L100-AQ1SWTRA ESTA ACTIVA EN CASO DE PASTPATH O RECAMBIO     09880099
098810*    EN ESTOS CASOS SERA NECESARIO GUARDAR SCR A PESAR DE ROLB_SI 09881099
098820*    IF L100-AQ1NIVUS = 555 OR                                    09882099
098830*       MOVE 1 TO SW-FASTPATH                                     09883099
098840*    END-if                                                       09884099
098850     IF L100-SWITCH-TRANSACC                                      09885099
098860        MOVE 1 TO SW-FASTPATH                                     09886099
098870     END-IF                                                       09887099
098880                                                                  09888099
098890     MOVE 999 TO L100-AQ1NIVUS                                    09889099
098900     .                                                            09890099
098910*                                                                 09891099
098920*NewSAMGbasedWarnings-I                                           09892099
098930 checkPartialMasking.                                             09893099
098940*                                                                 09894099
098950     PERFORM VARYING WS-IND1 FROM 1 BY 1                          09895099
098960     UNTIL WS-IND1 > 200                                          09896099
098970           OR L135-AQNUCAMP (WS-IND1) = 0                         09897099
098980           OR L135-AQSRCICP2 (WS-IND1) = 'AQ022'                  09898099
098990        CONTINUE                                                  09899099
099000     END-PERFORM                                                  09900099
099010     IF L135-AQSRCICP2 (WS-IND1) = 'AQ022'                        09901099
099020        SET partialMasking TO TRUE                                09902099
099030     ELSE                                                         09903099
099040        SET totalMasking TO TRUE                                  09904099
099041     END-IF                                                       09904199
099042     .                                                            09904299
099043*NewSAMGbasedWarnings-E                                           09904399
099044*                                                                 09904499
099045*----------------------------------------------------------------*09904599
099046*         SE MONTA EL AREA CAQL999 PARA EJECUTAR EL TRACE        *09904699
099047*         SI EL CAMPO L100-AQ1CONTR ESTA INFORMADO               *09904799
099048*----------------------------------------------------------------*09904899
099049 088-PANTALLA-TRACE.                                              09904999
099050*-------------------                                              09905099
099051*tracet->                       +                                 09905199
099052     IF WS-TRACE > '1'                                            09905299
099053        MOVE '088-PANTALLA-TRACE.             ' TO WS-AQNBDTRA    09905399
099054        PERFORM 131-TRACE-TECNIC                                  09905499
099055     END-IF                                                       09905599
099056*tracet<-                                                         09905699
099057     MOVE 'PC'          TO L310-AQCODOPE                          09905799
099058     INITIALIZE W001-CAQW001                                      09905899
099059     PERFORM 040-LINK-RAQW005.                                    09905999
099060*                                                                 09906099
099070*----------------------------------------------------------------*09907099
099080*   LINK A RAQW222 (OBTENCION CONTRATO DE ICP)                  .*09908099
099090*----------------------------------------------------------------*09909099
099100*089-OBT-CAMPOS-ICP.                                              09910099
099110*-------------------                                              09911099
099120*tracet->                       +                                 09912099
099130*    IF WS-TRACE > '1'                                            09913099
099140*       MOVE '089-OBT-CAMPOS-ICP.             ' TO WS-AQNBDTRA    09914099
099150*       PERFORM 131-TRACE-TECNIC                                  09915099
099160*    END-IF                                                       09916099
099170*tracet<-                                                         09917099
099180* Miramos si la transacción tiene parametrizados, para avisos,    09918099
099190* alguno de los campos: contrato, código cliente, identificación  09919099
099200* (tipo, código, dígito y secuencia).                             09920099
099210*                                                                 09921099
099220*rafa                                                             09922099
099230*    INITIALIZE AREA-CAQL222                                      09923099
099240*    SET W-PUNTER-POINTER            TO ADDRESS OF AREA-CAQL310   09924099
099250*    MOVE W-PUNTER-COMP              TO L222-AQ310PTR             09925099
099260*    MOVE 'S01'                      TO L222-AQCDOPC              09926099
099270*                                                                 09927099
099280*    EXEC CICS LINK PROGRAM ('RAQW222') COMMAREA (AREA-CAQL222)   09928099
099290*         RESP (COD-RESP)                                         09929099
099300*    END-EXEC                                                     09930099
099310*                                                                 09931099
099320*    IF COD-RESP NOT = DFHRESP (NORMAL)                           09932099
099330*       PERFORM 033-INFORMAR-DATOS-ABEND                          09933099
099340*    END-IF                                                       09934099
099350*    EVALUATE TRUE                                                09935099
099360*      WHEN L222-CORRECTO                                         09936099
099370*      WHEN L222-FUNCION-NO-ACTIVA                                09937099
099380*      WHEN L222-PARAM-NO-EXISTE                                  09938099
099390*      WHEN L222-NO-ENCONTRADO                                    09939099
099400*         CONTINUE                                                09940099
099410*      WHEN L222-ERROR-CICS                                       09941099
099420*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      09942099
099430*         MOVE L222-AQ1EIBFN         TO L100-AQ1EIBFN             09943099
099440*         MOVE L222-AQ1EIBRC         TO L100-AQ1EIBRC             09944099
099450*         MOVE L222-AQ1EIBRS         TO L100-AQ1EIBRS             09945099
099460*         MOVE C-ABEND-CICS          TO L100-AQ1ABNCD             09946099
099470*         PERFORM 099-ABEND-PROC                                  09947099
099480*      WHEN L222-ERROR-DB2                                        09948099
099490*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      09949099
099500*         MOVE L222-TABLNAME         TO L100-AQ1TABNM             09950099
099510*         MOVE L222-SQLCODE          TO WS-ABEND-NUM              09951099
099520*                                       L100-AQ1SQLCD             09952099
099530*         MOVE WS-ABEND-DB2          TO L100-AQ1ABNCD             09953099
099540*         MOVE L222-SQLERRM          TO L100-AQ1SQLER             09954099
099550*         PERFORM 099-ABEND-PROC                                  09955099
099560*      WHEN OTHER                                                 09956099
099570*         MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                    09957099
099580*         MOVE 'RAQW222'      TO L045-AQTXMENS (1)                09958099
099590*         MOVE L222-AQRETCOD  TO L045-AQTXMENS (2)                09959099
099600*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      09960099
099610*         PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  09961099
099620*         PERFORM 099-ABEND-PROC                                  09962099
099630*    END-EVALUATE.                                                09963099
099640*                                                                 09964099
099650* RTA-17-10-03 INICIO                                             09965099
099660*----------------------------------------------------------------*09966099
099670*   LINK A RAQWA11 (AVISOS A PRIORI)                            .*09967099
099680*----------------------------------------------------------------*09968099
099690*090-OBTENER-AVISOS-P.                                            09969099
099700*---------------------                                            09970099
099710*tracet->                       +                                 09971099
099720*    IF WS-TRACE > '1'                                            09972099
099730*       MOVE '090-OBTENER-AVISOS-P.           ' TO WS-AQNBDTRA    09973099
099740*       PERFORM 131-TRACE-TECNIC                                  09974099
099750*    END-IF                                                       09975099
099760*tracet<-                                                         09976099
099770*    MOVE 'S01'                      TO LA11-AQCDOPC              09977099
099780*    MOVE L100-AQ1TRANT              TO LA11-AQCDTRAN-IN          09978099
099790*    MOVE L222-AQCDENCT              TO LA11-AQCDENCT-IN          09979099
099800*    MOVE L222-AQCDCECT              TO LA11-AQCDCECT-IN          09980099
099810*    MOVE L222-AQCDCHDG              TO LA11-AQCDCHDG-IN          09981099
099820*    MOVE L222-AQNUCNTO              TO LA11-AQNUCNTO-IN          09982099
099830*    MOVE L222-AQCTCLIE              TO LA11-AQCTCLIE-IN          09983099
099840*    IF LA11-AQCTCLIE-IN > 0                                      09984099
099850*      PERFORM VARYING WS-IND1 FROM 1 BY 1 UNTIL                  09985099
099860*                    WS-IND1 > LA11-AQCTCLIE-IN OR                09986099
099870*                    WS-IND1 > 20                                 09987099
099880*        MOVE L222-NUMCLIEN(WS-IND1) TO LA11-AQCDCLIE-IN(WS-IND1) 09988099
099890*        MOVE L222-CODIDENT(WS-IND1) TO LA11-AQTPDOCU-IN(WS-IND1) 09989099
099900*        MOVE L222-CLAIDENT(WS-IND1) TO LA11-AQNUDOCC-IN(WS-IND1) 09990099
099910*        MOVE L222-CDIGIDEN(WS-IND1) TO LA11-AQCDLETR-IN(WS-IND1) 09991099
099920*        MOVE L222-SECUIDEN(WS-IND1) TO LA11-AQCDSECU-IN(WS-IND1) 09992099
099930*      END-PERFORM                                                09993099
099940*    END-IF                                                       09994099
099950*    MOVE L100-AQCDCANL              TO LA11-AQCDCANA-IN          09995099
099960*    MOVE L100-AQ1MESAI              TO LA11-AQ1MESAI-IN          09996099
099970*    MOVE L100-AQCDENTU              TO LA11-STNUBAN-IN           09997099
099980*                                                                 09998099
099990*    EXEC CICS LINK PROGRAM ('RAQWA11') COMMAREA (AREA-CAQLA11)   09999099
100000*         RESP (COD-RESP)                                         10000099
100100*    END-EXEC                                                     10010099
100200*                                                                 10020099
100300*    IF COD-RESP NOT = DFHRESP (NORMAL)                           10030099
100400*       PERFORM 033-INFORMAR-DATOS-ABEND                          10040099
100500*    END-IF                                                       10050099
100600*                                                                 10060099
100700*    EVALUATE LA11-AQRCMAJ                                        10070099
100800*      WHEN 'OK'                                                  10080099
100900*                                                                 10090099
101000*         EXEC CICS GETMAIN SET (L310-CAQLA99P)                   10100099
101100*            INITIMG (C-SPACES)                                   10110099
101200*            NOSUSPEND                                            10120099
101300*            FLENGTH (LENGTH OF AREA-CAQLA99)                     10130099
101400*         END-EXEC                                                10140099
101500*                                                                 10150099
101600*         MOVE 0 TO SW-AVISOS-P                                   10160099
101700*         MOVE L310-CAQLA99           TO W-PUNTER-COMP            10170099
101800*         SET ADDRESS OF AREA-CAQLA99 TO W-PUNTER-POINTER         10180099
101900*                                                                 10190099
102000*         PERFORM VARYING W-MENS-A11 FROM 1 BY 1                  10200099
102100*                         UNTIL W-MENS-A11 > 40                   10210099
102200*            IF LA11-AQTXAVIS (W-MENS-A11) NOT = SPACES           10220099
102300*               MOVE '1'  TO SW-AVISOS-P                          10230099
102400*               MOVE LA11-AQTPAVIS(W-MENS-A11)                    10240099
102500*                             TO LA99-AQTPAVIS(W-MENS-A11)        10250099
102600*               MOVE LA11-AQTXAVIS(W-MENS-A11)                    10260099
102700*                             TO LA99-AQTXAVIS(W-MENS-A11)        10270099
102800*            END-IF                                               10280099
102900*         END-PERFORM                                             10290099
103000*         IF SW-AVISOS-P = 0                                      10300099
103100*            MOVE 0  TO  L310-CAQLA99                             10310099
103200*         END-IF                                                  10320099
103300*      WHEN 'NF'                                                  10330099
103400*      WHEN 'EL'                                                  10340099
103500*         CONTINUE                                                10350099
103600*      WHEN 'EC'                                                  10360099
103700*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      10370099
103800*         MOVE LA11-AQ1EIBFN         TO L100-AQ1EIBFN             10380099
103900*         MOVE LA11-AQ1EIBRC         TO L100-AQ1EIBRC             10390099
104000*         MOVE LA11-AQ1EIBRS         TO L100-AQ1EIBRS             10400099
104100*         MOVE C-ABEND-CICS          TO L100-AQ1ABNCD             10410099
104200*         PERFORM 099-ABEND-PROC                                  10420099
104300*      WHEN 'DB'                                                  10430099
104400*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      10440099
104500*         MOVE LA11-TABLNAME         TO L100-AQ1TABNM             10450099
104600*         MOVE LA11-SQLCODE          TO WS-ABEND-NUM              10460099
104700*                                       L100-AQ1SQLCD             10470099
104800*         MOVE WS-ABEND-DB2          TO L100-AQ1ABNCD             10480099
104900*         MOVE LA11-SQLERRM          TO L100-AQ1SQLER             10490099
105000*         PERFORM 099-ABEND-PROC                                  10500099
105100*      WHEN OTHER                                                 10510099
105200*         MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                    10520099
105300*         MOVE 'RAQWA11'      TO L045-AQTXMENS (1)                10530099
105400*         MOVE LA11-AQRETCOD  TO L045-AQTXMENS (2)                10540099
105500*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      10550099
105600*         PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  10560099
105700*         PERFORM 099-ABEND-PROC                                  10570099
105800*    END-EVALUATE.                                                10580099
105900*                                                                 10590099
106000*----------------------------------------------------------------*10600099
106100*   LINK A RAQWA11 (AVISOS A PRIORI)                            .*10610099
106200*----------------------------------------------------------------*10620099
106300*P156->                                                           10630099
106400*-------------------                                              10640099
106500 091-OBTENIR-AVISOS.                                              10650099
106600*-------------------                                              10660099
106700*tracet->                       +                                 10670099
106800     IF WS-TRACE > '1'                                            10680099
106900        MOVE '091-OBTENIR-AVISOS.--->         ' TO WS-AQNBDTRA    10690099
107000        PERFORM 131-TRACE-TECNIC                                  10700099
107100     END-IF                                                       10710099
107200*tracet<-                                                         10720099
107300                                                                  10730099
107400     IF L135-AQSWAVCT = 'S' OR L135-AQSWAVCL = 'S'                10740099
107500        PERFORM 091B-OBTENIR-AVISOS                               10750099
107600     END-IF                                                       10760099
107700     .                                                            10770099
107800                                                                  10780099
107900*--------------------                                             10790099
108000 091B-OBTENIR-AVISOS.                                             10800099
108100*--------------------                                             10810099
108200*P156<-                                                           10820099
108300*tracet->                       +                                 10830099
108400     IF WS-TRACE > '1'                                            10840099
108500        MOVE '091B-OBTENIR-AVISOS.--->         ' TO WS-AQNBDTRA   10850099
108600        STRING 'Buscar tipus: ' LA11-AQSWCNMU-IN                  10860099
108700           DELIMITED BY SIZE               INTO WS-AQINFORM       10870099
108800        END-STRING                                                10880099
108900        PERFORM 131-TRACE-TECNIC                                  10890099
109000     END-IF                                                       10900099
109100*tracet<-                                                         10910099
109200*                                                                 10920099
109300     MOVE 'S01'                      TO LA11-AQCDOPC              10930099
109400     MOVE L100-AQ1TRANT              TO LA11-AQCDTRAN-IN          10940099
109500*i39-> Solo se pasa el Contrato si Avisos lo requiere en RAQW135  10950099
109600     IF L135-AQSWAVCT = 'S'                                       10960099
109700*i39<-                                                            10970099
109800        MOVE L135-STENTIDA              TO LA11-AQCDENCT-IN       10980099
109900        MOVE L135-STOFI                 TO LA11-AQCDCECT-IN       10990099
110000        MOVE L135-XECDIGIT              TO LA11-AQCDCHDG-IN       11000099
110100        MOVE L135-STNUCTA               TO LA11-AQNUCNTO-IN       11010099
110200*i39->                                                            11020099
110300     END-IF                                                       11030099
110400*    Solo se pasan Clientes/NIF si Avisos lo requiere en RAQW135  11040099
110500     IF L135-AQSWAVCL = 'S'                                       11050099
110600*i39<-                                                            11060099
110700        MOVE L135-AQNUCLIE              TO LA11-AQCTCLIE-IN       11070099
110800*MULTI020-I                                                       11080099
110900        MOVE 1 TO WS-IND5                                         11090099
111000*MULTI020-I                                                       11100099
111100        IF LA11-AQCTCLIE-IN > 0                                   11110099
111200          PERFORM VARYING WS-IND1 FROM 1 BY 1 UNTIL               11120099
111300                    WS-IND1 > LA11-AQCTCLIE-IN OR                 11130099
111400                    WS-IND1 > 20                                  11140099
111500*MULTI020-I                                                       11150099
111600*         Por motivos históricos, hay transacciones que tienen el 11160099
111700*         concepto '020' o '033' definidos en la ICP 'AQ001' en   11170099
111800*         lugar de la 'AQ009'.                                    11180099
111900*         MOVE L135-STCDCLIE(WS-IND1) TO LA11-AQCDCLIE-IN(WS-IND1)11190099
112000*         MOVE L135-STCDTNIF(WS-IND1) TO LA11-AQTPDOCU-IN(WS-IND1)11200099
112100*         MOVE L135-STCDNNIF(WS-IND1) TO LA11-AQNUDOCC-IN(WS-IND1)11210099
112200*         MOVE L135-STCDKNIF(WS-IND1) TO LA11-AQCDLETR-IN(WS-IND1)11220099
112300*         MOVE L135-AQNUSNIF(WS-IND1) TO LA11-AQCDSECU-IN(WS-IND1)11230099
112400          IF L135-AQSRCICP1(WS-IND1) = 'AQ001' OR 'AQ009'         11240099
112500             MOVE L135-STCDCLIE(WS-IND1)                          11250099
112600                                      TO LA11-AQCDCLIE-IN(WS-IND5)11260099
112700             MOVE L135-STCDTNIF(WS-IND1)                          11270099
112800                                      TO LA11-AQTPDOCU-IN(WS-IND5)11280099
112900             MOVE L135-STCDNNIF(WS-IND1)                          11290099
113000                                      TO LA11-AQNUDOCC-IN(WS-IND5)11300099
113100             MOVE L135-STCDKNIF(WS-IND1)                          11310099
113200                                      TO LA11-AQCDLETR-IN(WS-IND5)11320099
113300             MOVE L135-AQNUSNIF(WS-IND1)                          11330099
113400                                      TO LA11-AQCDSECU-IN(WS-IND5)11340099
113500             ADD 1 TO WS-IND5                                     11350099
113600          END-IF                                                  11360099
113700*MULTI020-E                                                       11370099
113800         END-PERFORM                                              11380099
113900       END-IF                                                     11390099
114000*i39->                                                            11400099
114100     END-IF                                                       11410099
114200*i39<-                                                            11420099
114300     MOVE L100-AQCDCANL              TO LA11-AQCDCANA-IN          11430099
114400*NewSAMGbasedWarnings-I                                           11440099
114500*    MOVE L100-AQ1MESAI              TO LA11-AQ1MESAI-IN          11450099
114600     IF notEvalNavigWarnings                                      11460099
114700        MOVE L100-AQ1MESAI           TO LA11-AQ1MESAI-IN          11470099
114800     ELSE                                                         11480099
114900*       This is a virtual unexistant key that we use to           11490099
115000*       setup any architectural warnings that are to be           11500099
115100*       triggered when navigating from one transacion to          11510099
115200*       the other, when the target one is reached.                11520099
115300        MOVE 'X'                     TO LA11-AQ1MESAI-IN          11530099
115400     END-IF                                                       11540099
115500*NewSAMGbasedWarnings-E                                           11550099
115600     MOVE L100-AQCDENTU              TO LA11-STNUBAN-IN           11560099
115700*                                                                 11570099
115800     EXEC CICS LINK PROGRAM ('RAQWA11') COMMAREA (AREA-CAQLA11)   11580099
115810          RESP (COD-RESP)                                         11581099
115820     END-EXEC                                                     11582099
115830*                                                                 11583099
115840     IF COD-RESP NOT = DFHRESP (NORMAL)                           11584099
115850        PERFORM 033-INFORMAR-DATOS-ABEND                          11585099
115860     END-IF                                                       11586099
115870                                                                  11587099
115880     EVALUATE LA11-AQRCMAJ                                        11588099
115890       WHEN 'OK'                                                  11589099
115900*                                                                 11590099
116000          EXEC CICS GETMAIN SET (L310-CAQLA99P)                   11600099
116100             INITIMG (C-SPACES)                                   11610099
116200             NOSUSPEND                                            11620099
116300             FLENGTH (LENGTH OF AREA-CAQLA99)                     11630099
116400          END-EXEC                                                11640099
116500*                                                                 11650099
116600          MOVE 0 TO SW-AVISOS-P                                   11660099
116700          MOVE L310-CAQLA99           TO W-PUNTER-COMP            11670099
116800          SET ADDRESS OF AREA-CAQLA99 TO W-PUNTER-POINTER         11680099
116900*MLV-ABL->                                                        11690099
117000          MOVE 0 TO WS-IND-COD                                    11700099
117100*MLV-ABL<-                                                        11710099
117200*JAS01-I                                                          11720099
117300          MOVE 0 TO WS-IND-COD2                                   11730099
117400*JAS01-F                                                          11740099
117500*                                                                 11750099
117600          PERFORM VARYING W-MENS-A11 FROM 1 BY 1                  11760099
117700                          UNTIL W-MENS-A11 > 40                   11770099
117800             IF LA11-AQTXAVIS (W-MENS-A11) NOT = SPACES           11780099
117900                MOVE '1'  TO SW-AVISOS-P                          11790099
118000                MOVE LA11-AQTPAVIS(W-MENS-A11)                    11800099
118100                              TO LA99-AQTPAVIS(W-MENS-A11)        11810099
118200                MOVE LA11-AQTXAVIS(W-MENS-A11)                    11820099
118300                              TO LA99-AQTXAVIS(W-MENS-A11)        11830099
118400*LCO01.I                                                          11840099
118500*               Por cada aviso accedemos a TG1051 para comprobar  11850099
118600*               si el aviso debe ser bloqueante o no              11860099
118700                IF LA11-AQTPAVIS(W-MENS-A11) = 'X'                11870099
118800                   PERFORM 137-VERIFICAR-EXCEPCION                11880099
118900                END-IF                                            11890099
119000*LCO01.F                                                          11900099
119100*P148-I                                                           11910099
119200*Verificar excepciones para avisos tipo 'G'                       11920099
119300                IF LA11-AQTPAVIS(W-MENS-A11) = 'G'                11930099
119400                   PERFORM 137A-EXCEPCION-GDPR                    11940099
119500                END-IF                                            11950099
119600*P148-F                                                           11960099
119700                                                                  11970099
119800*NewSAMGbasedWarnings-I                                           11980099
119900                IF LA11-AQTPAVIS(W-MENS-A11) = 'J'                11990099
120000                   AND                                            12000099
120100                   (W-MENS-A11 = 1                                12010099
120200                    OR                                            12020099
120300                    W-MENS-A11 > 1 AND                            12030099
120400                    LA11-AQTPAVIS(W-MENS-A11) NOT =               12040099
120500                    LA11-AQTPAVIS(W-MENS-A11 - 1)                 12050099
120600                   )                                              12060099
120700                   SET ackPending(W-MENS-A11) TO TRUE             12070099
120800                END-IF                                            12080099
120810                                                                  12081099
120820                IF LA11-AQTPAVIS(W-MENS-A11) = 'P'                12082099
120830*                  For completely prohibited access, we force     12083099
120840*                  a negative response (even though the user never12084099
120850*                  had the chance to issue it) so that RAQW370    12085099
120860*                  sets L100-AQAVISOS to 'H' and then we can deal 12086099
120870*                  evaluate if ICP AQ022 is to be checked for     12087099
120880*                  partial masking of screen data.                12088099
120890                   SET ackNegative(W-MENS-A11) TO TRUE            12089099
120891                END-IF                                            12089199
120892*NewSAMGbasedWarnings-E                                           12089299
120893                                                                  12089399
120894             END-IF                                               12089499
120895          END-PERFORM                                             12089599
120896          IF SW-AVISOS-P = 0                                      12089699
120897             MOVE 0  TO  L310-CAQLA99                             12089799
120898          END-IF                                                  12089899
120899       WHEN 'NF'                                                  12089999
120900       WHEN 'EL'                                                  12090099
120901          CONTINUE                                                12090199
120902       WHEN 'EC'                                                  12090299
120903          SET SW-ABEND-ARQUITECTURAL TO TRUE                      12090399
120904          MOVE LA11-AQ1EIBFN         TO L100-AQ1EIBFN             12090499
120905          MOVE LA11-AQ1EIBRC         TO L100-AQ1EIBRC             12090599
120906          MOVE LA11-AQ1EIBRS         TO L100-AQ1EIBRS             12090699
120907          MOVE C-ABEND-CICS          TO L100-AQ1ABNCD             12090799
120908          PERFORM 099-ABEND-PROC                                  12090899
120909       WHEN 'DB'                                                  12090999
120910          SET SW-ABEND-ARQUITECTURAL TO TRUE                      12091099
120920          MOVE LA11-TABLNAME         TO L100-AQ1TABNM             12092099
120930          MOVE LA11-SQLCODE          TO WS-ABEND-NUM              12093099
120940                                        L100-AQ1SQLCD             12094099
120950          MOVE WS-ABEND-DB2          TO L100-AQ1ABNCD             12095099
120960          MOVE LA11-SQLERRM          TO L100-AQ1SQLER             12096099
120970          PERFORM 099-ABEND-PROC                                  12097099
120980       WHEN OTHER                                                 12098099
120990          MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                    12099099
121000          MOVE 'RAQWA11'      TO L045-AQTXMENS (1)                12100099
121100          MOVE LA11-AQRETCOD  TO L045-AQTXMENS (2)                12110099
121200          SET SW-ABEND-ARQUITECTURAL TO TRUE                      12120099
121300          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  12130099
121400          PERFORM 099-ABEND-PROC                                  12140099
121500     END-EVALUATE                                                 12150099
121600*tracet->                       +                                 12160099
121700     IF WS-TRACE > '0'                                            12170099
121800        MOVE '091-OBTENIR-AVISOS.<---         ' TO WS-AQNBDTRA    12180099
121900        IF LA11-AQCDPLAN-CNT = 0                                  12190099
122000           MOVE 'NO TROBATS AVISOS'             TO WS-AQINFORM    12200099
122100        ELSE                                                      12210099
122200           MOVE LA11-AQCDPLAN-CNT               TO W-N4           12220099
122300           STRING 'TROBATS ' W-N4 ' AVISOS'                       12230099
122400              DELIMITED BY SIZE               INTO WS-AQINFORM    12240099
122500           END-STRING                                             12250099
122600        END-IF                                                    12260099
122700        PERFORM 131-TRACE-TECNIC                                  12270099
122800     END-IF                                                       12280099
122900*tracet<-                                                         12290099
123000     .                                                            12300099
123100*P148-I                                                           12310099
123200*Llamada a RAQWA11 para obtener todos los tipos de avisos que     12320099
123300*tiene la transaccion, no se recupera el detalle de cada uno      12330099
123400*----------------------------------------------------------------*12340099
123500*   LINK A RAQWA11 CON NUEVA OPCION S02                         .*12350099
123600*----------------------------------------------------------------*12360099
123700 091A-OBTENIR-AVISOS.                                             12370099
123800*-------------------                                              12380099
123900*tracet->                       +                                 12390099
124000     IF WS-TRACE > '1'                                            12400099
124100        MOVE '091A-OBTENIR-AVISOS.--->         ' TO WS-AQNBDTRA   12410099
124200        STRING 'Buscar todos: '                                   12420099
124300           DELIMITED BY SIZE               INTO WS-AQINFORM       12430099
124400        END-STRING                                                12440099
124500        PERFORM 131-TRACE-TECNIC                                  12450099
124600     END-IF                                                       12460099
124700*tracet<-                                                         12470099
124800*                                                                 12480099
124900     MOVE 'S02'                       TO LA11-AQCDOPC             12490099
125000*                                                                 12500099
125100     MOVE L100-AQ1TRANT               TO LA11-AQCDTRAN-IN         12510099
125200     MOVE L100-AQCDCANL               TO LA11-AQCDCANA-IN         12520099
125300*NewSAMGbasedWarnings-I                                           12530099
125400*    MOVE L100-AQ1MESAI               TO LA11-AQ1MESAI-IN         12540099
125500     SET warningTypeStringObtained TO TRUE                        12550099
125600     IF notEvalNavigWarnings                                      12560099
125700        MOVE L100-AQ1MESAI            TO LA11-AQ1MESAI-IN         12570099
125800     ELSE                                                         12580099
125900*       This is a virtual unexistant key that we use to           12590099
126000*       setup any architectural warnings that are to be           12600099
126100*       triggered when navigating from one transacion to          12610099
126200*       the other, when the target one is reached.                12620099
126300        MOVE 'X'                      TO LA11-AQ1MESAI-IN         12630099
126400     END-IF                                                       12640099
126500*NewSAMGbasedWarnings-E                                           12650099
126600     MOVE L100-AQCDENTU               TO LA11-STNUBAN-IN          12660099
126700*                                                                 12670099
126800     EXEC CICS LINK PROGRAM ('RAQWA11') COMMAREA (AREA-CAQLA11)   12680099
126900          RESP (COD-RESP)                                         12690099
127000     END-EXEC                                                     12700099
127100*                                                                 12710099
127200     IF COD-RESP NOT = DFHRESP (NORMAL)                           12720099
127300        PERFORM 033-INFORMAR-DATOS-ABEND                          12730099
127400     END-IF                                                       12740099
127500                                                                  12750099
127600     EVALUATE LA11-AQRCMAJ                                        12760099
127700       WHEN 'OK'                                                  12770099
127800*        IF LA11-AQTIPAVI > 0                                     12780099
127900            MOVE LA11-AQTIPAVI        TO WS-AQTIPAVI              12790099
128000*        END-IF                                                   12800099
128100*                                                                 12810099
128200       WHEN 'NF'                                                  12820099
128300       WHEN 'EL'                                                  12830099
128400          CONTINUE                                                12840099
128500       WHEN 'EC'                                                  12850099
128600          SET SW-ABEND-ARQUITECTURAL  TO TRUE                     12860099
128700          MOVE LA11-AQ1EIBFN          TO L100-AQ1EIBFN            12870099
128800          MOVE LA11-AQ1EIBRC          TO L100-AQ1EIBRC            12880099
128900          MOVE LA11-AQ1EIBRS          TO L100-AQ1EIBRS            12890099
129000          MOVE C-ABEND-CICS           TO L100-AQ1ABNCD            12900099
129100          PERFORM 099-ABEND-PROC                                  12910099
129200       WHEN 'DB'                                                  12920099
129300          SET SW-ABEND-ARQUITECTURAL  TO TRUE                     12930099
129400          MOVE LA11-TABLNAME          TO L100-AQ1TABNM            12940099
129500          MOVE LA11-SQLCODE           TO WS-ABEND-NUM             12950099
129600                                         L100-AQ1SQLCD            12960099
129700          MOVE WS-ABEND-DB2           TO L100-AQ1ABNCD            12970099
129800          MOVE LA11-SQLERRM           TO L100-AQ1SQLER            12980099
129900          PERFORM 099-ABEND-PROC                                  12990099
130000       WHEN OTHER                                                 13000099
130100          MOVE C-ERROR-MODULO         TO L100-AQ1ABNCD            13010099
130200          MOVE 'RAQWA11'              TO L045-AQTXMENS (1)        13020099
130300          MOVE LA11-AQRETCOD          TO L045-AQTXMENS (2)        13030099
130400          SET SW-ABEND-ARQUITECTURAL  TO TRUE                     13040099
130500          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  13050099
130600          PERFORM 099-ABEND-PROC                                  13060099
130700     END-EVALUATE                                                 13070099
130800*P148-F                                                           13080099
130900     .                                                            13090099
131000*                                                                 13100099
131100* RTA-17-10-03 FIN                                                13110099
131200*                                                                 13120099
131300*----------------------------------------------------------------*13130099
131400 092-LINK-RAQW370.                                                13140099
131500*-----------------                                                13150099
131600*tracet->                       +                                 13160099
131700     IF WS-TRACE > '1'                                            13170099
131800        MOVE '092-LINK-RAQW370.               ' TO WS-AQNBDTRA    13180099
131900        STRING                                                    13190099
132000          'L100-AQAVISOS: ' L100-AQAVISOS                         13200099
132100           DELIMITED BY SIZE  INTO WS-AQINFORM                    13210099
132200        END-STRING                                                13220099
132300        PERFORM 131-TRACE-TECNIC                                  13230099
132400     END-IF                                                       13240099
132500*tracet<-                                                         13250099
132600*                                                                 13260099
132700     EXEC CICS LINK PROGRAM ('RAQW370')                           13270099
132800          COMMAREA (L100-AREA-TOTAL)                              13280099
132900          RESP (COD-RESP)                                         13290099
133000     END-EXEC.                                                    13300099
133100*                                                                 13310099
133200*----------------------------------------------------------------*13320099
133300* GRAVAR REGISTRE ESPECIAL DE SCR AMB TRANSACCIONS RELACIONADES  *13330099
133400*----------------------------------------------------------------*13340099
133500 093-PANTALLA-RELACION.                                           13350099
133600*----------------------                                           13360099
133700*tracet->                       +                                 13370099
133800     IF WS-TRACE > '1'                                            13380099
133900        MOVE '093-PANTALLA-RELACION.          ' TO WS-AQNBDTRA    13390099
134000        PERFORM 131-TRACE-TECNIC                                  13400099
134100     END-IF                                                       13410099
134200*tracet<-                                                         13420099
134300     MOVE 'PR' TO L310-AQCODOPE                                   13430099
134400     PERFORM 095-LINK-RAQW007                                     13440099
134500     IF L310-AQCODRET NOT = SPACES                                13450099
134600        PERFORM 031-FINAL                                         13460099
134700     END-IF.                                                      13470099
134800                                                                  13480099
134900*----------------------------------------------------------------*13490099
135000*    - GESTIONA LA NUEVA COLA DE AVISOS                          *13500099
135100*----------------------------------------------------------------*13510099
135200 094-TRATA-MENSAJES.                                              13520099
135300*-------------------                                              13530099
135400*tracet->                       +                                 13540099
135500     IF WS-TRACE > '1'                                            13550099
135600        MOVE '094-TRATA-MENSAJES.             ' TO WS-AQNBDTRA    13560099
135700        PERFORM 131-TRACE-TECNIC                                  13570099
135800     END-IF                                                       13580099
135900*tracet<-                                                         13590099
136000*JO040902                                                         13600099
136100     IF L100-AQ1PTRAV > 0                                         13610099
136200        MOVE L100-AQ1PTRAV            TO W-PUNTER-COMP            13620099
136300        SET ADDRESS OF CGTL015-AREA   TO W-PUNTER-POINTER         13630099
136400*JO040902                                                         13640099
136500        IF L100-AQ1AVCD1 = SPACES                                 13650099
136600            PERFORM VARYING W-INDICE FROM 1 BY 1                  13660099
136700               UNTIL ( W-INDICE > C-40 ) OR                       13670099
136800                     ( L015-AQ15ERRO (W-INDICE) = C-A )           13680099
136900            END-PERFORM                                           13690099
137000            IF W-INDICE < C-40 + 1                                13700099
137100                MOVE L015-AQ15AVER (W-INDICE) TO L100-AQ1AVCD1    13710099
137200                MOVE SPACES TO L015-AQ15AVER (W-INDICE)           13720099
137300            END-IF                                                13730099
137400        END-IF                                                    13740099
137500        IF L100-AQ1AVCD2 = SPACES AND W-INDICE < C-40             13750099
137600            ADD 1 TO W-INDICE                                     13760099
137700            PERFORM VARYING W-INDICE FROM W-INDICE BY 1           13770099
137800              UNTIL ( W-INDICE > C-40 ) OR                        13780099
137900                    ( L015-AQ15ERRO (W-INDICE) = C-A )            13790099
138000            END-PERFORM                                           13800099
138100            IF W-INDICE < C-40 + 1                                13810099
138200                MOVE L015-AQ15AVER (W-INDICE) TO L100-AQ1AVCD2    13820099
138300                MOVE SPACES TO L015-AQ15AVER (W-INDICE)           13830099
138400            END-IF                                                13840099
138500        END-IF                                                    13850099
138600        IF L100-AQ1ERRCD = SPACES                                 13860099
138700           PERFORM VARYING W-INDICE FROM 1 BY 1                   13870099
138800                 UNTIL ( W-INDICE > C-40 ) OR                     13880099
138900                       ( L015-AQ15ERRO (W-INDICE) = C-E )         13890099
139000           END-PERFORM                                            13900099
139100           IF W-INDICE < C-40 + 1                                 13910099
139200               MOVE L015-AQ15AVER (W-INDICE) TO L100-AQ1ERRCD     13920099
139300               MOVE SPACES TO L015-AQ15AVER (W-INDICE)            13930099
139400           END-IF                                                 13940099
139500        END-IF                                                    13950099
139600     END-IF.                                                      13960099
139700*                                                                 13970099
139800*----------------------------------------------------------------*13980099
139900 095-LINK-RAQW007.                                                13990099
140000*-----------------                                                14000099
140100*tracet->                       +                                 14010099
140200     IF WS-TRACE > '1'                                            14020099
140300        MOVE '095-LINK-RAQW007.               ' TO WS-AQNBDTRA    14030099
140400        PERFORM 131-TRACE-TECNIC                                  14040099
140500     END-IF                                                       14050099
140600*tracet<-                                                         14060099
140700     MOVE SPACES       TO L310-MSGABEND                           14070099
140800     MOVE W001-CAQW001 TO L310-AQARPARM                           14080099
140900                                                                  14090099
141000* JVB 20020225 INI                                                14100099
141100*    SET ADDRESS OF LK-AREA-SCR   TO  L310-AQSCRAR                14110099
141200*    MOVE L100-AREA-TOTAL         TO  LK-AREA-SCR                 14120099
141300* JVB 20020225 FIN                                                14130099
141400                                                                  14140099
141500     EXEC CICS LINK PROGRAM ('RAQW007') RESP (COD-RESP)           14150099
141600          COMMAREA (L310-CAQL310)                                 14160099
141700     END-EXEC                                                     14170099
141800                                                                  14180099
141900     IF COD-RESP NOT = DFHRESP (NORMAL)                           14190099
142000        PERFORM 033-INFORMAR-DATOS-ABEND                          14200099
142100     END-IF                                                       14210099
142200                                                                  14220099
142300* JVB 20020225 INI                                                14230099
142400*    MOVE LK-AREA-SCR             TO  L100-AREA-TOTAL             14240099
142500* JVB 20020225 FIN                                                14250099
142600*                                                                 14260099
142700     IF L310-AQCODRET  NOT = '  '                                 14270099
142800        MOVE 'RAQW007'      TO L045-AQTXMENS (1)                  14280099
142900        PERFORM 129-ERROR-MODULS-RAQWNNN                          14290099
143000     END-IF                                                       14300099
143100                                                                  14310099
143200     MOVE L310-AQARPARM  TO  W001-CAQW001.                        14320099
143300*                                                                 14330099
143400*----------------------------------------------------------------*14340099
143500*    BUSCAR ENTRADA DE LA APLICACION                             *14350099
143600*----------------------------------------------------------------*14360099
143700 096-BUSCAR-ENTRADA-APLIC.                                        14370099
143800*-------------------------                                        14380099
143900*tracet->                       +                                 14390099
144000     IF WS-TRACE > '1'                                            14400099
144100        MOVE '096-BUSCAR-ENTRADA-APLIC.       ' TO WS-AQNBDTRA    14410099
144200        PERFORM 131-TRACE-TECNIC                                  14420099
144300     END-IF                                                       14430099
144400*tracet<-                                                         14440099
144500     MOVE 'EA'            TO L310-AQCODOPE                        14450099
144600     INITIALIZE W001-CAQW001                                      14460099
144700     MOVE L100-AQ1APLIC   TO W001-APLICA                          14470099
144800                                                                  14480099
144900     PERFORM 041-LINK-RAQW008                                     14490099
145000                                                                  14500099
145100     IF L310-MSGABEND NOT = SPACES                                14510099
145200        MOVE L310-MSGABEND TO L100-AQ1ABNCD                       14520099
145300        PERFORM 031-FINAL                                         14530099
145400     END-IF                                                       14540099
145500                                                                  14550099
145600     IF W001-ENTRADA NOT = SPACES                                 14560099
145700        MOVE W001-ENTRADA TO L100-AQ1ENTRA                        14570099
145800     ELSE                                                         14580099
145900        MOVE C-APLIC-CERRADA-ST TO L100-AQ1ABNCD                  14590099
146000        SET SW-ABEND-ARQUITECTURAL TO TRUE                        14600099
146100        PERFORM 099-ABEND-PROC                                    14610099
146200     END-IF.                                                      14620099
146300*                                                                 14630099
146400*----------------------------------------------------------------*14640099
146500*    -  ACTUALIZACION DE DATOS DEL TERMINAL                      *14650099
146600*----------------------------------------------------------------*14660099
146700 097-ACTUALIZA-TERMINAL.                                          14670099
146800*-----------------------                                          14680099
146900*tracet->                       +                                 14690099
147000     IF WS-TRACE > '1'                                            14700099
147100        MOVE '097-ACTUALIZA-TERMINAL.         ' TO WS-AQNBDTRA    14710099
147200        PERFORM 131-TRACE-TECNIC                                  14720099
147300     END-IF                                                       14730099
147400*tracet<-                                                         14740099
147500*--> MLV241100                                                    14750099
147600     IF F060-TERM-3270                                            14760099
147700        CONTINUE                                                  14770099
147800     ELSE                                                         14780099
147900        MOVE L100-AQ1TERML TO F060-AQCDTERM                       14790099
148000        EXEC CICS READ DATASET ('FAQ060') INTO (F060-CAQF060)     14800099
148100             RIDFLD (F060-AQCDTERM) RESP (COD-RESP) UPDATE        14810099
148200        END-EXEC                                                  14820099
148300        IF COD-RESP NOT = DFHRESP (NORMAL)                        14830099
148400           EVALUATE COD-RESP                                      14840099
148500           WHEN DFHRESP(NOTFND)                                   14850099
148600                MOVE C-TERM-NO-DEFINIDO TO L100-AQ1ABNCD          14860099
148700                SET SW-ABEND-ARQUITECTURAL TO TRUE                14870099
148800                PERFORM 099-ABEND-PROC                            14880099
148900           WHEN OTHER                                             14890099
149000                PERFORM 033-INFORMAR-DATOS-ABEND                  14900099
149100           END-EVALUATE                                           14910099
149200        END-IF                                                    14920099
149300        MOVE L100-AQ1SECTR TO F060-AQ9ULSEC                       14930099
149400        MOVE L100-AQ1FAMDX TO F060-AQ9FOPEX                       14940099
149500        EXEC CICS REWRITE DATASET ('FAQ060') FROM  (F060-CAQF060) 14950099
149600             RESP (COD-RESP )                                     14960099
149700        END-EXEC                                                  14970099
149800        IF COD-RESP NOT = DFHRESP (NORMAL)                        14980099
149900           PERFORM 033-INFORMAR-DATOS-ABEND                       14990099
150000        END-IF                                                    15000099
150100     END-IF.                                                      15010099
150200*                                                                 15020099
150300*----------------------------------------------------------------*15030099
150400*    -  CONTROLA LOS PASOS PARA FINALIZAR EL PROGRAMA            *15040099
150500*    -  CONTROL DE MENSAJES PENDIENTES                           *15050099
150600*    -  SI VE INFORMAT L100-AQTXTRAN PER L'APLICATIU             *15060099
150700*       BIFURCAR A AQUESTA TRANS, SI NO AL MENU GRAL DE L'APLICAC*15070099
150800*----------------------------------------------------------------*15080099
150900 098-BUSCAR-ENTRADA.                                              15090099
151000*-------------------                                              15100099
151100*tracet->                       +                                 15110099
151200     IF WS-TRACE > '1'                                            15120099
151300        MOVE '098-BUSCAR-ENTRADA.             ' TO WS-AQNBDTRA    15130099
151400        PERFORM 131-TRACE-TECNIC                                  15140099
151500     END-IF                                                       15150099
151600*tracet<-                                                         15160099
151700     IF (L100-AQTXTRAN NOT = SPACES) AND (EIBAID = DFHPF3)        15170099
151800        MOVE L100-AQTXTRAN      TO L310-AQARGMNT                  15180099
151900        MOVE '0'                TO L310-AQCODOP1                  15190099
152000        MOVE '2'                TO L310-AQCODOP2                  15200099
152100        EXEC CICS LINK PROGRAM ('RAQW311') COMMAREA (AREA-CAQL310)15210099
152200             RESP (COD-RESP)                                      15220099
152300        END-EXEC                                                  15230099
152400     ELSE                                                         15240099
152500        MOVE SPACES             TO L310-AQARGMNT                  15250099
152600        MOVE L100-AQ1APLIC      TO L310-AQARGMNT(1:4)             15260099
152700        MOVE L100-AQ1ENTRA      TO L310-AQARGMNT(5:8)             15270099
152800        MOVE '1'                TO L310-AQCODOP1                  15280099
152900        MOVE '2'                TO L310-AQCODOP2                  15290099
153000        EXEC CICS LINK PROGRAM ('RAQW311') COMMAREA (AREA-CAQL310)15300099
153100             RESP (COD-RESP)                                      15310099
153200        END-EXEC                                                  15320099
153300     END-IF                                                       15330099
153400                                                                  15340099
153500     IF EIBAID = DFHPF3                                           15350099
153600        IF L310-AQCODRET EQUAL '01'                               15360099
153700           MOVE SPACES             TO L310-AQARGMNT               15370099
153800           MOVE 'AQ  '             TO L310-AQARGMNT(1:4)          15380099
153900           MOVE 'MEN-APLI'         TO L310-AQARGMNT(5:8)          15390099
154000           MOVE '1'                TO L310-AQCODOP1               15400099
154100           MOVE '2'                TO L310-AQCODOP2               15410099
154200           EXEC CICS LINK PROGRAM ('RAQW311')                     15420099
154300                  COMMAREA (AREA-CAQL310)                         15430099
154400                  RESP (COD-RESP)                                 15440099
154500           END-EXEC                                               15450099
154600        END-IF                                                    15460099
154700     END-IF                                                       15470099
154800*                                                                 15480099
154900*MLV-01-06-05 INICIO                                              15490099
155000*    IF L310-AQCODRET EQUAL '00'                                  15500099
155100*       SET ADDRESS OF F030-CAQF030 TO L310-CAQF030B              15510099
155200*    ELSE                                                         15520099
155300*       IF L310-AQCODRET EQUAL '01'                               15530099
155400* FIN-JLM-11/12/01                                                15540099
155500*                                                                 15550099
155600*        PERFORM 033-INFORMAR-DATOS-ABEND                         15560099
155700*       END-IF                                                    15570099
155800*    END-IF                                                       15580099
155900*                                                                 15590099
156000     EVALUATE L310-AQCODRET                                       15600099
156100     WHEN '00'                                                    15610099
156200          SET ADDRESS OF F030-CAQF030 TO L310-CAQF030B            15620099
156300     WHEN '01'                                                    15630099
156400          MOVE 'JAQB089'      TO L100-AQ1ABNCD                    15640099
156500          MOVE L100-AQ1ENTRA  TO L045-AQTXMENS (1)                15650099
156600          MOVE L100-AQ1APLIC  TO L045-AQTXMENS (2)                15660099
156700          SET SW-ABEND-ARQUITECTURAL TO TRUE                      15670099
156800          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  15680099
156900          PERFORM 099-ABEND-PROC                                  15690099
157000     WHEN OTHER                                                   15700099
157100          MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                    15710099
157200          MOVE 'RAQW311'      TO L045-AQTXMENS (1)                15720099
157300          MOVE L310-AQCODRET  TO L045-AQTXMENS (2)                15730099
157400          SET SW-ABEND-ARQUITECTURAL TO TRUE                      15740099
157500          PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                  15750099
157600          PERFORM 099-ABEND-PROC                                  15760099
157700     END-EVALUATE                                                 15770099
157800*                                                                 15780099
157900*MLV-01-06-05 FINAL                                               15790099
158000     IF F030-AQ3APLIC  = 'AQ  ' AND F030-TRN-INACTIVA             15800099
158100        AND  F030-AQ3TIPUS  = '5'                                 15810099
158200        MOVE 'S'               TO F030-AQ3INDAC                   15820099
158300        MOVE 'V'               TO L085-AQCODOPE                   15830099
158400        MOVE C-AVISO-TRANS-ARQ TO L085-AQ4CLAVE                   15840099
158500        MOVE F030-AQ3TRNID     TO L085-AQTXMENS(1)                15850099
158600        PERFORM 047-LLAMADA-RAQW085                               15860099
158700        MOVE L085-AQTXME77     TO L145-AQMSGTXT                   15870099
158800        PERFORM 048-GRABAR-LOG                                    15880099
158900        INITIALIZE L145-CAQL145                                   15890099
159000     END-IF.                                                      15900099
159100*                                                                 15910099
159200*----------------------------------------------------------------*15920099
159300*    -  GESTIONA LAS TERMINACIONES ANORMALES                     *15930099
159400*    -  SE SUSTITUYE EL MENSAJE QUE HA INFORMADO EL APLICATIVO   *15940099
159500*       POR  C-ABEND-GENERAL , A EXCEPCION DE LOS 'JSTBXXX'      *15950099
159600*----------------------------------------------------------------*15960099
159700 099-ABEND-PROC.                                                  15970099
159800*---------------                                                  15980099
159900*tracet->                       +                                 15990099
160000     IF WS-TRACE > '1'                                            16000099
160100        MOVE '099-ABEND-PROC.                 ' TO WS-AQNBDTRA    16010099
160200        PERFORM 131-TRACE-TECNIC                                  16020099
160300     ELSE                                                         16030099
160400        MOVE 'ABEND PR'  TO F025-HORA-GRAVACIO                    16040099
160500                                                                  16050099
160600        EXEC CICS SYNCPOINT ROLLBACK END-EXEC                     16060099
160700     END-IF                                                       16070099
160800*                                                                 16080099
160900*tracet<-                                                         16090099
161000     MOVE C-ESCRITURA TO L100-AQ1MESST                            16100099
161100*                                                                 16110099
161200*M016->                                                           16120099
161300*    IF L121-CANAL-CONT-REBU103-S AND SW-APLICATIVO-LLAMADO AND   16130099
161400*       SW-EXIT-BE-OUT-NO-INVOCADO                                16140099
161500*       EXEC CICS LINK PROGRAM ('REBU103')                        16150099
161600*           RESP (COD-RESP) COMMAREA (L100-AREA-TOTAL)            16160099
161700*       END-EXEC                                                  16170099
161800     IF ( L121-CANAL-CONT-REBU103-S OR                            16180099
161900          L121-CANAL-CONT-REBU110-S   ) AND                       16190099
162000          SW-EXIT-BE-OUT-NO-INVOCADO    AND                       16200099
162100          SW-APLICATIVO-LLAMADO                                   16210099
162200*                                                                 16220099
162300        EVALUATE TRUE                                             16230099
162400        WHEN L121-CANAL-CONT-REBU103-S                            16240099
162500             EXEC CICS LINK PROGRAM ('REBU103')                   16250099
162600                  RESP (COD-RESP) COMMAREA (L100-AREA-TOTAL)      16260099
162700             END-EXEC                                             16270099
162800        WHEN L121-CANAL-CONT-REBU110-S                            16280099
162900             EXEC CICS LINK PROGRAM ('REBU110')                   16290099
163000                  RESP (COD-RESP) COMMAREA (L100-AREA-TOTAL)      16300099
163100             END-EXEC                                             16310099
163200        END-EVALUATE                                              16320099
163300*<-M016                                                           16330099
163400     END-IF                                                       16340099
163500*                                                                 16350099
163600*--> ACTIVAR EL INDICADOR SW-ABEND-APLICATIVO SI EL CODIGO DE     16360099
163700*--> ABEND ES 'JGTB127' O 'JAQB019', YA QUE DEBE SEGUIRSE LOS     16370099
163800*--> MISMOS PROCEDIMIENTOS QUE PARA UN ABEND DETECTADO POR LA     16380099
163900*--> LA APLICACION. EN EL CASO DE QUE EL AREA DNF ESTE MAL        16390099
164000*--> FORMATEADA (JGBT127) SE GUARDAN ESTAS AREAS PARA PODER HACER 16400099
164100*--> UN SEGUIMIENTO DEL ERROR.                                    16410099
164200*                                                                 16420099
164300     IF L100-AQ1ABNCD = 'JGTB127' OR                              16430099
164400        L100-AQ1ABNCD = 'JAQB019'                                 16440099
164500        SET SW-ABEND-APLICATIVO TO TRUE                           16450099
164600        IF L100-AQ1ABNCD = 'JGTB127'                              16460099
164700           PERFORM 115-SALVAR-AREA-DNF                            16470099
164800        END-IF                                                    16480099
164900     END-IF                                                       16490099
165000*                                                                 16500099
165100     MOVE L100-AQ1ABNCD TO W-COD-ABEND                            16510099
165200     MOVE L100-AQ1ABNCD TO W-ABEND-APLICACION                     16520099
165300     EVALUATE TRUE                                                16530099
165400        WHEN SW-ABEND-DB2                                         16540099
165500             MOVE L100-AQ1TABNM  TO W-TA3-TABLENAME               16550099
165600             MOVE L100-AQ1SQLCD  TO W-TA3-SQLCODE                 16560099
165700             MOVE L100-AQ1SQLED  TO W-TA3-SQLERRM                 16570099
165800             MOVE W-TEXTO-ABEND3 TO W-MENSAJE                     16580099
165900             MOVE 'S' TO L085-AQ4INTRA                            16590099
166000        WHEN SW-ABEND-CICS                                        16600099
166100             MOVE 'S' TO L085-AQ4INTRA                            16610099
166200             PERFORM 116-FORMATEAR-ABEND-CICS                     16620099
166300        WHEN SW-ABEND-DLI                                         16630099
166400             MOVE 'S' TO L085-AQ4INTRA                            16640099
166500             PERFORM 117-FORMATEAR-ABEND-DLI                      16650099
166600        WHEN OTHER                                                16660099
166700*                                                                 16670099
166800* TRANSFORMA MISSATGE D'ABEND PER UN ERROR, SOL.LICITAT           16680099
166900* EL 23.03.02 (CARLES CHAVES)                                     16690099
167000*                                                                 16700099
167100* INI-MLV-11/06/02                                                16710099
167200*            IF L100-AQ1ABNCD = 'JSTB024'                         16720099
167300*                MOVE 'JAQE130' TO L100-AQ1ABNCD                  16730099
167400*            END-IF                                               16740099
167500* FIN-MLV-11/06/02                                                16750099
167600             INITIALIZE L085-CAQL085                              16760099
167700*M010->                                                           16770099
167800             SET L085-CONSULTA-GENERICO TO TRUE                   16780099
167900*<-M010                                                           16790099
168000             MOVE 'F'                TO L085-AQCODOPE             16800099
168100             MOVE L100-AQ1ABNCD      TO L085-AQ4CLAVE             16810099
168200*******                                                           16820099
168300             IF F060-TERM-3270                                    16830099
168400                MOVE L078-AQCDIDIO   TO L085-AQCDIDIO             16840099
168500*M010->                                                           16850099
168600             ELSE                                                 16860099
168700                MOVE '00'            TO L085-AQCDIDIO             16870099
168800*<-M010                                                           16880099
168900             END-IF                                               16890099
169000             PERFORM 047-LLAMADA-RAQW085                          16900099
169100             MOVE L085-AQTXME77      TO W-MENSAJE                 16910099
169200     END-EVALUATE                                                 16920099
169300*    MOVE 'S' TO L085-AQ4INTRA                                    16930099
169400     MOVE 'N' TO L085-AQ4INABE                                    16940099
169500     MOVE 'S' TO L085-AQ4INREV                                    16950099
169600     IF L085-SW-MEN-VARIABLE                                      16960099
169700        PERFORM 118-MENSAJE-VARIABLE                              16970099
169800     END-IF                                                       16980099
169900*                                                                 16990099
170000*--> SI EL ERROR LO DETECTA ARQUITECTURA VER 'ARQ', SI LO DETECTA 17000099
170100*--> EL APLICATIVO MOVER EL CODIGO DE ABEND QUE ESTE RETORNA      17010099
170200*                                                                 17020099
170300     IF SW-ABEND-ARQUITECTURAL                                    17030099
170400        AND L100-AQ1ABNCD NOT = 'JGTB136'                         17040099
170500        AND L100-AQ1ABNCD NOT = 'JGTB127'                         17050099
170600        AND L100-AQ1ABNCD NOT = 'JAQB019'                         17060099
170700        AND L100-AQ1ABNCD NOT = 'JAQE130'                         17070099
170800        MOVE 'ARQ'       TO L145-AQ1ABNCD                         17080099
170900        MOVE W-NUM-ABEND TO L145-AQ1ABNCD(4:2)                    17090099
171000     ELSE                                                         17100099
171100        MOVE L100-AQ1ABNCD TO L145-AQ1ABNCD                       17110099
171200     END-IF                                                       17120099
171300*                                                                 17130099
171400     IF L100-AQ1ABNCD = 'JAQE130'                                 17140099
171500        MOVE SPACES    TO L145-AQ1ABNCD                           17150099
171600     END-IF                                                       17160099
171700                                                                  17170099
171800     MOVE W-MENSAJE TO L145-AQMSGTXT                              17180099
171900     PERFORM 048-GRABAR-LOG                                       17190099
172000*                                                                 17200099
172100* INI-JLM-22/06/02                                                17210099
172200*   GUARDAMOS EL MENSAJE DE ABEND ANTES DE CAMBIARLO PARA RAQUD01 17220099
172300*   EXCEPTO SI EL MENSAJE ES VARIABLE                             17230099
172400*MLV260802 INICIO                                                 17240099
172500     IF NOT L085-SW-MEN-VARIABLE                                  17250099
172600*MLV260802 FINAL                                                  17260099
172700       ADD  1                     TO LD01-AQNTMISF                17270099
172800       MOVE L100-AQ1ABNCD         TO LD01-AQCDMENS (LD01-AQNTMISF)17280099
172900*                                                                 17290099
173000       IF SW-ABEND-DB2     OR                                     17300099
173100          SW-ABEND-CICS    OR                                     17310099
173200          SW-ABEND-DLI                                            17320099
173300*MLV290802 INICIO                                                 17330099
173400*         MOVE 'N'                TO LD01-AQSWVARI (LD01-AQNTMISF)17340099
173500          MOVE 'S'                TO LD01-AQSWVARI (LD01-AQNTMISF)17350099
173600*MLV290802 FIN                                                    17360099
173700          MOVE W-MENSAJE          TO LD01-AQTXMENS (LD01-AQNTMISF)17370099
173800       ELSE                                                       17380099
173900          MOVE L085-AQ4INVAR      TO LD01-AQSWVARI (LD01-AQNTMISF)17390099
174000          MOVE W-MENSAJE-TEXTO    TO LD01-AQTXMENS (LD01-AQNTMISF)17400099
174100       END-IF                                                     17410099
174200     END-IF                                                       17420099
174300*                                                                 17430099
174400* FIN-JLM-22/06/02                                                17440099
174500*                                                                 17450099
174600*--> NUEVO TRATAMIENTO ABENDS                                     17460099
174700*                                                                 17470099
174800     EVALUATE TRUE                                                17480099
174900        WHEN F060-TERM-3270                                       17490099
175000             IF ( W-ESTADO-INICIAL = C-ESTADO-INICIO ) OR         17500099
175100                L100-SWITCH-TRANSACC OR SW-ABEND-ARQUITECTURAL    17510099
175200                PERFORM 105-TRATAMIENTO-DIARIO                    17520099
175300                SET L300-RETURN          TO TRUE                  17530099
175400*JO-17-02-05 INICIO                                               17540099
175500                IF L100-AQ1ABNCD NOT = 'JAQB210'                  17550099
175600*MLV-16-02-05 INICIO                                              17560099
175700                   MOVE  C-ABEND-GENERAL  TO L100-AQ1ABNCD        17570099
175800*JAS02-I                                                          17580099
175900                   IF SW-ERROR-USER-FISICO                        17590099
176000                      MOVE  C-USUA-NO-AUTORIZ TO L100-AQ1ABNCD    17600099
176100                   END-IF                                         17610099
176200*JAS02-F                                                          17620099
176300                END-IF                                            17630099
176400*MLV-16-02-05 FINAL                                               17640099
176500                PERFORM 119-ENVIAR-MSG-TERM                       17650099
176600             ELSE                                                 17660099
176700                MOVE C-MES-3270 TO W-MODULO                       17670099
176800                PERFORM 120-TRATAR-ABEND-APL                      17680099
176900                MOVE C-INDICADOR  TO L300-AQCOMMAR                17690099
177000                SET L300-RETURN-TRANSID  TO TRUE                  17700099
177100                MOVE L100-AQ1TRANT TO  L300-AQTRANRE              17710099
177200                MOVE '01-ABEND-P'  TO  L392-FILLER(1:10)          17720099
177300*A271 26/07/04 INICIO                                             17730099
177400*               PERFORM 124-ESBORRA-REGIS-SCR-TASCA               17740099
177500*A271 26/07/04 FINAL                                              17750099
177600*tracet->                                                         17760099
177700                IF WS-TRACE > '0'                                 17770099
177800                   MOVE 'END-RAQW001-11' TO WS-AQNBDTRA           17780099
177900                   MOVE L100-AQ1DCASO    TO WS-AQ1DCASO           17790099
178000                   STRING                                         17800099
178100                     '<<==== Tran/estado/caso|ret: '              17810099
178200                      F030-AQ3TRNID '/'                           17820099
178300                      L100-AQ1ESTAD '/' WS-AQ1DCASO '|'           17830099
178400                      L300-AQCDFURE                               17840099
178500                      DELIMITED BY SIZE  INTO WS-AQINFORM         17850099
178600                   END-STRING                                     17860099
178700                   PERFORM 131-TRACE-TECNIC                       17870099
178800                END-IF                                            17880099
178900*tracet<-                                                         17890099
179000                EXEC CICS RETURN                                  17900099
179100                END-EXEC                                          17910099
179200             END-IF                                               17920099
179300        WHEN F060-TERM-FINANCIERO                                 17930099
179400*268 29/03/2004 INICIO                                            17940099
179500             IF L100-AQ1TRANT = 'TLD3' OR 'TLF1' OR 'KC10'        17950099
179600                OR 'KC20'                                         17960099
179700                SET SW-ABEND-ARQUITECTURAL TO TRUE                17970099
179800             END-IF                                               17980099
179900*268 29/03/2004 FINAL                                             17990099
180000             IF SW-ABEND-ARQUITECTURAL OR L100-SWITCH-TRANSACC    18000099
180100                PERFORM 105-TRATAMIENTO-DIARIO                    18010099
180200*                                                                 18020099
180300*--  Se realiza el SYNCPOINT para consolidar la insercion en el   18030099
180400*--  diario Audit/trails                                          18040099
180500*                                                                 18050099
180600*                                                                 18060099
180700*P1008->                                                          18070099
180800*               IF NOT TERM-TCPIP                                 18080099
180900*                  EXEC CICS SYNCPOINT END-EXEC                   18090099
181000*               END-IF                                            18100099
181100*                                                                 18110099
181200                EXEC CICS SYNCPOINT END-EXEC                      18120099
181300*P1008<-                                                          18130099
181400*                                                                 18140099
181500*JO17072000-TCPIP                                                 18150099
181600                IF L100-AQTRTCPI = 'N'                            18160099
181700*A271 26/07/04 INICIO                                             18170099
181800*                  PERFORM 124-ESBORRA-REGIS-SCR-TASCA            18180099
181900*A271 26/07/04 FINAL                                              18190099
182000*A271 20/07/2004 INICIO                                           18200099
182100*                  EXEC CICS ABEND ABCODE ('ZZZZ') NODUMP END-EXEC18210099
182200                   PERFORM 121-PROVOCAR-ABEND-ZZZZ                18220099
182300*A271 20/07/2004 INICIO                                           18230099
182400                END-IF                                            18240099
182500*                                                                 18250099
182600*MLV-29-03-05 INICIO                                              18260099
182700*P1000->                                                          18270099
182800*               IF L300-ENTORNO-CAL390                            18280099
182900*                  PERFORM 122-RESPUESTA-ABEND-CAL390             18290099
183000*               END-IF                                            18300099
183100*P1000<-                                                          18310099
183200*MLV-29-03-04 FINAL                                               18320099
183300*                                                                 18330099
183400*MLV-03-07-03 INICIO                                              18340099
183500                IF L300-ENTORNO-ECDL                              18350099
183600                   PERFORM 123-RESPUESTA-ABEND-ECDL               18360099
183700                END-IF                                            18370099
183800*MLV-03-07-03 FINAL                                               18380099
183900*                                                                 18390099
184000             ELSE                                                 18400099
184100                MOVE C-MES-TF TO W-MODULO                         18410099
184200                PERFORM 120-TRATAR-ABEND-APL                      18420099
184300             END-IF                                               18430099
184400     END-EVALUATE                                                 18440099
184500     MOVE '02-ABEND-P'  TO  L392-FILLER(1:10)                     18450099
184600*A271 26/07/04 INICIO                                             18460099
184700*    PERFORM 124-ESBORRA-REGIS-SCR-TASCA                          18470099
184800*A271 26/07/04 FINAL                                              18480099
184900     MOVE 'ZZZZ'              TO L300-AQTRANRE                    18490099
185000     SET L300-RETURN          TO TRUE                             18500099
185100*    PERFORM 222-ESBORRAR-CUA-VARIABLES                           18510099
185200                                                                  18520099
185300*tracet->                                                         18530099
185400     IF WS-TRACE > '0'                                            18540099
185500        MOVE 'END-RAQW001-12' TO WS-AQNBDTRA                      18550099
185600        MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                      18560099
185700        STRING                                                    18570099
185800           '<<==== Tran/estado/caso|ret: ' F030-AQ3TRNID '/'      18580099
185900            L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE       18590099
186000            DELIMITED BY SIZE  INTO WS-AQINFORM                   18600099
186100        END-STRING                                                18610099
186200        PERFORM 131-TRACE-TECNIC                                  18620099
186300     END-IF                                                       18630099
186400*tracet<-                                                         18640099
186500     EXEC CICS RETURN END-EXEC.                                   18650099
186600*                                                                 18660099
186700*----------------------------------------------------------------*18670099
186800*    VERIFICAR ACCES O NO A NOVA TRANSACCIO                      *18680099
186900*----------------------------------------------------------------*18690099
187000 100-ACCESO-TRAN.                                                 18700099
187100*----------------                                                 18710099
187200*tracet->                       +                                 18720099
187300     IF WS-TRACE > '1'                                            18730099
187400        MOVE '100-ACCESO-TRAN.                ' TO WS-AQNBDTRA    18740099
187500        PERFORM 131-TRACE-TECNIC                                  18750099
187600     END-IF                                                       18760099
187700*tracet<-                                                         18770099
187800     IF W-TERM-TCPIP = 'NNNN'                                     18780099
187900        EXEC CICS LINK PROGRAM ('RAQW305')                        18790099
188000             COMMAREA (AREA-ENLACE) RESP (COD-RESP)               18800099
188100        END-EXEC                                                  18810099
188200        IF COD-RESP NOT = DFHRESP (NORMAL)                        18820099
188300            PERFORM 033-INFORMAR-DATOS-ABEND                      18830099
188400        END-IF                                                    18840099
188500     ELSE                                                         18850099
188600        MOVE ' ' TO LK-POSTA                                      18860099
188700     END-IF.                                                      18870099
188800*                                                                 18880099
188900*----------------------------------------------------------------*18890099
189000*    link al modul de misatges variables (en cas d,error)        *18900099
189100*----------------------------------------------------------------*18910099
189200 101-FORMATEIG-ERROR-VARIABLE.                                    18920099
189300*-----------------------------                                    18930099
189400*tracet->                       +                                 18940099
189500     IF WS-TRACE > '1'                                            18950099
189600        MOVE '101-FORMATEIG-ERROR-VARIABLE.   ' TO WS-AQNBDTRA    18960099
189700        PERFORM 131-TRACE-TECNIC                                  18970099
189800     END-IF                                                       18980099
189900*tracet<-                                                         18990099
190000     MOVE L100-AQ1ERRCD TO L045-AQ4CLAVE                          19000099
190100     EXEC CICS LINK PROGRAM ('RAQW045') COMMAREA (L045-CAQL045)   19010099
190200          RESP (COD-RESP)                                         19020099
190300     END-EXEC                                                     19030099
190400     IF COD-RESP NOT = DFHRESP (NORMAL)                           19040099
190500        PERFORM 033-INFORMAR-DATOS-ABEND                          19050099
190600     END-IF                                                       19060099
190700     IF L045-AQRETORN = 'B'                                       19070099
190800         MOVE L045-AQ1EIBFN TO L100-AQ1EIBFN                      19080099
190900         MOVE L045-AQ1EIBRC TO L100-AQ1EIBRC                      19090099
191000         MOVE L045-AQ1EIBRS TO L100-AQ1EIBRS                      19100099
191100         MOVE C-ABEND-CICS  TO L100-AQ1ABNCD                      19110099
191200         PERFORM 099-ABEND-PROC                                   19120099
191300     END-IF.                                                      19130099
191400*                                                                 19140099
191500*----------------------------------------------------------------*19150099
191600*    LINK AL MODUL DE TOTALITZACIO                               *19160099
191700*----------------------------------------------------------------*19170099
191800 102-TOTALITZACIO.                                                19180099
191900*-----------------                                                19190099
192000*tracet->                       +                                 19200099
192100     IF WS-TRACE > '1'                                            19210099
192200        MOVE '102-TOTALITZACIO.               ' TO WS-AQNBDTRA    19220099
192300        PERFORM 131-TRACE-TECNIC                                  19230099
192400     END-IF                                                       19240099
192500*tracet<-                                                         19250099
192600      IF L121-AQSWTOTA-SI                                         19260099
192700         IF L100-AQPTAPLI > 0                                     19270099
192800            MOVE L100-AQPTAPLI            TO W-PUNTER-COMP        19280099
192900            SET ADDRESS OF AREA-AQ-ADINAL TO W-PUNTER-POINTER     19290099
193000            IF L101-AQCDRETO  =  'OK'                             19300099
193100               INITIALIZE AREA-CAQLQ10                            19310099
193200               MOVE 'M02'           TO LQ10-AQCDOPC               19320099
193300               MOVE 'U'             TO LQ10-AQCDOPE               19330099
193400               MOVE L100-AQ1BANOP   TO LQ10-AQNUBANC              19340099
193500               MOVE L100-AQ1OFIOP   TO LQ10-AQNUOFI               19350099
193600               MOVE L101-AQIMPORT   TO LQ10-AQIMPORT              19360099
193700               MOVE L101-AQDIVISA   TO LQ10-AQDIVISA              19370099
193800               MOVE L101-AQSWDEBE   TO LQ10-AQSWDEBE              19380099
193900               MOVE L101-AQSWINCR   TO LQ10-AQSWINCR              19390099
194000*GFTÑ01-I                                                         19400099
194100*    Traspaso del detalle del billetaje de una operacion          19410099
194200               MOVE L101-AQDETABE      TO LQ10-AQDETABE           19420099
194300               MOVE L100-AQFHAMD8(1:6) TO LQ10-AQMESDET           19430099
194400*GFTÑ01-F                                                         19440099
194500*p86->                                                            19450099
194600               IF L100-AQ1TRANT = 'TLDA' OR 'TLHA'                19460099
194700                 MOVE L100-AQ1MPRTI            TO W-PUNTER-COMP   19470099
194800                 SET ADDRESS OF AREA-MAPA-REAL TO W-PUNTER-POINTER19480099
194900*Se mueve transacc. y Oficina y Cuenta desde el área de pantalla  19490099
195000                 MOVE L100-AQ1TRANT            TO LQ10-AQCDTRAN   19500099
195100*p86a->                                                           19510099
195200                 MOVE AREA-MAPA-REAL(126:04)   TO LQ10-AQOFICIN   19520099
195300*p86a<-                                                           19530099
195400                 MOVE AREA-MAPA-REAL(133:10)   TO LQ10-AQCUENTA   19540099
195500               END-IF                                             19550099
195600*p86<-                                                            19560099
195700               EXEC CICS LINK PROGRAM ('RAQWQ10')                 19570099
195800                    COMMAREA (AREA-CAQLQ10) RESP (COD-RESP)       19580099
195900               END-EXEC                                           19590099
196000               IF COD-RESP NOT = DFHRESP(NORMAL)                  19600099
196100                  MOVE 'KO' TO  L101-AQCDRETO                     19610099
196200               ELSE                                               19620099
196300                  PERFORM 126-TRACTAMENT-RETORN                   19630099
196400               END-IF                                             19640099
196500*p115d->                                                          19650099
196600            ELSE                                                  19660099
196700*              Si 'CC' se avisa que Caja Cerrada, pero si hay un  19670099
196800*              mensaje del aplicativo, éste se respeta            19680099
196900               IF L101-AQCDRETO  =  'CC'                          19690099
197000                  IF L100-AQ1ERRCD = SPACES                       19700099
197100                     MOVE 'JAQE341'   TO L100-AQ1ERRCD            19710099
197200                  END-IF                                          19720099
197300               END-IF                                             19730099
197400*p115d->                                                          19740099
197500            END-IF                                                19750099
197600         END-IF                                                   19760099
197700      END-IF                                                      19770099
197800     .                                                            19780099
197900*                                                                *19790099
198000*----------------------------------------------------------------*19800099
198100*         REALIZA LA ACTUALIZACION DEL REGISTRO DE SCR           *19810099
198200*----------------------------------------------------------------*19820099
198300 103-ACTUALIZ-SCR.                                                19830099
198400*-----------------                                                19840099
198500*tracet->                       +                                 19850099
198600     IF WS-TRACE > '1'                                            19860099
198700        MOVE '103-ACTUALIZ-SCR.               ' TO WS-AQNBDTRA    19870099
198800        PERFORM 131-TRACE-TECNIC                                  19880099
198900     END-IF                                                       19890099
199000*tracet<-                                                         19900099
199100* JVB270502      LOPD                                             19910099
199200*    Se a¦ade un cotrol de fastpath como medida provisional       19920099
199300*    para almacerar scr pues si no se queda el estado 555 en      19930099
199400*    scr y no hay manera de salir de la transaccion               19940099
199500     IF L100-AQSWROLB-NO OR SW-FASTPATH = 1                       19950099
199600*BROADCAST4EYES-I                                                 19960099
199700        OR L100-AUTORIZ-PEAU-DIST                                 19970099
199800        OR L100-AUTORIZ-PEAU-DIST-INIT                            19980099
199900        OR (L100-AUTORIZ-PEAU-DIST AND                            19990099
200000            EIBAID = DFHPF3)                                      20000099
200100        OR L100-AUTORIZ-4OJOS-DIST                                20010099
200200        OR L100-AUTORIZ-4OJOS-DIST-INIT                           20020099
200300        OR (L100-AUTORIZ-4OJOS-DIST AND                           20030099
200400            EIBAID = DFHPF3)                                      20040099
200500*BROADCAST4EYES-E                                                 20050099
200600        PERFORM 106-ACTUALIZ-SCR-01                               20060099
200700*tracet->                       +                                 20070099
200800        IF WS-TRACE > '1'                                         20080099
200900           MOVE '103-ACTUALIZ-SCR. POS 106-    ' TO WS-AQNBDTRA   20090099
201000           PERFORM 131-TRACE-TECNIC                               20100099
201100        END-IF                                                    20110099
201200*tracet<-                                                         20120099
201300     END-IF                                                       20130099
201400     .                                                            20140099
201500*                                                                *20150099
201600*----------------------------------------------------------------*20160099
201700*    start                                                       *20170099
201800*----------------------------------------------------------------*20180099
201900 104-ARRANCAR-TRANSACCION.                                        20190099
202000*-------------------------                                        20200099
202100*tracet->                       +                                 20210099
202200     IF WS-TRACE > '0'                                            20220099
202300        MOVE '104-ARRANCAR-TRANSACCION.       ' TO WS-AQNBDTRA    20230099
202400        MOVE W-TRANID                           TO WS-AQINFORM    20240099
202500        PERFORM 131-TRACE-TECNIC                                  20250099
202600     END-IF                                                       20260099
202700*tracet<-                                                         20270099
202800     INITIALIZE  W001-CAQW001                                     20280099
202900     MOVE 'ST'           TO L310-AQCODOPE                         20290099
203000     MOVE W-TERM-LOGICO  TO W001-AQTERMI                          20300099
203100     MOVE W-TRANID       TO W001-AQTRANID                         20310099
203200     MOVE W-TRANID       TO L300-AQTRANRE                         20320099
203300                                                                  20330099
203400     IF L300-AQCSTART NOT = 'NS'                                  20340099
203500        PERFORM 041-LINK-RAQW008                                  20350099
203600                                                                  20360099
203700        IF L310-AQCODRET NOT = ' '                                20370099
203800           MOVE '01' TO  W-NUM-ABEND                              20380099
203900           SET SW-ABEND-ARQUITECTURAL TO TRUE                     20390099
204000           PERFORM 099-ABEND-PROC                                 20400099
204100        END-IF                                                    20410099
204200     END-IF                                                       20420099
204300                                                                  20430099
204400     IF NOT F060-TERM-3270 AND L300-AQCSTART = 'NS'               20440099
204500        PERFORM 041-LINK-RAQW008                                  20450099
204600                                                                  20460099
204700        IF L310-AQCODRET NOT = ' '                                20470099
204800           MOVE '01' TO  W-NUM-ABEND                              20480099
204900           SET SW-ABEND-ARQUITECTURAL TO TRUE                     20490099
205000           PERFORM 099-ABEND-PROC                                 20500099
205100        END-IF                                                    20510099
205200     END-IF                                                       20520099
205300                                                                  20530099
205400     IF SW-TRAN-ARQUITEC                                          20540099
205500        IF F060-TERM-3270 AND  L300-AQCSTART = 'NS'  AND          20550099
205600           L100-AQ1ACCIO NOT = 'PRG'                              20560099
205700           PERFORM 041-LINK-RAQW008                               20570099
205800                                                                  20580099
205900           IF L310-AQCODRET NOT = ' '                             20590099
206000              MOVE '01' TO  W-NUM-ABEND                           20600099
206100              SET SW-ABEND-ARQUITECTURAL TO TRUE                  20610099
206200              PERFORM 099-ABEND-PROC                              20620099
206300           END-IF                                                 20630099
206400        END-IF                                                    20640099
206500     ELSE                                                         20650099
206600        IF F060-TERM-3270 AND  L300-AQCSTART = 'NS'               20660099
206700           PERFORM 041-LINK-RAQW008                               20670099
206800                                                                  20680099
206900           IF L310-AQCODRET NOT = ' '                             20690099
207000              MOVE '01' TO  W-NUM-ABEND                           20700099
207100              SET SW-ABEND-ARQUITECTURAL TO TRUE                  20710099
207200              PERFORM 099-ABEND-PROC                              20720099
207300           END-IF                                                 20730099
207400        END-IF                                                    20740099
207500     END-IF.                                                      20750099
207600                                                                  20760099
207700*----------------------------------------------------------------*20770099
207800*    COMPROBAR SI SE HA DE GRABAR EL DIARIO                      *20780099
207900*----------------------------------------------------------------*20790099
208000 105-TRATAMIENTO-DIARIO.                                          20800099
208100*-----------------------                                          20810099
208200*tracet->                       +                                 20820099
208300     IF WS-TRACE > '1'                                            20830099
208400        MOVE '105-TRATAMIENTO-DIARIO.         ' TO WS-AQNBDTRA    20840099
208500        PERFORM 131-TRACE-TECNIC                                  20850099
208600     END-IF                                                       20860099
208700*tracet<-                                                         20870099
208800*                                                                 20880099
208900*BROADCAST4EYES-I                                                 20890099
209000     IF EIBTRNID = 'AQ44' AND L100-AQ1MESAI = DFHPF5              20900099
209100        SET SW-GRABAR-DIARIO                                      20910099
209200            L100-ACCION-TERMINAL TO TRUE                          20920099
209300     END-IF                                                       20930099
209400*BROADCAST4EYES-E                                                 20940099
209500*                                                                 20950099
209600     IF SW-GRABAR-DIARIO                                  AND     20960099
209700       ( (F060-TERM-FINANCIERO) OR (F060-TERM-3270 AND            20970099
209800          W-ESTADO-INICIAL NOT = C-ESTADO-INICIO)  OR             20980099
209900         (F060-TERM-3270 AND W-ESTADO-INICIAL = C-ESTADO-INICIO   20990099
210000*BROADCAST4EYES-I                                                 21000099
210100* Una verificacion remota por AQ44 va a seguir teniendo su caso   21010099
210200* de entrada = 1, pero hay que grabar el diario igualmente        21020099
210300*         AND W-CASO-ENTRADA NOT = 1 ) )                  AND     21030099
210400          AND ( W-CASO-ENTRADA NOT = 1 OR                         21040099
210500                 EIBTRNID = 'AQ44'  ) ) )                 AND     21050099
210600*BROADCAST4EYES-E                                                 21060099
210700        (EIBTRNID NOT = 'GT05' AND NOT = 'AQM1')          AND     21070099
210800*I022->                                                           21080099
210900*        W-ENTRADA-APLIC (1:4) NOT = 'MEN-'                       21090099
211000         W-ENTRADA-APLIC NOT = W-ENTRADA-MENU-APLIC               21100099
211100*<-I022                                                           21110099
211200*MLV-14-08-03 INICIO                                              21120099
211300*       PERFORM 045-LLAMADA-RAQW163                               21130099
211400        IF W-ESTADO-INICIAL = C-ESTADO-INICIO AND                 21140099
211500           W-CASO-ENTRADA = 1                                     21150099
211600*BROADCAST4EYES-I                                                 21160099
211700*          Para el retorno desde una transaccion verificada       21170099
211800*          remotamente (a partir de enlace desde AQ44)            21180099
211900*          queremos entrar por el ELSE para que grabe el          21190099
212000*          diario sobre la emisión de la verificacion             21200099
212100*          obviamente solo si se ha emitido, no si se ha          21210099
212200*          cancelado. Para las verificaciones remotas de ECDL     21220099
212300*          no es necesario forzar la entrada por el ELSE          21230099
212400           AND (L100-AQ1AVCD1 NOT = 'JAQA116' OR                  21240099
212500                L300-ENTORNO-ECDL)                                21250099
212600*BROADCAST4EYES-E                                                 21260099
212700           CONTINUE                                               21270099
212800        ELSE                                                      21280099
212900*MLV-14-08-03 FINAL                                               21290099
213000           PERFORM 045-LLAMADA-RAQW163                            21300099
213100        END-IF                                                    21310099
213200* MLV221002 INICIO                                                21320099
213300*    ELSE                                                         21330099
213400     END-IF.                                                      21340099
213500                                                                  21350099
213600*----------------------------------------------------------------*21360099
213700*         REALIZA LA ACTUALIZACION DEL REGISTRO DE SCR           *21370099
213800*----------------------------------------------------------------*21380099
213900 106-ACTUALIZ-SCR-01.                                             21390099
214000*--------------------                                             21400099
214100*tracet->                       +                                 21410099
214200     IF WS-TRACE > '1'                                            21420099
214300        MOVE '106-ACTUALIZ-SCR-01.            ' TO WS-AQNBDTRA    21430099
214400        PERFORM 131-TRACE-TECNIC                                  21440099
214500     END-IF                                                       21450099
214600*tracet<-                                                         21460099
214700     SET L100-TIPO-SRC-ONLINE TO TRUE                             21470099
214800     SET L100-ON-LINE         TO TRUE                             21480099
214900     MOVE C-S                 TO L100-AQ1PREFJ                    21490099
215000     MOVE '0'                 TO L100-AQ1MSTOD                    21500099
215100                                                                  21510099
215200     MOVE L100-AQ1CLAVE  TO  WK-CLAU-SCR                          21520099
215300                                                                  21530099
215400*tracet->                       +                                 21540099
215500        IF WS-TRACE > '1'                                         21550099
215600           MOVE '106-ACTUALIZ-SCR-01. PRE FGT010X' TO WS-AQNBDTRA 21560099
215700           PERFORM 131-TRACE-TECNIC                               21570099
215800        END-IF                                                    21580099
215900*tracet<-                                                         21590099
216000     EXEC CICS READ DATASET ('FGT010X') INTO(WK-WORKA-SCR)        21600099
216100          RIDFLD (WK-CLAU-SCR) LENGTH (C-4080)                    21610099
216200          RESP (COD-RESP) UPDATE                                  21620099
216300     END-EXEC                                                     21630099
216400*tracet->                       +                                 21640099
216500        IF WS-TRACE > '1'                                         21650099
216600           MOVE '106-ACTUALIZ-SCR-01. POS FGT010X' TO WS-AQNBDTRA 21660099
216700           PERFORM 131-TRACE-TECNIC                               21670099
216800        END-IF                                                    21680099
216900*tracet<-                                                         21690099
217000     IF COD-RESP = DFHRESP (NORMAL)                               21700099
217100*                                                                 21710099
217200*--> PARCHE FRANCIA                                               21720099
217300        IF L100-STCDPAIS = 1                                      21730099
217400           MOVE WS-TIPO-CONEXION TO L100-AQTIPCON                 21740099
217500        END-IF                                                    21750099
217600*240402jvbi preservar centre d'user del registre en cas que l'hagi21760099
217700*           modificat la transaccio sl15                          21770099
217800* 270502 afegim entitat centre per a control de ngmc              21780099
217900        IF NOT SW-TRANS-ESPECIAL AND F060-TERM-FINANCIERO AND     21790099
218000           (L100-AQENDEUS NOT = WK-WORKA-SCR(729:4)   OR          21800099
218100            L100-AQCEDEUS NOT = WK-WORKA-SCR(733:4)   OR          21810099
218200            L100-AQENHDUS NOT = WK-WORKA-SCR(737:4)   OR          21820099
218300            L100-AQCEHDUS NOT = WK-WORKA-SCR(741:4)   OR          21830099
218400            L100-AQCDENTU NOT = WK-WORKA-SCR(604:4)   OR          21840099
218500            L100-AQCDCENU NOT = WK-WORKA-SCR(608:4) )             21850099
218600                                                                  21860099
218700           MOVE WK-WORKA-SCR(729:4) TO L100-AQENDEUS              21870099
218800           MOVE WK-WORKA-SCR(733:4) TO L100-AQCEDEUS              21880099
218900           MOVE WK-WORKA-SCR(737:4) TO L100-AQENHDUS              21890099
219000           MOVE WK-WORKA-SCR(741:4) TO L100-AQCEHDUS              21900099
219100           MOVE WK-WORKA-SCR(604:4) TO L100-AQCDENTU              21910099
219200           MOVE WK-WORKA-SCR(608:4) TO L100-AQCDCENU              21920099
219300        END-IF                                                    21930099
219400*240402jvbf                                                       21940099
219500*                                                                 21950099
219600*A303 MLV-25-05-05 INICIO                                         21960099
219700*    Mover el vector de teclas sobre el campo L100-AQGRTECL      *21970099
219800*    Este campo es un redefines del grupo L100-AQ1MENSA, que     *21980099
219900*    corresponde a los codigos de aviso, error y abend, pero que *21990099
220000*    al no tener sentido guardarlos se ha aprovechado para       *22000099
220100*    guardar el vector de teclas                                 *22010099
220200*BROADCAST4EYES-I                                                 22020099
220300*       Cuando retornamos a la AQ44 tras haber verificado remota- 22030099
220400*       mente una transacción cualquiera, necesitamos mantener    22040099
220500*       los mensajes que el RAQW110 o el RAQW020 hayan grabado en 22050099
220600*       los campos de aviso, pero al actualizar el SCR se pierde  22060099
220700*       el area de mensajes dentro del SCR porque se sobrescribe  22070099
220800*       con el area de teclas de eCDL, necesitamos mantener el    22080099
220900*       aviso 1 cuando sea la 'AQ44'                              22090099
221000        IF L100-AQ1AVCD1 NOT = SPACES AND                         22100099
221100           (L100-AQTRFAST = 'AQ44'                                22110099
221200            OR L000-AQCDTRAR = 'AQ44')                            22120099
221300            OR (L300-ENTORNO-ECDL AND                             22130099
221400                L100-AUT-DIST-CODES)                              22140099
221500           MOVE L100-AQ1AVCD1(5:3) TO L100-AQ1AVCD1-BCK           22150099
221600        ELSE                                                      22160099
221700           IF L100-AQ1ABNCD(1:4) = SPACES                         22170099
221800              MOVE SPACES        TO L100-AQ1AVCD1-BCK             22180099
221900           END-IF                                                 22190099
222000        END-IF                                                    22200099
222100*BROADCAST4EYES-E                                                 22210099
222200*                                                                 22220099
222300        MOVE L100-AQ1MENSA TO WS-AQ1MENSA                         22230099
222400        MOVE L017-AQGRTECL TO L100-AQGRTECL                       22240099
222500*                                                                 22250099
222600*A303 MLV-25-05-05 FIN                                            22260099
222700*                                                                 22270099
222800*tracet->                       +                                 22280099
222900        IF WS-TRACE > '1'                                         22290099
223000           MOVE '106-ACTUALIZ-SCR-01. PRE REWRITE' TO WS-AQNBDTRA 22300099
223100           PERFORM 131-TRACE-TECNIC                               22310099
223200        END-IF                                                    22320099
223300*tracet<-                                                         22330099
223400        EXEC CICS REWRITE DATASET ('FGT010X')                     22340099
223500             FROM (L100-AREA-TOTAL) RESP (COD-RESP)               22350099
223600        END-EXEC                                                  22360099
223700*tracet->                       +                                 22370099
223800        IF WS-TRACE > '1'                                         22380099
223900           MOVE '106-ACTUALIZ-SCR-01. POS REWRITE' TO WS-AQNBDTRA 22390099
224000           PERFORM 131-TRACE-TECNIC                               22400099
224100        END-IF                                                    22410099
224200*tracet<-                                                         22420099
224300*A303 MLV-25-05-05 INICIO                                         22430099
224400*BROADCAST4EYES-I                                                 22440099
224500*       Cuando retornamos a la AQ44 tras haber verificado remota- 22450099
224600*       mente una transacción cualquiera, necesitamos mantener    22460099
224700*       los mensajes que el RAQW110 o el RAQW020 hayan grabado en 22470099
224800*       el primer campo de aviso                                  22480099
224900        IF L100-AQ1ABNCD(1:4) = 'IIII' AND                        22490099
225000           L100-AQ1AVCD1-BCK NOT = SPACES AND                     22500099
225100           (L100-AQTRFAST = 'AQ44' OR                             22510099
225200            L000-AQCDTRAR = 'AQ44')                               22520099
225300            OR (L300-ENTORNO-ECDL AND                             22530099
225400                L100-AUT-DIST-CODES)                              22540099
225500           MOVE 'JAQA' TO L100-AQ1AVCD1(1:4)                      22550099
225600           MOVE L100-AQ1AVCD1-BCK TO L100-AQ1AVCD1(5:3)           22560099
225700           MOVE SPACES TO L100-AQ1AVCD1-BCK                       22570099
225800        END-IF                                                    22580099
225900*BROADCAST4EYES-E                                                 22590099
226000        MOVE WS-AQ1MENSA TO L100-AQ1MENSA                         22600099
226100*A303 MLV-25-05-05 FIN                                            22610099
226200                                                                  22620099
226300        IF COD-RESP NOT = DFHRESP(NORMAL)                         22630099
226400*tracet->                       +                                 22640099
226500           IF WS-TRACE > '1'                                      22650099
226600              MOVE '106-ACTUALIZ-SCR-01. ERR REWRITE'             22660099
226700              TO WS-AQNBDTRA                                      22670099
226800              PERFORM 131-TRACE-TECNIC                            22680099
226900           END-IF                                                 22690099
227000*tracet<-                                                         22700099
227100           PERFORM 033-INFORMAR-DATOS-ABEND                       22710099
227200        END-IF                                                    22720099
227300     ELSE                                                         22730099
227400*tracet->                       +                                 22740099
227500        IF WS-TRACE > '1'                                         22750099
227600           MOVE '106-ACTUALIZ-SCR-01. ABEND      ' TO WS-AQNBDTRA 22760099
227700           PERFORM 131-TRACE-TECNIC                               22770099
227800        END-IF                                                    22780099
227900*tracet<-                                                         22790099
228000        PERFORM 033-INFORMAR-DATOS-ABEND                          22800099
228100     END-IF.                                                      22810099
228200                                                                  22820099
228300*----------------------------------------------------------------*22830099
228400 107-ERROR-PF6.                                                   22840099
228500*--------------                                                   22850099
228600*tracet->                       +                                 22860099
228700     IF WS-TRACE > '1'                                            22870099
228800        MOVE '107-ERROR-PF6.                  ' TO WS-AQNBDTRA    22880099
228900        PERFORM 131-TRACE-TECNIC                                  22890099
229000     END-IF                                                       22900099
229100*tracet<-                                                         22910099
229200     MOVE C-ERROR-PF6 TO L100-AQ1ERRCD                            22920099
229300     PERFORM 031-FINAL.                                           22930099
229400*                                                                 22940099
229500*----------------------------------------------------------------*22950099
229600*--> SI SE HA SOLICITADO UNA AUTORIZACION (PEAU o 4-OJOS) O BIEN *22960099
229700*--> FIRMA ELECTRONICA, COMPROBAR QUE EL CANAL LO ADMITA         *22970099
229800*----------------------------------------------------------------*22980099
229900 108-VERIF-AUTORIZ-SALIDA.                                        22990099
230000*-------------------------                                        23000099
230100*tracet->                       +                                 23010099
230200     IF WS-TRACE > '1'                                            23020099
230300        MOVE '108-VERIF-AUTORIZ-SALIDA.       ' TO WS-AQNBDTRA    23030099
230400        STRING                                                    23040099
230500          'Tip.Aut: '     L100-AQ1STAUT, '/',                     23050099
230600          'Conf.moneda: ' L100-AQOPECON, '/'                      23060099
230700           DELIMITED BY SIZE INTO WS-AQINFORM                     23070099
230800        END-STRING                                                23080099
230900        PERFORM 131-TRACE-TECNIC                                  23090099
231000     END-IF                                                       23100099
231100*tracet<-                                                         23110099
231200     EVALUATE TRUE                                                23120099
231300     WHEN L100-AUTORIZ-PEAU                                       23130099
231400*BROADCAST4EYES-I                                                 23140099
231500     WHEN L100-AUTORIZ-PEAU-DIST                                  23150099
231600     WHEN L100-AUTORIZ-PEAU-DIST-INIT                             23160099
231700*BROADCAST4EYES-E                                                 23170099
231800     WHEN L100-AUTORIZ-USUARI                                     23180099
231900          EVALUATE TRUE                                           23190099
232000          WHEN L121-CANAL-SI-PEAU                                 23200099
232100*PEAU2->                                                          23210099
232200***            CONTINUE                                           23220099
232300               IF L121-CANAL-PEAU-AUTORIZADO                      23230099
232400*PEAU2.1->                                                        23240099
232500***               SET L100-AUTORIZ-PEAU2 TO TRUE                  23250099
232600                  IF L100-AUTORIZ-PEAU                            23260099
232700                     SET L100-AUTORIZ-PEAU2    TO TRUE            23270099
232800                  ELSE                                            23280099
232900                     SET L100-AUTORIZ-USUARI-2 TO TRUE            23290099
233000                  END-IF                                          23300099
233100*PEAU2.1<-                                                        23310099
233200               END-IF                                             23320099
233300*PEAU2<-                                                          23330099
233400          WHEN L121-CANAL-NO-PEAU                                 23340099
233500               MOVE C-ERROR-CANAL-NO-PEAU TO L100-AQ1ERRCD        23350099
233600          WHEN OTHER                                              23360099
233700               MOVE C-ABEND-TIPO-PEAU TO L100-AQ1ABNCD            23370099
233800               MOVE L121-AQSWPEAU     TO L045-AQTXMENS (1)        23380099
233900               PERFORM 037-FORMATEAR-MENSAJE-VARIABLE             23390099
234000          END-EVALUATE                                            23400099
234100     WHEN L100-AUTORIZ-4OJOS                                      23410099
234200     WHEN L100-AUTORIZ-4OJOS-8                                    23420099
234300*BROADCAST4EYES-I                                                 23430099
234400     WHEN L100-AUTORIZ-4OJOS-DIST                                 23440099
234500     WHEN L100-AUTORIZ-4OJOS-DIST-INIT                            23450099
234600*BROADCAST4EYES-E                                                 23460099
234700          EVALUATE TRUE                                           23470099
234800*QO2->                                                            23480099
234900***       WHEN L121-CANAL-4OJOS-STANDARD                          23490099
235000          WHEN L121-CANAL-SI-CUATRO-OJOS                          23500099
235100*QO2<-                                                            23510099
235200               IF L100-AUTORIZ-4OJOS                              23520099
235300*MLV11->                                                          23530099
235400*                 IF L100-AQCDQULL = 1                            23540099
235500*                    CONTINUE                                     23550099
235600*                 ELSE                                            23560099
235700*                    MOVE C-ABEND-4OJOS-NO-TIPO-1 TO L100-AQ1ABNCD23570099
235800*                    MOVE L100-AQCDQULL TO L045-AQTXMENS (1)      23580099
235900*                    PERFORM 037-FORMATEAR-MENSAJE-VARIABLE       23590099
236000*                 END-IF                                          23600099
236100                  PERFORM 132-VERIF-APLICAC-SOLUCION              23610099
236200*MLV11<-                                                          23620099
236300               END-IF                                             23630099
236400*QO2->                                                            23640099
236500               IF L121-CANAL-4OJOS-AUTORIZADO                     23650099
236600                  IF L100-AUTORIZ-4OJOS                           23660099
236700                     SET L100-AUTORIZ-4OJOS2   TO TRUE            23670099
236800                  END-IF                                          23680099
236900                  IF L100-AUTORIZ-4OJOS-8                         23690099
237000                     SET L100-AUTORIZ-4OJOS-8-2   TO TRUE         23700099
237100                  END-IF                                          23710099
237200               END-IF                                             23720099
237300*QO2<-                                                            23730099
237400          WHEN L121-CANAL-NO-CUATRO-OJOS                          23740099
237500               MOVE C-ABEND-CANAL-NO-4OJOS TO L100-AQ1ABNCD       23750099
237600          WHEN OTHER                                              23760099
237700               MOVE C-ABEND-TIPO-4OJOS TO L100-AQ1ABNCD           23770099
237800               MOVE L121-AQSWCUOJ      TO L045-AQTXMENS (1)       23780099
237900               PERFORM 037-FORMATEAR-MENSAJE-VARIABLE             23790099
238000          END-EVALUATE                                            23800099
238100     WHEN L100-NECESARIO-FIRMAS                                   23810099
238200          EVALUATE TRUE                                           23820099
238300          WHEN L121-CANAL-FIRMA-ELECTRON                          23830099
238400               CONTINUE                                           23840099
238500          WHEN L121-CANAL-NO-AUTENTIFICA                          23850099
238600               MOVE C-ABEND-CANAL-NO-AUTEN TO L100-AQ1ABNCD       23860099
238700               MOVE L100-AQCDCANL          TO L045-AQTXMENS (1)   23870099
238800               PERFORM 037-FORMATEAR-MENSAJE-VARIABLE             23880099
238900          WHEN OTHER                                              23890099
239000               MOVE C-ABEND-TIPO-AUTEN TO L100-AQ1ABNCD           23900099
239100               MOVE L121-AQSWAUTE      TO L045-AQTXMENS (1)       23910099
239200               PERFORM 037-FORMATEAR-MENSAJE-VARIABLE             23920099
239300          END-EVALUATE                                            23930099
239400     END-EVALUATE                                                 23940099
239500*                                                                 23950099
239600     IF L100-AQ1ABNCD NOT = SPACES                                23960099
239700        SET SW-ABEND-ARQUITECTURAL TO TRUE                        23970099
239800        PERFORM 099-ABEND-PROC                                    23980099
239900     END-IF.                                                      23990099
240000*                                                                 24000099
240100*----------------------------------------------------------------*24010099
240200*   GRAVACIO DE L'AGENT I CONTRACTE ASSOCIAT                     *24020099
240300*----------------------------------------------------------------*24030099
240400 109-GRAVACIO-AGENTS.                                             24040099
240500*--------------------                                             24050099
240600*tracet->                       +                                 24060099
240700     IF WS-TRACE > '1'                                            24070099
240800        MOVE '109-GRAVACIO-AGENTS.            ' TO WS-AQNBDTRA    24080099
240900        PERFORM 131-TRACE-TECNIC                                  24090099
241000     END-IF                                                       24100099
241100*tracet<-                                                         24110099
241200     EXEC CICS LINK PROGRAM ('RAQW373')                           24120099
241300          COMMAREA (L100-AREA-TOTAL)                              24130099
241400          RESP (COD-RESP)                                         24140099
241500     END-EXEC                                                     24150099
241600     IF COD-RESP NOT = DFHRESP (NORMAL)                           24160099
241700        PERFORM 033-INFORMAR-DATOS-ABEND                          24170099
241800     END-IF.                                                      24180099
241900*                                                                 24190099
242000*----------------------------------------------------------------*24200099
242100*    CONTROL 4-OJOS STANDARD                                     *24210099
242200*    SOLUCIONES TIPO 2 Y 3                                       *24220099
242300*----------------------------------------------------------------*24230099
242400 110-4OJOS-STANDARD.                                              24240099
242500*-------------------                                              24250099
242600*tracet->                       +                                 24260099
242700     IF WS-TRACE > '1'                                            24270099
242800        MOVE '110-4OJOS-STANDARD.             ' TO WS-AQNBDTRA    24280099
242900        PERFORM 131-TRACE-TECNIC                                  24290099
243000     END-IF                                                       24300099
243100*tracet<-                                                         24310099
243200     INITIALIZE W001-CAQW001                                      24320099
243300*AllowAQDrivenOnline4Eyes-I                                       24330099
243400*    MOVE 'QS'        TO L310-AQCODOPE                            24340099
243500     IF archOnline4EyesSolution                                   24350099
243600        MOVE 'QQ'        TO L310-AQCODOPE                         24360099
243700     ELSE                                                         24370099
243800        MOVE 'QS'        TO L310-AQCODOPE                         24380099
243900     END-IF                                                       24390099
244000*AllowAQDrivenOnline4Eyes-E                                       24400099
244100     MOVE W-EIBTRMID  TO W001-AQTERMI                             24410099
244200     MOVE W-EIBTRNID  TO W001-AQTRDEST                            24420099
244300     PERFORM 063-LINK-RAQW009.                                    24430099
244400*                                                                 24440099
244500*----------------------------------------------------------------*24450099
244600*    LLAMADA AL SERVICIO LOPD                                    *24460099
244700*----------------------------------------------------------------*24470099
244800 111-CONTROL-LOPD.                                                24480099
244900*-----------------                                                24490099
245000*tracet->                       +                                 24500099
245100     IF WS-TRACE > '1'                                            24510099
245200        MOVE '111-CONTROL-LOPD.               ' TO WS-AQNBDTRA    24520099
245300        PERFORM 131-TRACE-TECNIC                                  24530099
245400     END-IF                                                       24540099
245500*tracet<-                                                         24550099
245600*    Si no ha habido abend                                        24560099
245700     IF L100-AQ1ABNCD = SPACES  AND                               24570099
245800*      Si el canal tiene activado el servicio de LOPD             24580099
245900        L121-AQSWLORT = '1'     AND                               24590099
246000*       Si la transaccion tiene activado el servicio de LOPD      24600099
246100*I093->                                                           24610099
246200*       F030-AQCDFUNC(03) = 'A' AND                               24620099
246300        SW-CONTROL-LOPD-SI      AND                               24630099
246400*I093<-                                                           24640099
246500*       Si esta activo el servicio de LOPD                        24650099
246600        F409-AQSWSTAT(03) = 'A'                                   24660099
246700*A325b->                                                          24670099
246800*M057b->                                                          24680099
246900*       IF (L121-PAGINA-SI AND F030-AQSWPAGI = '1' AND            24690099
247000*           LN08-AQRETCOD = 'OK')                                 24700099
247100        IF L121-PAGINA-SI                                         24710099
247200        AND ((F030-AQSWPAGI = '1') OR                             24720099
247300             (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))      24730099
247400        AND LN08-AQRETCOD = 'OK'                                  24740099
247500*M057b-<                                                          24750099
247600*           Se ha mostrado una pagina ya visualizada anteriormente24760099
247700*           por lo que no hay que volver a pasar control LOPD     24770099
247800            CONTINUE                                              24780099
247900        ELSE                                                      24790099
248000*          GUARDAR CONTENIDO DE L310-AQCODRET                     24800099
248100           MOVE L310-L310PARM   TO WS-L310PARAM                   24810099
248200           MOVE 'RAQW001'       TO L310-AQCALPGM                  24820099
248300           EXEC CICS LINK PROGRAM ('RAQW220')                     24830099
248400                COMMAREA (AREA-CAQL310)                           24840099
248500                RESP (COD-RESP)                                   24850099
248600           END-EXEC                                               24860099
248700                                                                  24870099
248800*          RESTAURAR CONTENIDO DE L310-AQCODRET                   24880099
248900           MOVE WS-L310PARAM    TO L310-L310PARM                  24890099
249000                                                                  24900099
249100           IF COD-RESP NOT = DFHRESP (NORMAL)                     24910099
249200              PERFORM 033-INFORMAR-DATOS-ABEND                    24920099
249300           END-IF                                                 24930099
249400*I099->                                                           24940099
249500           IF L100-AQ1ERRCD NOT = SPACES                          24950099
249600              SET SW-ERROR-DETECTADO-AQ TO TRUE                   24960099
249700           END-IF                                                 24970099
249800*I099<-                                                           24980099
249900        END-IF                                                    24990099
250000     ELSE                                                         25000099
250100        SET L100-LOPD-SIN-CONTROL TO TRUE                         25010099
250200     END-IF                                                       25020099
250300     .                                                            25030099
250400                                                                  25040099
250500*----------------------------------------------------------------*25050099
250600*   LINK PROGRAMA RAQWN08 EMMAGATZEMAR PAGINA                   .*25060099
250700*----------------------------------------------------------------*25070099
250800 112-LINK-RAQWN08-AP.                                             25080099
250900*--------------------                                             25090099
251000*tracet->                       +                                 25100099
251100     IF WS-TRACE > '1'                                            25110099
251200        MOVE '112-LINK-RAQWN08-AP.            ' TO WS-AQNBDTRA    25120099
251300        MOVE 'No crida a RAQWN08'               TO WS-AQINFORM    25130099
251400     END-IF                                                       25140099
251500*tracet<-                                                         25150099
251600*JO-08.03.2004                                                    25160099
251700     INITIALIZE LN08-CAQLN08.                                     25170099
251800     MOVE 'AP'             TO LN08-AQFUNCIO                       25180099
251900                                                                  25190099
252000     IF L300-ENTORNO-ECDL                                         25200099
252100*       MOVE  1               TO L100-AQNUNIVE                    25210099
252200        MOVE L300-AQPTARE2    TO LN08-AQPTR000                    25220099
252300        MOVE L310-AQSCRARC    TO LN08-AQPTRSCR                    25230099
252400     ELSE                                                         25240099
252500        MOVE L300-AQPTARE3    TO LN08-AQPTRSCR                    25250099
252600     END-IF                                                       25260099
252700                                                                  25270099
252800     MOVE L300-AQPTARE1       TO LN08-AQPTR310                    25280099
252900*                                                                 25290099
253000*M057-->                                                          25300099
253100*    IF L121-PAGINA-SI  AND  F030-AQSWPAGI = '1'                  25310099
253200*M057b->                                                          25320099
253300*    IF (L121-PAGINA-SI  AND  F030-AQSWPAGI = '1') OR             25330099
253400*       (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE)            25340099
253500     IF L121-PAGINA-SI                                            25350099
253600     AND ((F030-AQSWPAGI = '1') OR                                25360099
253700          (L300-ENTORNO-ECDL AND L000-TRANSAC-PAGINABLE))         25370099
253800*M057<b-                                                          25380099
253900*M057<--                                                          25390099
254000        EXEC CICS LINK PROGRAM ('RAQWN08')                        25400099
254100             RESP (COD-RESP)                                      25410099
254200             COMMAREA (LN08-CAQLN08)                              25420099
254300        END-EXEC                                                  25430099
254400                                                                  25440099
254500        IF COD-RESP NOT = DFHRESP (NORMAL)                        25450099
254600           PERFORM 033-INFORMAR-DATOS-ABEND                       25460099
254700        ELSE                                                      25470099
254800           IF LN08-AQRETCOD  = 'OK' OR 'NP' OR 'PE'               25480099
254900              CONTINUE                                            25490099
255000           ELSE                                                   25500099
255100              MOVE  'JSTB081'        TO  L100-AQ1ABNCD            25510099
255200              SET  SW-ABEND-APLICATIVO  TO TRUE                   25520099
255300*             MOVE  LN08-AQRETCOD    TO  L045-AQTXMENS (3)        25530099
255400*             MOVE  'PROCESO ALMACENAR PAGINA, '                  25540099
255500*                                    TO  L045-AQTXMENS (1)        25550099
255600*             MOVE  'AP -RETORNO ERRONEO RAQWN08 :'               25560099
255700*                                    TO  L045-AQTXMENS (2)        25570099
255800              MOVE  'GRAVACIO AP: PAGINA ACT.  ' TO               25580099
255900                    W-TEXT-08                                     25590099
256000              MOVE  L100-AQNPAGEN  TO  W-TEXT-08(25:2)            25600099
256100              MOVE  W-TEXT-08        TO  L045-AQTXMENS (1)        25610099
256200              MOVE  ' ,ULT.PAG.                  '  TO            25620099
256300                    W-TEXT-08                                     25630099
256400              MOVE  L100-AQNPAGUL  TO W-TEXT-08(12:2)             25640099
256500              MOVE  W-TEXT-08        TO  L045-AQTXMENS (2)        25650099
256600              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              25660099
256700              PERFORM 099-ABEND-PROC                              25670099
256800           END-IF                                                 25680099
256900*tracet->                       +                                 25690099
257000           IF WS-TRACE > '1'                                      25700099
257100              STRING                                              25710099
257200                'Invocat RAQWN08. Resultat: ' LN08-AQRETCOD       25720099
257300                 DELIMITED BY SIZE INTO WS-AQINFORM               25730099
257400              END-STRING                                          25740099
257500           END-IF                                                 25750099
257600*tracet<-                                                         25760099
257700        END-IF                                                    25770099
257800     END-IF                                                       25780099
257900*tracet->                       +                                 25790099
258000     IF WS-TRACE > '1'                                            25800099
258100        PERFORM 131-TRACE-TECNIC                                  25810099
258200     END-IF                                                       25820099
258300*tracet<-                                                         25830099
258400     .                                                            25840099
258500*A348.I                                                           25850099
258600*----------------------------------------------------------------*25860099
258700 113-LINK-SEGURO.                                                 25870099
258800*----------------------------------------------------------------*25880099
258900*tracet->                       +                                 25890099
259000     IF WS-TRACE > '1'                                            25900099
259100        MOVE '113-LINK-SEGURO.                ' TO WS-AQNBDTRA    25910099
259200        PERFORM 131-TRACE-TECNIC                                  25920099
259300     END-IF                                                       25930099
259400*tracet<-                                                         25940099
259500     INITIALIZE L056-CAQL056                                      25950099
259600                                                                  25960099
259700     IF L300-ENTORNO-ECDL                                         25970099
259800        MOVE L310-AQSCRARC    TO L056-AQPTSESC                    25980099
259900     ELSE                                                         25990099
260000        MOVE L300-AQPTARE3    TO L056-AQPTSESC                    26000099
260100     END-IF                                                       26010099
260200                                                                  26020099
260300     EXEC CICS LINK PROGRAM ('RAQW056')                           26030099
260400       RESP (COD-RESP) COMMAREA (L056-CAQL056)                    26040099
260500     END-EXEC                                                     26050099
260600                                                                  26060099
260700     IF COD-RESP NOT = DFHRESP (NORMAL)                           26070099
260800        PERFORM 033-INFORMAR-DATOS-ABEND                          26080099
260900     END-IF                                                       26090099
261000                                                                  26100099
261100     IF L056-CORRECTO                                             26110099
261200        MOVE L056-AQPTLKSC     TO L000-AQPTLKSC                   26120099
261300     ELSE                                                         26130099
261400        IF L056-NO-APLICA-LINK AND                                26140099
261500           (L056-AQRCQUAL = '01' OR L056-AQRCQUAL = '02' OR       26150099
261600            L056-AQRCQUAL = '07')                                 26160099
261700           MOVE ZEROS          TO L000-AQPTLKSC                   26170099
261800        ELSE                                                      26180099
261900           MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                   26190099
262000           MOVE 'RAQW056'      TO L045-AQTXMENS (1)               26200099
262100           MOVE L056-AQRETCOD  TO L045-AQTXMENS (2)               26210099
262200           SET SW-ABEND-ARQUITECTURAL TO TRUE                     26220099
262300           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 26230099
262400           PERFORM 099-ABEND-PROC                                 26240099
262500        END-IF                                                    26250099
262600     END-IF                                                       26260099
262700     .                                                            26270099
262800*A348.F                                                           26280099
262900                                                                  26290099
263000*----------------------------------------------------------------*26300099
263100*   preparar area de missatges inesperats a eCDL                .*26310099
263200*----------------------------------------------------------------*26320099
263300 114-LINK-RAQW450.                                                26330099
263400*-----------------                                                26340099
263500*tracet->                       +                                 26350099
263600     IF WS-TRACE > '1'                                            26360099
263700        MOVE '114-LINK-RAQW450.               ' TO WS-AQNBDTRA    26370099
263800        PERFORM 131-TRACE-TECNIC                                  26380099
263900     END-IF                                                       26390099
264000*tracet<-                                                         26400099
264100     MOVE 'MG'              TO L310-AQCODOPE                      26410099
264200     INITIALIZE W001-CAQW001                                      26420099
264300     MOVE 'AQ'              TO W001-APLICA                        26430099
264400     MOVE SPACES            TO L310-MSGABEND                      26440099
264500     MOVE W001-CAQW001      TO L310-AQARPARM                      26450099
264600                                                                  26460099
264700     EXEC CICS LINK PROGRAM ('RAQW450')                           26470099
264800          RESP (COD-RESP)                                         26480099
264900          COMMAREA (AREA-CAQL310)                                 26490099
265000     END-EXEC.                                                    26500099
265100*                                                                 26510099
265200*----------------------------------------------------------------*26520099
265300*    SALVAR TODAS LAS AREAS DNF CUANDO SE DETECTA QUE ESTA MAL   *26530099
265400*----------------------------------------------------------------*26540099
265500 115-SALVAR-AREA-DNF.                                             26550099
265600*--------------------                                             26560099
265700*tracet->                       +                                 26570099
265800     IF WS-TRACE > '1'                                            26580099
265900        MOVE '115-SALVAR-AREA-DNF.            ' TO WS-AQNBDTRA    26590099
266000        PERFORM 131-TRACE-TECNIC                                  26600099
266100     END-IF                                                       26610099
266200*tracet<-                                                         26620099
266300     MOVE L100-AQ1MPTOD TO W-PUNTER-COMP                          26630099
266400     SET ADDRESS OF AREA-DNF TO W-PUNTER-POINTER                  26640099
266500     MOVE W-EIBTRMID TO CUATS-SCR-TRM                             26650099
266600     MOVE 'F'      TO CUATS-SCR-S                                 26660099
266700     SET SW-SEGUIR-BUCLE TO TRUE                                  26670099
266800     PERFORM VARYING W-CONT FROM 1 BY 1                           26680099
266900     UNTIL SW-FIN-BUCLE OR W-CONT > 10                            26690099
267000*hm1b                                                             26700099
267100         PERFORM 130-INSERTAR-DET-TRACE                           26710099
267200*hm1b                                                             26720099
267300         IF PUNTERO-SIG-AREA = 0                                  26730099
267400             SET SW-FIN-BUCLE TO TRUE                             26740099
267500         ELSE                                                     26750099
267600             MOVE PUNTERO-SIG-AREA TO W-PUNTER-COMP               26760099
267700             SET ADDRESS OF AREA-DNF TO W-PUNTER-POINTER          26770099
267800         END-IF                                                   26780099
267900     END-PERFORM.                                                 26790099
268000                                                                  26800099
268100*----------------------------------------------------------------*26810099
268200*      FORMATEAR EIBFN Y EIBRCODE                                *26820099
268300*----------------------------------------------------------------*26830099
268400 116-FORMATEAR-ABEND-CICS.                                        26840099
268500*-------------------------                                        26850099
268600*tracet->                       +                                 26860099
268700     IF WS-TRACE > '1'                                            26870099
268800        MOVE '116-FORMATEAR-ABEND-CICS.       ' TO WS-AQNBDTRA    26880099
268900        PERFORM 131-TRACE-TECNIC                                  26890099
269000     END-IF                                                       26900099
269100*tracet<-                                                         26910099
269200*   INICIO  21-05-99   JAMB                                       26920099
269300     INITIALIZE L240-CAQL240                                      26930099
269400     MOVE 'C'           TO L240-AQCDO240                          26940099
269500     MOVE L100-AQ1EIBFN TO L240-AQ1EIBFN                          26950099
269600     MOVE L100-AQ1EIBRC TO L240-AQ1EIBRC                          26960099
269700     MOVE L100-AQ1EIBRS TO L240-AQ1EIBRS                          26970099
269800                                                                  26980099
269900     EXEC CICS LINK PROGRAM ('RAQW145') COMMAREA (L240-CAQL240)   26990099
270000          RESP (COD-RESP)                                         27000099
270100     END-EXEC                                                     27010099
270200                                                                  27020099
270300     IF COD-RESP NOT = DFHRESP (NORMAL)                           27030099
270400        MOVE 'MD'    TO  L240-AQRET240                            27040099
270500     END-IF                                                       27050099
270600                                                                  27060099
270700     EVALUATE L240-AQRET240                                       27070099
270800        WHEN ' '                                                  27080099
270900             MOVE L240-AQTXM240  TO W-MENSAJE                     27090099
271000        WHEN OTHER                                                27100099
271100*MLV-08-09-03 INICIO                                              27110099
271200*            MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                 27120099
271300*            MOVE 'RAQW145'      TO L045-AQTXMENS (1)             27130099
271400*            MOVE L240-AQRET240  TO L045-AQTXMENS (2)             27140099
271500*            SET SW-ABEND-ARQUITECTURAL TO TRUE                   27150099
271600*            PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               27160099
271700*            PERFORM 099-ABEND-PROC                               27170099
271800             STRING 'ERROR EN MODULO RAQW145' DELIMITED BY SPACE  27180099
271900                    ', CODIGO DE RETORNO : ' DELIMITED BY SPACE   27190099
272000                    L240-AQRET240 DELIMITED BY SPACE              27200099
272100             INTO W-MENSAJE                                       27210099
272200*MLV-08-09-03 FINAL                                               27220099
272300     END-EVALUATE.                                                27230099
272400*                                                                 27240099
272500*----------------------------------------------------------------*27250099
272600*      FORMATEAR ABEND DLI                                       *27260099
272700*----------------------------------------------------------------*27270099
272800 117-FORMATEAR-ABEND-DLI.                                         27280099
272900*------------------------                                         27290099
273000*tracet->                       +                                 27300099
273100     IF WS-TRACE > '1'                                            27310099
273200        MOVE '117-FORMATEAR-ABEND-DLI.        ' TO WS-AQNBDTRA    27320099
273300        PERFORM 131-TRACE-TECNIC                                  27330099
273400     END-IF                                                       27340099
273500*tracet<-                                                         27350099
273600     INITIALIZE L240-CAQL240                                      27360099
273700     MOVE 'D'           TO L240-AQCDO240                          27370099
273800     MOVE L100-AQ1DLIST TO L240-AQ1DLIST                          27380099
273900     MOVE L100-AQ1DBDNM TO L240-AQ1DBDNM                          27390099
274000*    MOVE L100-AQDLIFUN TO L240-AQDLIFUN                          27400099
274100*    MOVE L100-AQNBPSBD TO L240-AQNBPSBD                          27410099
274200*    MOVE L100-AQDLIVCO TO L240-AQDLIVCO                          27420099
274300                                                                  27430099
274400     EXEC CICS LINK PROGRAM ('RAQW145') COMMAREA (L240-CAQL240)   27440099
274500          RESP (COD-RESP)                                         27450099
274600     END-EXEC.                                                    27460099
274700                                                                  27470099
274800     IF COD-RESP NOT = DFHRESP (NORMAL)                           27480099
274900        MOVE 'MD'    TO  L240-AQRET240                            27490099
275000     END-IF                                                       27500099
275100                                                                  27510099
275200     EVALUATE L240-AQRET240                                       27520099
275300        WHEN ' '                                                  27530099
275400             MOVE L240-AQTXM240  TO W-MENSAJE                     27540099
275500        WHEN OTHER                                                27550099
275600*MLV-08-09-03 INICIO                                              27560099
275700*            MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                 27570099
275800*            MOVE 'RAQW145'      TO L045-AQTXMENS (1)             27580099
275900*            MOVE L240-AQRET240  TO L045-AQTXMENS (2)             27590099
276000*            SET SW-ABEND-ARQUITECTURAL TO TRUE                   27600099
276100*            PERFORM 037-FORMATEAR-MENSAJE-VARIABLE               27610099
276200*            PERFORM 099-ABEND-PROC                               27620099
276300             STRING 'ERROR EN MODULO RAQW145' DELIMITED BY SPACE  27630099
276400                    ', CODIGO DE RETORNO : ' DELIMITED BY SPACE   27640099
276500                    L240-AQRET240 DELIMITED BY SPACE              27650099
276600             INTO W-MENSAJE                                       27660099
276700*MLV-08-09-03 FINAL                                               27670099
276800     END-EVALUATE.                                                27680099
276900*                                                                 27690099
277000*----------------------------------------------------------------*27700099
277100*    -  BUSCAR LA COLA TS QUE CONTIENE EL MENSAJE FORMATEADO     *27710099
277200*----------------------------------------------------------------*27720099
277300 118-MENSAJE-VARIABLE.                                            27730099
277400*---------------------                                            27740099
277500*tracet->                       +                                 27750099
277600     IF WS-TRACE > '1'                                            27760099
277700        MOVE '118-MENSAJE-VARIABLE.           ' TO WS-AQNBDTRA    27770099
277800        PERFORM 131-TRACE-TECNIC                                  27780099
277900     END-IF                                                       27790099
278000*tracet<-                                                         27800099
278100     SET SW-NO-ENCONTRADO TO TRUE                                 27810099
278200     INITIALIZE L095-CAQL095                                      27820099
278300     MOVE '10' TO L095-AQCDOPCI                                   27830099
278400     IF F060-TERM-3270                                            27840099
278500        MOVE L078-AQCDIDIO TO L095-AQCDIDIO                       27850099
278600     ELSE                                                         27860099
278700        MOVE L100-AQIDIOMA TO L095-AQCDIDIO                       27870099
278800     END-IF                                                       27880099
278900     EXEC CICS LINK PROGRAM ('RAQW095') COMMAREA (L095-CAQL095)   27890099
279000          LENGTH (LENGTH OF L095-CAQL095) RESP (COD-RESP)         27900099
279100     END-EXEC                                                     27910099
279200*                                                                 27920099
279300     EVALUATE COD-RESP                                            27930099
279400     WHEN DFHRESP (NORMAL)                                        27940099
279500        EVALUATE L095-AQRETORN                                    27950099
279600        WHEN SPACES                                               27960099
279700*    HAY MENSAJES                                                 27970099
279800             PERFORM VARYING W-ITEM FROM 1 BY 1                   27980099
279900             UNTIL W-ITEM > 10 OR L095-AQCDMENV (W-ITEM) = SPACES 27990099
280000                IF L100-AQ1ABNCD = L095-AQCDMENV (W-ITEM)         28000099
280100                   MOVE L095-AQCDMENV (W-ITEM) TO W-MENSAJE-CLAVE 28010099
280200                   MOVE L095-AQTXMESJ (W-ITEM) TO W-MENSAJE-TEXTO 28020099
280300                   MOVE '-'           TO W-MENSAJE-GUION          28030099
280400                   SET SW-ENCONTRADO TO TRUE                      28040099
280500                END-IF                                            28050099
280600             END-PERFORM                                          28060099
280700        WHEN 'B'                                                  28070099
280800*MLV-08-09-03 INICIO                                              28080099
280900*         MOVE C-ABEND-CICS TO L100-AQ1ABNCD                      28090099
281000*         SET SW-ABEND-ARQUITECTURAL TO TRUE                      28100099
281100*         MOVE C-ABEND-CICS TO L100-AQ1ABNCD                      28110099
281200*         MOVE L095-AQ1EIBFN TO L100-AQ1EIBFN                     28120099
281300*         MOVE L095-AQ1EIBRC TO L100-AQ1EIBRC                     28130099
281400*         MOVE L095-AQ1EIBRS TO L100-AQ1EIBRS                     28140099
281500*         PERFORM 099-ABEND-PROC                                  28150099
281600             STRING 'ERROR EN MODULO RAQW095' DELIMITED BY SPACE  28160099
281700                    ', CODIGO DE RETORNO : ' DELIMITED BY SPACE   28170099
281800                    L095-AQRETORN DELIMITED BY SPACE              28180099
281900             INTO W-MENSAJE                                       28190099
282000             SET SW-ENCONTRADO TO TRUE                            28200099
282100*MLV-08-09-03 FINAL                                               28210099
282200        END-EVALUATE                                              28220099
282300        IF SW-NO-ENCONTRADO                                       28230099
282400           MOVE L085-AQ4MENSA TO W-MENSAJE-TEXTO                  28240099
282500           MOVE L085-AQCDMENF TO W-MENSAJE-CLAVE                  28250099
282600           MOVE '-'           TO W-MENSAJE-GUION                  28260099
282700           INSPECT W-MENSAJE-TEXTO REPLACING ALL '@' BY SPACES    28270099
282800        END-IF                                                    28280099
282900     WHEN OTHER                                                   28290099
283000        MOVE EIBFN    TO L100-AQ1EIBFN                            28300099
283100        MOVE EIBRCODE TO L100-AQ1EIBRC                            28310099
283200        MOVE EIBRSRCE TO L100-AQ1EIBRS                            28320099
283300        PERFORM 116-FORMATEAR-ABEND-CICS                          28330099
283400     END-EVALUATE                                                 28340099
283500     .                                                            28350099
283600*                                                                 28360099
283700*----------------------------------------------------------------*28370099
283800*    -  ENVIAR MENSAJE DE ABEND AL TERMINAL                      *28380099
283900*----------------------------------------------------------------*28390099
284000 119-ENVIAR-MSG-TERM.                                             28400099
284100*--------------------                                             28410099
284200*tracet->                       +                                 28420099
284300     IF WS-TRACE > '1'                                            28430099
284400        MOVE '119-ENVIAR-MSG-TERM.            ' TO WS-AQNBDTRA    28440099
284500        PERFORM 131-TRACE-TECNIC                                  28450099
284600     END-IF                                                       28460099
284700*tracet<-                                                         28470099
284800     MOVE 'SM'          TO L310-AQCODOPE                          28480099
284900     INITIALIZE W001-CAQW001                                      28490099
285000     PERFORM 040-LINK-RAQW005.                                    28500099
285100*                                                                 28510099
285200*----------------------------------------------------------------*28520099
285300*    TRATAR ABEND DETECTADO POR LA APLICACION                    *28530099
285400*                                                                *28540099
285500*    - SI ESTA EN CONFIRMACION DAR MENSAJE DE CONFIRMAR DE NUEVO *28550099
285600*      DE LO CONTRARIO INTERTAR DE NUEVO.                        *28560099
285700*----------------------------------------------------------------*28570099
285800 120-TRATAR-ABEND-APL.                                            28580099
285900*---------------------                                            28590099
286000*tracet->                       +                                 28600099
286100     IF WS-TRACE > '1'                                            28610099
286200        MOVE '120-TRATAR-ABEND-APL.           ' TO WS-AQNBDTRA    28620099
286300        PERFORM 131-TRACE-TECNIC                                  28630099
286400     END-IF                                                       28640099
286500*tracet<-                                                         28650099
286600     MOVE 'ABEND AP'  TO F025-HORA-GRAVACIO                       28660099
286700                                                                  28670099
286800     IF L085-AQ4INTRA = 'S'                                       28680099
286900        IF NOT SW-CONSERVAR-MENSAJE                               28690099
287000           IF W-ESTADO-INICIAL = C-ESTADO-CONFIRMACION            28700099
287100              MOVE 'JSTB021' TO L100-AQ1ABNCD                     28710099
287200           ELSE                                                   28720099
287300              MOVE 'JSTB020' TO L100-AQ1ABNCD                     28730099
287400           END-IF                                                 28740099
287500        END-IF                                                    28750099
287600     END-IF                                                       28760099
287700     MOVE L100-AQ1ABNCD TO W-ABEND-INICIAL                        28770099
287800     EXEC CICS LINK PROGRAM (W-MODULO)                            28780099
287900          COMMAREA (L100-AREA) RESP (COD-RESP)                    28790099
288000     END-EXEC                                                     28800099
288100     IF COD-RESP NOT = DFHRESP (NORMAL)                           28810099
288200        MOVE EIBFN        TO L100-AQ1EIBFN                        28820099
288300        MOVE EIBRCODE     TO L100-AQ1EIBRC                        28830099
288400        MOVE EIBRSRCE     TO L100-AQ1EIBRS                        28840099
288500        MOVE C-ABEND-CICS TO L100-AQ1ABNCD                        28850099
288600     END-IF                                                       28860099
288700     IF L100-AQ1MESST = 'R'                                       28870099
288800        MOVE C-ESCRITURA TO L100-AQ1MESST                         28880099
288900        PERFORM 103-ACTUALIZ-SCR                                  28890099
289000     END-IF                                                       28900099
289100     IF L100-AQ1ABNCD NOT = W-ABEND-INICIAL                       28910099
289200        MOVE L100-AQ1ABNCD TO W-ABEND-APLICACION                  28920099
289300        EXEC CICS SYNCPOINT ROLLBACK END-EXEC                     28930099
289400        MOVE L100-AQ1ABNCD TO W-COD-ABEND                         28940099
289500        EVALUATE TRUE                                             28950099
289600           WHEN SW-ABEND-CICS                                     28960099
289700                PERFORM 116-FORMATEAR-ABEND-CICS                  28970099
289800           WHEN OTHER                                             28980099
289900                INITIALIZE L085-CAQL085                           28990099
290000*M010->                                                           29000099
290100                SET L085-CONSULTA-GENERICO TO TRUE                29010099
290200*<-M010                                                           29020099
290300                MOVE 'F'                TO L085-AQCODOPE          29030099
290400                MOVE L100-AQ1ABNCD      TO L085-AQ4CLAVE          29040099
290500*******                                                           29050099
290600                IF F060-TERM-3270                                 29060099
290700                   MOVE L078-AQCDIDIO   TO L085-AQCDIDIO          29070099
290800                END-IF                                            29080099
290900                PERFORM 047-LLAMADA-RAQW085                       29090099
291000                MOVE L085-AQTXME77      TO W-MENSAJE              29100099
291100        END-EVALUATE                                              29110099
291200        IF L085-SW-MEN-VARIABLE                                   29120099
291300           PERFORM 118-MENSAJE-VARIABLE                           29130099
291400        END-IF                                                    29140099
291500        MOVE 'ARQ'        TO L145-AQ1ABNCD                        29150099
291600        MOVE W-NUM-ABEND  TO L145-AQ1ABNCD(4:2)                   29160099
291700        MOVE W-MENSAJE TO L145-AQMSGTXT                           29170099
291800        PERFORM 048-GRABAR-LOG                                    29180099
291900        EVALUATE TRUE                                             29190099
292000           WHEN F060-TERM-3270                                    29200099
292100                IF L085-AQ4INTRA = 'S'                            29210099
292200                  IF NOT SW-CONSERVAR-MENSAJE                     29220099
292300                     MOVE  C-ABEND-GENERAL   TO L100-AQ1ABNCD     29230099
292400                     INITIALIZE L085-CAQL085                      29240099
292500*M010->                                                           29250099
292600                     SET L085-CONSULTA-GENERICO TO TRUE           29260099
292700*<-M010                                                           29270099
292800                     MOVE 'F'                TO L085-AQCODOPE     29280099
292900                     MOVE C-ABEND-GENERAL    TO L085-AQ4CLAVE     29290099
293000                     MOVE L078-AQCDIDIO      TO L085-AQCDIDIO     29300099
293100                     PERFORM 047-LLAMADA-RAQW085                  29310099
293200                     MOVE L085-AQTXME77      TO W-MENSAJE         29320099
293300                  END-IF                                          29330099
293400                END-IF                                            29340099
293500                PERFORM 105-TRATAMIENTO-DIARIO                    29350099
293600*JO-14.04.2005                                                    29360099
293700*               PERFORM 222-ESBORRAR-CUA-VARIABLES                29370099
293800                PERFORM 119-ENVIAR-MSG-TERM                       29380099
293900                SET L300-RETURN          TO TRUE                  29390099
294000                MOVE 'ZZZZ'              TO L300-AQTRANRE         29400099
294100           WHEN F060-TERM-FINANCIERO                              29410099
294200                PERFORM 105-TRATAMIENTO-DIARIO                    29420099
294300*JO-14.04.2005                                                    29430099
294400*               PERFORM 222-ESBORRAR-CUA-VARIABLES                29440099
294500*                                                                 29450099
294600*--  Se realiza el SYNCPOINT para consolidar la insercion en el   29460099
294700*--  diario Audit/trails                                          29470099
294800*                                                                 29480099
294900*                                                                 29490099
295000*P1008->                                                          29500099
295100*               IF NOT TERM-TCPIP                                 29510099
295200*                  EXEC CICS SYNCPOINT END-EXEC                   29520099
295300*               END-IF                                            29530099
295400*                                                                 29540099
295500                EXEC CICS SYNCPOINT END-EXEC                      29550099
295600*P1008->                                                          29560099
295700*JO17072000-TCPIP                                                 29570099
295800                IF L100-AQTRTCPI = 'N'                            29580099
295900*A271 20/07/2004 INICIO                                           29590099
296000*                  EXEC CICS ABEND ABCODE ('ZZZZ') NODUMP END-EXEC29600099
296100                   PERFORM 121-PROVOCAR-ABEND-ZZZZ                29610099
296200*A271 20/07/2004 INICIO                                           29620099
296300                END-IF                                            29630099
296400*                                                                 29640099
296500*MLV-29-03-05 INICIO                                              29650099
296600*P1000->                                                          29660099
296700*               IF L300-ENTORNO-CAL390                            29670099
296800*                  PERFORM 122-RESPUESTA-ABEND-CAL390             29680099
296900*               END-IF                                            29690099
297000*P1000<-                                                          29700099
297100*MLV-29-03-04 FINAL                                               29710099
297200*                                                                 29720099
297300*                                                                 29730099
297400*MLV-03-07-03 INICIO                                              29740099
297500*                                                                 29750099
297600                IF L300-ENTORNO-ECDL                              29760099
297700                   PERFORM 123-RESPUESTA-ABEND-ECDL               29770099
297800                END-IF                                            29780099
297900*                                                                 29790099
298000*MLV-03-07-03 FINAL                                               29800099
298100*                                                                 29810099
298200        END-EVALUATE                                              29820099
298300*JO-14.04.2005                                                    29830099
298400*       PERFORM 222-ESBORRAR-CUA-VARIABLES                        29840099
298500        MOVE '01-ABEN-AP'  TO  L392-FILLER(1:10)                  29850099
298600*tracet->                                                         29860099
298700        IF WS-TRACE > '0'                                         29870099
298800           MOVE 'END-RAQW001-13' TO WS-AQNBDTRA                   29880099
298900           MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                   29890099
299000           STRING                                                 29900099
299100              '<<==== Tran/estado/caso|ret: ' F030-AQ3TRNID '/'   29910099
299200               L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE    29920099
299300               DELIMITED BY SIZE  INTO WS-AQINFORM                29930099
299400           END-STRING                                             29940099
299500           PERFORM 131-TRACE-TECNIC                               29950099
299600        END-IF                                                    29960099
299700*tracet<-                                                         29970099
299800        EXEC CICS RETURN END-EXEC                                 29980099
299900     ELSE                                                         29990099
300000        PERFORM 105-TRATAMIENTO-DIARIO                            30000099
300100*JO-14.04.2005                                                    30010099
300200*       PERFORM 222-ESBORRAR-CUA-VARIABLES                        30020099
300300        MOVE '02-ABEN-AP'  TO  L392-FILLER(1:10)                  30030099
300400     END-IF.                                                      30040099
300500*                                                                 30050099
300600*----------------------------------------------------------------*30060099
300700*    CANCELAR LA TRANSACCION CON ABEN ZZZZ                       *30070099
300800*----------------------------------------------------------------*30080099
300900 121-PROVOCAR-ABEND-ZZZZ.                                         30090099
301000*------------------------                                         30100099
301100*tracet->                       +                                 30110099
301200     IF WS-TRACE > '0'                                            30120099
301300        MOVE '121-PROVOCAR-ABEND-ZZZZ.        ' TO WS-AQNBDTRA    30130099
301400        PERFORM 131-TRACE-TECNIC                                  30140099
301500     END-IF                                                       30150099
301600*tracet<-                                                         30160099
301700*    Llamada al modulo de consolidacion (LOG, TRACE, ETC)         30170099
301800     INITIALIZE AREA-CAQLL09                                      30180099
301900     MOVE 'CON' TO LL09-OPCION                                    30190099
302000     EXEC CICS LINK PROGRAM ('RAQWL09') RESP (COD-RESP)           30200099
302100          COMMAREA (AREA-CAQLL09) LENGTH (LENGTH OF AREA-CAQLL09) 30210099
302200     END-EXEC                                                     30220099
302300*                                                                 30230099
302400*A271 04/10/04 INICIO                                             30240099
302500     EXEC CICS SYNCPOINT END-EXEC                                 30250099
302600*A271 04/10/04 FINAL                                              30260099
302700*                                                                 30270099
302800*A271 26/07/04 INICIO                                             30280099
302900     PERFORM 124-ESBORRA-REGIS-SCR-TASCA                          30290099
303000*A271 26/07/04 FINAL                                              30300099
303100*                                                                 30310099
303200     EXEC CICS ABEND ABCODE ('ZZZZ') NODUMP END-EXEC              30320099
303300     .                                                            30330099
303400*                                                                 30340099
303500*----------------------------------------------------------------*30350099
303600*    DAR RESPUESTA A CAL390 AL PRODUCIRSE UN ABEND DE ARQ        *30360099
303700*----------------------------------------------------------------*30370099
303800*P1000->                                                          30380099
303900*122-RESPUESTA-ABEND-CAL390.                                      30390099
304000*---------------------------                                      30400099
304100*tracet->                       +                                 30410099
304200*    IF WS-TRACE > '1'                                            30420099
304300*       MOVE '122-RESPUESTA-ABEND-CAL390.     ' TO WS-AQNBDTRA    30430099
304400*       PERFORM 131-TRACE-TECNIC                                  30440099
304500*    END-IF                                                       30450099
304600*tracet<-                                                         30460099
304700*    IF L085-AQ4INTRA = 'S'                                       30470099
304800*       IF NOT SW-CONSERVAR-MENSAJE                               30480099
304900*          IF W-ESTADO-INICIAL = C-ESTADO-CONFIRMACION            30490099
305000*             MOVE 'JSTB021' TO L100-AQ1ABNCD                     30500099
305100*          ELSE                                                   30510099
305200*             MOVE 'JSTB020' TO L100-AQ1ABNCD                     30520099
305300*          END-IF                                                 30530099
305400*       END-IF                                                    30540099
305500*    END-IF                                                       30550099
305600*                                                                 30560099
305700*    MOVE L300-AQPTARE2       TO W-PUNTER-COMP                    30570099
305800*    SET ADDRESS OF T040-AREA TO W-PUNTER-POINTER                 30580099
305900*    MOVE T040-ADDR           TO W-PUNTER-COMP                    30590099
306000*    SET ADDRESS OF T040-RESPUESTA-CAL390 TO W-PUNTER-POINTER     30600099
306100*                                                                 30610099
306200*    MOVE LOW-VALUES          TO T040-SAL-DUMMY                   30620099
306300*    MOVE T040-LLOC           TO T040-SAL-PUESTO                  30630099
306400*    MOVE T040-SECUENCIA-TRAN TO T040-SAL-SECUENCIA               30640099
306500*    MOVE 'E'                 TO T040-SAL-RESULTADO               30650099
306600*    MOVE T040-ESTADO         TO T040-SAL-ESTADO                  30660099
306700*    MOVE T040-CASO           TO T040-SAL-CASO                    30670099
306800*    MOVE 'V'                 TO T040-SAL-TIPO-AREA               30680099
306900*    MOVE '0'                 TO T040-SAL-NIVEL                   30690099
307000*    MOVE L100-AQ1ABNCD       TO T040-SAL-MENSAJE                 30700099
307100*    MOVE C-MSK-FA8C8E        TO T040-SAL-FIN                     30710099
307200*                                                                 30720099
307300*tracet->                                                         30730099
307400*    IF WS-TRACE > '0'                                            30740099
307500*       MOVE 'END-RAQW001-14' TO WS-AQNBDTRA                      30750099
307600*       MOVE L100-AQ1DCASO    TO WS-AQ1DCASO                      30760099
307700*       STRING                                                    30770099
307800*          '<<==== Tran/estado/caso|ret: ' F030-AQ3TRNID '/'      30780099
307900*           L100-AQ1ESTAD '/' WS-AQ1DCASO '|' L300-AQCDFURE       30790099
308000*           DELIMITED BY SIZE  INTO WS-AQINFORM                   30800099
308100*       END-STRING                                                30810099
308200*       PERFORM 131-TRACE-TECNIC                                  30820099
308300*    END-IF                                                       30830099
308400*tracet<-                                                         30840099
308500*    EXEC CICS RETURN END-EXEC                                    30850099
308600*    .                                                            30860099
308700*P1000<-                                                          30870099
308800*                                                                 30880099
308900*----------------------------------------------------------------*30890099
309000*    DAR RESPUESTA A eCDL AL PRODUCIRSE UN ABEND ARQ             *30900099
309100*----------------------------------------------------------------*30910099
309200 123-RESPUESTA-ABEND-ECDL.                                        30920099
309300*-------------------------                                        30930099
309400*tracet->                       +                                 30940099
309500     IF WS-TRACE > '1'                                            30950099
309600        MOVE '123-RESPUESTA-ABEND-ECDL.       ' TO WS-AQNBDTRA    30960099
309700        PERFORM 131-TRACE-TECNIC                                  30970099
309800     END-IF                                                       30980099
309900*tracet<-                                                         30990099
310000*MLV-03-10-03 INICIO                                              31000099
310100     IF L085-AQ4INTRA = 'S'                                       31010099
310200        IF NOT SW-CONSERVAR-MENSAJE                               31020099
310300           IF W-ESTADO-INICIAL = C-ESTADO-CONFIRMACION            31030099
310400              MOVE 'JSTB021' TO L100-AQ1ABNCD                     31040099
310500           ELSE                                                   31050099
310600              MOVE 'JSTB020' TO L100-AQ1ABNCD                     31060099
310700           END-IF                                                 31070099
310800        END-IF                                                    31080099
310900     END-IF                                                       31090099
311000*MLV-03-10-03 FINAL                                               31100099
311100     MOVE C-E TO W-RESPUESTA                                      31110099
311200     PERFORM 049-ENVIAR-RESPUESTA.                                31120099
311300*                                                                 31130099
311400*----------------------------------------------------------------*31140099
311500 124-ESBORRA-REGIS-SCR-TASCA.                                     31150099
311600*----------------------------                                     31160099
311700*tracet->                       +                                 31170099
311800     IF WS-TRACE > '1'                                            31180099
311900        MOVE '124-ESBORRA-REGIS-SCR-TASCA.    ' TO WS-AQNBDTRA    31190099
312000        PERFORM 131-TRACE-TECNIC                                  31200099
312100     END-IF                                                       31210099
312200*tracet<-                                                         31220099
312300     MOVE 'DL'         TO   L392-OPCIONS                          31230099
312400*                                                                 31240099
312500     EXEC CICS LINK PROGRAM ('RAQW392') RESP (COD-RESP)           31250099
312600          COMMAREA (L100-AREA-RAQW392)                            31260099
312700     END-EXEC                                                     31270099
312800     IF COD-RESP NOT = DFHRESP (NORMAL)                           31280099
312900        CONTINUE                                                  31290099
313000     END-IF                                                       31300099
313100     INITIALIZE L100-AREA-RAQW392.                                31310099
313200*                                                                 31320099
313300*----------------------------------------------------------------*31330099
313400*    -  MARCAR A RAQW392 INICI TRANSACCIO                        *31340099
313500*----------------------------------------------------------------*31350099
313600 125-DESPRES-APLICA.                                              31360099
313700*-------------------                                              31370099
313800*tracet->                       +                                 31380099
313900     IF WS-TRACE > '1'                                            31390099
314000        MOVE '125-DESPRES-APLICA.             ' TO WS-AQNBDTRA    31400099
314100        PERFORM 131-TRACE-TECNIC                                  31410099
314200     END-IF                                                       31420099
314300*tracet<-                                                         31430099
314400     INITIALIZE L395-CAQL395                                      31440099
314500     MOVE 'W'             TO   L395-AQOPCIO                       31450099
314600     MOVE L100-AQ1ACCIO   TO   L395-FILLER                        31460099
314700     MOVE '/'             TO   L395-AQTEXT(4:1)                   31470099
314800     MOVE L100-AQ1ESTAD   TO   L395-AQTEXT(5:1)                   31480099
314900     MOVE '/'             TO   L395-AQTEXT(6:1)                   31490099
315000     MOVE L100-AQ1DCASO   TO   WS-CAS                             31500099
315100     MOVE WS-CAS          TO   L395-AQTEXT(7:3)                   31510099
315200     MOVE '/'             TO   L395-AQTEXT(10:1)                  31520099
315300     MOVE L100-AQ1ENTRA   TO   L395-AQTEXT(11:8)                  31530099
315400     MOVE '/'             TO   L395-AQTEXT(19:1)                  31540099
315500     MOVE L100-AQ1MESAI   TO   L395-AQTEXT(20:1)                  31550099
315600     MOVE '/'             TO   L395-AQTEXT(21:1)                  31560099
315700     MOVE L100-AQ1ERRCD   TO   L395-AQTEXT(22:8)                  31570099
315800     MOVE '/'             TO   L395-AQTEXT(31:1)                  31580099
315900     MOVE L100-AQ1ABNCD   TO   L395-AQTEXT(32:8)                  31590099
316000*                                                                 31600099
316100     PERFORM 128-LINK-RAQW395                                     31610099
316200     INITIALIZE L395-CAQL395.                                     31620099
316300*                                                                 31630099
316400*----------------------------------------------------------------*31640099
316500*    TRATA RETORNS                                               *31650099
316600*----------------------------------------------------------------*31660099
316700 126-TRACTAMENT-RETORN.                                           31670099
316800*----------------------                                           31680099
316900*tracet->                       +                                 31690099
317000     IF WS-TRACE > '1'                                            31700099
317100        MOVE '126-TRACTAMENT-RETORN.          ' TO WS-AQNBDTRA    31710099
317200        PERFORM 131-TRACE-TECNIC                                  31720099
317300     END-IF                                                       31730099
317400*tracet<-                                                         31740099
317500     IF LQ10-AQCDRETO   = 'OK'                                    31750099
317600        MOVE  'OK'             TO  L101-AQCDRETO                  31760099
317700     ELSE                                                         31770099
317800        MOVE  'KO'             TO  L101-AQCDRETO                  31780099
317900     END-IF                                                       31790099
318000                                                                  31800099
318100     IF LQ10-AQCDRETO  NOT = 'OK'                                 31810099
318200        MOVE  'JSTB081'        TO  L100-AQ1ABNCD                  31820099
318300        SET SW-ABEND-APLICATIVO TO TRUE                           31830099
318400        MOVE  LQ10-AQCDRETO    TO  L045-AQTXMENS (3)              31840099
318500        MOVE  'MODULO RAQWQ10, CODI. RETORNO'                     31850099
318600                               TO  L045-AQTXMENS (2)              31860099
318700        IF LQ10-AQCDRETO   = 'EP'                                 31870099
318800           MOVE 'ERROR EN PARAMETROS DE ENTRADA'                  31880099
318900           TO  L045-AQTXMENS  (1)                                 31890099
319000        END-IF                                                    31900099
319100        IF LQ10-AQCDRETO   = 'NF'                                 31910099
319200           MOVE 'LA OFICINA NO EXISTE EN TAQQ1'                   31920099
319300           TO  L045-AQTXMENS  (1)                                 31930099
319400        END-IF                                                    31940099
319500        IF LQ10-AQCDRETO   = 'NA'                                 31950099
319600           MOVE 'LA CAJA NO ESTA ABIERTA '                        31960099
319700                 TO  L045-AQTXMENS  (1)                           31970099
319800           MOVE  '  '             TO  L045-AQTXMENS (3)           31980099
319900           MOVE  '                             '                  31990099
320000                 TO  L045-AQTXMENS (2)                            32000099
320100        END-IF                                                    32010099
320200        IF LQ10-AQCDRETO   = 'CE'                                 32020099
320300           MOVE 'LA CAJA ESTA EN CUADRE  '                        32030099
320400                 TO  L045-AQTXMENS  (1)                           32040099
320500           MOVE  '  '             TO  L045-AQTXMENS (3)           32050099
320600           MOVE  '                             '                  32060099
320700                 TO  L045-AQTXMENS (2)                            32070099
320800        END-IF                                                    32080099
320900        IF LQ10-AQCDRETO   = 'EX'                                 32090099
321000           MOVE 'ERROR DE CICS/DB2 (MIRAR LOG) '                  32100099
321100           TO  L045-AQTXMENS  (1)                                 32110099
321200        END-IF                                                    32120099
321300        IF LQ10-AQCDRETO   = 'ER'                                 32130099
321400           MOVE 'ERROR DE LA RUTINA            '                  32140099
321500           TO  L045-AQTXMENS  (1)                                 32150099
321600        END-IF                                                    32160099
321700        SET SW-ABEND-APLICATIVO TO TRUE                           32170099
321800        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    32180099
321900        PERFORM 099-ABEND-PROC                                    32190099
322000     END-IF.                                                      32200099
322100*                                                                 32210099
322200*----------------------------------------------------------------*32220099
322300*   LINK PROGRAMA RAQW392                                       .*32230099
322400*----------------------------------------------------------------*32240099
322500 127-LINK-RAQW392.                                                32250099
322600*-----------------                                                32260099
322700*tracet->                       +                                 32270099
322800     IF WS-TRACE > '1'                                            32280099
322900        MOVE '127-LINK-RAQW392.               ' TO WS-AQNBDTRA    32290099
323000        STRING                                                    32300099
323100           'Opció:' L392-OPCIONS, '/'                             32310099
323200           'T.act:' L392-SCR-AQ(278:4), '/'                       32320099
323300           'T.ant:' L392-SCR-AQ(622:4), '/'                       32330099
323400           'T.aux:' W-AQ1TRANT, '/'                               32340099
323500           'EIBTRNID:', EIBTRNID                                  32350099
323600            DELIMITED BY SIZE    INTO WS-AQINFORM                 32360099
323700        END-STRING                                                32370099
323800        PERFORM 131-TRACE-TECNIC                                  32380099
323900     END-IF                                                       32390099
324000*tracet<-                                                         32400099
324100     EXEC CICS LINK PROGRAM ('RAQW392') RESP (COD-RESP)           32410099
324200          COMMAREA (L100-AREA-RAQW392)                            32420099
324300     END-EXEC                                                     32430099
324400*                                                                 32440099
324500     IF COD-RESP NOT = DFHRESP (NORMAL)                           32450099
324600        PERFORM 033-INFORMAR-DATOS-ABEND                          32460099
324700     END-IF.                                                      32470099
324800*                                                                 32480099
324900*----------------------------------------------------------------*32490099
325000*   LINK PROGRAMA RAQW392                                       .*32500099
325100*----------------------------------------------------------------*32510099
325200 128-LINK-RAQW395.                                                32520099
325300*-----------------                                                32530099
325400*tracet->                       +                                 32540099
325500     IF WS-TRACE > '1'                                            32550099
325600        MOVE '128-LINK-RAQW395.               ' TO WS-AQNBDTRA    32560099
325700        PERFORM 131-TRACE-TECNIC                                  32570099
325800     END-IF                                                       32580099
325900*tracet<-                                                         32590099
326000*tracet->                                                         32600099
326100*    EXEC CICS LINK PROGRAM ('RAQW395') RESP (COD-RESP)           32610099
326200*         COMMAREA (L395-CAQL395)                                 32620099
326300*    END-EXEC                                                     32630099
326400*tracet<-                                                         32640099
326500*                                                                 32650099
326600     IF COD-RESP NOT = DFHRESP (NORMAL)                           32660099
326700        MOVE 'E' TO  L395-AQRETORN                                32670099
326800     END-IF.                                                      32680099
326900*                                                                 32690099
327000*----------------------------------------------------------------*32700099
327100*                                                                *32710099
327200*   ERRORS ACCESOS A RAQW007/RAQW008                            .*32720099
327300*                                                                *32730099
327400*----------------------------------------------------------------*32740099
327500 129-ERROR-MODULS-RAQWNNN.                                        32750099
327600*-------------------------                                        32760099
327700*tracet->                       +                                 32770099
327800     IF WS-TRACE > '1'                                            32780099
327900        MOVE '129-ERROR-MODULS-RAQWNNN.       ' TO WS-AQNBDTRA    32790099
328000        PERFORM 131-TRACE-TECNIC                                  32800099
328100     END-IF                                                       32810099
328200*tracet<-                                                         32820099
328300     IF L310-AQCODRET  = 'OP'                                     32830099
328400        MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                      32840099
328500        MOVE L310-AQCODRET  TO L045-AQTXMENS (2)                  32850099
328600        SET SW-ABEND-ARQUITECTURAL TO TRUE                        32860099
328700        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    32870099
328800        PERFORM 099-ABEND-PROC                                    32880099
328900     END-IF                                                       32890099
329000                                                                  32900099
329100     IF L310-MSGABEND NOT = SPACES                                32910099
329200        SET SW-ABEND-ARQUITECTURAL TO TRUE                        32920099
329300        PERFORM 099-ABEND-PROC                                    32930099
329400     END-IF.                                                      32940099
329500                                                                  32950099
329600*hm1b                                                             32960099
329700******************************************************************32970099
329800*    Insertar en el nuevo trace las areas mal formateadas        *32980099
329900******************************************************************32990099
330000 130-INSERTAR-DET-TRACE.                                          33000099
330100*-----------------------                                          33010099
330200*tracet->                       +                                 33020099
330300     IF WS-TRACE > '1'                                            33030099
330400        MOVE '130-INSERTAR-DET-TRACE.         ' TO WS-AQNBDTRA    33040099
330500        PERFORM 131-TRACE-TECNIC                                  33050099
330600     END-IF                                                       33060099
330700*tracet<-                                                         33070099
330800     INITIALIZE CAQLT00-AREA                                      33080099
330900     MOVE 'I'                TO LT00-AQCDOPC                      33090099
331000     MOVE L100-AQ1USCIC      TO LT00-AQCDUSIN                     33100099
331100     MOVE 'CD'               TO LT00-AQCDLAYR                     33110099
331200     MOVE L100-AQ1TRANT      TO LT00-AQCDTRAN                     33120099
331300     MOVE SPACES             TO LT00-AQIDPROD                     33130099
331400                                LT00-AQIDOPER                     33140099
331500     MOVE 'RAQW001'          TO LT00-AQCDPROG                     33150099
331600     MOVE L100-AQHMALPC      TO LT00-AQHMALPC                     33160099
331700     MOVE L100-AQCTMINU      TO LT00-AQCTMINU                     33170099
331800     MOVE 'AREA-DNF-ERRONEA' TO LT00-AQNBDTRA                     33180099
331900     MOVE AREA-DNF           TO LT00-AQTXINFO                     33190099
332000     PERFORM 053-LLAMAR-RAQWT00                                   33200099
332100     .                                                            33210099
332200*hm1b                                                             33220099
332300*tracet->                                                         33230099
332400******************************************************************33240099
332500*    Grabaciones si Trace Tecnico activo                         *33250099
332600******************************************************************33260099
332700 131-TRACE-TECNIC.                                                33270099
332800*-----------------------                                          33280099
332900*    No se deja rastro del párrafo en el propio Trace             33290099
333000*----Grabación en el Journal.                                     33300099
333100     MOVE 'AQ'          TO L700-AQCDAPDE                          33310099
333200     MOVE  1            TO L700-AQCODIRE                          33320099
333300     MOVE 0019          TO L700-AQENTIDA                          33330099
333400     MOVE 3333          TO L700-AQOFICIN                          33340099
333500     MOVE 'AQ'          TO L700-AQCDAPOR                          33350099
333600     MOVE 41            TO L700-AQLNREGS                          33360099
333700     STRING 'RAQW001-' WS-AQNBDTRA '|' WS-AQINFORM                33370099
333800        DELIMITED BY SIZE                                         33380099
333900        INTO L700-AQREGIS                                         33390099
334000     END-STRING                                                   33400099
334100                                                                  33410099
334200*    Si campo ha sido informado se muestra y se borra             33420099
334300     IF WS-AQINFORM > SPACES                                      33430099
334400        ADD 80          TO L700-AQLNREGS                          33440099
334500        MOVE SPACES     TO WS-AQINFORM                            33450099
334600     END-IF                                                       33460099
334700                                                                  33470099
334800     EXEC CICS LINK PROGRAM  ('RAQU700') COMMAREA (L700-CAQL700)  33480099
334900          RESP (COD-RESP)                                         33490099
335000     END-EXEC                                                     33500099
335100                                                                  33510099
335200     EVALUATE L700-AQRETORN                                       33520099
335300        WHEN SPACES                                               33530099
335400           CONTINUE                                               33540099
335500        WHEN OTHER                                                33550099
335600           MOVE SPACES TO WS-TRACE                                33560099
335700     END-EVALUATE                                                 33570099
335800     .                                                            33580099
335900*tracet<-                                                         33590099
336000*----------------------------------------------------------------*33600099
336100*--> VERIFICAR LA PETICION DE VERIFICACION ON-LINE 4-OJOS        *33610099
336200*----------------------------------------------------------------*33620099
336300 132-VERIF-APLICAC-SOLUCION.                                      33630099
336400*---------------------------                                      33640099
336500*tracet->                       +                                 33650099
336600     IF WS-TRACE > '1'                                            33660099
336700        MOVE '132-VERIF-APLICAC-SOLUCION.     ' TO WS-AQNBDTRA    33670099
336800        PERFORM 131-TRACE-TECNIC                                  33680099
336900     END-IF                                                       33690099
337000*tracet<-                                                         33700099
337100*                                                                 33710099
337200     IF L100-AQCDQULL = 1                                         33720099
337300        IF L100-AQTR4OJO = L100-AQ1TRANT                          33730099
337400           IF L100-4OJOS-APLICA-A OR L100-4OJOS-CONVERSION-C      33740099
337500              IF L100-4OJOS-CONVERSION-C                          33750099
337600*                Activar el sw de inicio de verificacion del      33760099
337700*                cambio de solucion de 4-ojos                     33770099
337800                 SET L100-4OJOS-CONVERSION-ACTIV TO TRUE          33780099
337900              END-IF                                              33790099
338000           ELSE                                                   33800099
338100*             Se aplica la solucion mas restrictiva               33810099
338200              SET L100-4OJOS-APLICA-A TO TRUE                     33820099
338300*                                                                 33830099
338400              INITIALIZE L085-CAQL085                             33840099
338500              MOVE 'F'               TO L085-AQCODOPE             33850099
338600              MOVE 'JAQA126'         TO L085-AQ4CLAVE             33860099
338700              PERFORM 047-LLAMADA-RAQW085                         33870099
338800*                                                                 33880099
338900              INITIALIZE L145-CAQL145                             33890099
339000              MOVE L085-AQTXME77     TO L145-AQMSGTXT             33900099
339100*MLV13->                                                          33910099
339200              SET SW-SI-MENSAJE-4OJOS TO TRUE                     33920099
339300              PERFORM 048-GRABAR-LOG                              33930099
339400*MLV13<-                                                          33940099
339500           END-IF                                                 33950099
339600        ELSE                                                      33960099
339700*          Se aplica la solucion mas restrictiva                  33970099
339800           SET L100-4OJOS-APLICA-A TO TRUE                        33980099
339900*                                                                 33990099
340000           INITIALIZE L085-CAQL085                                34000099
340100           MOVE 'V'               TO L085-AQCODOPE                34010099
340200           MOVE 'JAQA125'         TO L085-AQ4CLAVE                34020099
340300           MOVE L100-AQTR4OJO     TO L085-AQTXMENS(1)             34030099
340400           PERFORM 047-LLAMADA-RAQW085                            34040099
340500*                                                                 34050099
340600           INITIALIZE L145-CAQL145                                34060099
340700           MOVE L085-AQTXME77     TO L145-AQMSGTXT                34070099
340800*MLV13->                                                          34080099
340900           SET SW-SI-MENSAJE-4OJOS TO TRUE                        34090099
341000           PERFORM 048-GRABAR-LOG                                 34100099
341100*MLV13<-                                                          34110099
341200        END-IF                                                    34120099
341300     ELSE                                                         34130099
341400        MOVE C-ABEND-4OJOS-NO-TIPO-1 TO L100-AQ1ABNCD             34140099
341500        MOVE L100-AQCDQULL TO L045-AQTXMENS (1)                   34150099
341600        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    34160099
341700     END-IF                                                       34170099
341800     .                                                            34180099
341900*                                                                 34190099
342000*P35->                                                            34200099
342100*----------------------------------------------------------------*34210099
342200*--> Tractament per verificar Avisos especials.                  *34220099
342300*   -Es mira a la taula TG0600 i si algun dels Avisos coincideix *34230099
342400*    s'ha d'invocar un módul de PW. Cal passar-li els codis de   *34240099
342500*    Client i si no els tenim els hem d'obtindre de Avisos       *34250099
342600*----------------------------------------------------------------*34260099
342700 133-TRACTA-AVISOS-ESPECIALS.                                     34270099
342800*---------------------------                                      34280099
342900*tracet->                       +                                 34290099
343000     IF WS-TRACE > '1'                                            34300099
343100        MOVE '133-TRACTA-AVISOS-ESPECIALS.    ' TO WS-AQNBDTRA    34310099
343200        PERFORM 131-TRACE-TECNIC                                  34320099
343300     END-IF                                                       34330099
343400*tracet<-                                                         34340099
343500*    Accedir a taula TG0600 para obtindre llista d'Avisos         34350099
343600     INITIALIZE AREA-CTGL005                                      34360099
343700     INITIALIZE T600-CTGT0600                                     34370099
343800     MOVE 1             TO W-ITEM                                 34380099
343900     MOVE '0600'        TO CTGL005-CDTABLA                        34390099
344000     MOVE '0019'        TO CTGL005-STBANCO                        34400099
344100     MOVE 1             TO CTGL005-NUCLAVE                        34410099
344200     MOVE 'AQ'          TO T600-TGCDAPL3                          34420099
344300     MOVE 'RAQW001'     TO T600-TGCDPRO8                          34430099
344400     MOVE W-ITEM        TO T600-TGNUSEC3                          34440099
344500     MOVE T600-CLAT0600 TO CTGL005-CLAVTAB                        34450099
344600     PERFORM 061-INVOCAR-RTGU005                                  34460099
344700*    Si existeix el registre a TG0600, revisar Avisos             34470099
344800     IF CTGL005-CDRETORN = '00'                                   34480099
344900*       Moure codis d'Avisos de TG0600 a taula memoria            34490099
345000        MOVE CTGL005-CONTOCUR TO W-AQCDPLAN-GRUP                  34500099
345100*       Per cada Avis retornat per RAQWA11...                     34510099
345200        PERFORM VARYING W-I1 FROM 1 BY 1 UNTIL                    34520099
345300                W-I1 > LA11-AQCDPLAN-CNT                          34530099
345400*          ...explorar si existeix a la taula de memoria          34540099
345500           PERFORM VARYING W-I2 FROM 1 BY 1 UNTIL                 34550099
345600                   W-I2 > 10                   OR                 34560099
345700                   W-AQCDPLAN(W-I2) = SPACES   OR                 34570099
345800*aqui->                                                           34580099
345900                   LA11-AQCDPLAN-OUT(W-I1) = W-AQCDPLAN(W-I2)     34590099
346000*aqui<-                                                           34600099
346100           END-PERFORM                                            34610099
346200*          Si coincideix, s'ha de cridar el módul de Partner      34620099
346300           IF W-I2 > 10 OR  W-AQCDPLAN(W-I2) = SPACES             34630099
346400              CONTINUE                                            34640099
346500           ELSE                                                   34650099
346600*             Mirar si tenim el codi de Client                    34660099
346700              IF LA11-AQCTCLIE-IN > 0                             34670099
346800*                CONTINUE                                         34680099
346900                 MOVE LA11-AQCTCLIE-IN TO W-I3                    34690099
347000              ELSE                                                34700099
347100                 PERFORM 134-OBTINDRE-CLIENT-AVISOS               34710099
347200              END-IF                                              34720099
347300*             Preparar crida módul                                34730099
347400              INITIALIZE AREA-RPIW602                             34740099
347500              SET L602-I-NEW-CASO TO TRUE                         34750099
347600*             Una crida per cada Client                           34760099
347700              PERFORM VARYING W-I4 FROM 1 BY 1 UNTIL W-I4 > W-I3  34770099
347800                 MOVE LA11-AQCDCLIE-IN(W-I4) TO L602-I-PICDCLIE   34780099
347900                 PERFORM 136-CRIDA-RPIW602                        34790099
348000              END-PERFORM                                         34800099
348100           END-IF                                                 34810099
348200        END-PERFORM                                               34820099
348300     ELSE                                                         34830099
348400        CONTINUE                                                  34840099
348500     END-IF                                                       34850099
348600     .                                                            34860099
348700*                                                                 34870099
348800*                                                                 34880099
348900*----------------------------------------------------------------*34890099
349000*--> Obtindre els códis de Client a partir del contracte i       *34900099
349100*    posar-los dins l'area LA11-AQCDCLIE-IN(x)                   *34910099
349200*----------------------------------------------------------------*34920099
349300 134-OBTINDRE-CLIENT-AVISOS.                                      34930099
349400*---------------------------                                      34940099
349500*tracet->                       +                                 34950099
349600     IF WS-TRACE > '1'                                            34960099
349700        MOVE '134-OBTINDRE-CLIENT-AVISOS.     ' TO WS-AQNBDTRA    34970099
349800        PERFORM 131-TRACE-TECNIC                                  34980099
349900     END-IF                                                       34990099
350000*tracet<-                                                         35000099
350100*    Obrir cursor amb RAQUA31 por obtindre claus dels fills       35010099
350200     INITIALIZE AREA-CAQLA31                                      35020099
350300     MOVE 'C02'                   TO LA31-AQCDOPC                 35030099
350400     MOVE LA11-AQCDPLAN-OUT(W-I1) TO LA31-AQCDPLAN-IN             35040099
350500     MOVE LA11-STNUBAN-IN         TO LA31-STNUBAN-IN              35050099
350600     MOVE LA11-AQCDENCT-IN        TO LA31-STBANCO-IN              35060099
350700     MOVE LA11-AQCDCECT-IN        TO LA31-STOFICI-IN              35070099
350800     MOVE LA11-AQNUCNTO-IN        TO LA31-STNUCTA-IN              35080099
350900     MOVE L100-AQFHDMA8(1:2)      TO LA31-STFHFIN-INI-IN(1:2)     35090099
351000     MOVE '.'                     TO LA31-STFHFIN-INI-IN(3:1)     35100099
351100     MOVE L100-AQFHDMA8(3:2)      TO LA31-STFHFIN-INI-IN(4:2)     35110099
351200     MOVE '.'                     TO LA31-STFHFIN-INI-IN(6:1)     35120099
351300     MOVE L100-AQFHDMA8(5:4)      TO LA31-STFHFIN-INI-IN(7:4)     35130099
351400     MOVE '31.12.9999'            TO LA31-STFHFIN-FIN-IN          35140099
351500     MOVE L100-AQCDPISO(1:2)      TO LA31-AQCDPAIS                35150099
351600                                                                  35160099
351700     MOVE 'O' TO LA31-AQCDACC                                     35170099
351800     PERFORM 135-CRIDA-RAQUA31                                    35180099
351900                                                                  35190099
352000*    bucle per llegir tots els possibles Clients del contracte    35200099
352100     MOVE 'F' TO LA31-AQCDACC                                     35210099
352200     PERFORM 135-CRIDA-RAQUA31                                    35220099
352300                                                                  35230099
352400     PERFORM UNTIL LA31-AQRCMAJ = 'NF'                            35240099
352500        ADD 1 TO W-I3                                             35250099
352600        MOVE LA31-AQIDAVRL-OUT TO W-AQIDAVRL(W-I3)                35260099
352700        PERFORM 135-CRIDA-RAQUA31                                 35270099
352800     END-PERFORM                                                  35280099
352900                                                                  35290099
353000     MOVE 'C' TO LA31-AQCDACC                                     35300099
353100     PERFORM 135-CRIDA-RAQUA31                                    35310099
353200                                                                  35320099
353300*    Lectura un a un dels Clients (pares) dels regs. obtinguts    35330099
353400     INITIALIZE AREA-CAQLA31                                      35340099
353500     MOVE 'S01'                   TO LA31-AQCDOPC                 35350099
353600     MOVE L100-AQCDPISO(1:2)      TO LA31-AQCDPAIS                35360099
353700*    bucle per llegir tots els possibles Clients del contracte    35370099
353800     PERFORM VARYING W-I4 FROM 1 BY 1 UNTIL W-I4 > W-I3           35380099
353900        MOVE W-AQIDAVRL(W-I4)     TO LA31-AQTIMEST-IN             35390099
354000        PERFORM 135-CRIDA-RAQUA31                                 35400099
354100        IF LA31-AQRCMAJ = 'OK'                                    35410099
354200           MOVE LA31-AQCDCLIE-OUT TO LA11-AQCDCLIE-IN(W-I4)       35420099
354300        ELSE                                                      35430099
354400           MOVE ZEROS             TO LA11-AQCDCLIE-IN(W-I4)       35440099
354500        END-IF                                                    35450099
354600     END-PERFORM                                                  35460099
354700     .                                                            35470099
354800*                                                                 35480099
354900*----------------------------------------------------------------*35490099
355000 135-CRIDA-RAQUA31.                                               35500099
355100*---------------------------                                      35510099
355200*tracet->                       +                                 35520099
355300     IF WS-TRACE > '1'                                            35530099
355400        MOVE '135-CRIDA-RAQUA31.              ' TO WS-AQNBDTRA    35540099
355500        PERFORM 131-TRACE-TECNIC                                  35550099
355600     END-IF                                                       35560099
355700*tracet<-                                                         35570099
355800*                                                                 35580099
355900*MODLC-I                                                          35590099
356000*    EXEC CICS                                                    35600099
356100*        LINK PROGRAM  ('RAQUA31') RESP (COD-RESP)                35610099
356200*             COMMAREA (AREA-CAQLA31)                             35620099
356300*             LENGTH   (LENGTH OF AREA-CAQLA31)                   35630099
356400*    END-EXEC                                                     35640099
356500*                                                                 35650099
356600*    IF COD-RESP NOT = DFHRESP(NORMAL)                            35660099
356700*       PERFORM 033-INFORMAR-DATOS-ABEND                          35670099
356800*    END-IF                                                       35680099
356900                                                                  35690099
357000     CALL CON-RAQUA31 USING DFHEIBLK, DFHCOMMAREA, AREA-CAQLA31   35700099
357100*MODLC-F                                                          35710099
357200     IF L100-AQ1ABNCD NOT = SPACES                                35720099
357300        PERFORM 099-ABEND-PROC                                    35730099
357400     END-IF                                                       35740099
357500                                                                  35750099
357600     EVALUATE LA31-AQRCMAJ                                        35760099
357700         WHEN 'OK'                                                35770099
357800         WHEN 'NF'                                                35780099
357900              CONTINUE                                            35790099
358000         WHEN OTHER                                               35800099
358100              MOVE 'JGTB143'      TO L100-AQ1ABNCD                35810099
358200              MOVE 'RAQUA31'      TO L045-AQTXMENS (1)            35820099
358300              MOVE LA31-AQRCMAJ   TO L045-AQTXMENS (2)            35830099
358400              SET SW-ABEND-ARQUITECTURAL TO TRUE                  35840099
358500              PERFORM 037-FORMATEAR-MENSAJE-VARIABLE              35850099
358600              PERFORM 099-ABEND-PROC                              35860099
358700     END-EVALUATE                                                 35870099
358800     .                                                            35880099
358900*                                                                 35890099
359000*----------------------------------------------------------------*35900099
359100 136-CRIDA-RPIW602.                                               35910099
359200*---------------------------                                      35920099
359300*tracet->                       +                                 35930099
359400     IF WS-TRACE > '1'                                            35940099
359500        MOVE '136-CRIDA-RPIW602.              ' TO WS-AQNBDTRA    35950099
359600        PERFORM 131-TRACE-TECNIC                                  35960099
359700     END-IF                                                       35970099
359800*tracet<-                                                         35980099
359900*                                                                 35990099
360000     EXEC CICS                                                    36000099
360100         LINK PROGRAM  ('RPIW602') RESP (COD-RESP)                36010099
360200              COMMAREA (AREA-RPIW602)                             36020099
360300              LENGTH   (LENGTH OF AREA-RPIW602)                   36030099
360400     END-EXEC                                                     36040099
360500                                                                  36050099
360600     IF COD-RESP NOT = DFHRESP(NORMAL)                            36060099
360700        PERFORM 033-INFORMAR-DATOS-ABEND                          36070099
360800     END-IF                                                       36080099
360900                                                                  36090099
361000     EVALUATE STD-RETURN-CODE                                     36100099
361100        WHEN '  '                                                 36110099
361200           CONTINUE                                               36120099
361300        WHEN OTHER                                                36130099
361400           MOVE 'JGTB143'       TO L100-AQ1ABNCD                  36140099
361500           MOVE 'RPIW602'       TO L045-AQTXMENS (1)              36150099
361600           MOVE STD-RETURN-CODE TO L045-AQTXMENS (2)              36160099
361700           SET SW-ABEND-ARQUITECTURAL TO TRUE                     36170099
361800           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 36180099
361900           PERFORM 099-ABEND-PROC                                 36190099
362000     END-EVALUATE                                                 36200099
362100     .                                                            36210099
362200                                                                  36220099
362300*LCO01.I                                                          36230099
362400*                                                                 36240099
362500*----------------------------------------------------------------*36250099
362600 137-VERIFICAR-EXCEPCION.                                         36260099
362700*Por cada aviso bloqueante recuperado por RAQWA11 se accede a     36270099
362800*TG 1051 para verificar si debe ser bloqueante o por el contrario 36280099
362900*se mostrará un mensaje y se continuará con la ejecución          36290099
363000*----------------------------------------------------------------*36300099
363100                                                                  36310099
363200*tracet->                       +                                 36320099
363300     IF WS-TRACE > '1'                                            36330099
363400        MOVE '137-VERIFICAR-EXCEPCION.        ' TO WS-AQNBDTRA    36340099
363500        PERFORM 131-TRACE-TECNIC                                  36350099
363600     END-IF                                                       36360099
363700*tracet<-                                                         36370099
363800                                                                  36380099
363900*P1006->                                                          36390099
364000*MLV-ABL->                                                        36400099
364100*    COMPUTE WS-IND-COD = WS-IND-COD + WS-CON-1                   36410099
364200*MLV-ABL<-                                                        36420099
364300*P1006<-                                                          36430099
364400                                                                  36440099
364500     INITIALIZE CTGL000                                           36450099
364600     MOVE '0019'                         TO CTGL000-STBANCO       36460099
364700     MOVE '1051'                         TO CTGL000-CDTABLA       36470099
364800*P1006->                                                          36480099
364900*MLV-ABL->                                                        36490099
365000*****MOVE LA11-AQCDPLAN-OUT(W-MENS-A11)  TO CTGL000-CLAVTAB       36500099
365100*    MOVE LA11-AQCDPLAN-OUT(WS-IND-COD)  TO CTGL000-CLAVTAB       36510099
365200*                                                                 36520099
365300     MOVE LA11-AQCDAVIS (W-MENS-A11) TO CTGL000-CLAVTAB           36530099
365400*MLV-ABL<-                                                        36540099
365500*P1006<-                                                          36550099
365600*                                                                 36560099
365700     MOVE 1                              TO CTGL000-NUCLAVE       36570099
365800                                                                  36580099
365900     PERFORM 046-INVOCAR-RTGU000                                  36590099
366000                                                                  36600099
366100     IF CTGL000-CDRETORN = '00'                                   36610099
366200        MOVE CTGL000-CONTOCUR(1:8)       TO WS-MOD-EXBLOQ         36620099
366300        PERFORM 138-ACCESO-MOD-APLICATIVO                         36630099
366400     ELSE                                                         36640099
366500*       El aviso no esta en la tabla TG 1051                      36650099
366600        ADD 1                            TO WS-CONT-AV-BLOQ       36660099
366700     END-IF                                                       36670099
366800     .                                                            36680099
366900*P148-I                                                           36690099
367000*----------------------------------------------------------------*36700099
367100 137A-EXCEPCION-GDPR.                                             36710099
367200*Verificar el campo que retorna el WA11, nos indica si el aviso   36720099
367300*tiene excepcion o no                                             36730099
367400*----------------------------------------------------------------*36740099
367500*tracet->                       +                                 36750099
367600     IF WS-TRACE > '1'                                            36760099
367700        MOVE '137A-VERIFICAR-EXCEPCION.        ' TO WS-AQNBDTRA   36770099
367800        PERFORM 131-TRACE-TECNIC                                  36780099
367900     END-IF                                                       36790099
368000*tracet<-                                                         36800099
368100*                                                                 36810099
368200*JAS01-I                                                          36820099
368300     COMPUTE WS-IND-COD2 = WS-IND-COD2 + WS-CON-1                 36830099
368400                                                                  36840099
368500*    IF LA11-AQGDPREX(W-MENS-A11) = 'S'                           36850099
368600     IF LA11-AQGDPREX(WS-IND-COD2) = 'S'                          36860099
368700*JAS01-F                                                          36870099
368800        EVALUATE TRUE                                             36880099
368900          WHEN SW-GDPR-PRIORI                                     36890099
369000* se guarda datos de aviso para mostrarlos a posteriori           36900099
369100* como avisos informativos                                        36910099
369200           ADD  1                    TO WS-CONT-EX-GDPR           36920099
369300                                        WS-CONT-LIN-EXGDPR        36930099
369400*                                                                 36940099
369500*JAS01-I                                                          36950099
369600*          MOVE LA11-AQTPAVIS(W-MENS-A11) TO WS-AQTPAVIS-GDPR     36960099
369700*                                            (WS-CONT-EX-GDPR)    36970099
369800*          MOVE LA11-AQCDPLAN-OUT(W-MENS-A11)                     36980099
369900*                            TO WS-AQCDPLAN-GDPR(WS-CONT-EX-GDPR) 36990099
370000*          MOVE LA11-AQTXAVIS(W-MENS-A11)                         37000099
370100*                            TO WS-AQTXAVIS-GDPR(WS-CONT-EX-GDPR) 37010099
370200*                                                                 37020099
370300*          COMPUTE WS-IND3 = W-MENS-A11 + 1                       37030099
370400           MOVE LA11-AQTPAVIS(WS-IND-COD2) TO WS-AQTPAVIS-GDPR    37040099
370500                                             (WS-CONT-EX-GDPR)    37050099
370600           MOVE LA11-AQCDPLAN-OUT(WS-IND-COD2)                    37060099
370700                             TO WS-AQCDPLAN-GDPR(WS-CONT-EX-GDPR) 37070099
370800           MOVE LA11-AQTXAVIS(WS-IND-COD2)                        37080099
370900                             TO WS-AQTXAVIS-GDPR(WS-CONT-EX-GDPR) 37090099
371000*                                                                 37100099
371100           COMPUTE WS-IND3 = WS-IND-COD2 + 1                      37110099
371200*JAS01-F                                                          37120099
371300           PERFORM VARYING WS-IND3 FROM WS-IND3 BY 1 UNTIL        37130099
371400              LA11-AQTXAVIS(WS-IND3) = (SPACES OR                 37140099
371500                                         LOW-VALUES)              37150099
371600              OR LA11-AQTPAVIS(WS-IND3) NOT = '0'                 37160099
371700                                                                  37170099
371800              ADD 1                  TO WS-CONT-LIN-EXGDPR        37180099
371900              MOVE LA11-AQTPAVIS(WS-IND3) TO WS-AQTPAVIS-GDPR     37190099
372000                                            (WS-CONT-LIN-EXGDPR)  37200099
372100              MOVE 'ZZZZZZZZZZ'                                   37210099
372200                          TO WS-AQCDPLAN-GDPR(WS-CONT-LIN-EXGDPR) 37220099
372300              MOVE LA11-AQTXAVIS(WS-IND3)                         37230099
372400                          TO WS-AQTXAVIS-GDPR(WS-CONT-LIN-EXGDPR) 37240099
372500           END-PERFORM                                            37250099
372600*verificar si el aviso ya ha sido tratado en a priori             37260099
372700          WHEN SW-GDPR-POSTER                                     37270099
372800           SET GDPRNO-ENCONTRADO     TO TRUE                      37280099
372900           PERFORM VARYING WS-IND1 FROM WS-CON-1  BY WS-CON-1     37290099
373000             UNTIL WS-IND1 > 40 OR                                37300099
373100              WS-AQTXAVIS-GDPR(WS-IND1) = SPACES OR LOW-VALUES OR 37310099
373200                  GDPRSI-ENCONTRADO                               37320099
373300*JAS01-I                                                          37330099
373400*                 IF LA11-AQCDPLAN-OUT(W-MENS-A11) =              37340099
373500                  IF LA11-AQCDPLAN-OUT(WS-IND-COD2) =             37350099
373600*JAS01-F                                                          37360099
373700                     WS-AQCDPLAN-GDPR(WS-IND1)                    37370099
373800                     SET GDPRSI-ENCONTRADO TO TRUE                37380099
373900                  END-IF                                          37390099
374000           END-PERFORM                                            37400099
374100*sino lo encontro, agregar el aviso excepcional encontrado        37410099
374200           IF GDPRNO-ENCONTRADO                                   37420099
374300              ADD 1                  TO WS-CONT-EX-GDPR           37430099
374400                                        WS-CONT-LIN-EXGDPR        37440099
374500*JAS01-I                                                          37450099
374600*             MOVE LA11-AQTPAVIS(W-MENS-A11) TO WS-AQTPAVIS-GDPR  37460099
374700*                                            (WS-CONT-EX-GDPR)    37470099
374800*             MOVE LA11-AQCDPLAN-OUT(W-MENS-A11)                  37480099
374900*                            TO WS-AQCDPLAN-GDPR(WS-CONT-EX-GDPR) 37490099
375000*             MOVE LA11-AQTXAVIS(W-MENS-A11)                      37500099
375100*                            TO WS-AQTXAVIS-GDPR(WS-CONT-EX-GDPR) 37510099
375200*                                                                 37520099
375300*             COMPUTE WS-IND3 = W-MENS-A11 + 1                    37530099
375400              MOVE LA11-AQTPAVIS(WS-IND-COD2) TO WS-AQTPAVIS-GDPR 37540099
375500                                             (WS-CONT-EX-GDPR)    37550099
375600              MOVE LA11-AQCDPLAN-OUT(WS-IND-COD2)                 37560099
375700                             TO WS-AQCDPLAN-GDPR(WS-CONT-EX-GDPR) 37570099
375800              MOVE LA11-AQTXAVIS(WS-IND-COD2)                     37580099
375900                             TO WS-AQTXAVIS-GDPR(WS-CONT-EX-GDPR) 37590099
376000                                                                  37600099
376100              COMPUTE WS-IND3 = WS-IND-COD2 + 1                   37610099
376200*JAS01-F                                                          37620099
376300              PERFORM VARYING WS-IND3 FROM WS-IND3 BY 1 UNTIL     37630099
376400                 LA11-AQTXAVIS(WS-IND3) = (SPACES OR              37640099
376500                                            LOW-VALUES)           37650099
376600                 OR LA11-AQTPAVIS(WS-IND3) NOT = '0'              37660099
376700                                                                  37670099
376800                 ADD 1                  TO WS-CONT-LIN-EXGDPR     37680099
376900                 MOVE LA11-AQTPAVIS(WS-IND3) TO WS-AQTPAVIS-GDPR  37690099
377000                                              (WS-CONT-LIN-EXGDPR)37700099
377100                 MOVE 'ZZZZZZZZZZ'                                37710099
377200                           TO WS-AQCDPLAN-GDPR(WS-CONT-LIN-EXGDPR)37720099
377300                 MOVE LA11-AQTXAVIS(WS-IND3)                      37730099
377400                           TO WS-AQTXAVIS-GDPR(WS-CONT-LIN-EXGDPR)37740099
377500              END-PERFORM                                         37750099
377600           END-IF                                                 37760099
377700        END-EVALUATE                                              37770099
377800     ELSE                                                         37780099
377900*Continuar con bloqueo                                            37790099
378000         ADD 1                       TO WS-CONT-AV-BLOQ           37800099
378100*Machacar el valor con 'X' para no afectar al teweb               37810099
378200*JAS01-I                                                          37820099
378300         MOVE 'X'                    TO LA99-AQTPAVIS(WS-IND-COD2)37830099
378400*JAS01-F                                                          37840099
378500     END-IF                                                       37850099
378600     .                                                            37860099
378700*----------------------------------------------------------------*37870099
378800 137B-AGREGAR-GDPR.                                               37880099
378900*A¦adir los avisos que fueron excepciones al area de CAQLA99      37890099
379000*para mostrarlos como avisos informativos                         37900099
379100*----------------------------------------------------------------*37910099
379200*tracet->                       +                                 37920099
379300     IF WS-TRACE > '1'                                            37930099
379400        MOVE '137B-AGREGAR-GDPR.               ' TO WS-AQNBDTRA   37940099
379500        PERFORM 131-TRACE-TECNIC                                  37950099
379600     END-IF                                                       37960099
379700*tracet<-                                                         37970099
379800*                                                                 37980099
379900                                                                  37990099
380000     IF WS-CONT-EX-GDPR > 0                                       38000099
380100       IF LA11-AQSWCNMU-IN = 'G'                                  38010099
380200*Obtener el numero de avisos informados en el area LA99           38020099
380300*y mover 'I' a los tipos de aviso 'G', han sido excepciones       38030099
380400         PERFORM VARYING WS-IND1 FROM WS-CON-1 BY WS-CON-1        38040099
380500          UNTIL LA99-AQTPAVIS(WS-IND1) = SPACES OR                38050099
380600                LOW-VALUES                                        38060099
380700           IF LA99-AQTPAVIS(WS-IND1) = 'G'                        38070099
380800              MOVE 'I'                TO LA99-AQTPAVIS(WS-IND1)   38080099
380900           ELSE                                                   38090099
381000              IF LA99-AQTPAVIS(WS-IND1) = '0'                     38100099
381100                 MOVE '1'             TO LA99-AQTPAVIS(WS-IND1)   38110099
381200              END-IF                                              38120099
381300           END-IF                                                 38130099
381400         END-PERFORM                                              38140099
381500         MOVE WS-IND1                   TO WS-IND2                38150099
381600*Buscar que las excepciones no sean las del area LA99.            38160099
381700         SET GDPRNO-ENCONTRADO          TO TRUE                   38170099
381800         PERFORM VARYING WS-IND1    FROM WS-CON-1 BY WS-CON-1     38180099
381900           UNTIL WS-IND1 > WS-CONT-LIN-EXGDPR OR                  38190099
382000                WS-IND1 > 40 OR                                   38200099
382100                WS-AQTXAVIS-GDPR(WS-IND1) = SPACES OR LOW-VALUES  38210099
382200           IF WS-AQTPAVIS-GDPR(WS-IND1) = 'G'                     38220099
382300            PERFORM VARYING WS-IND3    FROM WS-CON-1 BY WS-CON-1  38230099
382400             UNTIL LA99-AQTPAVIS(WS-IND3) = SPACES OR LOW-VALUES  38240099
382500                  OR WS-IND3 > 40                                 38250099
382600                  OR GDPRSI-ENCONTRADO                            38260099
382700             IF WS-AQTXAVIS-GDPR(WS-IND1) = LA99-AQTXAVIS(WS-IND3)38270099
382800                 SET GDPRSI-ENCONTRADO  TO TRUE                   38280099
382900             END-IF                                               38290099
383000            END-PERFORM                                           38300099
383100*Si la excepcion que esta guardada en WS no esta en LA99, se      38310099
383200*agrega en LA99                                                   38320099
383210* OVER-I                                                          38321099
383220*           IF GDPRNO-ENCONTRADO                                  38322099
383230            IF GDPRNO-ENCONTRADO AND WS-IND2 <= 40                38323099
383240* OVER-F                                                          38324099
383400              MOVE 'I'                  TO LA99-AQTPAVIS(WS-IND2) 38340099
383500              MOVE WS-AQTXAVIS-GDPR(WS-IND1)                      38350099
383600                                        TO LA99-AQTXAVIS(WS-IND2) 38360099
383700              ADD WS-CON-1              TO WS-IND2                38370099
383800              COMPUTE WS-IND4 = WS-IND1 + 1                       38380099
383900              PERFORM VARYING WS-IND4 FROM WS-IND4 BY 1 UNTIL     38390099
384000                 WS-AQTXAVIS-GDPR(WS-IND4) = (SPACES OR           38400099
384100                                                   LOW-VALUES)    38410099
384200                 OR WS-AQTPAVIS-GDPR(WS-IND4) NOT = '0'           38420099
384300                 MOVE '1'               TO LA99-AQTPAVIS(WS-IND2) 38430099
384400                 MOVE WS-AQTXAVIS-GDPR(WS-IND4)                   38440099
384500                                        TO LA99-AQTXAVIS(WS-IND2) 38450099
384600                 ADD WS-CON-1              TO WS-IND2             38460099
384700                                                                  38470099
384800              END-PERFORM                                         38480099
384900            ELSE                                                  38490099
385000              SET GDPRNO-ENCONTRADO          TO TRUE              38500099
385100            END-IF                                                38510099
385200           END-IF                                                 38520099
385300         END-PERFORM                                              38530099
385400       ELSE                                                       38540099
385500*JAR02-I                                                          38550099
385600*         IF LA11-AQRCMAJ NOT = 'OK'                              38560099
385700          IF L310-CAQLA99 = ZEROS                                 38570099
385800*JAR02-F                                                          38580099
385900             EXEC CICS GETMAIN SET (L310-CAQLA99P)                38590099
386000             INITIMG (C-SPACES)                                   38600099
386100             NOSUSPEND                                            38610099
386200             FLENGTH (LENGTH OF AREA-CAQLA99)                     38620099
386300             END-EXEC                                             38630099
386400*                                                                 38640099
386500             MOVE 1 TO SW-AVISOS-P                                38650099
386600             MOVE L310-CAQLA99           TO W-PUNTER-COMP         38660099
386700             SET ADDRESS OF AREA-CAQLA99 TO W-PUNTER-POINTER      38670099
386800             MOVE ZEROS                  TO WS-CONT-AV-BLOQ       38680099
386900          ELSE                                                    38690099
387000             PERFORM VARYING WS-IND1 FROM 40 BY -1                38700099
387100              UNTIL LA99-AQTPAVIS(WS-IND1) NOT EQUAL SPACES AND   38710099
387200                   LOW-VALUES                                     38720099
387300             END-PERFORM                                          38730099
387400             MOVE WS-IND1                TO WS-CONT-AV-BLOQ       38740099
387500          END-IF                                                  38750099
387600          PERFORM VARYING WS-IND1    FROM WS-CON-1 BY WS-CON-1    38760099
387700            UNTIL WS-IND4 > WS-CONT-EX-GDPR OR                    38770099
387800                  WS-IND1 > 40 OR                                 38780099
387900                  WS-AQTXAVIS-GDPR(WS-IND1) = SPACES OR LOW-VALUES38790099
388000*JAR02-I                                                          38800099
388100                SET GDPRNO-ENCONTRADO           TO TRUE           38810099
388200                PERFORM VARYING WS-IND-COD2 FROM 1 BY 1           38820099
388300                    UNTIL WS-IND-COD2 > 40 OR                     38830099
388400                          WS-AQTXAVIS-GDPR(WS-IND-COD2) =         38840099
388500                          SPACES OR LOW-VALUES OR                 38850099
388600                          GDPRSI-ENCONTRADO                       38860099
388700                 IF WS-AQTXAVIS-GDPR(WS-IND1) =                   38870099
388800                    LA99-AQTXAVIS(WS-IND-COD2)                    38880099
388900                    SET GDPRSI-ENCONTRADO           TO TRUE       38890099
389000                 END-IF                                           38900099
389100                END-PERFORM                                       38910099
389210* OVER-I                                                          38921099
389211*               IF GDPRNO-ENCONTRADO                              38921199
389220                IF GDPRNO-ENCONTRADO AND WS-CONT-AV-BLOQ < 40     38922099
389230* OVER-F                                                          38923099
389300*JAR02-F                                                          38930099
389400                 EVALUATE WS-AQTPAVIS-GDPR(WS-IND1)               38940099
389500                  WHEN 'G'                                        38950099
389600                   ADD 1 TO WS-CONT-AV-BLOQ                       38960099
389700                   MOVE 'I'    TO LA99-AQTPAVIS(WS-CONT-AV-BLOQ)  38970099
389800                   MOVE WS-AQTXAVIS-GDPR(WS-IND1)                 38980099
389900                              TO LA99-AQTXAVIS(WS-CONT-AV-BLOQ)   38990099
390000                   ADD 1         TO WS-IND4                       39000099
390100                  WHEN '0'                                        39010099
390200                   ADD 1 TO WS-CONT-AV-BLOQ                       39020099
390300                                                                  39030099
390400                   MOVE '1'     TO LA99-AQTPAVIS(WS-CONT-AV-BLOQ) 39040099
390500                   MOVE WS-AQTXAVIS-GDPR(WS-IND1)                 39050099
390600                                TO LA99-AQTXAVIS(WS-CONT-AV-BLOQ) 39060099
390700                  WHEN OTHER                                      39070099
390800                   ADD 1         TO WS-IND4                       39080099
390900                 END-EVALUATE                                     39090099
391000*JAR02-I                                                          39100099
391100                END-IF                                            39110099
391200*JAR02-F                                                          39120099
391300                                                                  39130099
391400          END-PERFORM                                             39140099
391500       END-IF                                                     39150099
391600     END-IF                                                       39160099
391700     .                                                            39170099
391800*P148-F                                                           39180099
391900*                                                                 39190099
392000*----------------------------------------------------------------*39200099
392100 138-ACCESO-MOD-APLICATIVO.                                       39210099
392200*Por cada aviso que se encuentre en la TG 1051 se invocará al     39220099
392300*módulo aplicativo correspondiente, obtenido también de TG 1051   39230099
392400*para chequear si el aviso debe bloquear o no la acción y no segui39240099
392500*Los datos de entrada variarán, pudiendo ser clientes, nif o      39250099
392600*contrato, o combinación de ellos.                                39260099
392700*----------------------------------------------------------------*39270099
392800                                                                  39280099
392900*tracet->                       +                                 39290099
393000     IF WS-TRACE > '1'                                            39300099
393100        MOVE '138-ACCESO-MOD-APLICATIVO.      ' TO WS-AQNBDTRA    39310099
393200        PERFORM 131-TRACE-TECNIC                                  39320099
393300     END-IF                                                       39330099
393400*tracet<-                                                         39340099
393500                                                                  39350099
393600*    Chequear que van informados:                                 39360099
393700     INITIALIZE AREA-CAQLAEB                                      39370099
393800     SET LAEB-VERIFICAR-EXC-BLOQUEO   TO TRUE                     39380099
393900*                                                                 39390099
394000*P1006->                                                          39400099
394100*MLV-ABL->                                                        39410099
394200*****MOVE LA11-AQCDPLAN-OUT(W-MENS-A11)                           39420099
394300*    MOVE LA11-AQCDPLAN-OUT(WS-IND-COD)                           39430099
394400*                                     TO LAEB-AQCDAVIS            39440099
394500*                                                                 39450099
394600     MOVE LA11-AQCDAVIS (W-MENS-A11) TO LAEB-AQCDAVIS             39460099
394700*                                                                 39470099
394800*MLV-ABL<-                                                        39480099
394900*P1006<-                                                          39490099
395000*                                                                 39500099
395100     MOVE L100-AQ1TRANT               TO LAEB-AQCDTRAN            39510099
395200     MOVE L121-AQCDCANA               TO LAEB-AQCDCANA            39520099
395300     MOVE L100-AQTIPCON               TO LAEB-AQTIPCON            39530099
395400*LCO01a->                                                         39540099
395500     MOVE L100-AQ1MPRTI               TO LAEB-AQPTMAPA            39550099
395600*LCO01a<-                                                         39560099
395700*LCO01b->                                                         39570099
395800     SET W-PUNTER-POINTER             TO ADDRESS OF L100-SCR      39580099
395900     MOVE W-PUNTER-COMP               TO LAEB-AQPTSCR             39590099
396000*LCO01b<-                                                         39600099
396100     MOVE L135-STENTIDA               TO LAEB-AQCDENTC            39610099
396200     MOVE L135-STOFI                  TO LAEB-AQCDOFIC            39620099
396300     MOVE L135-XECDIGIT               TO LAEB-AQCDCDGC            39630099
396400     MOVE L135-STNUCTA                TO LAEB-AQNUCTAC            39640099
396500     IF L135-AQSWAVCL = 'S'                                       39650099
396600        MOVE L135-AQNUCLIE            TO LA11-AQCTCLIE-IN         39660099
396700*MULTI020-I                                                       39670099
396800        MOVE 1 TO WS-IND5                                         39680099
396900*MULTI020-I                                                       39690099
397000        IF LA11-AQCTCLIE-IN > 0                                   39700099
397100           PERFORM VARYING WS-IND1 FROM 1 BY 1 UNTIL              39710099
397200                           WS-IND1 > LA11-AQCTCLIE-IN OR          39720099
397300                           WS-IND1 > 20                           39730099
397400*MULTI020-I                                                       39740099
397500*         Por motivos históricos, hay transacciones que tienen el 39750099
397600*         concepto '020' o '033' definidos en la ICP 'AQ001' en   39760099
397700*         lugar de la 'AQ009'.                                    39770099
397800*              MOVE L135-STCDCLIE(WS-IND1)                        39780099
397900*                                    TO LAEB-AQCDCLIE-IN(WS-IND1) 39790099
398000*              MOVE L135-STCDTNIF(WS-IND1)                        39800099
398100*                                    TO LAEB-AQTPDOCU-IN(WS-IND1) 39810099
398200*              MOVE L135-STCDNNIF(WS-IND1)                        39820099
398300*                                    TO LAEB-AQNUDOCC-IN(WS-IND1) 39830099
398400*              MOVE L135-STCDKNIF(WS-IND1)                        39840099
398500*                                    TO LAEB-AQCDLETR-IN(WS-IND1) 39850099
398600*              MOVE L135-AQNUSNIF(WS-IND1)                        39860099
398700*                                    TO LAEB-AQCDSECU-IN(WS-IND1) 39870099
398800               IF L135-AQSRCICP1(WS-IND1) = 'AQ001' OR 'AQ009'    39880099
398900                  MOVE L135-STCDCLIE(WS-IND1)                     39890099
399000                                      TO LA11-AQCDCLIE-IN(WS-IND5)39900099
399100                  MOVE L135-STCDTNIF(WS-IND1)                     39910099
399200                                      TO LA11-AQTPDOCU-IN(WS-IND5)39920099
399300                  MOVE L135-STCDNNIF(WS-IND1)                     39930099
399400                                      TO LA11-AQNUDOCC-IN(WS-IND5)39940099
399500                  MOVE L135-STCDKNIF(WS-IND1)                     39950099
399600                                      TO LA11-AQCDLETR-IN(WS-IND5)39960099
399700                  MOVE L135-AQNUSNIF(WS-IND1)                     39970099
399800                                      TO LA11-AQCDSECU-IN(WS-IND5)39980099
399900                  ADD 1 TO WS-IND5                                39990099
400000               END-IF                                             40000099
400100*MULTI020-E                                                       40010099
400200           END-PERFORM                                            40020099
400300        END-IF                                                    40030099
400400     END-IF                                                       40040099
400500                                                                  40050099
400600     EXEC CICS                                                    40060099
400700          LINK PROGRAM  (WS-MOD-EXBLOQ) RESP (COD-RESP)           40070099
400800          COMMAREA (AREA-CAQLAEB)                                 40080099
400900          LENGTH   (LENGTH OF AREA-CAQLAEB)                       40090099
401000     END-EXEC                                                     40100099
401100                                                                  40110099
401200     IF COD-RESP NOT = DFHRESP(NORMAL)                            40120099
401300*LCO01a->                                                         40130099
401400        ADD  1                     TO WS-CONT-AV-BLOQ             40140099
401500*LCO01a<-                                                         40150099
401600*    No abendamos el proceso, solo se informa el log              40160099
401700        MOVE COD-RESP              TO WS-RESP                     40170099
401800*                                                                 40180099
401900        INITIALIZE L145-CAQL145                                   40190099
402000        MOVE 'AQ'                  TO L145-AQ19APLI               40200099
402100        MOVE 'RAQW001'             TO L145-AQPROGRA               40210099
402200        MOVE 'F'                   TO L145-AQCODOPE               40220099
402300*FixLogExBloq-I                                                   40230099
402400*       MOVE L085-AQTXME77         TO L145-AQMSGTXT               40240099
402500*       STRING 'ERROR1 EN LLAMADA A MODULO: ' WS-MOD-EXBLOQ       40250099
402600*              ' RETORNO: ' WS-RESP  DELIMITED BY SIZE INTO       40260099
402700*              L145-AQMESTXT                                      40270099
402800*       END-STRING                                                40280099
402900        STRING 'ERROR1 EN LLAMADA A MODULO: ' WS-MOD-EXBLOQ       40290099
403000               ' RETORNO: ' WS-RESP  DELIMITED BY SIZE INTO       40300099
403100               L145-AQMSGTXT                                      40310099
403200*FixLogExBloq-E                                                   40320099
403300        PERFORM 048-GRABAR-LOG                                    40330099
403400     END-IF                                                       40340099
403500*                                                                 40350099
403600     IF LAEB-CORRECTO                                             40360099
403700        IF LAEB-CONTINUA-BLOQUEO                                  40370099
403800*          continua el bloqueo                                    40380099
403900           ADD  1                TO WS-CONT-AV-BLOQ               40390099
404000        ELSE                                                      40400099
404100*          se levanta el bloqueo para este mensaje                40410099
404200           MOVE LAEB-AQSWEXBL    TO LA99-AQEXBLOQ(W-MENS-A11)     40420099
404300           ADD  1                TO WS-CONT-EX-BLOQ               40430099
404400*P1006->                                                          40440099
404500*MLV-ABL->                                                        40450099
404600***********MOVE LA11-AQCDPLAN-OUT(W-MENS-A11)                     40460099
404700*          MOVE LA11-AQCDPLAN-OUT(WS-IND-COD)                     40470099
404800*MLV-ABL<-                                                        40480099
404900           MOVE LA11-AQCDAVIS(W-MENS-A11)                         40490099
405000                                    TO W-AQCDAVIS(WS-CONT-EX-BLOQ)40500099
405100*P1006->                                                          40510099
405200        END-IF                                                    40520099
405300     ELSE                                                         40530099
405400*       No cancelamos proceso, solo informamos el log             40540099
405500*LCO01a->                                                         40550099
405600        ADD  1                     TO WS-CONT-AV-BLOQ             40560099
405700*LCO01a<-                                                         40570099
405800        INITIALIZE L145-CAQL145                                   40580099
405900        MOVE 'AQ'                  TO L145-AQ19APLI               40590099
406000        MOVE 'RAQW001'             TO L145-AQPROGRA               40600099
406100        MOVE 'F'                   TO L145-AQCODOPE               40610099
406200*FixLogExBloq-I                                                   40620099
406300*       MOVE L085-AQTXME77         TO L145-AQMSGTXT               40630099
406400*       STRING 'ERROR2 EN LLAMADA A MODULO: ' WS-MOD-EXBLOQ       40640099
406500*              ' RETORNO: ' LAEB-AQRCMAJ DELIMITED BY SIZE INTO   40650099
406600*              L145-AQMESTXT                                      40660099
406700*       END-STRING                                                40670099
406800        STRING WS-MOD-EXBLOQ DELIMITED BY SPACES                  40680099
406900               ' Transaction is not exempt of blocking warning?'  40690099
407000               DELIMITED BY SIZE                                  40700099
407100           INTO L145-AQMSGTXT                                     40710099
407200        IF W-PTR-CAQL155 NOT = 0                                  40720099
407300           STRING 'ERROR2 EN LLAMADA A MODULO: ' WS-MOD-EXBLOQ    40730099
407400                  ' RETORNO: ' LAEB-AQRCMAJ DELIMITED BY SIZE     40740099
407500              INTO L155-AQMESTXT                                  40750099
407600        ELSE                                                      40760099
407700           STRING 'ERROR2 EN LLAMADA A MODULO: ' WS-MOD-EXBLOQ    40770099
407800                  ' RETORNO: ' LAEB-AQRCMAJ DELIMITED BY SIZE     40780099
407900              INTO L145-AQMESTXT                                  40790099
408000        END-IF                                                    40800099
408100*FixLogExBloq-E                                                   40810099
408200        PERFORM 048-GRABAR-LOG                                    40820099
408300     END-IF                                                       40830099
408400     .                                                            40840099
408500*LCO01.F                                                          40850099
408600*p101a->                                                          40860099
408700*----------------------------------------------------------------*40870099
408800*    Si está el puesto en piloto se activa el indicador          *40880099
408900*----------------------------------------------------------------*40890099
409000 139A-AUTORIZ-X-TERMINAL.                                         40900099
409100*-----------------------                                          40910099
409200*tracet->                       +                                 40920099
409300     IF WS-TRACE > '1'                                            40930099
409400        MOVE '139A-AUTORIZ-X-TERMINAL         ' TO WS-AQNBDTRA    40940099
409500        PERFORM 131-TRACE-TECNIC                                  40950099
409600     END-IF                                                       40960099
409700*tracet<-                                                         40970099
409800     IF F060-AQTPPTO = 'OS22'                                     40980099
409900                    OR 'THC2'                                     40990099
410000                    OR 'XP2'                                      41000099
410100                    OR 'XPT2'                                     41010099
410200                    OR 'THT2'                                     41020099
410300                    OR 'OSA2'                                     41030099
410400                    OR 'XPA2'                                     41040099
410500        SET L100-AUTH-SERV-SI TO TRUE                             41050099
410600     ELSE                                                         41060099
410700        SET L100-AUTH-SERV-NO TO TRUE                             41070099
410800     END-IF                                                       41080099
410900     .                                                            41090099
411000*p101a<-                                                          41100099
411100*p122->                                                           41110099
411200*----------------------------------------------------------------*41120099
411300*    Si está el puesto en piloto se activa el indicador          *41130099
411400*----------------------------------------------------------------*41140099
411500 139B-AUTORIZ-X-TERMINAL.                                         41150099
411600*-----------------------                                          41160099
411700*tracet->                       +                                 41170099
411800     IF WS-TRACE > '1'                                            41180099
411900        MOVE '139B-AUTORIZ-X-TERMINAL         ' TO WS-AQNBDTRA    41190099
412000        PERFORM 131-TRACE-TECNIC                                  41200099
412100     END-IF                                                       41210099
412200*tracet<-                                                         41220099
412300     IF F060-AQTPPTO = 'OS22'                                     41230099
412400                    OR 'THC2'                                     41240099
412500                    OR 'XP2'                                      41250099
412600                    OR 'XPT2'                                     41260099
412700                    OR 'THT2'                                     41270099
412800                    OR 'OSA2'                                     41280099
412900                    OR 'XPA2'                                     41290099
413000        SET L100-AUTH-PLAT-FIRM-SI TO TRUE                        41300099
413100     ELSE                                                         41310099
413200        SET L100-AUTH-PLAT-FIRM-NO TO TRUE                        41320099
413300     END-IF                                                       41330099
413400     .                                                            41340099
413500*p122<-                                                           41350099
413600*p101a<-                                                          41360099
413700*p115->                                                           41370099
413800*----------------------------------------------------------------*41380099
413900*    En caso de opciones '3' y '4' se busca en la tabla qué tran-*41390099
414000*    sacción quiere ejecutar y se busca para ver si existe y su  *41400099
414100*    estado. Tabla: TG1103                                       *41410099
414200*----------------------------------------------------------------*41420099
414300 140A-AUTORIZ-X-TRANSACC.                                         41430099
414400*-----------------------                                          41440099
414500*tracet->                       +                                 41450099
414600     IF WS-TRACE > '1'                                            41460099
414700        MOVE '140A-AUTORIZ-X-TRANSACC         ' TO WS-AQNBDTRA    41470099
414800        STRING                                                    41480099
414900           'Trans:' L100-AQ1TRANT '/ Trax.en mapa: '              41490099
415000            AREA-MAPA-REAL(82:04)                                 41500099
415100            DELIMITED BY SIZE INTO WS-AQINFORM                    41510099
415200        END-STRING                                                41520099
415300        PERFORM 131-TRACE-TECNIC                                  41530099
415400     END-IF                                                       41540099
415500*tracet<-                                                         41550099
415600     IF L100-AQ1TRANT = 'BT21'                                    41560099
415700*       Tratamiento especial para BT21.                           41570099
415800*       Direccionamos el mapa para obtener nombre de transacción  41580099
415900*       a la que se desea acceder                                 41590099
416000        MOVE L100-AQ1MPRTI               TO W-PUNTER-COMP         41600099
416100        SET ADDRESS OF AREA-MAPA-REAL    TO W-PUNTER-POINTER      41610099
416200*       En la posición 82:4 está el nombre de la transacción      41620099
416300        MOVE AREA-MAPA-REAL(82:04)       TO W-TRANP115            41630099
416400                                                                  41640099
416500*       Se prepara el acceso a Tabla para ver estado TRANSACCION  41650099
416600        INITIALIZE CTGL000                                        41660099
416700        MOVE '0019'                         TO CTGL000-STBANCO    41670099
416800        MOVE '1103'                         TO CTGL000-CDTABLA    41680099
416900                                                                  41690099
417000*       Componer clave de acceso a tabla: TRAN + PRODUCTO         41700099
417100*       El PRODUCTO se obtiene de la sesión eCDL                  41710099
417200        MOVE LE00-AQIDPROD                  TO W-PRODP115         41720099
417300        MOVE W-CLAU-P115                    TO CTGL000-CLAVTAB    41730099
417400        MOVE 001                            TO CTGL000-NUCLAVE    41740099
417500                                                                  41750099
417600        PERFORM 046-INVOCAR-RTGU000                               41760099
417700                                                                  41770099
417800        IF CTGL000-CDRETORN = '00'                                41780099
417900           MOVE CTGL000-CONTOCUR(1:2)       TO W-ESTAT-P115       41790099
418000           EVALUATE TRUE                                          41800099
418100              WHEN W-TRX-ACTIVA                                   41810099
418200                 SET L100-AUTH-SERV-SI      TO TRUE               41820099
418300              WHEN W-TRX-INACTIVA                                 41830099
418400                 SET L100-AUTH-SERV-NO      TO TRUE               41840099
418500           END-EVALUATE                                           41850099
418600        ELSE                                                      41860099
418700*          Clave específica no existe.                            41870099
418800           EVALUATE LE00-AQMDAUTH                                 41880099
418900*             Si es '3' y no existe, no debe autorizarse          41890099
419000              WHEN '3'                                            41900099
419100                 SET L100-AUTH-SERV-NO   TO TRUE                  41910099
419200*             Si es '4' y no existe, no hay restricciones         41920099
419300              WHEN '4'                                            41930099
419400                 SET L100-AUTH-SERV-SI   TO TRUE                  41940099
419500           END-EVALUATE                                           41950099
419600        END-IF                                                    41960099
419700     END-IF                                                       41970099
419800     .                                                            41980099
419900*p115<-                                                           41990099
420000*                                                                 42000099
420100*p122->                                                           42010099
420200*----------------------------------------------------------------*42020099
420300*    En caso de opciones '3' y '4' se busca en la tabla qué tran-*42030099
420400*    sacción quiere ejecutar y se busca para ver si existe y su  *42040099
420500*    estado. Tabla: TG1103                                       *42050099
420600*----------------------------------------------------------------*42060099
420700 140B-AUTORIZ-X-TRANSACC.                                         42070099
420800*-----------------------                                          42080099
420900*tracet->                       +                                 42090099
421000     IF WS-TRACE > '1'                                            42100099
421100        MOVE '140B-AUTORIZ-X-TRANSACC         ' TO WS-AQNBDTRA    42110099
421200        PERFORM 131-TRACE-TECNIC                                  42120099
421300     END-IF                                                       42130099
421400*tracet<-                                                         42140099
421500     IF L100-AQ1TRANT = 'BT21'                                    42150099
421600*       Tratamiento especial para BT21.                           42160099
421700*       Direccionamos el mapa para obtener nombre de transacción  42170099
421800*       a la que se desea acceder                                 42180099
421900        MOVE L100-AQ1MPRTI               TO W-PUNTER-COMP         42190099
422000        SET ADDRESS OF AREA-MAPA-REAL    TO W-PUNTER-POINTER      42200099
422100*       En la posición 82:4 está el nombre de la transacción      42210099
422200        MOVE AREA-MAPA-REAL(82:04)       TO W-TRANP115            42220099
422300                                                                  42230099
422400*       Se prepara el acceso a Tabla para ver estado TRANSACCION  42240099
422500        INITIALIZE CTGL000                                        42250099
422600        MOVE '0019'                         TO CTGL000-STBANCO    42260099
422700        MOVE '1103'                         TO CTGL000-CDTABLA    42270099
422800                                                                  42280099
422900*       Componer clave de acceso a tabla: TRAN + PRODUCTO         42290099
423000*       El PRODUCTO se obtiene de la sesión eCDL                  42300099
423100        MOVE LE00-AQIDPROD                  TO W-PRODP115         42310099
423200        MOVE W-CLAU-P115                    TO CTGL000-CLAVTAB    42320099
423300        MOVE 001                            TO CTGL000-NUCLAVE    42330099
423400                                                                  42340099
423500        PERFORM 046-INVOCAR-RTGU000                               42350099
423600                                                                  42360099
423700        IF CTGL000-CDRETORN = '00'                                42370099
423800           MOVE CTGL000-CONTOCUR(1:2)       TO W-ESTAT-P115       42380099
423900           EVALUATE TRUE                                          42390099
424000              WHEN W-TRX-ACTIVA                                   42400099
424100                 SET L100-AUTH-PLAT-FIRM-SI TO TRUE               42410099
424200              WHEN W-TRX-INACTIVA                                 42420099
424300                 SET L100-AUTH-PLAT-FIRM-NO TO TRUE               42430099
424400           END-EVALUATE                                           42440099
424500        ELSE                                                      42450099
424600*          Clave específica no existe.                            42460099
424700           EVALUATE LE00-AQSWFIEV                                 42470099
424800*             Si es '3' y no existe, no debe autorizarse          42480099
424900              WHEN '3'                                            42490099
425000                 SET L100-AUTH-PLAT-FIRM-NO TO TRUE               42500099
425100*             Si es '4' y no existe, no hay restricciones         42510099
425200              WHEN '4'                                            42520099
425300                 SET L100-AUTH-PLAT-FIRM-SI TO TRUE               42530099
425400           END-EVALUATE                                           42540099
425500        END-IF                                                    42550099
425600     END-IF                                                       42560099
425700     .                                                            42570099
425800*                                                                 42580099
425900*----------------------------------------------------------------*42590099
426000*    En caso de Autorización, se guardarán datos de la operación *42600099
426100*    en la tabla 'nevera' TAQS2, por si se difiere               *42610099
426200*    Para ello se invocará el módulo RAQWS14                     *42620099
426300*----------------------------------------------------------------*42630099
426400 141-GUARDAR-OPERACIO.                                            42640099
426500*-----------------------                                          42650099
426600*tracet->                       +                                 42660099
426700     IF WS-TRACE > '1'                                            42670099
426800        MOVE '141-GUARDAR-OPERACIO              ' TO WS-AQNBDTRA  42680099
426900        PERFORM 131-TRACE-TECNIC                                  42690099
427000     END-IF                                                       42700099
427100*tracet<-                                                         42710099
427200     MOVE 'GR'                         TO LS14-AQOPCION           42720099
427300                                                                  42730099
427400*    Informar la dirección del área de Autorizaciones             42740099
427500     MOVE L101-AQPTAUTH                TO LS14-AQPTAUTH           42750099
427600                                                                  42760099
427700*    Informar la dirección del área SCR + SPAD                    42770099
427800     MOVE L000-AQPTSCRC                TO LS14-AQPTSCRC           42780099
427900                                                                  42790099
428000*    Informar la dirección del área FDF                           42800099
428100     MOVE L000-AQPTFDFC                TO LS14-AQPTFDFC           42810099
428200                                                                  42820099
428300*    Informar longitud datos del mapa (menos cabecera¨)           42830099
428400***  MOVE 1920                         TO LS14-AQLONMAP           42840099
428500*???->                                                            42850099
428600     MOVE L100-AQLONALT                TO LS14-AQLONMAP           42860099
428700*???<-                                                            42870099
428800                                                                  42880099
428900     MOVE L100-AQ1MPRTI                TO LS14-AQPTMAPC           42890099
429000                                                                  42900099
429100     EXEC CICS                                                    42910099
429200          LINK PROGRAM  ('RAQWS14') RESP (COD-RESP)               42920099
429300          COMMAREA (AREA-RAQWS14)                                 42930099
429400          LENGTH   (LENGTH OF AREA-RAQWS14)                       42940099
429500     END-EXEC                                                     42950099
429600                                                                  42960099
429700     IF COD-RESP NOT = DFHRESP(NORMAL)                            42970099
429800        PERFORM 033-INFORMAR-DATOS-ABEND                          42980099
429900     END-IF                                                       42990099
430000                                                                  43000099
430100     EVALUATE LS14-AQCDRESP                                       43010099
430200        WHEN 'OK'                                                 43020099
430300           CONTINUE                                               43030099
430400        WHEN OTHER                                                43040099
430500           MOVE 'JGTB143'         TO L100-AQ1ABNCD                43050099
430600           MOVE 'RAQWS14'         TO L045-AQTXMENS (1)            43060099
430700           MOVE  LS14-AQCDRESP    TO L045-AQTXMENS (2)(1:2)       43070099
430800           MOVE  '/'              TO L045-AQTXMENS (2)(3:1)       43080099
430900           MOVE  LS14-AQCDRES2    TO L045-AQTXMENS (2)(4:2)       43090099
431000           SET SW-ABEND-ARQUITECTURAL TO TRUE                     43100099
431100           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 43110099
431200           PERFORM 099-ABEND-PROC                                 43120099
431300     END-EVALUATE                                                 43130099
431400     .                                                            43140099
431500*p122<-                                                           43150099
431600                                                                  43160099
431700*jfm06->                                                          43170099
431800*----------------------------------------------------------------*43180099
431900*    Control para evitar que si navegan atras vis 'back', la     *43190099
432000*    transacción que se lance, tenga coherencia                  *43200099
432100*----------------------------------------------------------------*43210099
432200 142-CONTROL-NAVEGADOR-ATRAS.                                     43220099
432300*----------------------------                                     43230099
432400*    direccionar área eCDL.                                       43240099
432500     SET ADDRESS OF LE00-CAQLE00   TO L000-AQPTSESP               43250099
432600*tracet->                       +                                 43260099
432700     IF WS-TRACE > '0'                                            43270099
432800        MOVE '142-CONTROL-NAVEGADOR-ATRAS.    ' TO WS-AQNBDTRA    43280099
432900        STRING                                                    43290099
433000           'swAtras:' LE00-AQSWPGAT '/'                           43300099
433100            DELIMITED BY SPACES INTO WS-AQINFORM                  43310099
433200        END-STRING                                                43320099
433300        PERFORM 131-TRACE-TECNIC                                  43330099
433400     END-IF                                                       43340099
433500*tracet<-                                                         43350099
433600                                                                  43360099
433700*    Si switch Pagina Atrás activado se abenda, ya que significa  43370099
433800*    que ha llegado aquí sin que la opcion sea 'INIT' ni 'MBT21'  43380099
433900*    Si Trace activo no abendamos para que quede constancia       43390099
434000     IF LE00-AQSWPGAT = 'S'                                       43400099
434100*tracet->                       +                                 43410099
434200        IF WS-TRACE > '0'                                         43420099
434300           MOVE '022- A B E N D secuencia' TO WS-AQNBDTRA         43430099
434400           PERFORM 131-TRACE-TECNIC                               43440099
434500        ELSE                                                      43450099
434600           MOVE 'JAQB095'             TO L100-AQ1ABNCD            43460099
434700           SET SW-ABEND-ARQUITECTURAL TO TRUE                     43470099
434800           PERFORM 099-ABEND-PROC                                 43480099
434900        END-IF                                                    43490099
435000     END-IF                                                       43500099
435100*tracet<-                                                         43510099
435200     .                                                            43520099
435300*jfm06<-                                                          43530099
435400                                                                  43540099
435500*P122->                                                           43550099
435600*----------------------------------------------------------------*43560099
435700*    Acceder a Area de Autorizaciones para verificar si alguna   *43570099
435800*    de ellas es de tipo 'PFD'                                   *43580099
435900*----------------------------------------------------------------*43590099
436000 143-VERIFICAR-PFD.                                               43600099
436100*----------------------------                                     43610099
436200*    direccionar área de Autorizaciones                           43620099
436300     SET ADDRESS OF LS98-CAQLS98   TO L101-AQPTAUTP               43630099
436400*tracet->                       +                                 43640099
436500     IF WS-TRACE > '0'                                            43650099
436600        MOVE '143-VERIFICAR-PFD.              ' TO WS-AQNBDTRA    43660099
436700        PERFORM 131-TRACE-TECNIC                                  43670099
436800     END-IF                                                       43680099
436900*tracet<-                                                         43690099
437000                                                                  43700099
437100*    Buscar en el área de Autorizaciones a ver si existe algúna   43710099
437200*    de tipo 'PFD'                                                43720099
437300     PERFORM VARYING W-I5 FROM 1 BY 1 UNTIL                       43730099
437400             W-I5 > LS98-AQNUAUTH     OR                          43740099
437500             LS98-AQTIPAUT(W-I5) = 'PFD'                          43750099
437600     END-PERFORM                                                  43760099
437700                                                                  43770099
437800     IF LS98-AQTIPAUT(W-I5) = 'PFD'                               43780099
437900        SET W-PFD-SI       TO TRUE                                43790099
438000     ELSE                                                         43800099
438100        SET W-PFD-NO       TO TRUE                                43810099
438200     END-IF                                                       43820099
438300     .                                                            43830099
438400*P122<--                                                          43840099
438500*P133->                                                           43850099
438600*----------------------------------------------------------------*43860099
438700 144-CENTROEXP-PFD.                                               43870099
438800*----------------------------                                     43880099
438900*Se accede a TG 1248 para verificar si los centros y transacciones43890099
439000*si permiten la firma digital                                     43900099
439100*----------------------------------------------------------------*43910099
439200                                                                  43920099
439300*tracet->                       +                                 43930099
439400     IF WS-TRACE > '1'                                            43940099
439500        MOVE '144-CENTROEXP-PFD.     ' TO WS-AQNBDTRA             43950099
439600        PERFORM 131-TRACE-TECNIC                                  43960099
439700     END-IF                                                       43970099
439800*tracet<-                                                         43980099
439900                                                                  43990099
440000     INITIALIZE CTGL000                                           44000099
440100     MOVE '0019'                       TO CTGL000-STBANCO         44010099
440200     MOVE '1248'                       TO CTGL000-CDTABLA         44020099
440300                                                                  44030099
440400     PERFORM 144A-CENTROEXP-PFD                                   44040099
440500     .                                                            44050099
440600                                                                  44060099
440700*----------------------------------------------------------------*44070099
440800 144A-CENTROEXP-PFD.                                              44080099
440900*----------------------------                                     44090099
441000*Primero se accede a la TG 1248 para validar si existe algún      44100099
441100*bloqueo para Firma Digital para la transacción en curso,         44110099
441200*independiente de la Oficina (****). Si no encuentra, se busca por44120099
441300*la transacción en curso para a Oficina en curso (L100-AQ1OFIOP). 44130099
441400*----------------------------------------------------------------*44140099
441500                                                                  44150099
441600*JAR01-I                                                          44160099
441700*    STRING L100-AQ1BANOP                                         44170099
441800     STRING L100-AQCDENTU                                         44180099
441900*JAR01-F                                                          44190099
442000            '/'                                                   44200099
442100            '****'                                                44210099
442200     DELIMITED BY SPACES               INTO CTGL000-CLAVTAB       44220099
442300                                                                  44230099
442400     MOVE 1                              TO CTGL000-NUCLAVE       44240099
442500                                                                  44250099
442600     PERFORM 046-INVOCAR-RTGU000                                  44260099
442700                                                                  44270099
442800     EVALUATE WS-CDRETORN                                         44280099
442900       WHEN '00'                                                  44290099
443000*P133a-I                                                          44300099
443100          SET L100-AUTH-PLAT-FIRM-NO     TO TRUE                  44310099
443200*         MOVE CTGL000-CONTOCUR          TO CTGT1248-DATOS        44320099
443300*         PERFORM 145-CONFIRMAR-TRANSACCION                       44330099
443400*P133a-F                                                          44340099
443500                                                                  44350099
443600       WHEN '10'                                                  44360099
443700          PERFORM 144B-CENTROEXP-PFD                              44370099
443800                                                                  44380099
443900       WHEN OTHER                                                 44390099
444000          SET L100-AUTH-PLAT-FIRM-SI     TO TRUE                  44400099
444100     END-EVALUATE                                                 44410099
444200     .                                                            44420099
444300                                                                  44430099
444400*----------------------------------------------------------------*44440099
444500 144B-CENTROEXP-PFD.                                              44450099
444600*----------------------------                                     44460099
444700*Accede a la TG 1248 para validar si existe algún bloqueo para    44470099
444800*Firma Digital para la transacción en curso y para la Oficina en  44480099
444900*(L100-AQ1OFIOP).                                                 44490099
445000*----------------------------------------------------------------*44500099
445100                                                                  44510099
445200*JAR01-I                                                          44520099
445300*    STRING L100-AQ1BANOP                                         44530099
445400*           '/'                                                   44540099
445500*           L100-AQ1OFIOP                                         44550099
445600     STRING L100-AQCDENTU                                         44560099
445700            '/'                                                   44570099
445800            L100-AQCDCENU                                         44580099
445900*JAR01-F                                                          44590099
446000     DELIMITED BY SPACES               INTO CTGL000-CLAVTAB       44600099
446100                                                                  44610099
446200     MOVE 1                              TO CTGL000-NUCLAVE       44620099
446300                                                                  44630099
446400     PERFORM 046-INVOCAR-RTGU000                                  44640099
446500                                                                  44650099
446600     EVALUATE CTGL000-CDRETORN                                    44660099
446700       WHEN '00'                                                  44670099
446800          MOVE CTGL000-CONTOCUR          TO CTGT1248-DATOS        44680099
446900          PERFORM 145B-CONFIRMAR-TRANSACCION                      44690099
447000                                                                  44700099
447100       WHEN OTHER                                                 44710099
447200          SET L100-AUTH-PLAT-FIRM-SI     TO TRUE                  44720099
447300     END-EVALUATE                                                 44730099
447400     .                                                            44740099
447500                                                                  44750099
447600*P133a-I                                                          44760099
447700*----------------------------------------------------------------*44770099
447800*145-CONFIRMAR-TRANSACCION.                                       44780099
447900*----------------------------                                     44790099
448000* Inependiente de la Oficina, busca la transacción en curso en la 44800099
448100* TG 1248. Si encontrar, deactivar permiso para Firma Digital.    44810099
448200*----------------------------------------------------------------*44820099
448300*    MOVE ZEROES                TO WS-IDX-TRANS                   44830099
448400                                                                  44840099
448500*    PERFORM VARYING WS-IDX-TRANS FROM 1 BY 1                     44850099
448600*       UNTIL L100-AQ1TRANT = CTGT1248-TGTRANS(WS-IDX-TRANS)      44860099
448700*       OR CTGT1248-TGTRANS(WS-IDX-TRANS) = SPACES OR LOW-VALUES  44870099
448800*    END-PERFORM                                                  44880099
448900                                                                  44890099
449000*    IF L100-AQ1TRANT = CTGT1248-TGTRANS(WS-IDX-TRANS)            44900099
449100*       SET L100-AUTH-PLAT-FIRM-NO       TO TRUE                  44910099
449200*    ELSE                                                         44920099
449300*       SET L100-AUTH-PLAT-FIRM-SI       TO TRUE                  44930099
449400*    END-IF                                                       44940099
449500*    .                                                            44950099
449600*P133a-F                                                          44960099
449700                                                                  44970099
449800*----------------------------------------------------------------*44980099
449900 145B-CONFIRMAR-TRANSACCION.                                      44990099
450000*----------------------------                                     45000099
450100* Comparar L100-AQ1APLIC con las transacionnes en TG 1248 que     45010099
450200* tiene ** en el final. Si coincide, deactivar permiso para Firma 45020099
450300* Digital. Si no encuentra, buscar por L100-AQ1TRANT y deactivar  45030099
450400* si encuentrar.                                                  45040099
450500*----------------------------------------------------------------*45050099
450600     MOVE ZEROES                         TO WS-IDX-TRANS          45060099
450700                                                                  45070099
450800     SET SW-TG1248-NO-ENCONTRADO         TO TRUE                  45080099
450900                                                                  45090099
451000     PERFORM VARYING WS-IDX-TRANS FROM 1 BY 1                     45100099
451100     UNTIL SW-TG1248-SI-ENCONTRADO OR                             45110099
451200     CTGT1248-TGTRANS(WS-IDX-TRANS) = SPACES OR LOW-VALUES        45120099
451300*p133a-I                                                          45130099
451400        IF CTGT1248-TGTRANS(WS-IDX-TRANS)(1:4) = '****'           45140099
451500              SET SW-TG1248-SI-ENCONTRADO       TO TRUE           45150099
451600              SET L100-AUTH-PLAT-FIRM-NO TO TRUE                  45160099
451700        ELSE                                                      45170099
451800*p133a-F                                                          45180099
451900          IF CTGT1248-TGTRANS(WS-IDX-TRANS)(3:2) = '**'           45190099
452000           IF L100-AQ1APLIC = CTGT1248-TGTRANS(WS-IDX-TRANS)(1:2) 45200099
452100              SET SW-TG1248-SI-ENCONTRADO       TO TRUE           45210099
452200              SET L100-AUTH-PLAT-FIRM-NO TO TRUE                  45220099
452300           END-IF                                                 45230099
452400          END-IF                                                  45240099
452500*p133a-I                                                          45250099
452600        END-IF                                                    45260099
452700*p133a-I                                                          45270099
452800     END-PERFORM                                                  45280099
452900                                                                  45290099
453000     IF SW-TG1248-NO-ENCONTRADO                                   45300099
453100        MOVE ZEROES                         TO WS-IDX-TRANS       45310099
453200                                                                  45320099
453300        PERFORM VARYING WS-IDX-TRANS FROM 1 BY 1                  45330099
453400        UNTIL L100-AQ1TRANT = CTGT1248-TGTRANS(WS-IDX-TRANS)      45340099
453500        OR CTGT1248-TGTRANS(WS-IDX-TRANS) = SPACES OR LOW-VALUES  45350099
453600        END-PERFORM                                               45360099
453700                                                                  45370099
453800        IF L100-AQ1TRANT = CTGT1248-TGTRANS(WS-IDX-TRANS)         45380099
453900           SET L100-AUTH-PLAT-FIRM-NO       TO TRUE               45390099
454000        ELSE                                                      45400099
454100           SET L100-AUTH-PLAT-FIRM-SI       TO TRUE               45410099
454200        END-IF                                                    45420099
454300     END-IF                                                       45430099
454400     .                                                            45440099
454500*P133<-                                                           45450099
454600                                                                  45460099
454700*MACRO-I                                                          45470099
454800*----------------------------------------------------------------*45480099
454900 CHECK-TECH-USER.                                                 45490099
455000*----------------------------                                     45500099
455100*                                                                 45510099
455200*    GETMAIN for RSLFUS1 DFHCOMMAREA                              45520099
455300     EXEC CICS GETMAIN SET (ADDRESS OF RSLFUS1-COMMAREA)          45530099
455400          FLENGTH (LENGTH OF RSLFUS1-COMMAREA)                    45540099
455500          INITIMG (CON-LOW-VALUES) NOSUSPEND                      45550099
455600     END-EXEC                                                     45560099
455700     IF EIBRESP NOT = DFHRESP(NORMAL)                             45570099
455800        PERFORM 033-INFORMAR-DATOS-ABEND                          45580099
455810     END-IF                                                       45581099
455820*                                                                 45582099
455830*    Retrieve user's RACF groups                                  45583099
455840     INITIALIZE RSLFUS1-COMMAREA                                  45584099
455850     MOVE 'CG' TO CSLFUS1-OPE                                     45585099
455860     MOVE W-USERID TO CSLFUS1-CGRP-USER                           45586099
455870     PERFORM link2RSLFUS1                                         45587099
455880*                                                                 45588099
455890     COMPUTE wsGroupBlockSize = CSLFUS1-CGRP-BLOCK-COUNT * 24     45589099
455891*                                                                 45589199
455892*    Check first if technical user, as they are never subject to  45589299
455893*    2FA                                                          45589399
455894     MOVE 0 to wsGroupBlockPos                                    45589499
455895     INSPECT CSLFUS1-CGRP-BLOCK-LIST (1:wsGroupBlockSize)         45589599
455896             TALLYING wsGroupBlockPos                             45589699
455897             FOR CHARACTERS BEFORE '$TECUSER'                     45589799
455898     IF wsGroupBlockPos > 0 AND                                   45589899
455899        wsGroupBlockPos < wsGroupBlockSize                        45589999
455900        SET ITS-TECH-USER TO TRUE                                 45590099
455901     ELSE                                                         45590199
455902        SET NOT-TECH-USER TO TRUE                                 45590299
455903     END-IF                                                       45590399
455904     .                                                            45590499
455905*                                                                 45590599
455906 link2RSLFUS1.                                                    45590699
455907*                                                                 45590799
455908     EXEC CICS LINK PROGRAM ('RSLFUS1')                           45590899
455909          COMMAREA (RSLFUS1-COMMAREA)                             45590999
455910          LENGTH (LENGTH OF RSLFUS1-COMMAREA)                     45591099
455911     END-EXEC                                                     45591199
455912*                                                                 45591299
455913     IF EIBRESP NOT = DFHRESP (NORMAL)                            45591399
455914         PERFORM 033-INFORMAR-DATOS-ABEND                         45591499
455915     END-IF                                                       45591599
455916*                                                                 45591699
455917     IF CSLFUS1-RETCODE NOT = 'OK'                                45591799
455918        MOVE C-ERROR-MODULO TO L100-AQ1ABNCD                      45591899
455919        MOVE 'RSLFUS1'      TO L045-AQTXMENS (1)                  45591999
455920        MOVE CSLFUS1-FUNC-RETC1 TO wsCSLFUS1-FUNC-RETC1           45592099
455921        MOVE CSLFUS1-FUNC-RETC2 TO wsCSLFUS1-FUNC-RETC2           45592199
455922        STRING 'OPE: ' DELIMITED BY SIZE                          45592299
455923               CSLFUS1-OPE     DELIMITED BY SIZE                  45592399
455924               ' RETCODE: ' DELIMITED BY SIZE                     45592499
455925               CSLFUS1-RETCODE DELIMITED BY SIZE                  45592599
455926               ' RC1: ' DELIMITED BY SIZE                         45592699
455927               wsCSLFUS1-FUNC-RETC1 DELIMITED BY SIZE             45592799
455928               ' RC2: ' DELIMITED BY SIZE                         45592899
455929               wsCSLFUS1-FUNC-RETC2 DELIMITED BY SIZE             45592999
455930          INTO L045-AQTXMENS (2)                                  45593099
455931        SET SW-ABEND-ARQUITECTURAL TO TRUE                        45593199
455932        PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                    45593299
455933        PERFORM 099-ABEND-PROC                                    45593399
455934     END-IF                                                       45593499
455935     .                                                            45593599
455936*MACRO-E                                                          45593699
455937                                                                  45593799
455938*SIMU-I                                                           45593899
455939*----------------------------------------------------------------*45593999
455940 146-ALTA-TERMINAL-DESECHABLE.                                    45594099
455941*----------------------------                                     45594199
455942*                                                                 45594299
455943     INITIALIZE AREA-CAQL605                                      45594399
455944     SET L605-ALTA-TERMINAL TO TRUE                               45594499
455945     MOVE L100-AQ1TERML   TO  L605-AQCDTERM                       45594599
455946     MOVE L100-AQ1BANOP   TO  L605-AQ9ENTIN                       45594699
455947                              L605-AQ9ENTOP                       45594799
455948                              L605-AQNUENTI                       45594899
455949     MOVE L100-AQ1OFIOP   TO  L605-AQ9OFICI                       45594999
455950                              L605-AQ9OFICO                       45595099
455960                              L605-STOFICIN                       45596099
455970     MOVE 'A'             TO  L605-AQ9ESTAT                       45597099
455980     MOVE 9               TO  L605-AQ9TPUS                        45598099
455990     MOVE '000000'        TO  L605-AQ9FOPEX                       45599099
456000     MOVE L100-AQCDCANL   TO  L605-AQCDCANL                       45600099
456100     MOVE L100-AQTIPCON   TO  L605-AQCDPRDT                       45610099
456200     MOVE 9999            TO  L605-AQNULLOC                       45620099
456300     MOVE 0               TO  L605-AQCDDISP                       45630099
456400     MOVE 'NA'            TO  L605-AQTPPTO                        45640099
456500                                                                  45650099
456600     EXEC CICS LINK PROGRAM  ('RAQW605') COMMAREA (AREA-CAQL605)  45660099
456700          RESP (COD-RESP)                                         45670099
456800     END-EXEC                                                     45680099
456900                                                                  45690099
457000     IF COD-RESP NOT = DFHRESP (NORMAL)                           45700099
457100        PERFORM 033-INFORMAR-DATOS-ABEND                          45710099
457200     END-IF                                                       45720099
457300                                                                  45730099
457400     EVALUATE TRUE                                                45740099
457500        WHEN L605-CORRECTO                                        45750099
457600           CONTINUE                                               45760099
457700        WHEN OTHER                                                45770099
457800           MOVE 'JGTB143'         TO L100-AQ1ABNCD                45780099
457900           MOVE 'RAQW605'         TO L045-AQTXMENS (1)            45790099
458000           MOVE  L605-AQRCMAJ     TO L045-AQTXMENS (2)(1:2)       45800099
458100           MOVE  '/'              TO L045-AQTXMENS (2)(3:1)       45810099
458200           MOVE  L605-AQRCQUAL    TO L045-AQTXMENS (2)(4:2)       45820099
458300           SET SW-ABEND-ARQUITECTURAL TO TRUE                     45830099
458400           PERFORM 037-FORMATEAR-MENSAJE-VARIABLE                 45840099
458500           PERFORM 099-ABEND-PROC                                 45850099
458600     END-EVALUATE                                                 45860099
458700     .                                                            45870099
458800*SIMU-E                                                           45880099
458900                                                                  45890099
